cscope 15 $HOME/phd/experiments/alchemy-2/src/learnwts               0000262499
	@discriminativelearner.h

67 #iâdeà
DISCRIMINATIVE_LEARNER_H_OCT_30_2005


68 
	#DISCRIMINATIVE_LEARNER_H_OCT_30_2005


	)

70 
	~"šãr.h
"

71 
	~"şau£.h
"

72 
	~"tim”.h
"

73 
	~"šdexŒª¦©Ü.h
"

74 
	~"maxw®k§t.h
"

75 
	~"bp.h
"

77 cÚ¡ 
boŞ
 
	gdldebug
 = 
çl£
;

78 cÚ¡ 
	gEPSILON
 = .00001;

80 #iâdeà
PI


81 
	#PI
 3.14159265

	)

84 
	$dÙ´od
(cÚ¡ * 
v1
, cÚ¡ * 
v2
, 
dim
)

86 
tÙ®
 = 0.0;

87 
i
 = 0; i < 
dim
; i++)

88 
tÙ®
 +ğ
v1
[
i
] * 
v2
[i];

89  
tÙ®
;

90 
	}
}

92 
dÙ´od
(cÚ¡ * 
v1
, cÚ¡ 
A¼ay
<>& 
v2
, 
dim
)

94 
	gtÙ®
 = 0.0;

95 
	gi
 = 0; i < 
	gdim
; i++)

96 
	gtÙ®
 +ğ
v1
[
i
] * 
v2
[i];

97  
	gtÙ®
;

100 
dÙ´od
(cÚ¡ 
A¼ay
<>& 
v1
, cÚ¡ A¼ay<>& 
v2
, 
dim
)

102 
	gtÙ®
 = 0.0;

103 
	gi
 = 0; i < 
	gdim
; i++)

105 
	gtÙ®
 +ğ
v1
[
i
] * 
v2
[i];

107  
	gtÙ®
;

110 
	$vËn
(cÚ¡ * 
v1
, 
dim
)

111 {  
	`sq¹
(
	`dÙ´od
(
v1
,v1,
dim
)); 
	}
}

112 
vËn
(cÚ¡ 
A¼ay
<>& 
v1
, 
dim
)

113 {  
sq¹
(
dÙ´od
(
v1
,v1,
dim
)); }

115 
boŞ
 
	$isOuutI‹r
(
™”
)

117 
™”
 % 10 == 0)

118 
™”
 /= 10;

120 ià(
™”
 == 1 || iter == 2 || iter == 5)

121  
Œue
;

123  
çl£
;

124 
	}
}

133 şas 
	cDisüimš©iveL—º”


135 
	mpublic
:

158 
Disüimš©iveL—º”
(cÚ¡ 
A¼ay
<
Inã»nû
*>& 
šã»nûs
,

159 cÚ¡ 
SŒšgHashA¼ay
& 
nÚEvidP»dNames
,

160 
IndexT¿n¦©Ü
* cÚ¡ & 
idxT¿ns
,

161 cÚ¡ 
boŞ
& 
ÏzyInã»nû
, cÚ¡ boŞ& 
w™hEM
,

162 cÚ¡ 
A¼ay
<
Inã»nû
*>& 
emInã»nûs
,

163 cÚ¡ 
boŞ
& 
»sÿËG¿d›Á
, cÚ¡ & 
m‘hod
,

164 cÚ¡ & 
Ïmbda
, cÚ¡ 
boŞ
& 
´ecÚd™iÚCG
,

165 cÚ¡ & 
maxLambda
, cÚ¡ & 
mš_Î_chªge
)

166 : 
domašCÁ_
(
šã»nûs
.
size
()), 
idxT¿ns_
(
idxT¿ns
),

167 
ÏzyInã»nû_
(
ÏzyInã»nû
), 
»sÿËG¿d›Á_
(
»sÿËG¿d›Á
),

168 
m‘hod_
(
m‘hod
),

171 
cg_Ïmbda_
(
Ïmbda
), 
´ecÚd™iÚCG_
(
´ecÚd™iÚCG
),

172 
maxBackŒacks_
(1000), 
backŒackCouÁ_
(0),

173 
cg_max_Ïmbda_
(
maxLambda
), 
mš_Î_chªge_
(
mš_Î_chªge
), 
	$w™hEM_
(
w™hEM
)

175 
cout
 << 
’dl
 << "Constructing discriminative†earner..." <<ƒndl <<ƒndl;

177 
šã»nûs_
.
	`­³nd
(
šã»nûs
);

178 
emInã»nûs_
.
	`­³nd
(
emInã»nûs
);

179 
logOddsP”Domaš_
.
	`growToSize
(
domašCÁ_
);

180 
şau£CÁP”Domaš_
.
	`growToSize
(
domašCÁ_
);

182 
i
 = 0; i < 
domašCÁ_
; i++)

185 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

187 
şau£CÁP”Domaš_
[
i
] =

188 
bp_
->
	`g‘FaùÜG¿ph
()->
	`g‘MLN
()->
	`g‘NumCÏu£s
();

192 
şau£CÁP”Domaš_
[
i
] =

193 
šã»nûs_
[
i
]->
	`g‘S‹
()->
	`g‘MLN
()->
	`g‘NumCÏu£s
();

195 
logOddsP”Domaš_
[
i
].
	`growToSize
(
şau£CÁP”Domaš_
[i], 0);

198 
tÙ®TrueCÁs_
.
	`growToSize
(
domašCÁ_
);

199 
tÙ®F®£CÁs_
.
	`growToSize
(
domašCÁ_
);

200 
deçuÉTrueCÁs_
.
	`growToSize
(
domašCÁ_
);

201 
deçuÉF®£CÁs_
.
	`growToSize
(
domašCÁ_
);

202 
»ËvªtCÏu£sP”Domaš_
.
	`growToSize
(
domašCÁ_
);

205 
	`fšdR–evªtCÏu£s
(
nÚEvidP»dNames
);

206 
	`fšdR–evªtCÏu£sFÜmuÏs
();

209 
	`š™ŸlizeWts
(
nÚEvidP»dNames
);

212 
i
 = 0; i < 
šã»nûs_
.
	`size
(); i++)

215 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

221 
šã»nûs_
[
i
]->
	`š™
();

225 ià(
w™hEM_
)

228 
i
 = 0; i < 
emInã»nûs_
.
	`size
(); i++)

230 
V¬ŸbËS‹
* 
¡©e
 = 
šã»nûs_
[
i
]->
	`g‘S‹
();

231 cÚ¡ 
Domaš
* 
domaš
 = 
¡©e
->
	`g‘Domaš
();

232 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
kÃP»ds
 = 
¡©e
->
	`g‘KÃP»ds
();

233 cÚ¡ 
A¼ay
<
TruthV®ue
>* 
kÃP»dV®ues
 = 
¡©e
->
	`g‘KÃP»dV®ues
();

236 
domaš
->
	`g‘DB
()->
	`£tV®uesToGiv’V®ues
(
kÃP»ds
, 
kÃP»dV®ues
);

238 
emInã»nûs_
[
i
]->
	`š™
();

241 
A¼ay
<
TruthV®ue
> 
tmpV®ues
;

242 
tmpV®ues
.
	`growToSize
(
kÃP»ds
->
	`size
());

243 
domaš
->
	`g‘DB
()->
	`£tV®uesToUnknown
(
kÃP»ds
, &
tmpV®ues
);

248 ~
	$Disüimš©iveL—º”
()

250 
i
 = 0; i < 
ŒašTrueCÁs_
.
	`size
(); i++)

252 
d–‘e
[] 
ŒašTrueCÁs_
[
i
];

253 
d–‘e
[] 
ŒašF®£CÁs_
[
i
];

255 ià(
w™hEM_
)

257 
i
 = 0; i < 
emDiffCÁs_
.
	`size
(); i++)

259 
d–‘e
[] 
emDiffCÁs_
[
i
];

262 
	}
}

265 
	$£tM—nsStdDevs
(cÚ¡ & 
¬rSize
, cÚ¡ * cÚ¡ & 
´iÜM—ns
,

266 cÚ¡ * cÚ¡ & 
´iÜStdDevs
)

268 ià(
¬rSize
 < 0)

270 
u£PriÜ_
 = 
çl£
;

271 
´iÜM—ns_
 = 
NULL
;

272 
´iÜStdDevs_
 = 
NULL
;

277 
u£PriÜ_
 = 
Œue
;

278 
´iÜM—ns_
 = 
´iÜM—ns
;

279 
´iÜStdDevs_
 = 
´iÜStdDevs
;

285 
	}
}

288 
	$£tMLNWeights
(* cÚ¡& 
weights
)

291 ià(
idxT¿ns_
 =ğ
NULL
)

293 
şau£CÁ
 = 
şau£CÁP”Domaš_
[0];

294 
i
 = 0; i < 
domašCÁ_
; i++)

296 
	`as£¹
(
şau£CÁP”Domaš_
[
i
] =ğ
şau£CÁ
);

297 cÚ¡ 
MLN
* 
mÊ
;

300 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

302 
mÊ
 = 
bp_
->
	`g‘FaùÜG¿ph
()->
	`g‘MLN
();

306 
mÊ
 = 
šã»nûs_
[
i
]->
	`g‘S‹
()->
	`g‘MLN
();

312 
j
 = 0; j < 
şau£CÁ
; j++)

314 
CÏu£
* 
c
 = (CÏu£*è
mÊ
->
	`g‘CÏu£
(
j
);

315 
c
->
	`£tWt
(
weights
[
j
]);

321 
A¼ay
<A¼ay<> >* 
wtsP”Domaš
 = 
idxT¿ns_
->
	`g‘WtsP”Domaš
();

322 cÚ¡ 
A¼ay
<A¼ay<A¼ay<
IdxDiv
>*> >* 
cIdxToCFIdxsP”Domaš


323 ğ
idxT¿ns_
->
	`g‘CÏu£IdxToCÏu£FÜmuÏIdxsP”Domaš
();

325 
i
 = 0; i < 
domašCÁ_
; i++)

327 
A¼ay
<>& 
wts
 = (*
wtsP”Domaš
)[
i
];

328 
	`mem£t
((*)
wts
.
	`g‘I‹ms
(), 0, wts.
	`size
()*());

331 
j
 = 0; j < 
wts
.
	`size
(); j++)

333 
A¼ay
<
IdxDiv
>* 
idxDivs
 = (*
cIdxToCFIdxsP”Domaš
)[
i
][
j
];

334 
k
 = 0; k < 
idxDivs
->
	`size
(); k++)

335 
wts
[
j
] +ğ
weights
[ (*
idxDivs
)[
k
].
idx
 ] / (*idxDivs)[k].
div
;

339 
i
 = 0; i < 
domašCÁ_
; i++)

341 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£s
 = 
»ËvªtCÏu£sP”Domaš_
[
i
];

342 
şau£CÁ
 = 
şau£CÁP”Domaš_
[
i
];

343 
A¼ay
<>& 
wts
 = (*
wtsP”Domaš
)[
i
];

344 
	`as£¹
(
wts
.
	`size
(è=ğ
şau£CÁ
);

345 cÚ¡ 
MLN
* 
mÊ
;

348 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

350 
mÊ
 = 
bp_
->
	`g‘FaùÜG¿ph
()->
	`g‘MLN
();

354 
mÊ
 = 
šã»nûs_
[
i
]->
	`g‘S‹
()->
	`g‘MLN
();

357 
j
 = 0; j < 
şau£CÁ
; j++)

359 
CÏu£
* 
c
 = (CÏu£*è
mÊ
->
	`g‘CÏu£
(
j
);

360 ià(
»ËvªtCÏu£s
[
j
]è
c
->
	`£tWt
(
wts
[j]);

361 
c
->
	`£tWt
(0);

365 
	}
}

368 
	$£tLogOddsWeights
(* 
weights
, 
numWeights
)

371 ià(
idxT¿ns_
 =ğ
NULL
)

373 
i
 = 0; i < 
domašCÁ_
; i++)

375 
A¼ay
<>& 
logOdds
 = 
logOddsP”Domaš_
[
i
];

376 
	`as£¹
(
numWeights
 =ğ
logOdds
.
	`size
());

377 
j
 = 0; j < 
logOdds
.
	`size
(); j++è
weights
[j] +=†ogOdds[j];

382 cÚ¡ 
A¼ay
<A¼ay<A¼ay<
IdxDiv
>*> >* 
cIdxToCFIdxsP”Domaš


383 ğ
idxT¿ns_
->
	`g‘CÏu£IdxToCÏu£FÜmuÏIdxsP”Domaš
();

385 
A¼ay
<> 
numLogOdds
;

386 
A¼ay
<> 
wtsFÜDomaš
;

387 
numLogOdds
.
	`growToSize
(
numWeights
);

388 
wtsFÜDomaš
.
	`growToSize
(
numWeights
);

390 
i
 = 0; i < 
domašCÁ_
; i++)

392 
	`mem£t
((*)
numLogOdds
.
	`g‘I‹ms
(), 0,‚umLogOdds.
	`size
()*());

393 
	`mem£t
((*)
wtsFÜDomaš
.
	`g‘I‹ms
(), 0,

394 
wtsFÜDomaš
.
	`size
()*());

396 
A¼ay
<>& 
logOdds
 = 
logOddsP”Domaš_
[
i
];

400 
j
 = 0; j < 
logOdds
.
	`size
(); j++)

402 
A¼ay
<
IdxDiv
>* 
idxDivs
 =(*
cIdxToCFIdxsP”Domaš
)[
i
][
j
];

403 
k
 = 0; k < 
idxDivs
->
	`size
(); k++)

405 
wtsFÜDomaš
[ (*
idxDivs
)[
k
].
idx
 ] +ğ
logOdds
[
j
];

406 
numLogOdds
[ (*
idxDivs
)[
k
].
idx
 ]++;

410 
j
 = 0; j < 
numWeights
; j++)

411 ià(
numLogOdds
[
j
] > 0è
weights
[j] +ğ
wtsFÜDomaš
[j]/numLogOdds[j];

415 
i
 = 0; i < 
numWeights
; i++)

416 
weights
[
i
] /ğ
domašCÁ_
;

417 
	}
}

420 
	$£tRªdGaussWeights
(* 
weights
, 
numWeights
, cÚ¡ * 
m—ns
,

421 cÚ¡ * 
¡devs
)

423 ià(
dldebug
è
cout
 << "S‘tšg„ªdom weights: " << 
’dl
;

424 
i
 = 0; i < 
numWeights
; i++)

426 
weights
[
i
] = 
ExtRªdom
::
	`gaussRªdom
(
m—ns
[i], 
¡devs
[i]);

427 
cout
 << 
weights
[
i
] << 
’dl
;

429 
	}
}

431 
	$£tRªdomWeights
(* 
weights
, 
numWeights
, cÚ¡ & 
mš
,

432 cÚ¡ & 
max
)

434 ià(
dldebug
è
cout
 << "S‘tšg„ªdom weights: " << 
’dl
;

435 
i
 = 0; i < 
numWeights
; i++)

437 
weights
[
i
] = (
max
 - 
mš
)*()
	`¿nd
()/()
RAND_MAX
 + min;

438 
cout
 << 
weights
[
i
] << 
’dl
;

440 
	}
}

443 
g‘V¬Ÿnû
(
A¼ay
<>& 
v¬Ÿnû
, 
numWeights
)

445 ià(
	gdldebug
)

446 
	gcout
 << "V¬Ÿnûs:" << 
	g’dl
;

449 
	gşau£no
 = 0; cÏu£nØ< 
	gnumWeights
; clauseno++)

451 
	gv¬Ÿnû
[
şau£no
] = 0.0;

454 ià(
	gu£PriÜ_
)

456 
	gsd
 = 
´iÜStdDevs_
[
şau£no
];

457 
	gv¬Ÿnû
[
şau£no
] = 1.0/(
sd
 * sd);

461 
	gi
 = 0; i < 
	gdomašCÁ_
; i++)

463 cÚ¡ 
	gA¼ay
<>* 
	gŒueCÁs
 = 
šã»nûs_
[
i
]->
g‘CÏu£TrueCÁs
();

464 cÚ¡ 
	gA¼ay
<>* 
	gŒueSqCÁs
 = 
šã»nûs_
[
i
]->
g‘CÏu£TrueSqCÁs
();

465 
	gtÙ®Sam¶es
 = 
šã»nûs_
[
i
]->
g‘NumSam¶es
();

467 
	gx
 = (*
ŒueCÁs
)[
şau£no
];

468 
	gxsq
 = (*
ŒueSqCÁs
)[
şau£no
];

469 
	gn
 = 
tÙ®Sam¶es
;

472 
	gv¬Ÿnû
[
şau£no
] +ğ
xsq
/
n
 - (
x
/n)*(x/n);

475 ià(
	gdldebug
)

476 
	gcout
 << 
	gşau£no
 << ": " << 
	gv¬Ÿnû
[
şau£no
] << 
	g’dl
;

481 cÚ¡ 
	gA¼ay
<>* 
g‘HessŸnVeùÜProduù
(cÚ¡ 
A¼ay
<>& 
d
)

484 cÚ¡ 
	gA¼ay
<>* 
	gHd
 = 
šã»nûs_
[0]->
g‘HessŸnVeùÜProduù
(
d
);

485 
	gi
 = 1; i < 
	gdomašCÁ_
; i++)

487 cÚ¡ 
	gA¼ay
<>* 
	gHd_i
 = 
šã»nûs_
[
i
]->
g‘HessŸnVeùÜProduù
(
d
);

488 
	gj
 = 0; j < 
	gHd
->
size
(); j++)

489 (*
	gHd
)[
j
] +ğ(*
Hd_i
)[j];

490 
d–‘e
 
	gHd_i
;

493  
	gHd
;

497 
compu‹Quad¿ticS‹pL’gth
(* 
g¿d›Á
, cÚ¡ 
A¼ay
<>& 
d
,

498 cÚ¡ 
A¼ay
<>* 
Hd
, 
Ïmbda
)

500 
	gnumWeights
 = 
d
.
size
();

503 
	gdHd
 = 
dÙ´od
(
d
, (*
Hd
), 
numWeights
);

504 
	gdd
 = 
dÙ´od
(
d
, d, 
numWeights
);

505 
	gdg
 = 
dÙ´od
(
g¿d›Á
, 
d
, 
numWeights
);

506 
	g®pha
 = -
dg
/(
dHd
 + 
Ïmbda
 * 
dd
);

509 ià(
	gdldebug
)

511 
	gcout
 << "dHd = " << 
	gdHd
 << 
	g’dl
;

512 
	gcout
 << "dd = " << 
	gdd
 << 
	g’dl
;

513 
	gcout
 << "dg = " << 
	gdg
 << 
	g’dl
;

514 
	gcout
 << "®ph¨ğ" << 
	g®pha
 << 
	g’dl
;

523 ià(
	g®pha
 < 0.0)

526 ià(
	gdldebug
)

528 
	gcout
 << "AÍh¨< 0! Bad dœeùiÚ o¸HessŸn." << 
	g’dl
;

533  
	g®pha
;

538 
	$Ë¬nWeights
(* cÚ¡ & 
weights
, cÚ¡ & 
numWeights
,

539 cÚ¡ & 
maxI‹r
, cÚ¡ & 
maxSec
,

540 cÚ¡ & 
Ë¬nšgR©e
, cÚ¡ & 
mom’tum
,

541 
boŞ
 
š™W™hLogOdds
, cÚ¡ & 
mwsMaxSub£qu’tS‹ps
,

542 
boŞ
 
³riodicMLNs
)

544 
Tim”
 
tim”
;

545 
begSec
 = 
tim”
.
	`time
();

548 
	`mem£t
(
weights
, 0, 
numWeights
*());

550 * 
av”ageWeights
 = 
Ãw
 [
numWeights
];

551 * 
g¿d›Á
 = 
Ãw
 [
numWeights
];

554 cÚ¡ 
A¼ay
<>* 
d–_´ed
 = 
NULL
;

555 cÚ¡ 
A¼ay
<>* 
Hd
 = 
NULL
;

558 
®pha
 = 1;

559 
A¼ay
<> 
	`d
(
numWeights
, 0.0);

560 
Şdg¿d›Á
[
numWeights
];

561 
A¼ay
<> 
	`Şdd
(
numWeights
, 0.0);

566 ià(
š™W™hLogOdds
)

567 
	`£tLogOddsWeights
(
weights
, 
numWeights
);

568 ià(
w™hEM_
)

571 ià(
u£PriÜ_
)

572 
	`£tRªdGaussWeights
(
weights
, 
numWeights
, 
´iÜM—ns_
, 
´iÜStdDevs_
);

574 
	`£tRªdomWeights
(
weights
, 
numWeights
, -1.0, 1.0);

578 cÚ¡ 
MLN
* 
mÊ
 = 
šã»nûs_
[0]->
	`g‘S‹
()->
	`g‘MLN
();

579 
i
=0; i<
numWeights
; i++) {

580 cÚ¡ 
CÏu£
* 
şau£
=
mÊ
->
	`g‘CÏu£
(
i
);

581 ià(
şau£
->
	`isH¬dCÏu£
()) {

582 
weights
[
i
]=10;

587 
	`memıy
(
av”ageWeights
, 
weights
, 
numWeights
*());

591 
i
 = 0; i < 
domašCÁ_
; i++)

592 
šã»nûs_
[
i
]->
	`§veAÎCouÁs
(
Œue
);

595 
A¼ay
<> 
	`cu¼V¬Ÿnû
(
numWeights
, 0);

598 
A¼ay
<> 
	`Şdweights
(
numWeights
, 0.0);

602 
boŞ
 
backŒacked
 = 
çl£
;

606 
™”
 = 1; i‹¸<ğ
maxI‹r
; iter++)

608 
cout
 << 
’dl
 << "I‹¿tiÚ " << 
™”
 << " : " <<ƒndl <<ƒndl;

610 
tÙ®£c
 = 
tim”
.
	`time
(è- 
begSec
;

611 
hour
 = ()
tÙ®£c
/3600;

612 
mš
 = ()(
tÙ®£c
 - 3600*
hour
)/60;

613 
£c
 = ()(
tÙ®£c
 - 3600*
hour
 - 60*
mš
);

616 
cout
 << "EÏp£dime: " << 
tÙ®£c
 << "s";

617 ià(
hour
 > 0)

618 
cout
 << " (" << 
hour
 << "h " << 
mš
 << "m " << 
£c
 << "s)";

619 ià(
mš
 > 0)

620 
cout
 << " (" << 
mš
 << "m " << 
£c
 << "s)";

621 
cout
 << 
’dl
;

623 ià(
maxSec
 > 0 && 
tÙ®£c
 > maxSec)

625 
cout
 << "Timlim™ƒxûeded. Stİpšg†—ºšg." << 
’dl
;

631 ià(
™”
 == 3)

633 
i
 = 0; i < 
šã»nûs_
.
	`size
(); i++)

636 ià(
MaxW®kS©
* 
mws
 = 
dyÇmic_ÿ¡
<MaxW®kS©*>(
šã»nûs_
[
i
]))

638 
mws
->
	`£tMaxS‹ps
(
mwsMaxSub£qu’tS‹ps
);

644 
tcouÁs
[
numWeights
];

645 
tcouÁsTÙ®
[
numWeights
];

646 
icouÁs
[
numWeights
];

647 
icouÁsTÙ®
[
numWeights
];

651 
	`£tMLNWeights
(
weights
);

653 ià(
w™hEM_
è
	`flInMissšgV®ues
();

654 
cout
 << "RuÂšg inã»nû ..." << 
’dl
;

655 
	`šãr
();

656 
cout
 << "DÚw™h inã»nû" << 
’dl
;

658 
cout
 << "G‘tšg g¿d›Á..." << 
’dl
;

661 
	`g‘G¿d›Á
(
weights
, 
g¿d›Á
, 
numWeights
);

663 
»®di¡
 = 1.0;

664 
´eddi¡
 = 1.0;

665 ià(
™”
 > 1 && 
d–_´ed
 !ğ
NULL
 && !
backŒacked
)

667 
A¼ay
<> 
	`di¡
(
numWeights
, 0.0);

668 
i
 = 0; i < 
numWeights
; i++)

669 
di¡
[
i
] = 
weights
[i] - 
Şdweights
[i];

677 
A¼ay
<> 
	`avgP»d
(
numWeights
);

678 
avgP»d
.
	`growToSize
(
numWeights
);

679 
i
 = 0; i < 
numWeights
; i++)

680 
avgP»d
[
i
] = 
Şdg¿d›Á
[i] + (*
d–_´ed
)[i]/2.0;

681 
´eddi¡
 = 
	`dÙ´od
(
avgP»d
, 
di¡
, 
numWeights
);

684 
»®di¡
 = 
	`dÙ´od
(
g¿d›Á
, 
di¡
, 
numWeights
);

690 
A¼ay
<> 
	`´edg¿d›Á
(
numWeights
, 0.0);

691 
i
 = 0; i < 
numWeights
; i++)

692 
´edg¿d›Á
[
i
] = 
Şdg¿d›Á
[i] + (*
d–_´ed
)[i];

694 
´eddi¡
 = 
	`dÙ´od
(
´edg¿d›Á
, 
di¡
, 
numWeights
);

695 
»®di¡
 = 
	`dÙ´od
(
g¿d›Á
, 
di¡
, 
numWeights
);

701 
A¼ay
<> 
	`d–_aùu®
(
numWeights
, 0.0);

702 
i
 = 0; i < 
numWeights
; i++)

703 
d–_aùu®
[
i
] = 
g¿d›Á
[i] - 
Şdg¿d›Á
[i];

705 
´eddi¡
 = 
	`dÙ´od
(*
d–_´ed
, 
di¡
, 
numWeights
);

706 
»®di¡
 = 
	`dÙ´od
(
d–_aùu®
, 
di¡
, 
numWeights
);

712 
A¼ay
<> 
	`avgP»d
(
numWeights
, 0.0);

713 
A¼ay
<> 
	`avgAùu®
(
numWeights
, 0.0);

714 
i
 = 0; i < 
numWeights
; i++)

716 
avgP»d
[
i
] = 
Şdg¿d›Á
[i] + (*
d–_´ed
)[i]/2.0;

717 
avgAùu®
[
i
] = (
Şdg¿d›Á
[i] + 
g¿d›Á
[i])/2.0;

720 
´eddi¡
 = 
	`dÙ´od
(
avgP»d
, 
di¡
, 
numWeights
);

721 
»®di¡
 = 
	`dÙ´od
(
avgAùu®
, 
di¡
, 
numWeights
);

725 
cout
 << "P»d*di¡ = " << 
´eddi¡
 << 
’dl
;

726 
cout
 << "R—l*di¡ = " << 
»®di¡
 << 
’dl
;

727 ià(
´eddi¡
 > 0)

728 
cout
 << "Di¡¿tiØğ" << 
»®di¡
/
´eddi¡
 << 
’dl
;

731 ià(
™”
 > 1 && (
m‘hod_
 =ğ
CG
 || m‘hod_ =ğ
DN
))

735 
d–
 = 
»®di¡
/
´eddi¡
;

737 ià(!
backŒacked
 && 
´eddi¡
 == 0)

738 
cg_Ïmbda_
 /= 4;

746 ià(
d–
 > 0.75 && delta < 1.333)

747 
cg_Ïmbda_
 /= 2;

748 ià(
d–
 < 0.25 || delta > 4.0)

750 ià(
cg_Ïmbda_
 * 4 > 
cg_max_Ïmbda_
)

751 
cg_Ïmbda_
 = 
cg_max_Ïmbda_
;

753 
cg_Ïmbda_
 *= 4;

756 ià(!
backŒacked
 && 
´eddi¡
 !ğ0 && 
d–
 > 0.75)

757 
cg_Ïmbda_
 /= 2;

759 ià(
d–
 < 0.0)

761 ià(
cg_Ïmbda_
 * 4 > 
cg_max_Ïmbda_
)

762 
cg_Ïmbda_
 = 
cg_max_Ïmbda_
;

764 
cg_Ïmbda_
 *= 4;

767 
cout
 << "Lambd¨ğ" << 
cg_Ïmbda_
 << 
’dl
;

769 ià(
d–
 < 0.0 && 
backŒackCouÁ_
 < 
maxBackŒacks_
)

771 
cout
 << "BackŒackšg!" << 
’dl
;

772 
™”
--;

774 
Şd®pha
 = 
®pha
;

775 
®pha
 = 
	`compu‹Quad¿ticS‹pL’gth
(
Şdg¿d›Á
, 
d
, 
Hd
, 
cg_Ïmbda_
);

776 
i
 = 0; i < 
numWeights
; i++)

778 
weights
[
i
] = 
Şdweights
[i] + 
®pha
 * 
d
[i];

779 (*
d–_´ed
)[
i
] *ğ
®pha
/
Şd®pha
;

782 
i
 = 0; i < 
numWeights
; i++)

783 
weights
[
i
] = 
Şdweights
[i];

786 
i
 = 0; i < 
domašCÁ_
; i++)

787 
šã»nûs_
[
i
]->
	`»¡ÜeCÁs
();

789 
backŒacked
 = 
Œue
;

790 
backŒackCouÁ_
++;

794 
backŒacked
 = 
çl£
;

795 
backŒackCouÁ_
 = 0;

799 ià(!
backŒacked
)

801 
i
 = 0; i < 
domašCÁ_
; i++)

802 
šã»nûs_
[
i
]->
	`§veCÁs
();

808 ià(!
backŒacked
)

810 
i
 = 0; i < 
numWeights
; i++)

813 
´iÜCouÁs
 = 1.0;

814 
tcouÁs
[
i
] +ğ
´iÜCouÁs
;

815 
tcouÁsTÙ®
[
i
] +ğ
´iÜCouÁs
 * 2.0;

816 
icouÁs
[
i
] +ğ
´iÜCouÁs
;

817 
icouÁsTÙ®
[
i
] +ğ
´iÜCouÁs
 * 2.0;

820 
sd
 = 
´iÜStdDevs_
[
i
];

821 
efãùiveCouÁs
 = 
tcouÁs
[
i
] -

822 (
weights
[
i
] - 
´iÜM—ns_
[i])/(
sd
*sd);

824 ià(
tcouÁsTÙ®
[
i
] == 0)

827 
p
 = 
efãùiveCouÁs
/
tcouÁsTÙ®
[
i
];

828 ià(
p
 < 0.0) {… = 0.0; }

829 ià(
p
 > 1.0) {… = 1.0; }

830 
cdf
 =

833 ià(
cdf
 < 0.05 || cdf > 0.95)

836 
cout
 << "˜ğ" << 
i
 << 
’dl
;

837 
cout
 << "tc' = " << 
efãùiveCouÁs
 << 
’dl
;

838 
cout
 << "tøğ" << 
tcouÁs
[
i
] << ";ù = " << 
tcouÁsTÙ®
[i] << 
’dl
;

839 
cout
 << "iøğ" << 
icouÁs
[
i
] << "; iù = " << 
icouÁsTÙ®
[i] << 
’dl
;

840 
cout
 << "Ba£…rob: " << 
p
 << 
’dl
;

841 
cout
 << "Inã¼ed…rob: " << ()
icouÁs
[
i
]/
icouÁsTÙ®
[i] << 
’dl
;

842 
cout
 << "cdàğ" << 
cdf
 << 
’dl
;

844 
™”sSšûSignifiÿÁ
 = 0;

851 
™”sSšûSignifiÿÁ
++;

852 ià(
™”sSšûSignifiÿÁ
 > 10)

854 
cout
 << "No significant difference in‡ny dimension‡fter "

865 ià(
m‘hod_
 =ğ
CG
 && !
backŒacked
)

868 
A¼ay
<> 
	`´ecÚd
(
numWeights
, 1.0);

871 ià(
´ecÚd™iÚCG_
)

873 
A¼ay
<> 
	`v¬Ÿnû
(
numWeights
, 0.0);

874 
	`g‘V¬Ÿnû
(
v¬Ÿnû
, 
numWeights
);

876 
şau£no
 = 0; cÏu£nØ< 
numWeights
; clauseno++)

877 
´ecÚd
[
şau£no
] = 1.0/
v¬Ÿnû
[clauseno];

881 
b‘a
 = 0.0;

887 
b‘a_num
 = 0.0;

888 
b‘a_d’om
 = 0.0;

890 ià(
™”
 > 1)

892 
i
 = 0; i < 
numWeights
; i++)

894 
b‘a_num
 +ğ
g¿d›Á
[
i
] * 
´ecÚd
[i]

895 * (
g¿d›Á
[
i
] - 
Şdg¿d›Á
[i]);

896 
b‘a_d’om
 +ğ
Şdg¿d›Á
[
i
] * 
´ecÚd
[i] * oldgradient[i];

898 
b‘a
 = 
b‘a_num
/
b‘a_d’om
;

901 
b‘a
 = 0.0;

903 ià(
dldebug
)

904 
cout
 << "B‘¨ğ" << 
b‘a
 << 
’dl
;

907 
w
 = 0; w < 
numWeights
; w++)

908 
d
[
w
] = -
´ecÚd
[w]*
g¿d›Á
[w] + 
b‘a
*
Şdd
[w];

910 
d–‘e
 
Hd
;

911 
Hd
 = 
	`g‘HessŸnVeùÜProduù
(
d
);

912 
®pha
 = 
	`compu‹Quad¿ticS‹pL’gth
(
g¿d›Á
, 
d
, 
Hd
, 
cg_Ïmbda_
);

916 ià(
®pha
 < 0.0)

918 
w
 = 0; w < 
numWeights
; w++)

919 
d
[
w
] = -
´ecÚd
[w]*
g¿d›Á
[w];

921 
d–‘e
 
Hd
;

922 
Hd
 = 
	`g‘HessŸnVeùÜProduù
(
d
);

923 
®pha
 = 
	`compu‹Quad¿ticS‹pL’gth
(
g¿d›Á
, 
d
, 
Hd
, 
cg_Ïmbda_
);

929 ià(
m‘hod_
 =ğ
DN
 && !
backŒacked
)

931 
A¼ay
<> 
	`v¬Ÿnû
(
numWeights
, 0.0);

932 
	`g‘V¬Ÿnû
(
v¬Ÿnû
, 
numWeights
);

934 
w
 = 0; w < 
numWeights
; w++)

936 ià(
	`çbs
(
g¿d›Á
[
w
]) < 0.00000001)

937 
g¿d›Á
[
w
] = 0;

938 
d
[
w
] = -
g¿d›Á
[w]/
v¬Ÿnû
[w];

941 
d–‘e
 
Hd
;

942 
Hd
 = 
	`g‘HessŸnVeùÜProduù
(
d
);

943 
®pha
 = 
	`compu‹Quad¿ticS‹pL’gth
(
g¿d›Á
, 
d
, 
Hd
, 
cg_Ïmbda_
);

947 ià(
m‘hod_
 =ğ
SIMPLE
)

950 
w
 = 0; w < 
numWeights
; w++)

951 
d
[
w
] = -
g¿d›Á
[w];

954 
®pha
 = 
Ë¬nšgR©e
;

957 ià(!
backŒacked
 && 
®pha
 <= 0.0)

962 
backŒacked
 = 
Œue
;

963 
™”
--;

966 ià(!
backŒacked
)

969 
A¼ay
<> 
	`wchªge
(
numWeights
, 0.0);

970 
w
 = 0; w < 
numWeights
; w++) {

971 cÚ¡ 
CÏu£
* 
şau£
=
mÊ
->
	`g‘CÏu£
(
w
);

972 ià(
şau£
->
	`isH¬dCÏu£
()) ;

973 
wchªge
[
w
] = 
d
[w] * 
®pha
 + (
weights
[w] - 
Şdweights
[w]è* 
mom’tum
;

979 
maxchªge
 = -
	`dÙ´od
(
g¿d›Á
, 
wchªge
, 
numWeights
);

980 
cout
 << "Maximumƒ¡im©ed im´ovem’t: " << 
maxchªge
 << 
’dl
;

981 ià((
m‘hod_
 =ğ
CG
 || m‘hod_ =ğ
DN
) &&

982 
maxchªge
 < 
mš_Î_chªge_
)

984 
cout
 << "Uµ” bound i Ës thª " << 
mš_Î_chªge_


985 << "; h®tšg†—ºšg." << 
’dl
;

990 
w
 = 0; w < 
numWeights
; w++)

992 
Şdweights
[
w
] = 
weights
[w];

993 
Şdd
[
w
] = 
d
[w];

994 
Şdg¿d›Á
[
w
] = 
g¿d›Á
[w];

996 
weights
[
w
] +ğ
wchªge
[w];

997 
av”ageWeights
[
w
] = ((
™”
-1è*‡v”ageWeights[w] + 
weights
[w])/iter;

1001 
d–‘e
 
d–_´ed
;

1002 
d–_´ed
 = 
	`g‘HessŸnVeùÜProduù
(
wchªge
);

1008 
i
 = 0; i < 
domašCÁ_
; i++)

1009 
šã»nûs_
[
i
]->
	`»£tCÁs
();

1012 
boŞ
 
´št
 = !
backŒacked
 && (!
³riodicMLNs
 || 
	`isOuutI‹r
(
™”
));

1013 ià(
´št
)

1015 
cout
 << "Weights:\tNew\t\tAverage\n";

1016 
w
 = 0; w < 
numWeights
; w++)

1017 
cout
 << 
w
 << ":\t\t" << 
weights
[w] << "\t\t"

1018 << 
av”ageWeights
[
w
] << 
’dl
;

1024 
cout
 << 
’dl
 << "Learned Weights : " <<ƒndl;

1025 
w
 = 0; w < 
numWeights
; w++)

1028 ià(
dyÇmic_ÿ¡
<
MaxW®kS©
*>(
šã»nûs_
[0]))

1030 
weights
[
w
] = 
av”ageWeights
[w];

1032 
cout
 << 
w
 << ":" << 
weights
[w] << 
’dl
;

1035 
d–‘e
 [] 
av”ageWeights
;

1036 
d–‘e
 [] 
g¿d›Á
;

1038 
	`»£tDBs
();

1039 
	}
}

1042 
	g´iv©e
:

1047 
	$»£tDBs
()

1049 ià(!
ÏzyInã»nû_
)

1051 
i
 = 0; i < 
domašCÁ_
; i++)

1054 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

1059 
V¬ŸbËS‹
* 
¡©e
 = 
šã»nûs_
[
i
]->
	`g‘S‹
();

1060 
D©aba£
* 
db
 = 
¡©e
->
	`g‘Domaš
()->
	`g‘DB
();

1062 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
kÃP»ds
 = 
¡©e
->
	`g‘KÃP»ds
();

1063 cÚ¡ 
A¼ay
<
TruthV®ue
>* 
kÃP»dV®ues
 = 
¡©e
->
	`g‘KÃP»dV®ues
();

1064 
db
->
	`£tV®uesToGiv’V®ues
(
kÃP»ds
, 
kÃP»dV®ues
);

1066 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
uÃP»ds
 = 
¡©e
->
	`g‘UÃP»ds
();

1067 
´edno
 = 0;…»dnØ< 
uÃP»ds
->
	`size
();…redno++)

1068 
db
->
	`£tV®ue
((*
uÃP»ds
)[
´edno
], 
UNKNOWN
);

1071 
	}
}

1078 
	$fšdR–evªtCÏu£s
(cÚ¡ 
SŒšgHashA¼ay
& 
nÚEvidP»dNames
)

1080 
d
 = 0; d < 
domašCÁ_
; d++)

1082 
şau£CÁ
 = 
şau£CÁP”Domaš_
[
d
];

1083 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£s
 = 
»ËvªtCÏu£sP”Domaš_
[
d
];

1084 
»ËvªtCÏu£s
.
	`growToSize
(
şau£CÁ
);

1085 
	`mem£t
((
boŞ
*)
»ËvªtCÏu£s
.
	`g‘I‹ms
(), 
çl£
,

1086 
»ËvªtCÏu£s
.
	`size
()*(
boŞ
));

1087 cÚ¡ 
Domaš
* 
domaš
;

1088 cÚ¡ 
MLN
* 
mÊ
;

1091 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
d
])))

1093 
domaš
 = 
bp_
->
	`g‘FaùÜG¿ph
()->
	`g‘Domaš
();

1094 
mÊ
 = 
bp_
->
	`g‘FaùÜG¿ph
()->
	`g‘MLN
();

1098 
domaš
 = 
šã»nûs_
[
d
]->
	`g‘S‹
()->
	`g‘Domaš
();

1099 
mÊ
 = 
šã»nûs_
[
d
]->
	`g‘S‹
()->
	`g‘MLN
();

1102 cÚ¡ 
A¼ay
<
IndexCÏu£
*>* 
šdşau£s
;

1103 cÚ¡ 
CÏu£
* 
şau£
;

1104 
´edid
, 
şau£id
;

1105 
i
 = 0; i < 
nÚEvidP»dNames
.
	`size
(); i++)

1107 
´edid
 = 
domaš
->
	`g‘P»diÿ‹Id
(
nÚEvidP»dNames
[
i
].
	`c_¡r
());

1110 
šdşau£s
 = 
mÊ
->
	`g‘CÏu£sCÚššgP»d
(
´edid
);

1111 ià(
šdşau£s
)

1113 
j
 = 0; j < 
šdşau£s
->
	`size
(); j++)

1115 
şau£
 = (*
šdşau£s
)[
j
]->clause;

1116 
şau£id
 = 
mÊ
->
	`fšdCÏu£Idx
(
şau£
);

1119 ià(!
mÊ
->
	`isEx‹º®CÏu£
(
şau£id
))

1120 
»ËvªtCÏu£s
[
şau£id
] = 
Œue
;

1125 
	}
}

1128 
	$fšdR–evªtCÏu£sFÜmuÏs
()

1130 ià(
idxT¿ns_
 =ğ
NULL
)

1132 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£s
 = 
»ËvªtCÏu£sP”Domaš_
[0];

1133 
»ËvªtCÏu£sFÜmuÏs_
.
	`growToSize
(
»ËvªtCÏu£s
.
	`size
());

1134 
i
 = 0; i < 
»ËvªtCÏu£s
.
	`size
(); i++)

1135 
»ËvªtCÏu£sFÜmuÏs_
[
i
] = 
»ËvªtCÏu£s
[i];

1139 
idxT¿ns_
->
	`£tR–evªtCÏu£sFÜmuÏs
(
»ËvªtCÏu£sFÜmuÏs_
,

1140 
»ËvªtCÏu£sP”Domaš_
[0]);

1141 
cout
 << "R–evªˆşau£s/fÜmuÏs:" << 
’dl
;

1142 
idxT¿ns_
->
	`´štR–evªtCÏu£sFÜmuÏs
(
cout
, 
»ËvªtCÏu£sFÜmuÏs_
);

1143 
cout
 << 
’dl
;

1145 
	}
}

1157 
ÿlcuÏ‹CouÁs
(
A¼ay
<>& 
ŒueCÁ
, A¼ay<>& 
çl£CÁ
,

1158 cÚ¡ & 
domašIdx
, cÚ¡ 
boŞ
& 
hasUnknownP»ds
)

1160 
CÏu£
* 
	gşau£
;

1161 
	gtmpUnknownCÁ
;

1162 
	gşau£CÁ
 = 
şau£CÁP”Domaš_
[
domašIdx
];

1163 
	gA¼ay
<
	gboŞ
>& 
	g»ËvªtCÏu£s
 = 
»ËvªtCÏu£sP”Domaš_
[
domašIdx
];

1164 cÚ¡ 
Domaš
* 
	gdomaš
;

1165 cÚ¡ 
MLN
* 
	gmÊ
;

1168 ià((
	gbp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
domašIdx
])))

1170 
domaš
 = 
bp_
->
g‘FaùÜG¿ph
()->
g‘Domaš
();

1171 
	gmÊ
 = 
bp_
->
g‘FaùÜG¿ph
()->
g‘MLN
();

1175 
	gdomaš
 = 
šã»nûs_
[
domašIdx
]->
g‘S‹
()->
g‘Domaš
();

1176 
	gmÊ
 = 
šã»nûs_
[
domašIdx
]->
g‘S‹
()->
g‘MLN
();

1180 
	gşau£no
 = 0; cÏu£nØ< 
	gşau£CÁ
; clauseno++)

1182 ià(!
	g»ËvªtCÏu£s
[
şau£no
])

1187 
	gşau£
 = (
CÏu£
*è
mÊ
->
g‘CÏu£
(
şau£no
);

1188 
	gşau£
->
g‘NumTrueF®£UnknownGroundšgs
(
domaš
, domaš->
g‘DB
(),

1189 
hasUnknownP»ds
,

1190 
ŒueCÁ
[
şau£no
],

1191 
çl£CÁ
[
şau£no
],

1192 
tmpUnknownCÁ
);

1193 
as£¹
(
hasUnknownP»ds
 || (
tmpUnknownCÁ
==0));

1205 
	$š™ŸlizeWts
(cÚ¡ 
SŒšgHashA¼ay
& 
nÚEvidP»dNames
)

1207 
cout
 << "In™Ÿlizšg weight ..." << 
’dl
;

1209 
boŞ
 
hasUnknownP»ds
;

1211 
A¼ay
<
P»diÿ‹
*> 
g´eds
;

1212 
A¼ay
<
P»diÿ‹
*> 
µ»ds
;

1213 
A¼ay
<
TruthV®ue
> 
g´edV®ues
;

1214 
A¼ay
<
TruthV®ue
> 
tmpV®ues
;

1216 ià(!
ÏzyInã»nû_
)

1218 
ŒašTrueCÁs_
.
	`growToSize
(
domašCÁ_
);

1219 
ŒašF®£CÁs_
.
	`growToSize
(
domašCÁ_
);

1220 ià(
w™hEM_
è
emDiffCÁs_
.
	`growToSize
(
domašCÁ_
);

1223 
i
 = 0; i < 
domašCÁ_
; i++)

1225 ià(
dldebug
è
cout
 << "Domaš " << 
i
 << 
’dl
;

1226 
şau£CÁ
 = 
şau£CÁP”Domaš_
[
i
];

1227 ià(
dldebug
è
cout
 << "CÏu£ couÁ: " << 
şau£CÁ
 << 
’dl
;

1228 
Domaš
* 
domaš
;

1230 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

1232 
FaùÜG¿ph
* 
fg
 = 
bp_
->
	`g‘FaùÜG¿ph
();

1233 
domaš
 = (
Domaš
*)
fg
->
	`g‘Domaš
();

1237 
V¬ŸbËS‹
* 
¡©e
 = 
šã»nûs_
[
i
]->
	`g‘S‹
();

1238 
domaš
 = (
Domaš
*)
¡©e
->
	`g‘Domaš
();

1241 ià(
ÏzyInã»nû_
 || (
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

1243 
domaš
->
	`g‘DB
()->
	`£tP”fÜmšgInã»nû
(
çl£
);

1246 
g´eds
.
	`ş—r
();

1247 
g´edV®ues
.
	`ş—r
();

1248 
tmpV®ues
.
	`ş—r
();

1249 
´edno
 = 0;…»dnØ< 
nÚEvidP»dNames
.
	`size
();…redno++)

1251 
µ»ds
.
	`ş—r
();

1252 
´edid
 = 
domaš
->
	`g‘P»diÿ‹Id
(
nÚEvidP»dNames
[
´edno
].
	`c_¡r
());

1253 
P»diÿ‹
::
	`ü—‹AÎGroundšgs
(
´edid
, 
domaš
, 
µ»ds
);

1254 
g´eds
.
	`­³nd
(
µ»ds
);

1257 
domaš
->
	`g‘DB
()->
	`®‹rTruthV®ue
(&
g´eds
, 
UNKNOWN
, 
FALSE
, &
g´edV®ues
);

1259 
hasUnknownP»ds
 = 
çl£
;

1261 
A¼ay
<>& 
ŒueCÁ
 = 
tÙ®TrueCÁs_
[
i
];

1262 
A¼ay
<>& 
çl£CÁ
 = 
tÙ®F®£CÁs_
[
i
];

1263 
ŒueCÁ
.
	`growToSize
(
şau£CÁ
);

1264 
çl£CÁ
.
	`growToSize
(
şau£CÁ
);

1265 
	`ÿlcuÏ‹CouÁs
(
ŒueCÁ
, 
çl£CÁ
, 
i
, 
hasUnknownP»ds
);

1269 
hasUnknownP»ds
 = 
Œue
;

1271 
domaš
->
	`g‘DB
()->
	`£tV®uesToUnknown
(&
g´eds
, &
tmpV®ues
);

1273 
A¼ay
<>& 
dTrueCÁ
 = 
deçuÉTrueCÁs_
[
i
];

1274 
A¼ay
<>& 
dF®£CÁ
 = 
deçuÉF®£CÁs_
[
i
];

1275 
dTrueCÁ
.
	`growToSize
(
şau£CÁ
);

1276 
dF®£CÁ
.
	`growToSize
(
şau£CÁ
);

1277 
	`ÿlcuÏ‹CouÁs
(
dTrueCÁ
, 
dF®£CÁ
, 
i
, 
hasUnknownP»ds
);

1279 
´edno
 = 0;…»dnØ< 
g´eds
.
	`size
();…redno++)

1280 
d–‘e
 
g´eds
[
´edno
];

1282 
domaš
->
	`g‘DB
()->
	`£tP”fÜmšgInã»nû
(
Œue
);

1286 
V¬ŸbËS‹
* 
¡©e
 = 
šã»nûs_
[
i
]->
	`g‘S‹
();

1287 ià(
w™hEM_
)

1289 
V¬ŸbËS‹
* 
emS‹
 = 
emInã»nûs_
[
i
]->
	`g‘S‹
();

1290 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
emUÃP»ds
 = 
emS‹
->
	`g‘UÃP»ds
();

1291 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
emKÃP»ds
 = 
emS‹
->
	`g‘KÃP»ds
();

1293 
emDiffCÁs_
[
i
] = 
Ãw
 [
şau£CÁ
];

1295 ià(
dldebug
)

1297 ià(
emUÃP»ds
)

1299 
cout
 << "UnknowÀnÚ-evid…»d (E): " << 
emUÃP»ds
->
	`size
()

1300 << 
’dl
;

1302 ià(
emKÃP»ds
)

1304 
cout
 << "KnowÀnÚ-evid…»d (E): " << 
emKÃP»ds
->
	`size
()

1305 << 
’dl
;

1308 
emUÃP»dsSize
 = 0;

1309 
emKÃP»dsSize
 = 0;

1310 ià(
emUÃP»ds
è
emUÃP»dsSize
 =ƒmUÃP»ds->
	`size
();

1311 ià(
emKÃP»ds
è
emKÃP»dsSize
 =ƒmKÃP»ds->
	`size
();

1313 
emTÙ®P»ds
 = 
emUÃP»dsSize
 + 
emKÃP»dsSize
;

1316 
A¼ay
<
boŞ
>* 
emUnknownP»d
 = 
Ãw
 Array<bool>;

1317 
emUnknownP»d
->
	`growToSize
(
emTÙ®P»ds
, 
çl£
);

1318 
´edno
 = 0;…»dnØ< 
emTÙ®P»ds
;…redno++)

1320 
GroundP»diÿ‹
* 
p
;

1321 ià(
´edno
 < 
emUÃP»dsSize
)

1322 
p
 = (*
emUÃP»ds
)[
´edno
];

1324 
p
 = (*
emKÃP»ds
)[
´edno
 - 
emUÃP»dsSize
];

1325 
TruthV®ue
 
tv
 = 
emS‹
->
	`g‘Domaš
()->
	`g‘DB
()->
	`g‘V®ue
(
p
);

1328 ià(
tv
 =ğ
TRUE
)

1330 
emS‹
->
	`£tV®ueOfAtom
(
´edno
 + 1, 
Œue
, 
çl£
, -1);

1331 
p
->
	`£tTruthV®ue
(
Œue
);

1335 
emS‹
->
	`£tV®ueOfAtom
(
´edno
 + 1, 
çl£
, false, -1);

1336 
p
->
	`£tTruthV®ue
(
çl£
);

1339 ià(
tv
 =ğ
UNKNOWN
)

1341 (*
emUnknownP»d
)[
´edno
] = 
Œue
;

1346 
emS‹
->
	`š™MakeB»akCo¡W©ch
();

1348 
emS‹
->
	`g‘NumCÏu£GndšgsW™hUnknown
(
emDiffCÁs_
[
i
], 
şau£CÁ
,

1349 
Œue
, 
emUnknownP»d
);

1350 
d–‘e
 
emUnknownP»d
;

1351 ià(
dldebug
)

1353 
şau£no
 = 0; cÏu£nØ< 
şau£CÁ
; clauseno++)

1355 
cout
 << 
şau£no
 << " :ƒmDiffCÁ = " << 
emDiffCÁs_
[
i
][clauseno]

1356 << 
’dl
;

1361 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
uÃP»ds
 = 
¡©e
->
	`g‘UÃP»ds
();

1362 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
kÃP»ds
 = 
¡©e
->
	`g‘KÃP»ds
();

1364 
ŒašTrueCÁs_
[
i
] = 
Ãw
 [
şau£CÁ
];

1365 
ŒašF®£CÁs_
[
i
] = 
Ãw
 [
şau£CÁ
];

1367 ià(
dldebug
)

1369 
cout
 << "UnknowÀnÚ-evid…»ds: " << 
uÃP»ds
->
	`size
(è<< 
’dl
;

1370 
cout
 << "KnowÀnÚ-evid…»ds: " << 
kÃP»ds
->
	`size
(è<< 
’dl
;

1372 
tÙ®P»ds
 = 
uÃP»ds
->
	`size
(è+ 
kÃP»ds
->size();

1375 
A¼ay
<
boŞ
>* 
unknownP»d
 = 
Ãw
 Array<bool>;

1376 
unknownP»d
->
	`growToSize
(
tÙ®P»ds
, 
çl£
);

1377 
´edno
 = 0;…»dnØ< 
tÙ®P»ds
;…redno++)

1379 
GroundP»diÿ‹
* 
p
;

1380 ià(
´edno
 < 
uÃP»ds
->
	`size
())

1381 
p
 = (*
uÃP»ds
)[
´edno
];

1383 
p
 = (*
kÃP»ds
)[
´edno
 - 
uÃP»ds
->
	`size
()];

1384 
TruthV®ue
 
tv
 = 
¡©e
->
	`g‘Domaš
()->
	`g‘DB
()->
	`g‘V®ue
(
p
);

1388 
boŞ
 
aùiv©e
 = 
çl£
;

1389 ià(
tv
 =ğ
TRUE
)

1391 
¡©e
->
	`£tV®ueOfAtom
(
´edno
 + 1, 
Œue
, 
aùiv©e
, -1);

1392 
p
->
	`£tTruthV®ue
(
Œue
);

1396 
¡©e
->
	`£tV®ueOfAtom
(
´edno
 + 1, 
çl£
, 
aùiv©e
, -1);

1397 
p
->
	`£tTruthV®ue
(
çl£
);

1400 ià(
tv
 =ğ
UNKNOWN
)

1402 (*
unknownP»d
)[
´edno
] = 
Œue
;

1407 
¡©e
->
	`š™MakeB»akCo¡W©ch
();

1409 
¡©e
->
	`g‘NumCÏu£GndšgsW™hUnknown
(
ŒašTrueCÁs_
[
i
], 
şau£CÁ
,

1410 
Œue
, 
unknownP»d
);

1411 ià(
w™hEM_
)

1413 
şau£no
 = 0; cÏu£nØ< 
şau£CÁ
; clauseno++)

1415 
emDiffCÁs_
[
i
][
şau£no
] = 
ŒašTrueCÁs_
[i][clauseno] -

1416 
emDiffCÁs_
[
i
][
şau£no
];

1421 
¡©e
->
	`g‘NumCÏu£GndšgsW™hUnknown
(
ŒašF®£CÁs_
[
i
], 
şau£CÁ
,

1422 
çl£
, 
unknownP»d
);

1423 
d–‘e
 
unknownP»d
;

1424 ià(
dldebug
)

1426 
şau£no
 = 0; cÏu£nØ< 
şau£CÁ
; clauseno++)

1428 
cout
 << 
şau£no
 << " :øğ" << 
ŒašTrueCÁs_
[
i
][clauseno]

1429 << " ** føğ" << 
ŒašF®£CÁs_
[
i
][
şau£no
] << 
’dl
;

1435 
tc
,
fc
;

1436 
nÚEvidP»ds
 = 0;

1437 
cout
 << "Li¡ oàCNF CÏu£ : " << 
’dl
;

1438 
şau£no
 = 0; cÏu£nØ< 
şau£CÁP”Domaš_
[0]; clauseno++)

1440 
tc
 = 0.0; 
fc
 = 0.0; 
nÚEvidP»ds
 = 0;

1441 
Domaš
* 
domaš0
;

1443 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[0])))

1445 
domaš0
 = (
Domaš
*)
bp_
->
	`g‘FaùÜG¿ph
()->
	`g‘Domaš
();

1449 
domaš0
 = (
Domaš
*)
šã»nûs_
[0]->
	`g‘S‹
()->
	`g‘Domaš
();

1452 
i
 = 0; i < 
domašCÁ_
; i++)

1454 cÚ¡ 
MLN
* 
mÊ
;

1455 
Domaš
* 
domaš
;

1457 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

1459 
FaùÜG¿ph
* 
fg
 = 
bp_
->
	`g‘FaùÜG¿ph
();

1460 
domaš
 = (
Domaš
*)
fg
->
	`g‘Domaš
();

1461 
mÊ
 = 
fg
->
	`g‘MLN
();

1465 
V¬ŸbËS‹
* 
¡©e
 = 
šã»nûs_
[
i
]->
	`g‘S‹
();

1466 
domaš
 = (
Domaš
*)
¡©e
->
	`g‘Domaš
();

1467 
mÊ
 = 
¡©e
->
	`g‘MLN
();

1470 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£s
 = 
»ËvªtCÏu£sP”Domaš_
[
i
];

1471 
A¼ay
<>& 
logOdds
 = 
logOddsP”Domaš_
[
i
];

1473 ià(!
»ËvªtCÏu£s
[
şau£no
])

1475 
domaš
->
	`£tNumTrueNÚEvidGndšgs
(
şau£no
, 0);

1476 
domaš
->
	`£tNumF®£NÚEvidGndšgs
(
şau£no
, 0);

1477 
logOdds
[
şau£no
] = 0.0;

1481 
cout
 << 
şau£no
 << ":";

1482 cÚ¡ 
CÏu£
* 
şau£
 = 
mÊ
->
	`g‘CÏu£
(
şau£no
);

1483 
şau£
->
	`´št
(
cout
, 
domaš0
);

1484 
cout
 << 
’dl
;

1486 
domašTrueCÁs
 = 0.0;

1487 
domašF®£CÁs
 = 0.0;

1488 ià(
ÏzyInã»nû_
 || (
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

1490 
domašTrueCÁs
 = 
tÙ®TrueCÁs_
[
i
][
şau£no
] -

1491 
deçuÉTrueCÁs_
[
i
][
şau£no
];

1492 
domašF®£CÁs
 = 
tÙ®F®£CÁs_
[
i
][
şau£no
] -

1493 
deçuÉF®£CÁs_
[
i
][
şau£no
];

1497 
domašTrueCÁs
 = 
ŒašTrueCÁs_
[
i
][
şau£no
];

1498 
domašF®£CÁs
 = 
ŒašF®£CÁs_
[
i
][
şau£no
];

1501 
tc
 +ğ
domašTrueCÁs
;

1502 
fc
 +ğ
domašF®£CÁs
;

1503 
domaš
->
	`£tNumTrueNÚEvidGndšgs
(
şau£no
, 
domašTrueCÁs
);

1504 
domaš
->
	`£tNumF®£NÚEvidGndšgs
(
şau£no
, 
domašF®£CÁs
);

1506 ià(
dldebug
)

1507 
cout
 << 
şau£no
 << " :øğ" << 
tc
 << " ** føğ"<< 
fc
 <<
’dl
;

1509 
i
 = 0; i < 
şau£
->
	`g‘NumP»diÿ‹s
(); i++)

1511 cÚ¡ * 
´edName
 =

1512 
şau£
->
	`g‘P»diÿ‹
(
i
)->
	`g‘Tem¶©e
()->
	`g‘Name
();

1513 ià(
nÚEvidP»dNames
.
	`cÚšs
(
´edName
))

1514 
nÚEvidP»ds
++;

1518 
weight
 = 0.0;

1519 
tÙ®CÁ
 = 
tc
 + 
fc
;

1521 ià(
tÙ®CÁ
 =ğ0 || 
nÚEvidP»ds
 == 0)

1524 
weight
 = 
EPSILON
;

1528 ià(
fc
 == 0.0)

1529 
fc
 = 0.00001;

1530 ià(
tc
 == 0.0)

1531 
tc
 = 0.00001;

1533 
´iÜodds
 = (
	`pow
(2.0, 
nÚEvidP»ds
) - 1.0)/1.0;

1534 
weight
 = 
	`log
(
tc
/
fc
è-†og(
´iÜodds
);

1537 
i
 = 0; i < 
domašCÁ_
; i++)

1539 
A¼ay
<>& 
logOdds
 = 
logOddsP”Domaš_
[
i
];

1540 
logOdds
[
şau£no
] = 
weight
;

1543 
	}
}

1549 
	$šãr
()

1551 
i
 = 0; i < 
domašCÁ_
; i++)

1553 ià(
dldebug
è
cout
 << "š domaš " << 
i
 << 
’dl
;

1556 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
i
])))

1558 
šã»nûs_
[
i
]->
	`šãr
();

1562 
V¬ŸbËS‹
* 
¡©e
 = 
šã»nûs_
[
i
]->
	`g‘S‹
();

1563 
¡©e
->
	`£tGndCÏu£sWtsToSumOfP¬’tWts
();

1566 
¡©e
->
	`š™
();

1567 
šã»nûs_
[
i
]->
	`šãr
();

1568 
¡©e
->
	`§veLowS‹ToGndP»ds
();

1571 ià(
dldebug
)

1573 
cout
 << "Inã¼ed fŞlowšg v®ue (M): " << 
’dl
;

1574 
šã»nûs_
[
i
]->
	`´štProbab™›s
(
cout
);

1577 
	}
}

1583 
	$flInMissšgV®ues
()

1585 
	`as£¹
(
w™hEM_
);

1586 
cout
 << "Flšg iÀmissšg d©¨..." << 
’dl
;

1589 
A¼ay
<A¼ay<
TruthV®ue
> > 
ueV®ues
;

1590 
ueV®ues
.
	`growToSize
(
domašCÁ_
);

1591 
i
 = 0; i < 
domašCÁ_
; i++)

1593 
V¬ŸbËS‹
* 
¡©e
 = 
šã»nûs_
[
i
]->
	`g‘S‹
();

1594 cÚ¡ 
Domaš
* 
domaš
 = 
¡©e
->
	`g‘Domaš
();

1595 cÚ¡ 
GroundP»diÿ‹HashA¼ay
* 
kÃP»ds
 = 
¡©e
->
	`g‘KÃP»ds
();

1596 cÚ¡ 
A¼ay
<
TruthV®ue
>* 
kÃP»dV®ues
 = 
¡©e
->
	`g‘KÃP»dV®ues
();

1599 
domaš
->
	`g‘DB
()->
	`£tV®uesToGiv’V®ues
(
kÃP»ds
, 
kÃP»dV®ues
);

1601 
V¬ŸbËS‹
* 
emS‹
 = 
emInã»nûs_
[
i
]->
	`g‘S‹
();

1603 
emS‹
->
	`£tGndCÏu£sWtsToSumOfP¬’tWts
();

1605 
emS‹
->
	`š™
();

1606 
emInã»nûs_
[
i
]->
	`šãr
();

1607 
emS‹
->
	`§veLowS‹ToGndP»ds
();

1609 ià(
dldebug
)

1611 
cout
 << "Inã¼ed fŞlowšg v®ue (E): " << 
’dl
;

1612 
emInã»nûs_
[
i
]->
	`´štProbab™›s
(
cout
);

1616 
şau£CÁ
 = 
şau£CÁP”Domaš_
[
i
];

1617 
emS‹
->
	`š™MakeB»akCo¡W©ch
();

1619 cÚ¡ 
A¼ay
<>* 
şau£TrueCÁs
 =

1620 
emInã»nûs_
[
i
]->
	`g‘CÏu£TrueCÁs
();

1621 
	`as£¹
(
şau£TrueCÁs
->
	`size
(è=ğ
şau£CÁ
);

1622 
numSam¶es
 = 
emInã»nûs_
[
i
]->
	`g‘NumSam¶es
();

1623 
j
 = 0; j < 
şau£CÁ
; j++)

1626 
ŒašTrueCÁs_
[
i
][
j
] = (*
şau£TrueCÁs
)[j]/
numSam¶es
 +

1627 
emDiffCÁs_
[
i
][
j
];

1634 
A¼ay
<
TruthV®ue
> 
tmpV®ues
;

1635 
tmpV®ues
.
	`growToSize
(
kÃP»ds
->
	`size
());

1636 
domaš
->
	`g‘DB
()->
	`£tV®uesToUnknown
(
kÃP»ds
, &
tmpV®ues
);

1638 
cout
 << "DÚflšg iÀmissšg d©a" << 
’dl
;

1639 
	}
}

1646 
	$g‘CouÁsFÜDomaš
(* cÚ¡ & 
şau£T¿šCÁs
,

1647 * cÚ¡ & 
şau£T¿šTÙ®
, * cÚ¡ & 
şau£Inã¼edCÁs
,

1648 * cÚ¡ & 
şau£Inã¼edTÙ®
, 
domašIdx
)

1650 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£s
 = 
»ËvªtCÏu£sP”Domaš_
[
domašIdx
];

1651 
şau£CÁ
 = 
şau£CÁP”Domaš_
[
domašIdx
];

1652 * 
ŒašCÁs
 = 
NULL
;

1653 * 
šã¼edCÁs
 = 
NULL
;

1654 
A¼ay
<>& 
tÙ®TrueCÁs
 = 
tÙ®TrueCÁs_
[
domašIdx
];

1656 
A¼ay
<>& 
deçuÉTrueCÁs
 = 
deçuÉTrueCÁs_
[
domašIdx
];

1657 cÚ¡ 
MLN
* 
mÊ
 = 
šã»nûs_
[
domašIdx
]->
	`g‘S‹
()->
	`g‘MLN
();

1658 cÚ¡ 
Domaš
* 
domaš
 = 
šã»nûs_
[
domašIdx
]->
	`g‘S‹
()->
	`g‘Domaš
();

1660 
	`mem£t
(
şau£T¿šCÁs
, 0, 
şau£CÁ
*());

1661 
	`mem£t
(
şau£Inã¼edCÁs
, 0, 
şau£CÁ
*());

1662 
	`mem£t
(
şau£T¿šTÙ®
, 0, 
şau£CÁ
*());

1663 
	`mem£t
(
şau£Inã¼edTÙ®
, 0, 
şau£CÁ
*());

1665 ià(!(
ÏzyInã»nû_
 || (
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
domašIdx
]))))

1667 ià(!
šã¼edCÁs
èšã¼edCÁ ğ
Ãw
 [
şau£CÁ
];

1669 cÚ¡ 
A¼ay
<>* 
şau£TrueCÁs
 =

1670 
šã»nûs_
[
domašIdx
]->
	`g‘CÏu£TrueCÁs
();

1671 
	`as£¹
(
şau£TrueCÁs
->
	`size
(è=ğ
şau£CÁ
);

1672 
i
 = 0; i < 
şau£CÁ
; i++)

1673 
šã¼edCÁs
[
i
] = (*
şau£TrueCÁs
)[i];

1675 
ŒašCÁs
 = 
ŒašTrueCÁs_
[
domašIdx
];

1679 
şau£no
 = 0; cÏu£nØ< 
şau£CÁ
; clauseno++)

1681 ià(!
»ËvªtCÏu£s
[
şau£no
]) ;

1684 
tÙ®Gndšgs
 = ()(
ŒašF®£CÁs_
[
domašIdx
][
şau£no
]

1685 + 
ŒašTrueCÁs_
[
domašIdx
][
şau£no
]);

1686 
şau£T¿šTÙ®
[
şau£no
] +ğ
tÙ®Gndšgs
;

1687 
şau£Inã¼edTÙ®
[
şau£no
] +ğ
tÙ®Gndšgs
 *

1688 
šã»nûs_
[
domašIdx
]->
	`g‘NumSam¶es
();

1690 ià(
ÏzyInã»nû_
 || (
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
domašIdx
])))

1692 
CÏu£
* 
şau£
 = (CÏu£*è
mÊ
->
	`g‘CÏu£
(
şau£no
);

1694 
ŒašCÁ
 = 
tÙ®TrueCÁs
[
şau£no
];

1695 
šã¼edCÁ
 =

1696 
şau£
->
	`g‘NumTrueGroundšgs
(
domaš
, domaš->
	`g‘DB
(), 
çl£
);

1697 
ŒašCÁ
 -ğ
deçuÉTrueCÁs
[
şau£no
];

1698 
šã¼edCÁ
 -ğ
deçuÉTrueCÁs
[
şau£no
];

1699 
şau£T¿šCÁs
[
şau£no
] +ğ()
ŒašCÁ
;

1700 
şau£Inã¼edCÁs
[
şau£no
] +ğ()
šã¼edCÁ
;

1704 
şau£T¿šCÁs
[
şau£no
] +ğ()
ŒašCÁs
[clauseno];

1705 
şau£Inã¼edCÁs
[
şau£no
] +ğ()
šã¼edCÁs
[clauseno];

1710 
d–‘e
[] 
šã¼edCÁs
;

1711 
	}
}

1715 
	$g‘G¿d›ÁFÜDomaš
(* cÚ¡ & 
g¿d›Á
, cÚ¡ & 
domašIdx
)

1717 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£s
 = 
»ËvªtCÏu£sP”Domaš_
[
domašIdx
];

1718 
şau£CÁ
 = 
şau£CÁP”Domaš_
[
domašIdx
];

1719 * 
ŒašCÁs
 = 
NULL
;

1720 * 
šã¼edCÁs
 = 
NULL
;

1721 * 
şau£T¿šCÁs
 = 
Ãw
 [
şau£CÁ
];

1722 * 
şau£Inã¼edCÁs
 = 
Ãw
 [
şau£CÁ
];

1729 
	`mem£t
(
şau£T¿šCÁs
, 0, 
şau£CÁ
*());

1730 
	`mem£t
(
şau£Inã¼edCÁs
, 0, 
şau£CÁ
*());

1732 ià(!
šã¼edCÁs
èšã¼edCÁ ğ
Ãw
 [
şau£CÁ
];

1734 cÚ¡ 
A¼ay
<>* 
şau£TrueCÁs
 =

1735 
šã»nûs_
[
domašIdx
]->
	`g‘CÏu£TrueCÁs
();

1736 
cout
<<
şau£TrueCÁs
->
	`size
()<<
’dl
;

1737 
i
=0;i<
şau£TrueCÁs
->
	`size
();i++)

1739 
cout
<<(*
şau£TrueCÁs
)[
i
]<<" ";

1741 
cout
<<
’dl
;

1742 
	`as£¹
(
şau£TrueCÁs
->
	`size
(è=ğ
şau£CÁ
);

1743 
numSam¶es
 = 
šã»nûs_
[
domašIdx
]->
	`g‘NumSam¶es
();

1744 
i
 = 0; i < 
şau£CÁ
; i++)

1746 ià((
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
domašIdx
])))

1747 
šã¼edCÁs
[
i
] = (*
şau£TrueCÁs
)[i];

1749 
šã¼edCÁs
[
i
] = (*
şau£TrueCÁs
)[i] / 
numSam¶es
;

1751 ià(!(
ÏzyInã»nû_
 || (
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
domašIdx
]))))

1752 
ŒašCÁs
 = 
ŒašTrueCÁs_
[
domašIdx
];

1754 ià(
dldebug
)

1755 
cout
 << "numSam¶e ğ" << 
numSam¶es
 << 
’dl
;

1759 
şau£no
 = 0; cÏu£nØ< 
şau£CÁ
; clauseno++)

1761 ià(!
»ËvªtCÏu£s
[
şau£no
]) ;

1762 ià(
ÏzyInã»nû_
 || (
bp_
 = 
dyÇmic_ÿ¡
<
BP
*>(
šã»nûs_
[
domašIdx
])))

1764 
şau£T¿šCÁs
[
şau£no
] = clauseTrainCnts[clauseno] +

1765 
tÙ®TrueCÁs_
[
domašIdx
][
şau£no
] -

1766 
deçuÉTrueCÁs_
[
domašIdx
][
şau£no
];

1767 
şau£Inã¼edCÁs
[
şau£no
] +ğ
šã¼edCÁs
[clauseno];

1771 
şau£T¿šCÁs
[
şau£no
] +ğ
ŒašCÁs
[clauseno];

1772 
şau£Inã¼edCÁs
[
şau£no
] +ğ
šã¼edCÁs
[clauseno];

1777 ià(
dldebug
)

1779 
cout
 << "Domaš " << 
domašIdx
 << "‚‘ couÁ : " << 
’dl
;

1780 
cout
 << "\t\‰¿š couÁ\t\t\t\tšã¼ed couÁ" << 
’dl
 <<ƒndl;

1783 
şau£no
 = 0; cÏu£nØ< 
şau£CÁ
; clauseno++)

1785 ià(!
»ËvªtCÏu£s
[
şau£no
]) ;

1787 ià(
dldebug
)

1788 
cout
 << 
şau£no
 << ":\t\t" << 
şau£T¿šCÁs
[clauseno] << "\t\t\t\t"

1789 << 
şau£Inã¼edCÁs
[
şau£no
] << 
’dl
;

1792 ià(
»sÿËG¿d›Á_
 && 
şau£T¿šCÁs
[
şau£no
] > 0)

1794 
g¿d›Á
[
şau£no
] -=

1795 (
şau£T¿šCÁs
[
şau£no
] - 
şau£Inã¼edCÁs
[clauseno])

1796 / 
şau£T¿šCÁs
[
şau£no
];

1800 
g¿d›Á
[
şau£no
] -ğ
şau£T¿šCÁs
[clauseno] -

1801 
şau£Inã¼edCÁs
[
şau£no
];

1805 
d–‘e
[] 
šã¼edCÁs
;

1806 
d–‘e
[] 
şau£T¿šCÁs
;

1807 
d–‘e
[] 
şau£Inã¼edCÁs
;

1808 
	}
}

1812 
	$g‘G¿d›Á
(* cÚ¡ & 
weights
, * cÚ¡ & 
g¿d›Á
,

1813 cÚ¡ 
numWts
)

1816 
	`mem£t
(
g¿d›Á
, 0, 
numWts
*());

1819 ià(
idxT¿ns_
 =ğ
NULL
)

1821 
i
 = 0; i < 
domašCÁ_
; i++)

1824 
	`g‘G¿d›ÁFÜDomaš
(
g¿d›Á
, 
i
);

1830 
A¼ay
<A¼ay<> >* 
g¿dsP”Domaš
 = 
idxT¿ns_
->
	`g‘G¿dsP”Domaš
();

1831 cÚ¡ 
A¼ay
<A¼ay<A¼ay<
IdxDiv
>*> >* 
cIdxToCFIdxsP”Domaš


1832 ğ
idxT¿ns_
->
	`g‘CÏu£IdxToCÏu£FÜmuÏIdxsP”Domaš
();

1834 
i
 = 0; i < 
domašCÁ_
; i++)

1838 
A¼ay
<>& 
g¿ds
 = (*
g¿dsP”Domaš
)[
i
];

1839 
	`mem£t
((*)
g¿ds
.
	`g‘I‹ms
(), 0, g¿ds.
	`size
()*());

1841 
	`g‘G¿d›ÁFÜDomaš
((*)
g¿ds
.
	`g‘I‹ms
(), 
i
);

1844 
	`as£¹
(
g¿ds
.
	`size
(è=ğ
şau£CÁP”Domaš_
[
i
]);

1845 
j
 = 0; j < 
g¿ds
.
	`size
(); j++)

1847 
A¼ay
<
IdxDiv
>* 
idxDivs
 = (*
cIdxToCFIdxsP”Domaš
)[
i
][
j
];

1848 
k
 = 0; k < 
idxDivs
->
	`size
(); k++)

1849 
g¿d›Á
[ (*
idxDivs
)[
k
].
idx
 ] +ğ
g¿ds
[
j
] / (*idxDivs)[k].
div
;

1855 ià(
u£PriÜ_
)

1857 
i
 = 0; i < 
numWts
; i++)

1860 
sd
 = 
´iÜStdDevs_
[
i
];

1861 
´iÜD”iv©ive
 = (
weights
[
i
]-
´iÜM—ns_
[i])/(
sd
*sd);

1864 
g¿d›Á
[
i
] +ğ
´iÜD”iv©ive
;

1868 
	}
}

1870 
	gpublic
:

1873 cÚ¡ 
SIMPLE
 = 0;

1874 cÚ¡ 
	gDN
 = 2;

1875 cÚ¡ 
	gCG
 = 3;

1878 
	g´iv©e
:

1879 
domašCÁ_
;

1880 
	gA¼ay
<A¼ay<> > 
	glogOddsP”Domaš_
;

1881 
	gA¼ay
<> 
	gşau£CÁP”Domaš_
;

1884 
	gA¼ay
<A¼ay<> > 
	gtÙ®TrueCÁs_
;

1885 
	gA¼ay
<A¼ay<> > 
	gtÙ®F®£CÁs_
;

1886 
	gA¼ay
<A¼ay<> > 
	gdeçuÉTrueCÁs_
;

1887 
	gA¼ay
<A¼ay<> > 
	gdeçuÉF®£CÁs_
;

1889 
	gA¼ay
<A¼ay<
	gboŞ
> > 
	g»ËvªtCÏu£sP”Domaš_
;

1890 
	gA¼ay
<
	gboŞ
> 
	g»ËvªtCÏu£sFÜmuÏs_
;

1893 
	gA¼ay
<*> 
	gŒašTrueCÁs_
;

1894 
	gA¼ay
<*> 
	gŒašF®£CÁs_
;

1896 
boŞ
 
	gu£PriÜ_
;

1897 cÚ¡ * 
	g´iÜM—ns_
, * 
	g´iÜStdDevs_
;

1899 
IndexT¿n¦©Ü
* 
	gidxT¿ns_
;

1901 
boŞ
 
	gÏzyInã»nû_
;

1902 
boŞ
 
	gisQu”yEvid’û_
;

1903 
boŞ
 
	g»sÿËG¿d›Á_
;

1904 
	gm‘hod_
;

1905 
	gcg_Ïmbda_
;

1906 
boŞ
 
	g´ecÚd™iÚCG_
;

1908 
	gmaxBackŒacks_
;

1909 
	gbackŒackCouÁ_
;

1910 
	gcg_max_Ïmbda_
;

1911 
	gmš_Î_chªge_
;

1913 
	gA¼ay
<
	gInã»nû
*> 
	gšã»nûs_
;

1916 
boŞ
 
	gw™hEM_
;

1917 
	gA¼ay
<
	gInã»nû
*> 
	gemInã»nûs_
;

1919 
	gA¼ay
<*> 
	gemDiffCÁs_
;

1922 
BP
* 
	gbp_
;

	@indextranslator.h

67 #iâdeà
INDEXTRANSLATOR_H_NOV_29_2005


68 
	#INDEXTRANSLATOR_H_NOV_29_2005


	)

71 
	~"mÊ.h
"

75 
	sIdxDiv
 { 
	midx
; 
	mdiv
; };

78 şas 
	cIndexT¿n¦©Ü


80 
	mpublic
:

81 
IndexT¿n¦©Ü
(cÚ¡ 
A¼ay
<
MLN
*>* cÚ¡ & 
mÊs
,

82 cÚ¡ 
A¼ay
<
Domaš
*>* cÚ¡ & 
domašs
)

83 : 
mÊs_
(
mÊs
), 
domašs_
(
domašs
), 
cIdxToCFIdxsP”Domaš_
(
NULL
),

84 
wtsP”Domaš_
(
NULL
), 
g¿dsP”Domaš_
(NULL),

85 
şau£Ord”šg_
(
NULL
), 
	$exi¡FÜmuÏOrd”šg_
(
NULL
)

86 { 
	`ü—‹CÏu£IdxToCÏu£FÜmuÏIdxsM­
(); }

89 ~
	$IndexT¿n¦©Ü
()

91 ià(
cIdxToCFIdxsP”Domaš_
)

93 
i
 = 0; i < 
cIdxToCFIdxsP”Domaš_
->
	`size
(); i++)

94 (*
cIdxToCFIdxsP”Domaš_
)[
i
].
	`d–‘eI‹msAndCË¬
();

95 
d–‘e
 
cIdxToCFIdxsP”Domaš_
;

97 ià(
wtsP”Domaš_
è
d–‘e
 wtsPerDomain_;

98 ià(
g¿dsP”Domaš_
è
d–‘e
 gradsPerDomain_;

99 ià(
şau£Ord”šg_
)

100 { 
şau£Ord”šg_
->
	`d–‘eI‹msAndCË¬
(); 
d–‘e
 clauseOrdering_; }

101 ià(
exi¡FÜmuÏOrd”šg_
è
d–‘e
ƒxistFormulaOrdering_;

102 
	}
}

109 
boŞ
 
ÃedIndexT¿n¦©Ü
(cÚ¡ 
A¼ay
<
MLN
*>& 
mÊs
,

110 cÚ¡ 
A¼ay
<
Domaš
*>& 
domašs
)

112 ià(
	gmÊs
.
size
(è<ğ1è 
çl£
;

114 
	gi
 = 1; i < 
	gmÊs
.
size
(); i++)

115 ià(
	gmÊs
[0]->
g‘NumCÏu£s
(è!ğ
mÊs
[
i
]->g‘NumCÏu£s()è 
Œue
;

120 
boŞ
 
	g®lT›dFÜmuÏsHaveOÃCÏu£
 = 
Œue
;

121 
	gi
 = 0; i < 
	gmÊs
.
size
(); i++)

123 cÚ¡ 
FÜmuÏAndCÏu£sA¼ay
* 
	gâÿ
 = 
mÊs
[
i
]->
g‘FÜmuÏAndCÏu£sA¼ay
();

124 
	gj
 = 0; j < 
	gâÿ
->
size
(); j++)

126 ià(
fÜmuÏWtT›dToCÏu£Wts
((*
âÿ
)[
j
]) &&

127 (*
	gâÿ
)[
j
]->
	gšdexCÏu£s
->
size
() > 1)

129 
	g®lT›dFÜmuÏsHaveOÃCÏu£
 = 
çl£
;

133 ià(!
	g®lT›dFÜmuÏsHaveOÃCÏu£
) ;

136 ià(
	g®lT›dFÜmuÏsHaveOÃCÏu£
è 
	gçl£
;

143 
	gi
 = 0; i < 
	gmÊs
[0]->
g‘NumCÏu£s
(); i++)

146 ià(
t›CÏu£WtToFÜmuÏWt
(
mÊs
[0], 
i
))

148 
o¡ršg¡»am
 
	goss0
;

149 
	gmÊs
[0]->
g‘CÏu£
(
i
)->
´štW™houtWtW™hSŒV¬
(
oss0
, 
domašs
[0]);

150 
	gj
 = 1; j < 
	gmÊs
.
size
(); j++)

152 
o¡ršg¡»am
 
	gossj
;

153 
	gmÊs
[
j
]->
g‘CÏu£
(
i
)->
´štW™houtWtW™hSŒV¬
(
ossj
, 
domašs
[j]);

154 ià(
	goss0
.
¡r
().
com·»
(
ossj
.¡r()è!ğ0è 
Œue
;

159  
	gçl£
;

163 cÚ¡ 
	gA¼ay
<A¼ay<A¼ay<
	gIdxDiv
>*> >*

164 
	$g‘CÏu£IdxToCÏu£FÜmuÏIdxsP”Domaš
() const

165 {  
cIdxToCFIdxsP”Domaš_
; 
	}
}

167 
	gA¼ay
<A¼ay<> >* 
	$g‘WtsP”Domaš
(ècÚ¡ {  
wtsP”Domaš_
; 
	}
}

169 
	gA¼ay
<A¼ay<> >* 
	$g‘G¿dsP”Domaš
(ècÚ¡ {  
g¿dsP”Domaš_
; 
	}
}

171 cÚ¡ 
CÏu£HashA¼ay
* 
	$g‘CÏu£Ord”šg
(ècÚ¡ {  
şau£Ord”šg_
; 
	}
}

173 cÚ¡ 
SŒšgHashA¼ay
* 
	$g‘Exi¡FÜmuÏOrd”šg
() const

174 {  
exi¡FÜmuÏOrd”šg_
; 
	}
}

176 
	$g‘NumCÏu£sAndExi¡FÜmuÏs
() const

177 {  
şau£Ord”šg_
->
	`size
(è+ 
exi¡FÜmuÏOrd”šg_
->size(); 
	}
}

182 
boŞ
 
	$checkCIdxWtsG¿dsSize
(cÚ¡ & 
numAdded
)

184 
i
 = 0; i < 
mÊs_
->
	`size
(); i++)

186 
sz
 = (*
mÊs_
)[
i
]->
	`g‘NumCÏu£s
(è+ 
numAdded
;

187 ià((*
cIdxToCFIdxsP”Domaš_
)[
i
].
	`size
(è!ğ
sz
è 
çl£
;

188 ià((*
wtsP”Domaš_
)[
i
].
	`size
(è!ğ
sz
è 
çl£
;

189 ià((*
g¿dsP”Domaš_
)[
i
].
	`size
(è!ğ
sz
è 
çl£
;

191  
Œue
;

192 
	}
}

197 
upd©eCÏu£FÜmuÏWtsInMLNs
(cÚ¡ 
A¼ay
<>& 
wts
,

198 cÚ¡ 
A¼ay
<
CÏu£
*>*cÚ¡& 
­³ndedCÏu£s
,

199 cÚ¡ 
A¼ay
<
¡ršg
>*cÚ¡& 
­³ndedFÜmuÏs
)

201 
as£¹
(
­³ndedCÏu£s
 =ğ
NULL
 || 
­³ndedFÜmuÏs
 == NULL);

202 
Domaš
* 
	gdom0
 = (*
domašs_
)[0];

203 
	gi
 = 0; i < 
	gmÊs_
->
size
(); i++)

205 
MLN
* 
	gmÊ
 = (*
mÊs_
)[
i
];

206 
Domaš
* 
	gdom
 = (*
domašs_
)[
i
];

208 
	gj
 = 0; j < 
	gşau£Ord”šg_
->
size
(); j++)

210 
CÏu£
* 
	gc
 = (*
şau£Ord”šg_
)[
j
];

211 ià(
	gi
 > 0 && 
	gc
->
cÚšsCÚ¡ªts
()èc->
Œª¦©eCÚ¡ªts
(
dom0
, 
dom
);

212 
CÏu£
* 
	gcc
 = (CÏu£*è
mÊ
->
fšdCÏu£
(
c
);

213 ià(
	gi
 > 0 && 
	gc
->
cÚšsCÚ¡ªts
()èc->
Œª¦©eCÚ¡ªts
(
dom
, 
dom0
);

214 
	gcc
->
£tWt
(
wts
[
j
]);

217 
	goff£t
 = 
şau£Ord”šg_
->
size
();

219 
	gj
 = 0; j < 
	gexi¡FÜmuÏOrd”šg_
->
size
(); j++)

220 
	gmÊ
->
£tFÜmuÏWt
((*
exi¡FÜmuÏOrd”šg_
)[
j
], 
wts
[
off£t
+j]);

222 
	goff£t
 +ğ
exi¡FÜmuÏOrd”šg_
->
size
();

224 ià(
	g­³ndedCÏu£s
)

226 
	gj
 = 0; j < 
	g­³ndedCÏu£s
->
size
(); j++)

228 
CÏu£
* 
	gc
 = (*
­³ndedCÏu£s
)[
j
];

229 ià(
	gi
 > 0 && 
	gc
->
cÚšsCÚ¡ªts
()èc->
Œª¦©eCÚ¡ªts
(
dom0
, 
dom
);

230 
CÏu£
* 
	gcc
 = (CÏu£*è
mÊ
->
fšdCÏu£
(
c
);

231 ià(
	gi
 > 0 && 
	gc
->
cÚšsCÚ¡ªts
()èc->
Œª¦©eCÚ¡ªts
(
dom
, 
dom0
);

232 
	gcc
->
£tWt
(
wts
[
off£t
+
j
]);

236 ià(
	g­³ndedFÜmuÏs
)

238 
	gj
 = 0; j < 
	g­³ndedFÜmuÏs
->
size
(); j++)

239 
	gmÊ
->
£tFÜmuÏWt
((*
­³ndedFÜmuÏs
)[
j
], 
wts
[
off£t
+j]);

245 
g‘CÏu£FÜmuÏWts
(
A¼ay
<>& 
wts
) const

247 
	gwts
.
ş—r
();

248 
	gwts
.
growToSize
(
şau£Ord”šg_
->
size
(è+ 
exi¡FÜmuÏOrd”šg_
->size());

249 
	ga
 = 0;

250 
	gj
 = 0; j < 
	gşau£Ord”šg_
->
size
(); j++)

251 
	gwts
[
a
++] = (*
mÊs_
)[0]->
fšdCÏu£
((*
şau£Ord”šg_
)[
j
])->
g‘Wt
();

253 
	gj
 = 0; j < 
	gexi¡FÜmuÏOrd”šg_
->
size
(); j++)

254 
	gwts
[
a
++] = (*
mÊs_
)[0]->
g‘FÜmuÏWt
((*
exi¡FÜmuÏOrd”šg_
)[
j
]);

260 
	$ü—‹CÏu£IdxToCÏu£FÜmuÏIdxsM­
()

262 
	`as£¹
(
mÊs_
->
	`size
(è=ğ
domašs_
->size());

263 ià(
mÊs_
->
	`size
() <= 1) ;

264 ià(
cIdxToCFIdxsP”Domaš_
)

266 
i
 = 0; i < 
cIdxToCFIdxsP”Domaš_
->
	`size
(); i++)

267 (*
cIdxToCFIdxsP”Domaš_
)[
i
].
	`d–‘eI‹msAndCË¬
();

268 
d–‘e
 
cIdxToCFIdxsP”Domaš_
;

270 ià(
wtsP”Domaš_
è
d–‘e
 wtsPerDomain_;

271 ià(
g¿dsP”Domaš_
è
d–‘e
 gradsPerDomain_;

272 ià(
şau£Ord”šg_
)

273 { 
şau£Ord”šg_
->
	`d–‘eI‹msAndCË¬
(); 
d–‘e
 clauseOrdering_; }

274 ià(
exi¡FÜmuÏOrd”šg_
è
d–‘e
ƒxistFormulaOrdering_;

276 
	`ŒackCÏu£CÚ¡ªts
();

277 
şau£Ord”šg_
 = 
Ãw
 
CÏu£HashA¼ay
;

278 
exi¡FÜmuÏOrd”šg_
 = 
Ãw
 
SŒšgHashA¼ay
;

279 
	`ü—‹CÏu£sFÜmuÏsOrd”šg
((*
mÊs_
)[0], 
şau£Ord”šg_
,

280 
exi¡FÜmuÏOrd”šg_
);

282 
cIdxToCFIdxsP”Domaš_
 = 
Ãw
 
A¼ay
<A¼ay<A¼ay<
IdxDiv
>*> >;

283 
wtsP”Domaš_
 = 
Ãw
 
A¼ay
<Array<> >;

284 
g¿dsP”Domaš_
 = 
Ãw
 
A¼ay
<Array<> >;

285 
cIdxToCFIdxsP”Domaš_
->
	`growToSize
(
mÊs_
->
	`size
());

286 
wtsP”Domaš_
->
	`growToSize
(
mÊs_
->
	`size
());

287 
g¿dsP”Domaš_
->
	`growToSize
(
mÊs_
->
	`size
());

289 
Domaš
* 
dom0
 = (*
domašs_
)[0];

290 
i
 = 0; i < 
mÊs_
->
	`size
(); i++)

292 
MLN
* 
mÊ
 = (*
mÊs_
)[
i
];

293 
Domaš
* 
dom
 = (*
domašs_
)[
i
];

294 cÚ¡ 
FÜmuÏAndCÏu£sA¼ay
* 
âÿ
 = 
mÊ
->
	`g‘FÜmuÏAndCÏu£sA¼ay
();

295 
A¼ay
<A¼ay<
IdxDiv
>*>& 
cIdxToCFIdxsM­
 = (*
cIdxToCFIdxsP”Domaš_
)[
i
];

296 
cIdxToCFIdxsM­
.
	`growToSize
(
mÊ
->
	`g‘NumCÏu£s
());

297 (*
wtsP”Domaš_
)[
i
].
	`growToSize
(
mÊ
->
	`g‘NumCÏu£s
());

298 (*
g¿dsP”Domaš_
)[
i
].
	`growToSize
(
mÊ
->
	`g‘NumCÏu£s
());

300 
j
 = 0; j < 
mÊ
->
	`g‘NumCÏu£s
(); j++)

302 
A¼ay
<
IdxDiv
>* 
cfIdxs
 = 
Ãw
 Array<IdxDiv>;

303 
cIdxToCFIdxsM­
[
j
] = 
cfIdxs
;

308 ià(
	`noT›CÏu£WtToFÜmuÏWt
(
mÊ
,
j
))

310 
CÏu£
* 
c
 = (CÏu£*è
mÊ
->
	`g‘CÏu£
(
j
);

311 ià(
i
 > 0 && 
c
->
	`cÚšsCÚ¡ªts
()èc->
	`Œª¦©eCÚ¡ªts
(
dom
, 
dom0
);

312 
idx
 = 
şau£Ord”šg_
->
	`fšd
(
c
);

313 
cfIdxs
->
	`­³nd
(
	`IdxDiv
());

314 
cfIdxs
->
	`Ï¡I‹m
().
idx
 = idx;

315 
cfIdxs
->
	`Ï¡I‹m
().
div
 = 1;

316 ià(
i
 > 0 && 
c
->
	`cÚšsCÚ¡ªts
()èc->
	`Œª¦©eCÚ¡ªts
(
dom0
, 
dom
);

317 ià(
idx
 < 0)

319 
cout
 <<"ERROR: in IndexTranslator::"

321 
c
->
	`´štW™houtWtW™hSŒV¬
(
cout
, 
dom
); couˆ<< "nÙ found!"<<
’dl
;

322 
	`ex™
(-1);

329 ià(
	`t›CÏu£WtToFÜmuÏWt
(
mÊ
, 
j
))

331 cÚ¡ 
A¼ay
<
FÜmuÏCÏu£Indexes
*>& 
fciA¼


332 ğ
mÊ
->
	`g‘MLNCÏu£Info
(
j
)->
fÜmuÏCÏu£Indexes
;

334 
k
 = 0; k < 
fciA¼
.
	`size
(); k++)

336 
fidx
 = *(
fciA¼
[
k
]->
fÜmuÏIndex
);

337 ià(!
	`fÜmuÏWtT›dToCÏu£Wts
((*
âÿ
)[
fidx
])) ;

338 
¡ršg
 
fÜmuÏ
 = (*
âÿ
)[
fidx
]->formula;

339 
numCÏu£s
 = (*
âÿ
)[
fidx
]->
šdexCÏu£s
->
	`size
();

340 
idx
 = 
exi¡FÜmuÏOrd”šg_
->
	`fšd
(
fÜmuÏ
);

341 
cfIdxs
->
	`­³nd
(
	`IdxDiv
());

343 
cfIdxs
->
	`Ï¡I‹m
().
idx
 = idx + 
şau£Ord”šg_
->
	`size
();

345 ià(
mÊ
->
	`isExi¡CÏu£
(
j
))

346 
cfIdxs
->
	`Ï¡I‹m
().
div
 = 
numCÏu£s
;

348 ià(
mÊ
->
	`isExi¡UniqueCÏu£
(
j
))

351 
CÏu£
* 
fœ¡CÏu£


352 ğ(*((*
âÿ
)[
fidx
]->
šdexCÏu£s
))[0]->
şau£
;

353 
numP»ds
 = 
fœ¡CÏu£
->
	`g‘NumP»diÿ‹s
();

354 
CÏu£
* 
c
 = (CÏu£*è
mÊ
->
	`g‘CÏu£
(
j
);

355 ià(
c
->
	`§me
(
fœ¡CÏu£
))

356 
cfIdxs
->
	`Ï¡I‹m
().
div
 = (
numP»ds
 > 1) ?‚umPreds+1 : 1;

358 
cfIdxs
->
	`Ï¡I‹m
().
div
 = (
numP»ds
*numPreds-1)*0.5;

361 
	`as£¹
(
çl£
);

364 ià(
idx
 < 0)

366 
cout
 << "ERROR: in createClauseIdxToClauseFormulaIdxsMap(): "

367 << "fÜmuÏ " << 
fÜmuÏ
 << "nÙ found!" << 
’dl
;

368 
	`ex™
(-1);

373 
cfIdxs
->
	`com´ess
();

377 
	}
}

380 
	$­³ndCÏu£IdxToCÏu£FÜmuÏIdxs
(cÚ¡ & 
numCFIdxs
,

381 cÚ¡ & 
numCIdxsP”CFIdx
,

382 cÚ¡ & 
domašIdx
)

384 ià(
numCFIdxs
 == 0) ;

385 
A¼ay
<A¼ay<
IdxDiv
>*>& 
cidxs
 = (*
cIdxToCFIdxsP”Domaš_
)[
domašIdx
];

386 
A¼ay
<>& 
wts
 = (*
wtsP”Domaš_
)[
domašIdx
];

387 
A¼ay
<>& 
g¿ds
 = (*
g¿dsP”Domaš_
)[
domašIdx
];

388 
numCÏu£sFÜmuÏs
 = 
	`g‘NumCÏu£sAndExi¡FÜmuÏs
();

390 
j
 = 0; j < 
numCFIdxs
; j++)

392 
cfidx
 = 
numCÏu£sFÜmuÏs
 + 
j
;

393 
k
 = 0; k < 
numCIdxsP”CFIdx
; k++)

395 
IdxDiv
 
idiv
;

396 
idiv
.
idx
 = 
cfidx
;

397 
idiv
.
div
 = 1;

398 
A¼ay
<
IdxDiv
>* 
¬r
 = 
Ãw
 Array<IdxDiv>(1);

399 
¬r
->
	`­³nd
(
idiv
);

400 
cidxs
.
	`­³nd
(
¬r
);

402 
wts
.
	`­³nd
(0.0);

403 
g¿ds
.
	`­³nd
(0.0);

406 
	}
}

409 
	$­³ndCÏu£IdxToCÏu£FÜmuÏIdxs
(cÚ¡ & 
numCFIdxs
,

410 cÚ¡ & 
numCIdxsP”CFIdx
)

412 ià(
numCFIdxs
 == 0) ;

413 
i
 = 0; i < 
cIdxToCFIdxsP”Domaš_
->
	`size
(); i++)

414 
	`­³ndCÏu£IdxToCÏu£FÜmuÏIdxs
(
numCFIdxs
, 
numCIdxsP”CFIdx
, 
i
);

415 
	}
}

418 
	$»moveCÏu£IdxToCÏu£FÜmuÏIdxs
(cÚ¡ & 
numCFIdxs
,

419 cÚ¡ & 
numCIdxsP”CFIdx
,

420 cÚ¡ & 
domašIdx
)

422 ià(
numCFIdxs
 == 0) ;

423 
A¼ay
<A¼ay<
IdxDiv
>*>& 
cidxs
 = (*
cIdxToCFIdxsP”Domaš_
)[
domašIdx
];

424 
A¼ay
<>& 
wts
 = (*
wtsP”Domaš_
)[
domašIdx
];

425 
A¼ay
<>& 
g¿ds
 = (*
g¿dsP”Domaš_
)[
domašIdx
];

427 
j
 = 0; j < 
numCFIdxs
; j++)

428 
k
 = 0; k < 
numCIdxsP”CFIdx
; k++)

430 
d–‘e
 
cidxs
.
	`»moveLa¡I‹m
();

431 
wts
.
	`»moveLa¡I‹m
();

432 
g¿ds
.
	`»moveLa¡I‹m
();

434 
	}
}

437 
	$»moveCÏu£IdxToCÏu£FÜmuÏIdxs
(cÚ¡ & 
numCFIdxs
,

438 cÚ¡ & 
numCIdxsP”CFIdx
)

440 ià(
numCFIdxs
 == 0) ;

441 
i
 = 0; i < 
cIdxToCFIdxsP”Domaš_
->
	`size
(); i++)

442 
	`»moveCÏu£IdxToCÏu£FÜmuÏIdxs
(
numCFIdxs
, 
numCIdxsP”CFIdx
, 
i
);

443 
	}
}

446 
£tPriÜM—ns
(
A¼ay
<>& 
´iÜM—ns
)

448 
	g´iÜM—ns
.
ş—r
();

449 
	g´iÜM—ns
.
growToSize
(
şau£Ord”šg_
->
size
() +

450 
exi¡FÜmuÏOrd”šg_
->
size
());

451 
	gm
 = 0;

452 
MLN
* 
	gmÊ0
 = (*
mÊs_
)[0];

454 
	gi
 = 0; i < 
	gşau£Ord”šg_
->
size
(); i++)

456 
CÏu£
* 
	gc
 = (*
şau£Ord”šg_
)[
i
];

457 
	gcidx
 = 
mÊ0
->
fšdCÏu£Idx
(
c
);

458 
	g´iÜM—ns
[
m
++] = 
mÊ0
->
g‘MLNCÏu£Info
(
cidx
)->
´iÜM—n
;

461 cÚ¡ 
FÜmuÏAndCÏu£sA¼ay
* 
	gâÿ
 = 
mÊ0
->
g‘FÜmuÏAndCÏu£sA¼ay
();

462 
	gi
 = 0; i < 
	gexi¡FÜmuÏOrd”šg_
->
size
(); i++)

464 
FÜmuÏAndCÏu£s
 
tmp
((*
exi¡FÜmuÏOrd”šg_
)[
i
], 0, 
çl£
, false,

465 
çl£
);

466 
	ga
 = 
âÿ
->
fšd
(&
tmp
);

467 
as£¹
(
a
 >= 0);

468 
	g´iÜM—ns
[
m
++] = (*
âÿ
)[
a
]->
´iÜM—n
;

475 
g‘CÏu£FÜmuÏIndexes
(
A¼ay
<>& 
şau£Indexes
, cÚ¡ & 
domašIdx
)

477 
	gi
 = 0; i < 
	gşau£Indexes
.
size
(); i++)

479 
	gcidx
 = 
şau£Indexes
[
i
];

480 
	gA¼ay
<
	gIdxDiv
>* 
	gidxDivs
 = (*
cIdxToCFIdxsP”Domaš_
)[
domašIdx
][
cidx
];

481 
	gj
 = 0; j < 
	gidxDivs
->
size
(); j++)

482 ià((*
	gidxDivs
)[
j
].
	gidx
 < 
	gşau£Ord”šg_
->
size
())

486 
as£¹
((*
idxDivs
)[
j
].
div
 == 1);

487 
	gşau£Indexes
[
i
] = (*
idxDivs
)[
j
].
idx
;

495 
	$assignNÚT›dCÏu£WtsToMLNs
(cÚ¡ * cÚ¡ & 
wts
)

497 
i
 = 0; i < 
mÊs_
->
	`size
(); i++)

499 
MLN
* 
mÊ
 = (*
mÊs_
)[
i
];

500 
j
 = 0; j < 
mÊ
->
	`g‘NumCÏu£s
(); j++)

502 ià(!
	`noT›CÏu£WtToFÜmuÏWt
(
mÊ
,
j
)) ;

504 
CÏu£
* 
c
 = ((CÏu£*è
mÊ
->
	`g‘CÏu£
(
j
));

505 
	`as£¹
(
	`šCÏu£Ord”šg
(
c
, 
i
));

506 
A¼ay
<
IdxDiv
>* 
idxDivs
 =(*
cIdxToCFIdxsP”Domaš_
)[
i
][
j
];

507 
wt
 = 0;

508 
k
 = 0; k < 
idxDivs
->
	`size
(); k++)

511 ià((*
idxDivs
)[
k
].
idx
 < 
şau£Ord”šg_
->
	`size
())

512 
wt
 +ğ
wts
[ (*
idxDivs
)[
k
].
idx
 ] / (*idxDivs)[k].
div
;

514 
c
->
	`£tWt
(
wt
);

517 
	}
}

520 
	$´štCÏu£FÜmuÏWts
(
o¡»am
& 
out
, cÚ¡ 
boŞ
& 
šşudeIdx
)

522 
A¼ay
<> 
wts
;

523 
	`g‘CÏu£FÜmuÏWts
(
wts
);

525 
A¼ay
<
CÏu£
*> 
tmp
;

526 
i
 = 0; i < 
şau£Ord”šg_
->
	`size
(); i++)

528 (*
şau£Ord”šg_
)[
i
]->
	`£tWt
(
wts
[i]);

529 
tmp
.
	`­³nd
((*
şau£Ord”šg_
)[
i
]);

531 
CÏu£
::
	`sÜtByL’
(
tmp
);

533 
out
.
	`£tf
(
ios_ba£
::
Ëá
, ios_ba£::
adju¡f›ld
);

534 
i
 = 0; i < 
tmp
.
	`size
(); i++)

536 ià(
šşudeIdx
è{ 
out
 << 
i
 << ": "; out.
	`width
(14); }

537 { 
out
.
	`width
(10); }

538 
out
 << 
tmp
[
i
]->
	`g‘Wt
(); out.
	`width
(0); out << " ";

539 
tmp
[
i
]->
	`´štW™houtWtW™hSŒV¬
(
out
, (*
domašs_
)[0]); ouˆ<< 
’dl
;

541 
out
.
	`width
(0);

543 
i
 = 0; i < 
exi¡FÜmuÏOrd”šg_
->
	`size
(); i++)

545 
idx
 = 
i
+
şau£Ord”šg_
->
	`size
();

546 ià(
šşudeIdx
è{ 
out
 << 
idx
 <<": ";out.
	`width
(14);}

547 { 
out
.
	`width
(10); }

548 
out
 << 
wts
[
idx
]; out.
	`width
(0);

549 
out
 << " " << (*
exi¡FÜmuÏOrd”šg_
)[
i
] << 
’dl
;

551 
out
.
	`width
(0);

552 
	}
}

556 
£tR–evªtCÏu£sFÜmuÏs
(
A¼ay
<
boŞ
>& 
»ËvªtCÏu£sFÜmuÏs
,

557 cÚ¡ 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£sInMLN0
)

559 cÚ¡ 
	gA¼ay
<
	gboŞ
>& 
	g»ËvªtCÏu£s
 = 
»ËvªtCÏu£sInMLN0
;

561 ià(
	g»ËvªtCÏu£sFÜmuÏs
.
size
(è< 
	g»ËvªtCÏu£s
.size())

562 
	g»ËvªtCÏu£sFÜmuÏs
.
growToSize
(
»ËvªtCÏu£s
.
size
());

564 ià(
	g»ËvªtCÏu£sFÜmuÏs
.
size
(è> 
	g»ËvªtCÏu£s
.size())

565 
	g»ËvªtCÏu£sFÜmuÏs
.
shrškToSize
(
»ËvªtCÏu£s
.
size
());

567 
	gi
 = 0; i < 
	g»ËvªtCÏu£sFÜmuÏs
.
size
(); i++)

568 
	g»ËvªtCÏu£sFÜmuÏs
[
i
] = 
çl£
;

571 
	gi
 = 0; i < 
	gşau£Ord”šg_
->
size
(); i++)

573 
	gcidx
 = (*
mÊs_
)[0]->
fšdCÏu£Idx
((*
şau£Ord”šg_
)[
i
]);

574 
	g»ËvªtCÏu£sFÜmuÏs
[
i
] = 
»ËvªtCÏu£s
[
cidx
];

577 
	goff£t
 = 
şau£Ord”šg_
->
size
();

579 
	gi
 = 0; i < 
	gexi¡FÜmuÏOrd”šg_
->
size
(); i++)

581 cÚ¡ 
IndexCÏu£HashA¼ay
* 
	gicha


582 ğ(*
mÊs_
)[0]->
g‘CÏu£sOfFÜmuÏ
((*
exi¡FÜmuÏOrd”šg_
)[
i
]);

583 
	gj
 = 0; j < 
	gicha
->
size
(); j++)

585 
	gcidx
 = (*
mÊs_
)[0]->
fšdCÏu£Idx
((*
icha
)[
j
]->
şau£
);

586 
	g»ËvªtCÏu£sFÜmuÏs
[
off£t
+
i
] = 
»ËvªtCÏu£s
[
cidx
];

587 ià(
	g»ËvªtCÏu£sFÜmuÏs
[
off£t
+
i
]) ;

593 
´štR–evªtCÏu£sFÜmuÏs
(
o¡»am
& 
out
,

594 cÚ¡ 
A¼ay
<
boŞ
>& 
»ËvªtCÏu£sFÜmuÏs
)

596 
	gi
 = 0; i < 
	gşau£Ord”šg_
->
size
(); i++)

598 ià(
	g»ËvªtCÏu£sFÜmuÏs
[
i
])

600 
	gout
 << 
	gi
 << ": ";

601 (*
	gşau£Ord”šg_
)[
i
]->
´štW™houtWtW™hSŒV¬
(
out
, (*
domašs_
)[0]);

602 
	gout
 << 
	g’dl
;

606 
	goff£t
 = 
şau£Ord”šg_
->
size
();

608 
	gi
 = 0; i < 
	gexi¡FÜmuÏOrd”šg_
->
size
(); i++)

610 ià(
	g»ËvªtCÏu£sFÜmuÏs
[
off£t
+
i
])

611 
	gout
 << 
	goff£t
+
	gi
 << ": " << (*
	gexi¡FÜmuÏOrd”šg_
)[
i
] << 
	g’dl
;

616 
	g´iv©e
:

617 
	$ŒackCÏu£CÚ¡ªts
()

619 
i
 = 0; i < 
mÊs_
->
	`size
(); i++)

620 
j
 = 0; j < (*
mÊs_
)[
i
]->
	`g‘NumCÏu£s
(); j++)

621 ià(
	`noT›CÏu£WtToFÜmuÏWt
((*
mÊs_
)[
i
], 
j
))

623 
CÏu£
* 
c
 = (CÏu£*è(*
mÊs_
)[
i
]->
	`g‘CÏu£
(
j
);

624 ià(
c
->
	`g‘AuxCÏu£D©a
(è=ğ
NULL
èc->
	`ÃwAuxCÏu£D©a
();

625 
c
->
	`ŒackCÚ¡ªts
();

627 
	}
}

630 
	$ü—‹CÏu£sFÜmuÏsOrd”šg
(
MLN
* cÚ¡ & 
mÊ
,

631 
CÏu£HashA¼ay
* cÚ¡ & 
şau£s
,

632 
SŒšgHashA¼ay
* cÚ¡ & 
exi¡FÜmuÏs
)

634 
i
 = 0; i < 
mÊ
->
	`g‘NumCÏu£s
(); i++)

635 ià(
	`noT›CÏu£WtToFÜmuÏWt
(
mÊ
,
i
))

637 
CÏu£
* 
c
 = 
Ãw
 
	`CÏu£
Ğ*((CÏu£*)
mÊ
->
	`g‘CÏu£
(
i
)) );

638 
şau£s
->
	`­³nd
(
c
);

641 cÚ¡ 
FÜmuÏAndCÏu£sA¼ay
* 
âÿ
 = 
mÊ
->
	`g‘FÜmuÏAndCÏu£sA¼ay
();

642 
i
 = 0; i < 
âÿ
->
	`size
(); i++)

643 ià(
	`fÜmuÏWtT›dToCÏu£Wts
((*
âÿ
)[
i
]))

644 
exi¡FÜmuÏs
->
	`­³nd
((*
âÿ
)[
i
]->
fÜmuÏ
);

645 
	}
}

648 
boŞ
 
	$šCÏu£Ord”šg
(
CÏu£
* cÚ¡ & 
c
, cÚ¡ & 
domašIdx
)

650 
	`as£¹
(
c
->
	`g‘AuxCÏu£D©a
());

651 ià(
domašIdx
 > 0 && 
c
->
	`cÚšsCÚ¡ªts
())

652 
c
->
	`Œª¦©eCÚ¡ªts
((*
domašs_
)[
domašIdx
], (*domains_)[0]);

653 
boŞ
 
š
 = (
şau£Ord”šg_
->
	`fšd
(
c
) >= 0);

654 ià(
domašIdx
 > 0 && 
c
->
	`cÚšsCÚ¡ªts
())

655 
c
->
	`Œª¦©eCÚ¡ªts
((*
domašs_
)[0], (*domašs_)[
domašIdx
]);

656  
š
;

657 
	}
}

664 
boŞ
 
	$t›CÏu£WtToFÜmuÏWt
(cÚ¡ 
MLN
* cÚ¡ & 
mÊ
, cÚ¡ & 
i
)

665 {  (
mÊ
->
	`isExi¡CÏu£
(
i
è|| mÊ->
	`isExi¡UniqueCÏu£
(i)); 
	}
}

668 
boŞ
 
	$fÜmuÏWtT›dToCÏu£Wts
(cÚ¡ 
FÜmuÏAndCÏu£s
* cÚ¡ & 
âc
)

669 {  (
âc
->
hasExi¡
 || fnc->
isExi¡Unique
); 
	}
}

676 
boŞ
 
	$noT›CÏu£WtToFÜmuÏWt
(cÚ¡ 
MLN
* cÚ¡ & 
mÊ
, cÚ¡ & 
i
)

677 {  
mÊ
->
	`şau£InNÚExi¡AndNÚExi¡UniqueFÜmuÏCNF
(
i
); 
	}
}

679 
	g´iv©e
:

680 cÚ¡ 
A¼ay
<
MLN
*>* 
mÊs_
;

681 cÚ¡ 
	gA¼ay
<
	gDomaš
*>* 
	gdomašs_
;

688 
	gA¼ay
<A¼ay<A¼ay<
	gIdxDiv
>*> >* 
	gcIdxToCFIdxsP”Domaš_
;

689 
	gA¼ay
<A¼ay<> >* 
	gwtsP”Domaš_
;

690 
	gA¼ay
<A¼ay<> >* 
	gg¿dsP”Domaš_
;

692 
CÏu£HashA¼ay
* 
	gşau£Ord”šg_
;

693 
SŒšgHashA¼ay
* 
	gexi¡FÜmuÏOrd”šg_
;

	@lbfgsb.h

67 #iâdeà
LBFGSB_H_SEP_17_2005


68 
	#LBFGSB_H_SEP_17_2005


	)

70 
	~<cm©h
>

71 
	~<c¡dlib
>

72 
	~<f¡»am
>

73 
	~"tim”.h
"

74 
	~"p£udŞoglik–ihood.h
"

75 
	~"PŞynomŸl.h
"

77 cÚ¡ 
	gLBFGSB_PRINT
 = -1;

85 şas 
	cLBFGSB


87 
	mpublic
:

88 
	$LBFGSB
(cÚ¡ & 
maxI‹r
, cÚ¡ & 
áŞ
,

89 
P£udoLogLik–ihood
* cÚ¡& 
¶l
, cÚ¡ & 
numWts
)

90 : 
	`maxI‹r_
(
maxI‹r
), 
	`áŞ_
(
áŞ
), 
	`¶l_
(
¶l
),

91 
	`nbd_
(
NULL
), 
	`iwa_
(NULL), 
	`l_
(NULL), 
	`u_
(NULL), 
	`g_
(NULL), 
	$wa_
(
NULL
)

92 { 
	`š™
(
numWts
); }

95 ~
	$LBFGSB
(è{ 
	`de¡roy
(); 
	}
}

98 
	$£tMaxI‹r
(cÚ¡ & 
™”
è{ 
maxI‹r_
 = i‹r; 
	}
}

100 
	$£tFtŞ
(cÚ¡ & 
tŞ
è{ 
áŞ_
 =Ş; 
	}
}

103 
	$š™
(cÚ¡ & 
numWts
)

105 
	`de¡roy
();

106 
numWts_
 = 
numWts
;

107 
mmax
 = 17;

108 
nbd_
 = 
Ãw
 [
numWts_
+1];

109 
iwa_
 = 
Ãw
 [3*
numWts_
+1];

110 
l_
 = 
Ãw
 [
numWts_
+1];

111 
u_
 = 
Ãw
 [
numWts_
+1];

112 
g_
 = 
Ãw
 [
numWts_
+1];

113 
wa_
 = 
Ãw
 [2*
mmax
*
numWts_
+4*numWts_+12*mmax*mmax+12*mmax+1];

114 
	}
}

117 
	$»In™
(cÚ¡ & 
numWts
)

119 ià(
numWts_
 =ğ
numWts
) ;

120 
	`š™
(
numWts
);

121 
	}
}

123 
	$de¡roy
()

125 ià(
nbd_
 !ğ
NULL
è
d–‘e
 []‚bd_;

126 ià(
iwa_
 !ğ
NULL
è
d–‘e
 [] iwa_;

127 ià(
l_
 !ğ
NULL
è
d–‘e
 []†_;

128 ià(
u_
 !ğ
NULL
è
d–‘e
 [] u_;

129 ià(
g_
 !ğ
NULL
è
d–‘e
 [] g_;

130 ià(
wa_
 !ğ
NULL
è
d–‘e
 [] wa_;

131 
	}
}

133 
	$mšimize
(* cÚ¡ & 
wts
, & 
™”
, 
boŞ
& 
”rÜ
)

135 
”rÜ
 = 
çl£
;

136 
m
 = 5;

137 
f
;

138 
çùr
 = 0;

139 
pgtŞ
 = 0;

141 
of¡»am
* 
™fe
 = 
NULL
;

142 
ršt
 = 
LBFGSB_PRINT
;

143 ià(
ršt
 >ğ1è
™fe
 = 
Ãw
 
	`of¡»am
("iterate.dat");

144 
™”
 = 0;

147 
i
 = 0; i <ğ
numWts_
; i++è
nbd_
[i] = 0;

149 
	`¡rıy
(
sk_
,"START");

150 
i
 = 5; i <ğ60; i++è
sk_
[i]=' ';

152 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

153 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

155 
š™ŸlV®ue
 = 0, 
´evV®ue
 = 0, 
ÃwV®ue
;

156 
boŞ
 
fœ¡I‹r
 = 
Œue
;

159 
	`¡ºcmp
(
sk_
,"FG",2)==0 || strncmp(task_,"NEW_X",5)==0)

161 ià(
	`¡ºcmp
(
sk_
,"FG",2)==0)

163 
f
 = 
	`g‘V®ueAndG¿d›Á
(
g_
, 
wts
);

165 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

166 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

168 ià(
fœ¡I‹r
è{ fœ¡I‹¸ğ
çl£
; 
´evV®ue
 = 
f
; 
š™ŸlV®ue
 = f; }

174 ià(
™”
+1 > 
maxI‹r_
) ;

175 ++
™”
;

176 
ÃwV®ue
 = 
f
;

178 ià(
	`çbs
(
ÃwV®ue
-
´evV®ue
è< 
áŞ_
*fabs(prevValue)) ;

179 
´evV®ue
 = 
ÃwV®ue
;

181 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

182 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

191 ià(
	`¡ºcmp
(
sk_
,"ABNO",4) == 0)

193 
cout
 << "ERROR: LBFGSB faed. R‘uºed ABNO" << 
’dl
;

194 
”rÜ
 = 
Œue
;

195  
š™ŸlV®ue
;

198 ià(
	`¡ºcmp
(
sk_
,"ERROR",5)==0)

200 
cout
 << "ERROR: LBFGSB faed. R‘uºed ERROR" << 
’dl
;

201 
”rÜ
 = 
Œue
;

202  
š™ŸlV®ue
;

205 ià(
	`¡ºcmp
(
sk_
,"CONV",4)==0)

210  
f
;

211 
	}
}

213 
	$mšimize
(cÚ¡ & 
numWts
, * cÚ¡ & 
wts
, & 
™”
,
boŞ
& 
”rÜ
)

215 
	`»In™
(
numWts
);

216  
	`mšimize
(
wts
, 
™”
, 
”rÜ
);

217 
	}
}

219 
	$¡¬tPl
(* cÚ¡ & 
wts
, & 
™”
, 
boŞ
& 
”rÜ
, 
PŞyNomŸl
& 
¶
)

221 
”rÜ
 = 
çl£
;

222 
m
 = 5;

223 
f
;

224 
çùr
 = 0;

225 
pgtŞ
 = 0;

227 
of¡»am
* 
™fe
 = 
NULL
;

228 
ršt
 = 
LBFGSB_PRINT
;

229 ià(
ršt
 >ğ1è
™fe
 = 
Ãw
 
	`of¡»am
("iterate.dat");

230 
™”
 = 0;

235 
i
 = 0; i <ğ
numWts_
; i++è
nbd_
[i] = 2;

237 
	`¡rıy
(
sk_
,"START");

238 
i
 = 5; i <ğ60; i++è
sk_
[i]=' ';

241 
¶
.
v¬V®ue_
.
	`ş—r
();

242 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

244 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

245 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

247 
™”
++;

248 
¶
.
v¬V®ue_
.
	`ş—r
();

249 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

250  
f
;

251 
	}
}

253 
	$´oûedOÃS‹pPl
(* cÚ¡ & 
wts
, & 
š™ŸlV®ue
, & 
™”
, 
boŞ
& 
”rÜ
, 
PŞyNomŸl
& 
¶
)

255 
”rÜ
 = 
çl£
;

256 
m
 = 5;

257 
f
 = 
š™ŸlV®ue
;

258 
çùr
 = 0;

259 
pgtŞ
 = 0;

261 
of¡»am
* 
™fe
 = 
NULL
;

262 
ršt
 = 
LBFGSB_PRINT
;

263 ià(
ršt
 >ğ1è
™fe
 = 
Ãw
 
	`of¡»am
("iterate.dat");

266 ià(
	`¡ºcmp
(
sk_
,"FG",2)==0)

268 
f
 = 
	`g‘V®ueAndG¿d›ÁPl
(
g_
, 
wts
, 
¶
);

269 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

270 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

271 
¶
.
v¬V®ue_
.
	`ş—r
();

272 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

279 ià(
™”
 + 1 > 
maxI‹r_
è -
BigV®ue
;

280 ++
™”
;

282 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

283 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

285 
¶
.
v¬V®ue_
.
	`ş—r
();

286 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

294  
f
;

296 
	}
}

299 
	$mšimizePl
(* cÚ¡ & 
wts
, & 
™”
, 
boŞ
& 
”rÜ
, 
PŞyNomŸl
& 
¶
)

301 
”rÜ
 = 
çl£
;

302 
m
 = 5;

303 
f
;

304 
çùr
 = 0;

305 
pgtŞ
 = 0;

307 
of¡»am
* 
™fe
 = 
NULL
;

308 
ršt
 = 
LBFGSB_PRINT
;

309 ià(
ršt
 >ğ1è
™fe
 = 
Ãw
 
	`of¡»am
("iterate.dat");

310 
™”
 = 0;

315 
i
 = 0; i <ğ
numWts_
; i++è
nbd_
[i] = 2;

317 
	`¡rıy
(
sk_
,"START");

318 
i
 = 5; i <ğ60; i++è
sk_
[i]=' ';

321 
¶
.
v¬V®ue_
.
	`ş—r
();

322 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

324 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

325 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

327 
¶
.
v¬V®ue_
.
	`ş—r
();

328 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

331 
š™ŸlV®ue
 = 0, 
´evV®ue
 = 0, 
ÃwV®ue
;

332 
boŞ
 
fœ¡I‹r
 = 
Œue
;

335 
	`¡ºcmp
(
sk_
,"FG",2)==0 || strncmp(task_,"NEW_X",5)==0)

337 ià(
	`¡ºcmp
(
sk_
,"FG",2)==0)

339 
f
 = 
	`g‘V®ueAndG¿d›ÁPl
(
g_
, 
wts
, 
¶
);

341 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

342 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

344 
¶
.
v¬V®ue_
.
	`ş—r
();

345 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

348 ià(
fœ¡I‹r
è{ fœ¡I‹¸ğ
çl£
; 
´evV®ue
 = 
f
; 
š™ŸlV®ue
 = f; }

354 ià(
™”
+1 > 
maxI‹r_
) ;

355 ++
™”
;

356 
ÃwV®ue
 = 
f
;

358 ià(
	`çbs
(
ÃwV®ue
-
´evV®ue
è< 
áŞ_
*fabs(prevValue)) ;

359 
´evV®ue
 = 
ÃwV®ue
;

361 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

362 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

364 
¶
.
v¬V®ue_
.
	`ş—r
();

365 
i
 = 0; i < 
numWts_
; i++è
¶
.
v¬V®ue_
.
	`­³nd
(
wts
[i+1]);

375 ià(
	`¡ºcmp
(
sk_
,"ABNO",4) == 0)

377 
cout
 << "ERROR: LBFGSB faed. R‘uºed ABNO" << 
’dl
;

378 
”rÜ
 = 
Œue
;

379  
š™ŸlV®ue
;

382 ià(
	`¡ºcmp
(
sk_
,"ERROR",5)==0)

384 
cout
 << "ERROR: LBFGSB faed. R‘uºed ERROR" << 
’dl
;

385 
”rÜ
 = 
Œue
;

386  
š™ŸlV®ue
;

389 ià(
	`¡ºcmp
(
sk_
,"CONV",4)==0)

394  
f
;

396 
	}
}

399 
	$£tUµ”Bounds
(cÚ¡ * 
u
)

401 ià(
numWts_
 > 0)

403 
	`memıy
(
u_
+1, 
u
, 
numWts_
*());

405 
	}
}

407 
	$£tLow”Bounds
(cÚ¡ * 
l
)

409 if(
numWts_
 > 0)

411 
	`memıy
(
l_
+1, 
l
, 
numWts_
*());

413 
	}
}

415 
	g´iv©e
:

416 
maxI‹r_
;

417 
	gáŞ_
;

418 
P£udoLogLik–ihood
* 
	g¶l_
;

419 
	gnumWts_
;

422 * 
	gnbd_
;

423 * 
	giwa_
;

424 * 
	gl_
;

425 * 
	gu_
;

426 * 
	gg_
;

427 * 
	gwa_
;

429 
	gsk_
[61];

430 
	gc§ve_
[61];

431 
boŞ
 
	gl§ve_
[5];

432 
	gi§ve_
[45];

433 
	gd§ve_
[30];

436 
	g´iv©e
 :

438 
	$g‘V®ueAndG¿d›ÁPl
(* cÚ¡ & 
g
, cÚ¡ * cÚ¡ & 
wts
, 
PŞyNomŸl
& 
¶
)

440 
g
[0] = 0;

443 
A¼ay
<> 
gr
 = 
¶
.
	`G‘G¿d›Á
();

445 
i
 = 0; i < 
gr
.
	`size
(); i++)

447 
g
[
i
+1] = 
gr
[i];

450  
¶
.
	`Compu‹PlV®ue
();

451 
	}
}

453 
	$g‘V®ueAndG¿d›Á
(* 
g
, * 
wts
)

455  (
¶l_
->
	`g‘V®ueAndG¿d›Á
(
g
+1, 
wts
+1, 
numWts_
));

456 
	}
}

459 
	$g‘Idx
(cÚ¡ & 
i
, cÚ¡ & 
j
, cÚ¡ & 
idim
)

461  (
j
-1)*
idim
 + 
i
;

462 
	}
}

465 
	$max
(cÚ¡ & 
a
, cÚ¡ & 
b
è{ ià×>=bè‡;  b; 
	}
}

467 
	$mš
(cÚ¡ & 
a
, cÚ¡ & 
b
è{ ià×<=bè‡;  b; 
	}
}

469 
	$mš
(cÚ¡ & 
a
, cÚ¡ & 
b
è{ ià×<=bè‡;  b; 
	}
}

471 
	$max
(cÚ¡ & 
a
, cÚ¡ & 
b
, cÚ¡ & 
c
)

473 ià(
a
 >ğ
b
 &&‡ >ğ
c
) ‡;

474 ià(
b
 >ğ
a
 && b >ğ
c
)  b;

475 
	`as£¹
(
c
 >ğ
a
 && c >ğ
b
);

476  
c
;

477 
	}
}

668 
	$£tulb
(cÚ¡ & 
n
, cÚ¡ & 
m
, * cÚ¡ & 
x
,

669 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

670 cÚ¡ * cÚ¡ & 
nbd
, & 
f
, * cÚ¡ & 
g
,

671 cÚ¡ & 
çùr
, cÚ¡ & 
pgtŞ
,

672 * cÚ¡ & 
wa
, * cÚ¡ & 
iwa
,

673 * cÚ¡ & 
sk
, cÚ¡ & 
ršt
,

674 * cÚ¡ & 
c§ve
, 
boŞ
* cÚ¡ & 
l§ve
,

675 * cÚ¡ & 
i§ve
, * cÚ¡ & 
d§ve
,

676 
of¡»am
* 
™fe
)

678 
l1
,
l2
,
l3
,
lws
,
Ì
,
lz
,
É
,
ld
,
lsg
,
lwa
,
lyg
,

679 
lsgo
,
lwy
,
lsy
,
lss
,
lyy
,
lwt
,
lwn
,
l¢d
,
lygo
;

681 ià(
	`¡ºcmp
(
sk
,"START",5)==0)

683 
i§ve
[1] = 
m
*
n
;

684 
i§ve
[2] = 
m
*m;

685 
i§ve
[3] = 4*
m
*m;

686 
i§ve
[4] = 1;

687 
i§ve
[5] = isave[4] + isave[1];

688 
i§ve
[6] = isave[5] + isave[1];

689 
i§ve
[7] = isave[6] + isave[2];

690 
i§ve
[8] = isave[7] + isave[2];

691 
i§ve
[9] = isave[8] + isave[2];

692 
i§ve
[10] = isave[9] + isave[2];

693 
i§ve
[11] = isave[10] + isave[3];

694 
i§ve
[12] = isave[11] + isave[3];

695 
i§ve
[13] = i§ve[12] + 
n
;

696 
i§ve
[14] = i§ve[13] + 
n
;

697 
i§ve
[15] = i§ve[14] + 
n
;

698 
i§ve
[16] = i§ve[15] + 
n
;

699 
i§ve
[17] = i§ve[16] + 8*
m
;

700 
i§ve
[18] = i§ve[17] + 
m
;

701 
i§ve
[19] = i§ve[18] + 
m
;

702 
i§ve
[20] = i§ve[19] + 
m
;

704 
l1
 = 
i§ve
[1];

705 
l2
 = 
i§ve
[2];

706 
l3
 = 
i§ve
[3];

707 
lws
 = 
i§ve
[4];

708 
lwy
 = 
i§ve
[5];

709 
lsy
 = 
i§ve
[6];

710 
lss
 = 
i§ve
[7];

711 
lyy
 = 
i§ve
[8];

712 
lwt
 = 
i§ve
[9];

713 
lwn
 = 
i§ve
[10];

714 
l¢d
 = 
i§ve
[11];

715 
lz
 = 
i§ve
[12];

716 
Ì
 = 
i§ve
[13];

717 
ld
 = 
i§ve
[14];

718 
É
 = 
i§ve
[15];

719 
lwa
 = 
i§ve
[16];

720 
lsg
 = 
i§ve
[17];

721 
lsgo
 = 
i§ve
[18];

722 
lyg
 = 
i§ve
[19];

723 
lygo
 = 
i§ve
[20];

725 
tim”_
.
	`»£t
();

727 
	`mašlb
(
n
,
m
,
x
,
l
,
u
,
nbd
,
f
,
g
,
çùr
,
pgtŞ
,

728 &(
wa
[
lws
-1]),&(wa[
lwy
-1]),&(wa[
lsy
-1]),&(wa[
lss
-1]),&(wa[
lyy
-1]),

729 &(
wa
[
lwt
-1]),&(wa[
lwn
-1]),&(wa[
l¢d
-1]),&(wa[
lz
-1]),&(wa[
Ì
-1]),

730 &(
wa
[
ld
-1]),&(wa[
É
-1]),&(wa[
lwa
-1]),&(wa[
lsg
-1]),&(wa[
lsgo
-1]),

731 &(
wa
[
lyg
-1]),&(wa[
lygo
-1]),&(
iwa
[1-1]),&(iwa[
n
+1-1]),&(iwa[2*n+1-1]),

732 
sk
,
ršt
,
c§ve
,
l§ve
,&(
i§ve
[22-1]),
d§ve
, 
™fe
);

733 
	}
}

915 
	$mašlb
(cÚ¡ & 
n
, cÚ¡ & 
m
, * cÚ¡ & 
x
,

916 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

917 cÚ¡ * cÚ¡ & 
nbd
, & 
f
, * cÚ¡ & 
g
,

918 cÚ¡ & 
çùr
, cÚ¡ & 
pgtŞ
,

919 * cÚ¡ & 
ws
, * cÚ¡ & 
wy
, * cÚ¡ & 
sy
,

920 * cÚ¡ & 
ss
, * cÚ¡ & 
yy
, * cÚ¡ & 
wt
,

921 * cÚ¡ & 
wn
, * cÚ¡ & 
¢d
, * cÚ¡ & 
z
,

922 * cÚ¡ & 
r
, * cÚ¡ & 
d
, * cÚ¡ & 
t
,

923 * cÚ¡ & 
wa
, * cÚ¡ & 
sg
, * cÚ¡& 
sgo
,

924 * cÚ¡ & 
yg
, * cÚ¡ & 
ygo
, * cÚ¡& 
šdex
,

925 * cÚ¡ & 
iwh”e
, * cÚ¡ & 
šdx2
, * cÚ¡& 
sk
,

926 cÚ¡ & 
ršt
, * cÚ¡& 
c§ve
, 
boŞ
 * cÚ¡& 
l§ve
,

927 * cÚ¡ & 
i§ve
, * cÚ¡ & 
d§ve
, 
of¡»am
* 
™fe
)

929 
boŞ
 
´jùd
,
ú¡nd
,
boxed
,
upd©d
,
wrk
;

930 
wÜd
[4];

931 
k
,
nštŞ
,
iback
,
nsk
,

932 
h—d
,
cŞ
,
™”
,
™a
,
iupd©
,

933 
nšt
,
nfgv
,
šfo
,
ifun
=0,

934 
iwÜd
,
nä“
,
Çù
,
—ve
,
ÃÁ”
;

935 
th‘a
,
fŞd
=0,
dr
,
¼
,
tŞ
,

936 
x¡•
,
sbgÄm
,
ddum
,
dnÜm
=0,
dtd
,
•smch
,

937 
ıu1
=0,
ıu2
,
ÿchyt
,
sbtime
,
Êscht
,
time1
,
time2
,

938 
gd
,
gdŞd
=0,
¡p
,
¡pmx
=0,
time
;

939 
Úe
=1.0,
z”o
=0.0;

941 ià(
ršt
 > 1è{ 
	`as£¹
(
™fe
); }

943 ià(
	`¡ºcmp
(
sk
,"START",5)==0)

945 
time1
 = 
tim”_
.
	`time
();

948 
•smch
 = 
	`dpm•s
();

955 
cŞ
 = 0;

956 
h—d
 = 1;

957 
th‘a
 = 
Úe
;

958 
iupd©
 = 0;

959 
upd©d
 = 
çl£
;

962 
™”
 = 0;

963 
nfgv
 = 0;

964 
nšt
 = 0;

965 
nštŞ
 = 0;

966 
nsk
 = 0;

967 
nä“
 = 
n
;

970 
tŞ
 = 
çùr
*
•smch
;

973 
ÿchyt
 = 0;

974 
sbtime
 = 0;

975 
Êscht
 = 0;

979 
	`¡rıy
(
wÜd
, "---");

982 
šfo
 = 0;

992 
	`”rşb
(
n
,
m
,
çùr
,
l
,
u
,
nbd
,
sk
,
šfo
,
k
);

993 ià(
	`¡ºcmp
(
sk
,"ERROR",5)==0)

995 
	`´n3lb
(
n
,
x
,
f
,
sk
,
ršt
,
šfo
,
™fe
,

996 
™”
,
nfgv
,
nštŞ
,
nsk
,
Çù
,
sbgÄm
,

997 
z”o
,
nšt
,
wÜd
,
iback
,
¡p
,
x¡•
,
k
,

998 
ÿchyt
,
sbtime
,
Êscht
);

1002 
	`´n1lb
(
n
,
m
,
l
,
u
,
x
,
ršt
,
™fe
,
•smch
);

1005 
	`aùive
(
n
,
l
,
u
,
nbd
,
x
,
iwh”e
,
ršt
,
´jùd
,
ú¡nd
,
boxed
) ;

1012 
´jùd
 = 
l§ve
[1];

1013 
ú¡nd
 = 
l§ve
[2];

1014 
boxed
 = 
l§ve
[3];

1015 
upd©d
 = 
l§ve
[4];

1017 
nštŞ
 = 
i§ve
[1];

1019 
iback
 = 
i§ve
[4];

1020 
nsk
 = 
i§ve
[5];

1021 
h—d
 = 
i§ve
[6];

1022 
cŞ
 = 
i§ve
[7];

1023 
™a
 = 
i§ve
[8];

1024 
™”
 = 
i§ve
[9];

1025 
iupd©
 = 
i§ve
[10];

1026 
nšt
 = 
i§ve
[12];

1027 
nfgv
 = 
i§ve
[13];

1028 
šfo
 = 
i§ve
[14];

1029 
ifun
 = 
i§ve
[15];

1030 
iwÜd
 = 
i§ve
[16];

1031 
nä“
 = 
i§ve
[17];

1032 
Çù
 = 
i§ve
[18];

1033 
—ve
 = 
i§ve
[19];

1034 
ÃÁ”
 = 
i§ve
[20];

1036 
th‘a
 = 
d§ve
[1];

1037 
fŞd
 = 
d§ve
[2];

1038 
tŞ
 = 
d§ve
[3];

1039 
dnÜm
 = 
d§ve
[4];

1040 
•smch
 = 
d§ve
[5];

1041 
ıu1
 = 
d§ve
[6];

1042 
ÿchyt
 = 
d§ve
[7];

1043 
sbtime
 = 
d§ve
[8];

1044 
Êscht
 = 
d§ve
[9];

1045 
time1
 = 
d§ve
[10];

1046 
gd
 = 
d§ve
[11];

1047 
¡pmx
 = 
d§ve
[12];

1048 
sbgÄm
 = 
d§ve
[13];

1049 
¡p
 = 
d§ve
[14];

1050 
gdŞd
 = 
d§ve
[15];

1051 
dtd
 = 
d§ve
[16];

1056 ià(
	`¡ºcmp
(
sk
,"FG_LN",5)==0è
gÙo66
;

1057 ià(
	`¡ºcmp
(
sk
,"NEW_X",5)==0è
gÙo777
;

1058 ià(
	`¡ºcmp
(
sk
,"FG_ST",5)==0è
gÙo111
;

1059 ià(
	`¡ºcmp
(
sk
,"STOP",4)==0)

1061 ià(
	`¡ºcmp
(&(
sk
[6]),"CPU",3)==0)

1064 
	`dcİy
(
n
,
t
,1,
x
,1);

1065 
	`dcİy
(
n
,
r
,1,
g
,1);

1066 
f
 = 
fŞd
;

1068 
gÙo999
;

1074 
	`¡rıy
(
sk
, "FG_START");

1076 
gÙo1000
;

1078 
gÙo111
:

1080 
nfgv
 = 1;

1084 
	`´ojgr
(
n
,
l
,
u
,
nbd
,
x
,
g
,
sbgÄm
);

1086 ià(
ršt
 >= 1)

1088 
cout
 << "Aˆ™”©" << 
™”
 << ": f=" <<
f
<<", |´oj g|="<<
sbgÄm
<<
’dl
;

1089 *
™fe
 << "Aˆ™”©" << 
™”
 << ":‚fgv=" << 
nfgv


1090 << ", sbgÄm=" << 
sbgÄm
 << ", f=" << 
f
 << 
’dl
;

1093 ià(
sbgÄm
 <ğ
pgtŞ
)

1096 
	`¡rıy
(
sk
,"CONVERGENCE: NORM OF PROJECTED GRADIENT <= PGTOL");

1097 
gÙo999
;

1102 
gÙo222
:

1103 ià(
ršt
 >ğ99è
cout
 << "ITERATION " << (
™”
 + 1è<< 
’dl
;

1104 
iwÜd
 = -1;

1106 ià(!
ú¡nd
 && 
cŞ
 > 0)

1109 
	`dcİy
(
n
,
x
,1,
z
,1);

1110 
wrk
 = 
upd©d
;

1111 
nšt
 = 0;

1112 
gÙo333
;

1121 
ıu1
 = 
tim”_
.
	`time
();

1123 
	`ÿuchy
(
n
,
x
,
l
,
u
,
nbd
,
g
,
šdx2
,
iwh”e
,
t
,
d
,
z
,

1124 
m
,
wy
,
ws
,
sy
,
wt
,
th‘a
,
cŞ
,
h—d
,

1125 &(
wa
[1-1]),&(wa[2*
m
+1-1]),&(wa[4*m+1-1]),&(wa[6*m+1-1]),
nšt
,

1126 
sg
,
yg
,
ršt
,
sbgÄm
,
šfo
,
•smch
);

1128 ià(
šfo
 > 0)

1131 ià(
ršt
 >= 1)

1132 
cout
 << "Singularriangular system detected; "

1133 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." <<
’dl
;

1134 
šfo
 = 0;

1135 
cŞ
 = 0;

1136 
h—d
 = 1;

1137 
th‘a
 = 
Úe
;

1138 
iupd©
 = 0;

1139 
upd©d
 = 
çl£
;

1140 
ıu2
 = 
tim”_
.
	`time
();

1141 
ÿchyt
 = cachyˆ+ 
ıu2
 - 
ıu1
;

1142 
gÙo222
;

1144 
ıu2
 = 
tim”_
.
	`time
();

1145 
ÿchyt
 = cachyˆ+ 
ıu2
 - 
ıu1
;

1146 
nštŞ
 =‚štŞ + 
nšt
;

1151 
	`ä“v
(
n
,
nä“
,
šdex
,
ÃÁ”
,
—ve
,
šdx2
,

1152 
iwh”e
,
wrk
,
upd©d
,
ú¡nd
,
ršt
,
™”
);

1154 
Çù
 = 
n
 - 
nä“
;

1156 
gÙo333
:

1161 ià(
nä“
 =ğ0 || 
cŞ
 =ğ0è
gÙo555
;

1169 
ıu1
 = 
tim”_
.
	`time
();

1177 ià(
wrk
è
	`fÜmk
(
n
,
nä“
,
šdex
,
ÃÁ”
,
—ve
,
šdx2
,
iupd©
,

1178 
upd©d
,
wn
,
¢d
,
m
,
ws
,
wy
,
sy
,
th‘a
,
cŞ
,
h—d
,
šfo
);

1180 ià(
šfo
 != 0)

1184 if(
ršt
 >= 1)

1185 
cout
 << "Nonpositive definiteness in Cholesky factorization in formk;"

1186 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." << 
’dl
;

1187 
šfo
 = 0;

1188 
cŞ
 = 0;

1189 
h—d
 = 1;

1190 
th‘a
 = 
Úe
;

1191 
iupd©
 = 0;

1192 
upd©d
 = 
çl£
;

1193 
ıu2
 = 
tim”_
.
	`time
() ;

1194 
sbtime
 = sbtim+ 
ıu2
 - 
ıu1
;

1195 
gÙo222
;

1200 
	`cm´lb
(
n
,
m
,
x
,
g
,
ws
,
wy
,
sy
,
wt
,
z
,
r
,
wa
,
šdex
,

1201 
th‘a
,
cŞ
,
h—d
,
nä“
,
ú¡nd
,
šfo
);

1203 ià(
šfo
 !ğ0è
gÙo444
;

1205 
	`subsm
(
n
,
m
,
nä“
,
šdex
,
l
,
u
,
nbd
,
z
,
r
,
ws
,
wy
,
th‘a
,

1206 
cŞ
,
h—d
,
iwÜd
,
wa
,
wn
,
ršt
,
šfo
);

1209 
gÙo444
:

1210 ià(
šfo
 != 0)

1214 if(
ršt
 >= 1)

1215 
cout
 << "Singularriangular system detected; "

1216 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." <<
’dl
;

1217 
šfo
 = 0;

1218 
cŞ
 = 0;

1219 
h—d
 = 1;

1220 
th‘a
 = 
Úe
;

1221 
iupd©
 = 0;

1222 
upd©d
 = 
çl£
;

1223 
ıu2
 = 
tim”_
.
	`time
();

1224 
sbtime
 = sbtim+ 
ıu2
 - 
ıu1
;

1225 
gÙo222
;

1228 
ıu2
 = 
tim”_
.
	`time
();

1229 
sbtime
 = sbtim+ 
ıu2
 - 
ıu1
 ;

1230 
gÙo555
:

1240 
i
 = 1; i <ğ
n
; i++)

1241 
d
[
i
] = 
z
[i] - 
x
[i];

1243 
ıu1
 = 
tim”_
.
	`time
();

1244 
gÙo66
:

1246 
	`Ê¤lb
(
n
,
l
,
u
,
nbd
,
x
,
f
,
fŞd
,
gd
,
gdŞd
,
g
,
d
,
r
,
t
,
z
,
¡p
,
dnÜm
,

1247 
dtd
,
x¡•
,
¡pmx
,
™”
,
ifun
,
iback
,
nfgv
,
šfo
,
sk
,

1248 
boxed
,
ú¡nd
,
c§ve
,&(
i§ve
[22-1]),&(
d§ve
[17-1]));

1250 ià(
šfo
 !ğ0 || 
iback
 >= 20)

1253 
	`dcİy
(
n
,
t
,1,
x
,1);

1254 
	`dcİy
(
n
,
r
,1,
g
,1);

1255 
f
 = 
fŞd
;

1256 ià(
cŞ
 == 0)

1259 ià(
šfo
 == 0)

1261 
šfo
 = -9;

1263 
nfgv
 -= 1;

1264 
ifun
 -= 1;

1265 
iback
 -= 1;

1267 
	`¡rıy
(
sk
, "ABNORMAL_TERMINATION_IN_LNSRCH");

1268 
™”
 += 1;

1269 
gÙo999
;

1274 if(
ršt
 >= 1)

1275 
cout
 << "Bad direction inhe†ine search; "

1276 << "thlbfg memÜy‡nd„e¡¬ˆth™”©iÚ" << 
’dl
;

1277 ià(
šfo
 =ğ0è
nfgv
 =‚fgv - 1;

1278 
šfo
 = 0;

1279 
cŞ
 = 0;

1280 
h—d
 = 1;

1281 
th‘a
 = 
Úe
;

1282 
iupd©
 = 0;

1283 
upd©d
 = 
çl£
;

1284 
	`¡rıy
(
sk
, "RESTART_FROM_LNSRCH");

1285 
ıu2
 = 
tim”_
.
	`time
();

1286 
Êscht
 +ğ
ıu2
 - 
ıu1
;

1287 
gÙo222
;

1291 ià(
	`¡ºcmp
(
sk
,"FG_LN",5)==0)

1294 
gÙo1000
;

1299 
ıu2
 = 
tim”_
.
	`time
() ;

1300 
Êscht
 +ğ
ıu2
 - 
ıu1
;

1301 
™”
 += 1;

1305 
	`´ojgr
(
n
,
l
,
u
,
nbd
,
x
,
g
,
sbgÄm
);

1309 
	`´n2lb
(
n
,
x
,
f
,
g
,
ršt
,
™fe
,
™”
,
nfgv
,
Çù
,

1310 
sbgÄm
,
nšt
,
wÜd
,
iwÜd
,
iback
,
¡p
,
x¡•
);

1311 
gÙo1000
;

1313 
gÙo777
:

1317 ià(
sbgÄm
 <ğ
pgtŞ
)

1320 
	`¡rıy
(
sk
, "CONVERGENCE: NORM OF PROJECTED GRADIENT <= PGTOL");

1321 
gÙo999
;

1324 
ddum
 = 
	`max
(
	`çbs
(
fŞd
), fabs(
f
), 
Úe
);

1325 ià((
fŞd
 - 
f
è<ğ
tŞ
*
ddum
)

1328 
	`¡rıy
(
sk
, "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH");

1329 ià(
iback
 >ğ10è
šfo
 = -5;

1331 
gÙo999
;

1336 
i
 = 1; i <ğ
n
; i++)

1337 
r
[
i
] = 
g
[i] -„[i];

1338 
¼
 = 
	`ddÙ
(
n
,
r
,1,r,1);

1339 ià(
¡p
 =ğ
Úe
)

1341 
dr
 = 
gd
 - 
gdŞd
;

1342 
ddum
 = -
gdŞd
;

1346 
dr
 = (
gd
 - 
gdŞd
)*
¡p
;

1347 
	`dsÿl
(
n
,
¡p
,
d
,1);

1348 
ddum
 = -
gdŞd
*
¡p
;

1351 ià(
dr
 <ğ
•smch
*
ddum
)

1354 
nsk
 =‚skip + 1;

1355 
upd©d
 = 
çl£
;

1356 ià(
ršt
 >= 1)

1357 
cout
 << " ys=" << 
dr
 << " -gs=" <<
ddum
<<" BFSG upd©SKIPPED"<<
’dl
;

1358 
gÙo888
;

1367 
upd©d
 = 
Œue
;

1368 
iupd©
 += 1;

1372 
	`m©upd
(
n
,
m
,
ws
,
wy
,
sy
,
ss
,
d
,
r
,
™a
,

1373 
iupd©
,
cŞ
,
h—d
,
th‘a
,
¼
,
dr
,
¡p
,
dtd
);

1380 
	`fÜmt
(
m
,
wt
,
sy
,
ss
,
cŞ
,
th‘a
,
šfo
);

1382 ià(
šfo
 != 0)

1386 if(
ršt
 >= 1)

1387 
cout
 << "Nonpositive definiteness in Cholesky factorization in formt; "

1388 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." << 
’dl
;

1389 
šfo
 = 0;

1390 
cŞ
 = 0;

1391 
h—d
 = 1;

1392 
th‘a
 = 
Úe
;

1393 
iupd©
 = 0;

1394 
upd©d
 = 
çl£
;

1395 
gÙo222
;

1403 
gÙo888
:

1407 
gÙo222
;

1409 
gÙo999
:

1410 
time2
 = 
tim”_
.
	`time
();

1411 
time
 = 
time2
 - 
time1
;

1412 
	`´n3lb
(
n
,
x
,
f
,
sk
,
ršt
,
šfo
,
™fe
,

1413 
™”
,
nfgv
,
nštŞ
,
nsk
,
Çù
,
sbgÄm
,

1414 
time
,
nšt
,
wÜd
,
iback
,
¡p
,
x¡•
,
k
,

1415 
ÿchyt
,
sbtime
,
Êscht
);

1416 
gÙo1000
:

1419 
l§ve
[1] = 
´jùd
;

1420 
l§ve
[2] = 
ú¡nd
;

1421 
l§ve
[3] = 
boxed
;

1422 
l§ve
[4] = 
upd©d
;

1424 
i§ve
[1] = 
nštŞ
;

1426 
i§ve
[4] = 
iback
;

1427 
i§ve
[5] = 
nsk
;

1428 
i§ve
[6] = 
h—d
;

1429 
i§ve
[7] = 
cŞ
;

1430 
i§ve
[8] = 
™a
;

1431 
i§ve
[9] = 
™”
;

1432 
i§ve
[10] = 
iupd©
;

1433 
i§ve
[12] = 
nšt
;

1434 
i§ve
[13] = 
nfgv
;

1435 
i§ve
[14] = 
šfo
;

1436 
i§ve
[15] = 
ifun
;

1437 
i§ve
[16] = 
iwÜd
;

1438 
i§ve
[17] = 
nä“
;

1439 
i§ve
[18] = 
Çù
;

1440 
i§ve
[19] = 
—ve
;

1441 
i§ve
[20] = 
ÃÁ”
;

1443 
d§ve
[1] = 
th‘a
;

1444 
d§ve
[2] = 
fŞd
;

1445 
d§ve
[3] = 
tŞ
;

1446 
d§ve
[4] = 
dnÜm
;

1447 
d§ve
[5] = 
•smch
;

1448 
d§ve
[6] = 
ıu1
;

1449 
d§ve
[7] = 
ÿchyt
;

1450 
d§ve
[8] = 
sbtime
;

1451 
d§ve
[9] = 
Êscht
;

1452 
d§ve
[10] = 
time1
;

1453 
d§ve
[11] = 
gd
;

1454 
d§ve
[12] = 
¡pmx
;

1455 
d§ve
[13] = 
sbgÄm
;

1456 
d§ve
[14] = 
¡p
;

1457 
d§ve
[15] = 
gdŞd
;

1458 
d§ve
[16] = 
dtd
;

1460 
	}
}

1490 
	$aùive
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
l
,

1491 cÚ¡ * cÚ¡ & 
u
, cÚ¡ * cÚ¡ & 
nbd
,

1492 * cÚ¡ & 
x
, * cÚ¡ & 
iwh”e
, cÚ¡ & 
ršt
,

1493 
boŞ
& 
´jùd
, boŞ& 
ú¡nd
, boŞ& 
boxed
)

1496 
nbdd
;

1497 
z”o
=0.0;

1500 
nbdd
 = 0;

1501 
´jùd
 = 
çl£
;

1502 
ú¡nd
 = 
çl£
;

1503 
boxed
 = 
Œue
;

1507 
i
 = 1; i <ğ
n
; i++)

1509 ià(
nbd
[
i
] > 0)

1511 ià(
nbd
[
i
] <ğ2 && 
x
[i] <ğ
l
[i])

1513 ià(
x
[
i
] < 
l
[i])

1515 
´jùd
 = 
Œue
;

1516 
x
[
i
] = 
l
[i];

1518 
nbdd
 += 1;

1521 ià(
nbd
[
i
] >ğ2 && 
x
[i] >ğ
u
[i])

1523 ià(
x
[
i
] > 
u
[i])

1525 
´jùd
 = 
Œue
;

1526 
x
[
i
] = 
u
[i];

1528 
nbdd
 += 1;

1535 
i
 = 1; i <ğ
n
; i++)

1537 ià(
nbd
[
i
] !ğ2è
boxed
 = 
çl£
;

1538 ià(
nbd
[
i
] == 0)

1541 
iwh”e
[
i
] = -1;

1546 
ú¡nd
 = 
Œue
;

1547 ià(
nbd
[
i
] =ğ2 && (
u
[i]-
l
[i]è<ğ
z”o
)

1550 
iwh”e
[
i
] = 3;

1553 
iwh”e
[
i
] = 0;

1557 ià(
ršt
 >= 0)

1559 ià(
´jùd
)

1560 
cout
 << "The initial X is infeasible. Restart with its…rojection."

1561 << 
’dl
;

1562 ià(!
ú¡nd
è
cout
 << "Thi ´obËm i uncÚ¡¿šed." << 
’dl
;

1565 ià(
ršt
 > 0)

1566 
cout
 << "AˆX0 " << 
nbdd
 << " v¬ŸbË ¬exaùly‡ˆthbounds" <<
’dl
;

1567 
	}
}

1628 
	$bmv
(cÚ¡ & 
m
, * cÚ¡ & 
sy
, * cÚ¡ & 
wt
,

1629 cÚ¡ & 
cŞ
, cÚ¡ * cÚ¡ & 
v
, * cÚ¡ & 
p
,

1630 & 
šfo
)

1633 
i2
;

1634 
sum
;

1636 ià(
cŞ
 == 0) ;

1642 
p
[
cŞ
+1] = 
v
[col+1];

1644 
i
 = 2; i <ğ
cŞ
; i++)

1646 
i2
 = 
cŞ
 + 
i
;

1647 
sum
 = 0;

1648 
k
 = 1; k <ğ
i
-1; k++)

1649 
sum
 +ğ
sy
[
	`g‘Idx
(
i
,
k
,
m
)]*
v
[k]/sy[getIdx(k,k,m)];

1651 
p
[
i2
] = 
v
[i2] + 
sum
;

1655 
	`dŒ¦
(
wt
,
m
,
cŞ
,&(
p
[cŞ+1-1]),11,
šfo
);

1656 ià(
šfo
 != 0) ;

1659 
i
 = 1; i <ğ
cŞ
; i++)

1660 
p
[
i
] = 
v
[i]/
	`sq¹
(
sy
[
	`g‘Idx
(i,i,
m
)]);

1666 
	`dŒ¦
(
wt
,
m
,
cŞ
,&(
p
[cŞ+1-1]),1,
šfo
);

1667 ià(
šfo
 != 0) ;

1671 
i
 = 1; i <ğ
cŞ
; i++)

1672 
p
[
i
] = -p[i]/
	`sq¹
(
sy
[
	`g‘Idx
(i,i,
m
)]);

1674 
i
 = 1; i <ğ
cŞ
; i++)

1676 
sum
 = 0;

1677 
k
 = 
i
+1; i <ğ
cŞ
; i++)

1678 
sum
 +ğ
sy
[
	`g‘Idx
(
k
,
i
,
m
)]*
p
[
cŞ
+k]/sy[getIdx(i,i,m)];

1679 
p
[
i
] +ğ
sum
;

1681 
	}
}

1861 
	$ÿuchy
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
x
,

1862 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

1863 cÚ¡ * cÚ¡ & 
nbd
, cÚ¡ * cÚ¡ & 
g
,

1864 * cÚ¡ & 
iÜd”
, * cÚ¡ & 
iwh”e
,

1865 * cÚ¡ & 
t
, * cÚ¡ & 
d
, * cÚ¡ & 
xı
,

1866 cÚ¡ & 
m
, * cÚ¡ & 
wy
,

1867 * cÚ¡ & 
ws
, * cÚ¡ & 
sy
,

1868 * cÚ¡ & 
wt
, & 
th‘a
,

1869 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, * cÚ¡ & 
p
,

1870 * cÚ¡ & 
c
, * cÚ¡ & 
wbp
,

1871 * cÚ¡ & 
v
, & 
nšt
, cÚ¡ * cÚ¡ & 
sg
,

1872 cÚ¡ * cÚ¡ & 
yg
, cÚ¡ & 
ršt
,

1873 cÚ¡ & 
sbgÄm
, & 
šfo
, cÚ¡ & 
•smch
)

1875 
boŞ
 
xlow”
,
xuµ”
,
bnded
;

1877 
cŞ2
,
nä“
,
nb»ak
,
pošŒ
,

1878 
ibp
,
Æeá
,
ibkmš
,
™”
;

1879 
f1
,
f2
,
dt
,
dtm
,
tsum
,
dibp
,
zibp
,
dibp2
,
bkmš
,

1880 
tu
=0,

=0,
wmc
,
wmp
,
wmw
,
tj
,
tj0
,
Ãggi
,

1881 
f2_Üg
;

1882 
Úe
=1,
z”o
=0;

1888 ià(
sbgÄm
 <ğ
z”o
)

1890 ià(
ršt
 >ğ0è
cout
 << "SubgnÜm = 0. GCP = X." << 
’dl
;

1891 
	`dcİy
(
n
,
x
,1,
xı
,1);

1894 
bnded
 = 
Œue
;

1895 
nä“
 = 
n
 + 1;

1896 
nb»ak
 = 0;

1897 
ibkmš
 = 0;

1898 
bkmš
 = 
z”o
;

1899 
cŞ2
 = 2*
cŞ
;

1900 
f1
 = 
z”o
;

1901 ià(
ršt
 >= 99)

1902 
cout
 << "---------------- CAUCHYƒÁ”ed-------------------" << 
’dl
;

1905 
i
 = 1; i <ğ
cŞ2
; i++)

1906 
p
[
i
] = 
z”o
;

1912 
i
 = 1; i <ğ
n
; i++)

1914 
Ãggi
 = -
g
[
i
];

1915 ià(
iwh”e
[
i
] != 3 && iwhere[i] != -1)

1919 ià(
nbd
[
i
] <ğ2è

 = 
x
[i] - 
l
[i];

1920 ià(
nbd
[
i
] >ğ2è
tu
 = 
u
[i] - 
x
[i];

1924 
xlow”
 = (
nbd
[
i
] <ğ2 && 

 <ğ
z”o
);

1925 
xuµ”
 = (
nbd
[
i
] >ğ2 && 
tu
 <ğ
z”o
);

1928 
iwh”e
[
i
] = 0;

1929 ià(
xlow”
)

1931 ià(
Ãggi
 <ğ
z”o
è
iwh”e
[
i
] = 1;

1934 ià(
xuµ”
)

1936 ià(
Ãggi
 >ğ
z”o
è
iwh”e
[
i
] = 2;

1940 ià(
	`çbs
(
Ãggi
è<ğ
z”o
è
iwh”e
[
i
] = -3;

1943 
pošŒ
 = 
h—d
;

1944 ià(
iwh”e
[
i
] != 0 && iwhere[i] != -1)

1945 
d
[
i
] = 
z”o
;

1948 
d
[
i
] = 
Ãggi
;

1949 
f1
 -ğ
Ãggi
*neggi;

1951 
j
 = 1; j <ğ
cŞ
; j++)

1953 
p
[
j
] +ğ
wy
[
	`g‘Idx
(
i
,
pošŒ
,
n
)] * 
Ãggi
;

1954 
p
[
cŞ
 + 
j
] +ğ
ws
[
	`g‘Idx
(
i
,
pošŒ
,
n
)] * 
Ãggi
;

1955 
pošŒ
 =…ošŒ%
m
 + 1;

1957 ià(
nbd
[
i
] <ğ2 &&‚bd[i] !ğ0 && 
Ãggi
 < 
z”o
)

1960 
nb»ak
 += 1;

1961 
iÜd”
[
nb»ak
] = 
i
;

1962 
t
[
nb»ak
] = 

/(-
Ãggi
);

1963 ià(
nb»ak
 =ğ1 || 
t
[nb»ak] < 
bkmš
)

1965 
bkmš
 = 
t
[
nb»ak
];

1966 
ibkmš
 = 
nb»ak
;

1970 ià(
nbd
[
i
] >ğ2 && 
Ãggi
 > 
z”o
)

1973 
nb»ak
 += 1;

1974 
iÜd”
[
nb»ak
] = 
i
;

1975 
t
[
nb»ak
] = 
tu
/
Ãggi
;

1976 ià(
nb»ak
 =ğ1 || 
t
[nb»ak] < 
bkmš
)

1978 
bkmš
 = 
t
[
nb»ak
];

1979 
ibkmš
 = 
nb»ak
;

1985 
nä“
 -= 1;

1986 
iÜd”
[
nä“
] = 
i
;

1987 ià(
	`çbs
(
Ãggi
è> 
z”o
è
bnded
 = 
çl£
;

1997 ià(
th‘a
 !ğ
Úe
)

2000 
	`dsÿl
(
cŞ
,
th‘a
,&(
p
[col+1-1]),1);

2005 
	`dcİy
(
n
,
x
,1,
xı
,1);

2007 ià(
nb»ak
 =ğ0 && 
nä“
 =ğ
n
 + 1)

2010 ià(
ršt
 > 100)

2012 
cout
 << "Cauchy X = ";

2013 
i
 = 1; i <ğ
n
; i++)

2014 
cout
 << 
xı
[
i
] << " ";

2015 
cout
 << 
’dl
;

2022 
j
 = 1; j <ğ
cŞ2
; j++)

2023 
c
[
j
] = 
z”o
;

2027 
f2
 = -
th‘a
*
f1
;

2028 
f2_Üg
 = 
f2
;

2029 ià(
cŞ
 > 0)

2031 
	`bmv
(
m
,
sy
,
wt
,
cŞ
,
p
,
v
,
šfo
);

2032 ià(
šfo
 != 0) ;

2033 
f2
 -ğ
	`ddÙ
(
cŞ2
,
v
,1,
p
,1);

2035 
dtm
 = -
f1
/
f2
;

2036 
tsum
 = 
z”o
;

2037 
nšt
 = 1;

2038 ià(
ršt
 >= 99)

2039 
cout
 << "Th”¬" << 
nb»ak
 << " b»akpošts" << 
’dl
;

2043 ià(
nb»ak
 =ğ0è
gÙo888
;

2045 
Æeá
 = 
nb»ak
;

2046 
™”
 = 1;

2048 
tj
 = 
z”o
;

2052 
gÙo777
:

2057 
tj0
 = 
tj
;

2058 ià(
™”
 == 1)

2063 
tj
 = 
bkmš
;

2064 
ibp
 = 
iÜd”
[
ibkmš
];

2068 ià(
™”
 == 2)

2072 ià(
ibkmš
 !ğ
nb»ak
)

2074 
t
[
ibkmš
] =[
nb»ak
];

2075 
iÜd”
[
ibkmš
] = iÜd”[
nb»ak
];

2081 
	`hpsŞb
(
Æeá
,
t
,
iÜd”
,
™”
-2);

2082 
tj
 = 
t
[
Æeá
];

2083 
ibp
 = 
iÜd”
[
Æeá
];

2086 
dt
 = 
tj
 - 
tj0
;

2088 ià(
dt
 !ğ
z”o
 && 
ršt
 >= 100)

2090 
cout
 << "P›û " << 
nšt
 << " --f1, f2‡t start…oint "

2091 << 
f1
 << "," << 
f2
 << 
’dl
;

2092 
cout
 << "Di¡ªûØthÃxˆb»ak…ošˆğ" << 
dt
 << 
’dl
;

2093 
cout
 << "Di¡ªûØth¡©iÚ¬y…ošˆğ" << 
dtm
 << 
’dl
;

2098 ià(
dtm
 < 
dt
è
gÙo888
;

2103 
tsum
 +ğ
dt
;

2104 
Æeá
 -= 1;

2105 
™”
 += 1;

2106 
dibp
 = 
d
[
ibp
];

2107 
d
[
ibp
] = 
z”o
;

2108 ià(
dibp
 > 
z”o
)

2110 
zibp
 = 
u
[
ibp
] - 
x
[ibp];

2111 
xı
[
ibp
] = 
u
[ibp];

2112 
iwh”e
[
ibp
] = 2;

2116 
zibp
 = 
l
[
ibp
] - 
x
[ibp];

2117 
xı
[
ibp
] = 
l
[ibp];

2118 
iwh”e
[
ibp
] = 1;

2120 ià(
ršt
 >ğ100è
cout
 << "V¬ŸbË " << 
ibp
 << " i fixed." << 
’dl
;

2121 ià(
Æeá
 =ğ0 && 
nb»ak
 =ğ
n
)

2124 
dtm
 = 
dt
;

2125 
gÙo999
;

2130 
nšt
 += 1;

2131 
dibp2
 = 
dibp
*dibp;

2136 
f1
 +ğ
dt
*
f2
 + 
dibp2
 - 
th‘a
*
dibp
*
zibp
;

2137 
f2
 -ğ
th‘a
*
dibp2
;

2139 ià(
cŞ
 > 0)

2142 
	`daxpy
(
cŞ2
,
dt
,
p
,1,
c
,1);

2146 
pošŒ
 = 
h—d
;

2147 
j
 = 1; j <ğ
cŞ
; j++)

2149 
wbp
[
j
] = 
wy
[
	`g‘Idx
(
ibp
,
pošŒ
,
n
)];

2150 
wbp
[
cŞ
 + 
j
] = 
th‘a
*
ws
[
	`g‘Idx
(
ibp
,
pošŒ
,
n
)];

2151 
pošŒ
 =…ošŒ%
m
 + 1;

2154 
	`bmv
(
m
,
sy
,
wt
,
cŞ
,
wbp
,
v
,
šfo
);

2155 ià(
šfo
 != 0) ;

2156 
wmc
 = 
	`ddÙ
(
cŞ2
,
c
,1,
v
,1);

2157 
wmp
 = 
	`ddÙ
(
cŞ2
,
p
,1,
v
,1);

2158 
wmw
 = 
	`ddÙ
(
cŞ2
,
wbp
,1,
v
,1);

2161 
	`daxpy
(
cŞ2
,-
dibp
,
wbp
,1,
p
,1);

2164 
f1
 +ğ
dibp
*
wmc
;

2165 
f2
 +ğ2.0*
dibp
*
wmp
 - 
dibp2
*
wmw
;

2168 
f2
 = 
	`max
(
•smch
*
f2_Üg
,f2);

2169 ià(
Æeá
 > 0)

2171 
dtm
 = -
f1
/
f2
;

2172 
gÙo777
;

2176 if(
bnded
)

2178 
f1
 = 
z”o
;

2179 
f2
 = 
z”o
;

2180 
dtm
 = 
z”o
;

2183 
dtm
 = -
f1
/
f2
;

2187 
gÙo888
:

2188 ià(
ršt
 >= 99)

2190 
cout
 << 
’dl
 << "GCP found inhis segment" <<ƒndl

2191 << "P›û " << 
nšt
 << " --f1, f2‡t start…oint "

2192 << 
f1
 << "," << 
f2
 << 
’dl


2193 << "Di¡ªûØth¡©iÚ¬y…ošˆğ" << 
dtm
 << 
’dl
;

2196 ià(
dtm
 <ğ
z”o
) dtm = zero;

2197 
tsum
 +ğ
dtm
;

2202 
	`daxpy
(
n
,
tsum
,
d
,1,
xı
,1);

2204 
gÙo999
:

2209 ià(
cŞ
 > 0è
	`daxpy
(
cŞ2
,
dtm
,
p
,1,
c
,1);

2210 ià(
ršt
 > 100)

2212 
cout
<< "Cauchy X = ";

2213 
i
 = 1; i <=
n
; i++)

2214 
cout
 << 
xı
[
i
] << " ";

2215 
cout
 << 
’dl
;

2217 ià(
ršt
 >= 99)

2218 
cout
 << "----------------ƒx™ CAUCHY----------------------" << 
’dl
;

2219 
	}
}

2246 
	$cm´lb
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ * cÚ¡ & 
x
,

2247 cÚ¡ * cÚ¡ & 
g
, * cÚ¡ & 
ws
,

2248 * cÚ¡ & 
wy
, * cÚ¡ & 
sy
,

2249 * cÚ¡ & 
wt
, cÚ¡ * cÚ¡ & 
z
,

2250 * cÚ¡ & 
r
, * cÚ¡ & 
wa
,

2251 cÚ¡ * cÚ¡ & 
šdex
, cÚ¡ & 
th‘a
,

2252 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, cÚ¡ & 
nä“
,

2253 cÚ¡ 
boŞ
& 
ú¡nd
, & 
šfo
)

2256 
k
,
pošŒ
,
idx
;

2257 
a1
,
a2
;

2259 ià(!
ú¡nd
 && 
cŞ
 > 0)

2261 
i
 = 1; i <ğ
n
; i++)

2262 
r
[
i
] = -
g
[i];

2266 
i
 = 1; i <ğ
nä“
; i++)

2268 
k
 = 
šdex
[
i
];

2269 
r
[
i
] = -
th‘a
*(
z
[
k
] - 
x
[k]è- 
g
[k];

2271 
	`bmv
(
m
,
sy
,
wt
,
cŞ
,&(
wa
[2*m+1-1]),&(wa[1-1]),
šfo
);

2272 ià(
šfo
 != 0)

2274 
šfo
 = -8;

2277 
pošŒ
 = 
h—d
;

2278 
j
 = 1; j <ğ
cŞ
; j++)

2280 
a1
 = 
wa
[
j
];

2281 
a2
 = 
th‘a
*
wa
[
cŞ
 + 
j
];

2282 
i
 = 1; i <ğ
nä“
; i++)

2284 
k
 = 
šdex
[
i
];

2285 
idx
 = 
	`g‘Idx
(
k
,
pošŒ
,
n
);

2286 
r
[
i
] +ğ
wy
[
idx
]*
a1
 + 
ws
[idx]*
a2
;

2289 
pošŒ
 =…ošŒ%
m
 + 1;

2292 
	}
}

2314 
	$”rşb
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ & 
çùr
,

2315 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

2316 cÚ¡ * cÚ¡ & 
nbd
, * cÚ¡ & 
sk
, & 
šfo
,

2317 & 
k
)

2321 
z”o
=0.0;

2325 ià(
n
 <ğ0è
	`¡rıy
(
sk
,"ERROR: N <= 0");

2326 ià(
m
 <ğ0è
	`¡rıy
(
sk
,"ERROR: M <= 0");

2327 ià(
çùr
 < 
z”o
è
	`¡rıy
(
sk
,"ERROR: FACTR < 0");

2330 
i
 = 1; i <ğ
n
; i++)

2332 ià(
nbd
[
i
] < 0 ||‚bd[i] > 3)

2335 
	`¡rıy
(
sk
,"ERROR: INVALID NBD");

2336 
šfo
 = -6;

2337 
k
 = 
i
;

2339 ià(
nbd
[
i
] == 2)

2341 ià(
l
[
i
] > 
u
[i])

2344 
	`¡rıy
(
sk
, "ERROR: NO FEASIBLE SOLUTION");

2345 
šfo
 = -7;

2346 
k
 = 
i
;

2350 
	}
}

2476 
	$fÜmk
(cÚ¡ & 
n
, cÚ¡ & 
nsub
, cÚ¡ * cÚ¡ & 
šd
,

2477 cÚ¡ & 
ÃÁ”
, cÚ¡ & 
—ve
,

2478 cÚ¡ * cÚ¡ & 
šdx2
, cÚ¡ & 
iupd©
,

2479 cÚ¡ 
boŞ
& 
upd©d
, * cÚ¡ & 
wn
,

2480 * cÚ¡ & 
wn1
, cÚ¡ & 
m
,

2481 * cÚ¡ & 
ws
, * cÚ¡ & 
wy
,

2482 * cÚ¡ & 
sy
, cÚ¡ & 
th‘a
,

2483 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, & 
šfo
)

2486 
m2
,
Ár
,
j²Œ
,
iy
,
is
,
jy
,
js
,
is1
,
js1
,
k1
,

2487 
cŞ2
,
pbegš
,
³nd
,
dbegš
,
d’d
,
upş
;

2488 
idx1
, 
idx2
;

2489 
‹mp1
,
‹mp2
,
‹mp3
,
‹mp4
;

2491 
z”o
=0.0;

2493 
m2
 = 2*
m
;

2501 ià(
upd©d
)

2503 ià(
iupd©
 > 
m
)

2506 
jy
 = 1; jy <ğ
m
-1; jy++)

2508 
js
 = 
m
 + 
jy
;

2509 
	`dcİy
(
m
-
jy
,&(
wn1
[
	`g‘Idx
(jy+1,jy+1,
m2
)-1]),1,

2510 &(
wn1
[
	`g‘Idx
(
jy
,jy,
m2
)-1]),1);

2511 
	`dcİy
(
m
-
jy
,&(
wn1
[
	`g‘Idx
(
js
+1,js+1,
m2
)-1]),1,

2512 &(
wn1
[
	`g‘Idx
(
js
,js,
m2
)-1]), 1);

2513 
	`dcİy
(
m
-1, &(
wn1
[
	`g‘Idx
(m+2,
jy
+1,
m2
)-1]), 1,

2514 &(
wn1
[
	`g‘Idx
(
m
+1,
jy
,
m2
)-1]),1);

2519 
pbegš
 = 1;

2520 
³nd
 = 
nsub
;

2521 
dbegš
 = 
nsub
 + 1;

2522 
d’d
 = 
n
;

2523 
iy
 = 
cŞ
;

2524 
is
 = 
m
 + 
cŞ
;

2525 
Ár
 = 
h—d
 + 
cŞ
 - 1;

2526 ià(
Ár
 > 
m
) ipntr -= m ;

2527 
j²Œ
 = 
h—d
;

2529 
jy
 = 1; jy <ğ
cŞ
; jy++)

2531 
js
 = 
m
 + 
jy
;

2532 
‹mp1
 = 
z”o
;

2533 
‹mp2
 = 
z”o
;

2534 
‹mp3
 = 
z”o
;

2536 
k
 = 
pbegš
; k <ğ
³nd
; k++)

2538 
k1
 = 
šd
[
k
];

2539 
‹mp1
 +ğ
wy
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*wy[g‘Idx(k1,
j²Œ
,n)];

2542 
k
 = 
dbegš
; k <ğ
d’d
; k++)

2544 
k1
 = 
šd
[
k
];

2545 
idx1
 = 
	`g‘Idx
(
k1
,
Ár
,
n
);

2546 
idx2
 = 
	`g‘Idx
(
k1
,
j²Œ
,
n
);

2547 
‹mp2
 +ğ
ws
[
idx1
] * ws[
idx2
];

2548 
‹mp3
 +ğ
ws
[
idx1
] * 
wy
[
idx2
];

2550 
wn1
[
	`g‘Idx
(
iy
,
jy
,
m2
)] = 
‹mp1
;

2551 
wn1
[
	`g‘Idx
(
is
,
js
,
m2
)] = 
‹mp2
;

2552 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] = 
‹mp3
;

2553 
j²Œ
 = j²Œ%
m
 + 1;

2557 
jy
 = 
cŞ
;

2558 
j²Œ
 = 
h—d
 + 
cŞ
 - 1;

2559 ià(
j²Œ
 > 
m
) jpntr -= m;

2560 
Ár
 = 
h—d
;

2561 
i
 = 1; i <ğ
cŞ
; i++)

2563 
is
 = 
m
 + 
i
;

2564 
‹mp3
 = 
z”o
;

2566 
k
 = 
pbegš
; k <ğ
³nd
; k++)

2568 
k1
 = 
šd
[
k
];

2569 
‹mp3
 +ğ
ws
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*
wy
[g‘Idx(k1,
j²Œ
,n)];

2571 
Ár
 = i²Œ%
m
 + 1;

2572 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] = 
‹mp3
;

2574 
upş
 = 
cŞ
 - 1;

2577 
upş
 = 
cŞ
;

2581 
Ár
 = 
h—d
;

2583 
iy
 = 1; iy <ğ
upş
; iy++)

2585 
is
 = 
m
 + 
iy
;

2586 
j²Œ
 = 
h—d
;

2588 
jy
 = 1; jy <ğ
iy
; jy++)

2590 
js
 = 
m
 + 
jy
;

2591 
‹mp1
 = 
z”o
;

2592 
‹mp2
 = 
z”o
;

2593 
‹mp3
 = 
z”o
;

2594 
‹mp4
 = 
z”o
;

2595 
k
 = 1; k <ğ
ÃÁ”
; k++)

2597 
k1
 = 
šdx2
[
k
];

2598 
idx1
 = 
	`g‘Idx
(
k1
,
Ár
,
n
);

2599 
idx2
 = 
	`g‘Idx
(
k1
,
j²Œ
,
n
);

2600 
‹mp1
 +ğ
wy
[
idx1
]*wy[
idx2
];

2601 
‹mp2
 +ğ
ws
[
idx1
]*ws[
idx2
];

2603 
k
 = 
—ve
; k <ğ
n
; k++)

2605 
k1
 = 
šdx2
[
k
];

2606 
idx1
 = 
	`g‘Idx
(
k1
,
Ár
,
n
);

2607 
idx2
 = 
	`g‘Idx
(
k1
,
j²Œ
,
n
);

2608 
‹mp3
 +ğ
wy
[
idx1
]*wy[
idx2
];

2609 
‹mp4
 +ğ
ws
[
idx1
]*ws[
idx2
];

2611 
wn1
[
	`g‘Idx
(
iy
,
jy
,
m2
)] +ğ
‹mp1
 - 
‹mp3
;

2612 
wn1
[
	`g‘Idx
(
is
,
js
,
m2
)] +ğ
‹mp4
 - 
‹mp2
;

2613 
j²Œ
 = j²Œ%
m
 + 1;

2615 
Ár
 = i²Œ%
m
 + 1;

2618 
Ár
 = 
h—d
;

2620 
is
 = 
m
+1; i <ğm + 
upş
; is++)

2622 
j²Œ
 = 
h—d
;

2623 
jy
 = 1; jy <ğ
upş
; jy++)

2625 
‹mp1
 = 
z”o
;

2626 
‹mp3
 = 
z”o
;

2628 
k
 = 1; k <ğ
ÃÁ”
; k++)

2630 
k1
 = 
šdx2
[
k
];

2631 
‹mp1
 +ğ
ws
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*
wy
[g‘Idx(k1,
j²Œ
,n)];

2633 
k
 = 
—ve
; k <ğ
n
; k++)

2635 
k1
 = 
šdx2
[
k
];

2636 
‹mp3
 +ğ
ws
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*
wy
[g‘Idx(k1,
j²Œ
,n)];

2638 ià(
is
 <ğ
jy
 + 
m
)

2639 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] +ğ
‹mp1
 - 
‹mp3
;

2641 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] +ğ
‹mp3
 - 
‹mp1
;

2643 
j²Œ
 = j²Œ%
m
 + 1;

2645 
Ár
 = i²Œ%
m
 + 1;

2650 
iy
 = 1; iy <ğ
cŞ
; iy++)

2652 
is
 = 
cŞ
 + 
iy
;

2653 
is1
 = 
m
 + 
iy
;

2654 
jy
 = 1; jy <ğ
iy
; jy++)

2656 
js
 = 
cŞ
 + 
jy
;

2657 
js1
 = 
m
 + 
jy
;

2658 
wn
[
	`g‘Idx
(
jy
,
iy
,
m2
)] = 
wn1
[g‘Idx(iy,jy,m2)]/
th‘a
;

2659 
wn
[
	`g‘Idx
(
js
,
is
,
m2
)] = 
wn1
[g‘Idx(
is1
,
js1
,m2)]*
th‘a
;

2662 
jy
 = 1; jy <ğ
iy
-1; jy++)

2663 
wn
[
	`g‘Idx
(
jy
,
is
,
m2
)] = -
wn1
[g‘Idx(
is1
,jy,m2)];

2665 
jy
 = 
iy
; jy <ğ
cŞ
; jy++)

2666 
wn
[
	`g‘Idx
(
jy
,
is
,
m2
)] = 
wn1
[g‘Idx(
is1
,jy,m2)];

2667 
wn
[
	`g‘Idx
(
iy
,iy,
m2
)] +ğ
sy
[g‘Idx(iy,iy,
m
)];

2675 
	`dpoç
(
wn
,
m2
,
cŞ
,
šfo
);

2676 ià(
šfo
 != 0)

2678 
šfo
 = -1;

2683 
cŞ2
 = 2*
cŞ
;

2684 
js
 = 
cŞ
+1; j <ğ
cŞ2
; js++)

2685 
	`dŒ¦
(
wn
,
m2
,
cŞ
,&(wn[
	`g‘Idx
(1,
js
,m2)-1]),11,
šfo
);

2692 
is
 = 
cŞ
+1; i <ğ
cŞ2
; is++)

2693 
js
 = 
is
; j <ğ
cŞ2
; js++)

2694 
wn
[
	`g‘Idx
(
is
,
js
,
m2
)] +ğ
	`ddÙ
(
cŞ
,&(wn[getIdx(1,is,m2)-1]),1,

2695 &(
wn
[
	`g‘Idx
(1,
js
,
m2
)-1]),1);

2698 
	`dpoç
(&(
wn
[
	`g‘Idx
(
cŞ
+1,cŞ+1,
m2
)-1]),m2,cŞ,
šfo
);

2700 ià(
šfo
 != 0)

2702 
šfo
 = -2;

2705 
	}
}

2734 
	$fÜmt
(cÚ¡ & 
m
, * cÚ¡ & 
wt
, * cÚ¡& 
sy
,

2735 * cÚ¡ & 
ss
, cÚ¡ & 
cŞ
, cÚ¡ & 
th‘a
,

2736 & 
šfo
)

2739 
k1
, 
idx
;

2740 
ddum
;

2741 
z”o
=0.0;

2745 
j
 = 1; j <ğ
cŞ
; j++)

2747 
idx
 = 
	`g‘Idx
(1,
j
,
m
);

2748 
wt
[
idx
] = 
th‘a
*
ss
[idx];

2751 
i
 = 2; i <ğ
cŞ
; i++)

2752 
j
 = 
i
; j <ğ
cŞ
; j++)

2754 
k1
 = 
	`mš
(
i
,
j
) - 1;

2755 
ddum
 = 
z”o
;

2756 
k
 = 1; k <ğ
k1
; k++)

2757 
ddum
 +ğ
sy
[
	`g‘Idx
(
i
,
k
,
m
)]*sy[g‘Idx(
j
,k,m)]/sy[getIdx(k,k,m)];

2758 
wt
[
	`g‘Idx
(
i
,
j
,
m
)] = 
ddum
 + 
th‘a
*
ss
[getIdx(i,j,m)];

2764 
	`dpoç
(
wt
,
m
,
cŞ
,
šfo
);

2765 ià(
šfo
 != 0) info = -3;

2766 
	}
}

2807 
	$ä“v
(cÚ¡ & 
n
, & 
nä“
, * cÚ¡ & 
šdex
, & 
ÃÁ”
,

2808 & 
—ve
, * cÚ¡ & 
šdx2
, * cÚ¡ & 
iwh”e
,

2809 
boŞ
& 
wrk
, cÚ¡ boŞ& 
upd©d
, cÚ¡ boŞ& 
ú¡nd
,

2810 cÚ¡ & 
ršt
, cÚ¡ & 
™”
)

2813 
Ÿù
,
k
;

2815 
ÃÁ”
 = 0;

2816 
—ve
 = 
n
 + 1;

2817 ià(
™”
 > 0 && 
ú¡nd
)

2820 
i
 = 1; i <ğ
nä“
; i++)

2822 
k
 = 
šdex
[
i
];

2823 ià(
iwh”e
[
k
] > 0)

2825 
—ve
 -= 1;

2826 
šdx2
[
—ve
] = 
k
;

2827 ià(
ršt
 >= 100)

2828 
cout
 << "V¬ŸbË " << 
k
<<"†—ve th£ˆoàä“ v¬ŸbËs"<<
’dl
;

2832 
i
 = 1+
nä“
; i <ğ
n
; i++)

2834 
k
 = 
šdex
[
i
];

2835 ià(
iwh”e
[
k
] <= 0)

2837 
ÃÁ”
 += 1;

2838 
šdx2
[
ÃÁ”
] = 
k
;

2839 ià(
ršt
 >= 100)

2840 
cout
 << "V¬ŸbË " << 
k
<<"ƒÁ” th£ˆoàä“ v¬ŸbËs"<<
’dl
;

2843 ià(
ršt
 >= 99)

2844 
cout
 << 
n
+1-
—ve
 << " variables†eave; "

2845 << 
ÃÁ”
 << " v¬ŸbË ’‹r" << 
’dl
;

2847 
wrk
 = (
—ve
 < 
n
+1è|| (
ÃÁ”
 > 0è|| 
upd©d
;

2851 
nä“
 = 0;

2852 
Ÿù
 = 
n
 + 1;

2853 
i
 = 1; i <ğ
n
; i++)

2855 ià(
iwh”e
[
i
] <= 0)

2857 
nä“
 += 1;

2858 
šdex
[
nä“
] = 
i
;

2862 
Ÿù
 -= 1;

2863 
šdex
[
Ÿù
] = 
i
;

2867 ià(
ršt
 >= 99)

2868 
cout
 << 
nä“
 << " v¬ŸbË ¬ä“‡ˆGCP " << 
™”
 + 1 << 
’dl
;

2869 
	}
}

2914 
	$hpsŞb
(cÚ¡ & 
n
, * cÚ¡ & 
t
, * cÚ¡ & 
iÜd”
,

2915 cÚ¡ & 
ih—p
)

2918 
i
,
j
,
šdxš
,
šdxou
;

2919 
ddum
,
out
;

2921 ià(
ih—p
 == 0)

2924 
k
 = 2; k <ğ
n
; k++)

2926 
ddum
 = 
t
[
k
];

2927 
šdxš
 = 
iÜd”
[
k
];

2930 
i
 = 
k
;

2931 
gÙo10
:

2932 ià(
i
>1)

2934 
j
 = 
i
/2;

2935 ià(
ddum
 < 
t
[
j
])

2937 
t
[
i
] =[
j
];

2938 
iÜd”
[
i
] = iÜd”[
j
];

2939 
i
 = 
j
;

2940 
gÙo10
;

2944 
t
[
i
] = 
ddum
;

2945 
iÜd”
[
i
] = 
šdxš
;

2953 ià(
n
 > 1)

2955 
i
 = 1;

2956 
out
 = 
t
[1];

2957 
šdxou
 = 
iÜd”
[1];

2958 
ddum
 = 
t
[
n
];

2959 
šdxš
 = 
iÜd”
[
n
];

2962 
gÙo30
:

2963 
j
 = 
i
+i;

2964 ià(
j
 <ğ
n
-1)

2966 ià(
t
[
j
+1] <[j]) j = j+1;

2967 ià(
t
[
j
] < 
ddum
 )

2969 
t
[
i
] =[
j
];

2970 
iÜd”
[
i
] = iÜd”[
j
];

2971 
i
 = 
j
;

2972 
gÙo30
;

2975 
t
[
i
] = 
ddum
;

2976 
iÜd”
[
i
] = 
šdxš
;

2980 
t
[
n
] = 
out
;

2981 
iÜd”
[
n
] = 
šdxou
;

2983 
	}
}

3013 
	$Ê¤lb
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

3014 cÚ¡ * cÚ¡& 
nbd
, * cÚ¡ & 
x
, & 
f
,

3015 & 
fŞd
, & 
gd
, & 
gdŞd
, * cÚ¡& 
g
,

3016 * cÚ¡& 
d
, * cÚ¡& 
r
, * cÚ¡& 
t
,

3017 * cÚ¡& 
z
, & 
¡p
, & 
dnÜm
, & 
dtd
,

3018 & 
x¡•
, & 
¡pmx
, cÚ¡ & 
™”
, & 
ifun
,

3019 & 
iback
, & 
nfgv
, & 
šfo
, * cÚ¡ & 
sk
,

3020 cÚ¡ 
boŞ
& 
boxed
, cÚ¡ boŞ& 
ú¡nd
, * cÚ¡ & 
c§ve
,

3021 * cÚ¡ & 
i§ve
, * cÚ¡ & 
d§ve
)

3024 
a1
,
a2
;

3025 
Úe
=1.0,
z”o
=0.0,
big
=1e10;

3026 
áŞ
=1.0e-3,
gtŞ
=0.9,
xtŞ
=0.1;

3029 ià(
	`¡ºcmp
(
sk
,"FG_LN",5)==0è
gÙo556
;

3031 
dtd
 = 
	`ddÙ
(
n
,
d
,1,d,1);

3032 
dnÜm
 = 
	`sq¹
(
dtd
);

3036 
¡pmx
 = 
big
;

3037 ià(
ú¡nd
)

3039 ià(
™”
 == 0)

3040 
¡pmx
 = 
Úe
;

3043 
i
 = 1; i <ğ
n
; i++)

3045 
a1
 = 
d
[
i
];

3046 ià(
nbd
[
i
] != 0)

3048 ià(
a1
 < 
z”o
 && 
nbd
[
i
] <= 2)

3050 
a2
 = 
l
[
i
] - 
x
[i];

3051 ià(
a2
 >ğ
z”o
)

3052 
¡pmx
 = 
z”o
;

3054 ià(
a1
*
¡pmx
 < 
a2
)

3055 
¡pmx
 = 
a2
/
a1
;

3058 ià(
a1
 > 
z”o
 && 
nbd
[
i
] >= 2)

3060 
a2
 = 
u
[
i
] - 
x
[i];

3061 ià(
a2
 <ğ
z”o
)

3062 
¡pmx
 = 
z”o
;

3064 ià(
a1
*
¡pmx
 > 
a2
)

3065 
¡pmx
 = 
a2
/
a1
;

3072 ià(
™”
 =ğ0 && !
boxed
)

3073 
¡p
 = 
	`mš
(
Úe
/
dnÜm
, 
¡pmx
);

3075 
¡p
 = 
Úe
;

3077 
	`dcİy
(
n
,
x
,1,
t
,1);

3078 
	`dcİy
(
n
,
g
,1,
r
,1);

3079 
fŞd
 = 
f
;

3080 
ifun
 = 0;

3081 
iback
 = 0;

3082 
	`¡rıy
(
c§ve
,"START");

3083 
gÙo556
:

3084 
gd
 = 
	`ddÙ
(
n
,
g
,1,
d
,1);

3085 ià(
ifun
 == 0)

3087 
gdŞd
=
gd
;

3088 ià(
gd
 >ğ
z”o
)

3092 
šfo
 = -4;

3097 
	`dc¤ch
(
f
,
gd
,
¡p
,
áŞ
,
gtŞ
,
xtŞ
,
z”o
,
¡pmx
,
c§ve
,
i§ve
,
d§ve
);

3099 
x¡•
 = 
¡p
*
dnÜm
;

3100 ià(
	`¡ºcmp
(
c§ve
,"CONV",4) != 0 && strncmp(csave,"WARN",4) != 0)

3102 
	`¡rıy
(
sk
,"FG_LNSRCH");

3103 
ifun
 += 1;

3104 
nfgv
 += 1;

3105 
iback
 = 
ifun
 - 1;

3106 ià(
¡p
 =ğ
Úe
)

3107 
	`dcİy
(
n
,
z
,1,
x
,1);

3110 
i
 = 1; i <ğ
n
; i++)

3111 
x
[
i
] = 
¡p
*
d
[i] + 
t
[i];

3115 
	`¡rıy
(
sk
,"NEW_X");

3116 
	}
}

3143 
	$m©upd
(cÚ¡ & 
n
, cÚ¡ & 
m
, * cÚ¡ & 
ws
,

3144 * cÚ¡ & 
wy
, * cÚ¡ & 
sy
, * cÚ¡ & 
ss
,

3145 * cÚ¡ & 
d
, * cÚ¡ & 
r
, & 
™a
, & 
iupd©
,

3146 & 
cŞ
, & 
h—d
, & 
th‘a
, & 
¼
, & 
dr
,

3147 & 
¡p
, & 
dtd
)

3150 
pošŒ
;

3151 
Úe
=1.0;

3152 
idx
;

3155 ià(
iupd©
 <ğ
m
)

3157 
cŞ
 = 
iupd©
;

3158 
™a
 = (
h—d
+
iupd©
-2)%
m
 + 1;

3162 
™a
 = i%
m
 + 1;

3163 
h—d
 = h—d%
m
 + 1;

3167 
idx
 = 
	`g‘Idx
(1,
™a
,
n
)-1;

3168 
	`dcİy
(
n
,
d
,1,&(
ws
[
idx
]),1);

3169 
	`dcİy
(
n
,
r
,1,&(
wy
[
idx
]),1);

3172 
th‘a
 = 
¼
/
dr
;

3177 ià(
iupd©
 > 
m
)

3180 
j
 = 1; j <ğ
cŞ
-1; j++)

3182 
	`dcİy
(
j
,&(
ss
[
	`g‘Idx
(2,j+1,
m
)-1]),1,&(ss[getIdx(1,j,m)-1]),1);

3183 
	`dcİy
(
cŞ
-
j
,&(
sy
[
	`g‘Idx
(j+1,j+1,
m
)-1]),1,&(sy[getIdx(j,j,m)-1]),1);

3189 
pošŒ
 = 
h—d
;

3190 
j
 = 1; j <ğ
cŞ
-1; j++)

3192 
idx
 = 
	`g‘Idx
(1,
pošŒ
,
n
)-1;

3193 
sy
[
	`g‘Idx
(
cŞ
,
j
,
m
)] = 
	`ddÙ
(
n
,
d
,1,&(
wy
[
idx
]),1);

3194 
ss
[
	`g‘Idx
(
j
,
cŞ
,
m
)] = 
	`ddÙ
(
n
,&(
ws
[
idx
]),1,
d
,1);

3195 
pošŒ
 =…ošŒ%
m
 + 1;

3198 
idx
 = 
	`g‘Idx
(
cŞ
,cŞ,
m
);

3199 ià(
¡p
 =ğ
Úe
)

3200 
ss
[
idx
] = 
dtd
;

3202 
ss
[
idx
] = 
¡p
*¡p*
dtd
;

3204 
sy
[
idx
] = 
dr
;

3205 
	}
}

3229 
	$´n1lb
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ * cÚ¡ & 
l
,

3230 cÚ¡ * cÚ¡ & 
u
, cÚ¡ * cÚ¡ & 
x
,

3231 cÚ¡ & 
ršt
, 
of¡»am
* 
™fe
, cÚ¡ & 
•smch
)

3235 ià(
ršt
 >= 0)

3237 
cout
 << "RUNNING THE L-BFGS-B CODE, " << 
’dl


3238 << "•smch = machš´ecisiÚ" << 
’dl


3239 << "™ = i‹¿tiÚ‚umb”" << 
’dl


3240 << "nà =‚umb” oàfunùiÚƒv®u©iÚs" << 
’dl


3242 << 
’dl


3244 << 
’dl


3246 << 
’dl


3247 <<"cÚ = cÚv”ged, bnd =‡ bound wa »ached" << 
’dl


3249 << 
’dl


3250 << "¡•Èğ¡•†’gth u£d" << 
’dl


3251 << "t¡• =‚Üm oàthdi¥Ïûm’ˆÑÙ® s‹p)" << 
’dl


3252 << "´ojg =‚Üm oàth´ojeùed g¿d›Á" << 
’dl


3253 << "à = funùiÚ v®ue" << 
’dl


3254 << "Machš´ecisiÚ = " << 
•smch
 << 
’dl
;

3255 
cout
 << "N = " << 
n
 << ", M = " << 
m
 << 
’dl
;

3256 ià(
ršt
 >= 1)

3258 *
™fe
 << "RUNNING THE L-BFGS-B CODE,ƒpsmch = "

3259 << "™ = i‹¿tiÚ‚umb”" << 
’dl


3260 << "nà =‚umb” oàfunùiÚƒv®u©iÚs" << 
’dl


3262 << 
’dl


3264 << 
’dl


3266 << 
’dl


3267 <<"cÚ = cÚv”ged, bnd =‡ bound wa »ached" << 
’dl


3269 << 
’dl


3270 << "¡•Èğ¡•†’gth u£d" << 
’dl


3271 << "t¡• =‚Üm oàthdi¥Ïûm’ˆÑÙ® s‹p)" << 
’dl


3272 << "´ojg =‚Üm oàth´ojeùed g¿d›Á" << 
’dl


3273 << "à = funùiÚ v®ue" << 
’dl


3274 << "Machš´ecisiÚ = " << 
•smch
 << 
’dl
;

3275 *
™fe
 << "N = " << 
n
 << ", M = " << 
m
 << 
’dl
;

3276 *
™fe
 << " it‚f‚int‚act sub itls steplstep…rojg"

3277 << " f" << 
’dl
;

3278 ià(
ršt
 > 100)

3280 
cout
 << "L = ";

3281 
i
 = 1; i <ğ
n
; i++è
cout
 << 
l
[i] << " ";

3282 
cout
 << 
’dl
;

3283 
cout
 << "X0 = ";

3284 
i
 = 1; i <ğ
n
; i++è
cout
 << 
x
[i] << " ";

3285 
cout
 << 
’dl
;

3286 
cout
 << "U = ";

3287 
i
 = 1; i <ğ
n
; i++è
cout
 << 
u
[i] << " ";

3288 
cout
 << 
’dl
;

3292 
	}
}

3315 
	$´n2lb
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
x
, cÚ¡ & 
f
,

3316 cÚ¡ * cÚ¡ & 
g
, cÚ¡ & 
ršt
,

3317 
of¡»am
* 
™fe
, cÚ¡ & 
™”
, cÚ¡ & 
nfgv
,

3318 cÚ¡ & 
Çù
, cÚ¡ & 
sbgÄm
, cÚ¡ & 
nšt
,

3319 * cÚ¡ & 
wÜd
, cÚ¡ & 
iwÜd
, cÚ¡ & 
iback
,

3320 cÚ¡ & 
¡p
, cÚ¡ & 
x¡•
)

3323 
imod
;

3326 ià(
iwÜd
 == 0)

3329 
	`¡rıy
(
wÜd
, "con");

3332 ià(
iwÜd
 == 1)

3335 
	`¡rıy
(
wÜd
, "bnd");

3338 ià(
iwÜd
 == 5)

3341 
	`¡rıy
(
wÜd
, "TNT");

3345 
	`¡rıy
(
wÜd
, "---");

3347 ià(
ršt
 >= 99)

3349 
cout
 << "LINE SEARCH " << 
iback
 <<"imes;‚Üm oà¡• = " <<
x¡•
<<
’dl
;

3350 
cout
 << "Aˆ™”©" << 
™”
 << " f=" << 
f
 <<" |´oj g|="<<
sbgÄm
<<
’dl
;

3351 ià(
ršt
 > 100)

3353 
cout
 << "X = " << 
’dl
;

3354 
i
 = 1; i <ğ
n
; i++è
cout
 << 
x
[i] << " ";

3355 
cout
 << 
’dl
;

3356 
cout
 << "G = " << 
’dl
;

3357 
i
 = 1; i <ğ
n
; i++è
cout
 << 
g
[i] << " ";

3358 
cout
 << 
’dl
;

3362 ià(
ršt
 > 0)

3364 
imod
 = 
™”
%
ršt
;

3365 ià(
imod
 == 0)

3366 
cout
 << "Aˆ™”©" << 
™”
 << " f="<<
f
<< " |´oj g|="<<
sbgÄm
<<
’dl
;

3368 ià(
ršt
 >= 1)

3369 *
™fe
 << " " << 
™”
 << " " << 
nfgv
 << " " << 
nšt
 << " " << 
Çù
 << " "

3370 << 
wÜd
 << " " << 
iback
 << " " << 
¡p
 << " " << 
x¡•
 << " "

3371 << 
sbgÄm
 << " " << 
f
 << 
’dl
;

3372 
	}
}

3396 
	$´n3lb
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
x
, & 
f
,

3397 cÚ¡ * cÚ¡ & 
sk
, cÚ¡ & 
ršt
,

3398 cÚ¡ & 
šfo
, 
of¡»am
* 
™fe
, cÚ¡ & 
™”
,

3399 cÚ¡ & 
nfgv
, cÚ¡ & 
nštŞ
, cÚ¡ & 
nsk
,

3400 cÚ¡ & 
Çù
, cÚ¡ & 
sbgÄm
, cÚ¡ & 
time
,

3401 cÚ¡ & 
nšt
, cÚ¡ * cÚ¡ & 
wÜd
, cÚ¡ & 
iback
,

3402 cÚ¡ & 
¡p
,cÚ¡ & 
x¡•
, cÚ¡ & 
k
,

3403 cÚ¡ & 
ÿchyt
, cÚ¡ & 
sbtime
, cÚ¡ & 
Êscht
)

3406 ià(
	`¡ºcmp
(
sk
,"ERROR",5)==0è
gÙo999
;

3408 ià(
ršt
 >= 0)

3410 
cout
 << " * * *"

3411 << "T™ =Ù®‚umb” oà™”©iÚs" << 
’dl


3412 << "Tnà =Ù®‚umb” oàfunùiÚƒv®u©iÚs" << 
’dl


3414 << " Cauchy s—rches" << 
’dl


3415 << "Sk =‚umb” oàBFGS upd©e sk³d" << 
’dl


3417 << " Cauchy…ošt" << 
’dl


3418 << "Projg =‚Üm oàthfš®…rojeùed g¿d›Á" << 
’dl


3419 << "F = fš® funùiÚ v®ue" << 
’dl


3420 << " * * *" << 
’dl
;

3422 
cout
 << " N T™ Tnà Tnšˆ Sk Naù Projg F" << 
’dl
;

3423 
cout
 << " " << 
n
 << " " << 
™”
 << " " << 
nfgv
 << " " << 
nštŞ
 << " "

3424 << 
nsk
 << " " << 
Çù
 << " " << 
sbgÄm
 << " " << 
f
 << 
’dl
;

3425 ià(
ršt
 >= 100)

3427 
cout
 << "X = ";

3428 
i
 = 1; i <ğ
n
; i++)

3429 
cout
 << 
x
[
i
] << " ";

3430 
cout
 << 
’dl
;

3432 ià(
ršt
 >ğ1è
cout
 << " F = " << 
f
 << 
’dl
;

3435 
gÙo999
:

3437 ià(
ršt
 >= 0)

3439 
cout
 << 
sk
 << 
’dl
;

3440 ià(
šfo
 != 0)

3442 ià(
šfo
 == -1)

3443 
cout
 << "Matrix in 1st Cholesky factorization in formk is‚ot "

3444 << "Pos. Def." << 
’dl
;

3445 ià(
šfo
 == -2)

3446 
cout
 << "Matrix in 2st Cholesky factorization in formk is‚ot "

3447 << "Pos. Def." << 
’dl
;

3448 ià(
šfo
 == -3)

3449 
cout
 << "Matrix inhe Cholesky factorization in formt is‚ot "

3450 << "Pos. Def." << 
’dl
;

3451 ià(
šfo
 == -4)

3452 
cout
 << "Derivative >= 0, backtracking†ine search impossible."

3453 << 
’dl
 << "Previous x, f‡nd g„estored." <<ƒndl

3455 <<"ev®u©iÚ;" << 
’dl


3456 << "2„oundšgƒ¼Ü domš©computiÚ." << 
’dl
;

3457 ià(
šfo
 == -5)

3458 
cout
 << "W¬nšg: mÜthª 10 funùiÚ‡nd g¿d›Á" << 
’dl


3460 << "may…ossibly bÿu£d by‡ bad s—rch dœeùiÚ."<<
’dl
;

3461 ià(
šfo
 == -6)

3462 
cout
 << " IÅuˆnbd(" << 
k
 << "èi šv®id."<<
’dl
;

3463 ià(
šfo
 == -7)

3464 
cout
 << "†(" << 
k
 << ") > u(" << k << "). No feasible solution."

3465 << 
’dl
;

3466 ià(
šfo
 == -8)

3467 
cout
 << "ThŒŸnguÏ¸sy¡em i sšguÏr" << 
’dl
;

3468 ià(
šfo
 == -9)

3469 
cout
 << " Lš£¬ch cªnÙ†oÿ‹‡Àadequ©pošˆaá”"<<
’dl


3471 << " g„e¡Üed." << 
’dl


3474 << 
’dl
;

3477 ià(
ršt
 >= 1)

3478 
cout
 << "Cauchyim" << 
ÿchyt
 << " secÚds."<<
’dl


3479 << "Sub¥aû mšimiz©iÚim" << 
sbtime
 << " secÚds."<<
’dl


3480 << "Lš£¬chim" << 
Êscht
 << " secÚds."<<
’dl
;

3482 
cout
 << "TÙ® U£¸tim" << 
time
 << " secÚds." << 
’dl
;

3484 ià(
ršt
 >= 1)

3486 ià(
šfo
 == -4 || info == -9)

3488 *
™fe
 << " " << 
n
 << " " << 
™”
 << " " << 
nfgv
 << " " << 
nštŞ


3489 << " " << 
nsk
 << " " << 
Çù
 << " " << 
sbgÄm
 << " " << 
f


3490 << 
’dl
;

3492 *
™fe
 << 
sk
 << 
’dl
;

3493 ià(
šfo
 != 0)

3495 ià(
šfo
 == -1)

3496 *
™fe
 << "Matrix in 1st Cholesky factorization in formk is‚ot"

3497 << " Pos. Def." << 
’dl
;

3498 ià(
šfo
 == -2)

3499 *
™fe
 << "Matrix in 2st Cholesky factorization in formk is‚ot"

3500 << " Pos. Def." << 
’dl
;

3501 ià(
šfo
 == -3)

3502 *
™fe
 << "Matrix inhe Cholesky factorization in formt is‚ot"

3503 << " Pos. Def." << 
’dl
;

3504 ià(
šfo
 == -4)

3505 *
™fe
 << "Derivative>=0, backtracking†ine search impossible."

3506 << 
’dl
 << "Previous x, f‡nd g„estored." <<ƒndl

3508 <<"ev®u©iÚ;" << 
’dl


3509 << "2„oundšgƒ¼Ü domš©computiÚ." << 
’dl
;

3510 ià(
šfo
 == -5)

3511 *
™fe
 << "W¬nšg: mÜthª 10 funùiÚ‡nd g¿d›Á" << 
’dl


3514 << 
’dl
;

3515 ià(
šfo
 == -8)

3516 
cout
 << "ThŒŸnguÏ¸sy¡em i sšguÏr" << 
’dl
;

3517 ià(
šfo
 == -9)

3518 
cout
 << " Line search cannot†ocate‡n‡dequate…oint‡fter"

3519 << 
’dl


3521 << "ªd g„e¡Üed." << 
’dl


3524 << 
’dl
;

3526 *
™fe
 << "TÙ® U£¸tim" << 
time
 << " secÚds." << 
’dl
;

3529 
	}
}

3552 
	$´ojgr
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

3553 cÚ¡ * cÚ¡ & 
nbd
, cÚ¡ * cÚ¡ & 
x
,

3554 cÚ¡ * cÚ¡ & 
g
, & 
sbgÄm
)

3557 
gi
;

3559 
z”o
=0.0;

3561 
sbgÄm
 = 
z”o
;

3562 
i
 = 1; i <ğ
n
; i++)

3564 
gi
 = 
g
[
i
];

3565 ià(
nbd
[
i
] != 0)

3567 ià(
gi
 < 
z”o
)

3569 ià(
nbd
[
i
] >ğ2è
gi
 = 
	`max
((
x
[i]-
u
[i]),gi);

3573 ià(
nbd
[
i
] <ğ2è
gi
 = 
	`mš
((
x
[i]-
l
[i]),gi);

3576 
sbgÄm
 = 
	`max
(sbgÄm,
	`çbs
(
gi
));

3578 
	}
}

3729 
	$subsm
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ & 
nsub
, cÚ¡ * cÚ¡& 
šd
,

3730 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

3731 cÚ¡ * cÚ¡ & 
nbd
, * cÚ¡ & 
x
, * cÚ¡ & 
d
,

3732 * cÚ¡ & 
ws
, * cÚ¡ & 
wy
, cÚ¡ & 
th‘a
,

3733 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, & 
iwÜd
, * cÚ¡ & 
wv
,

3734 * cÚ¡ & 
wn
, cÚ¡ & 
ršt
, & 
šfo
)

3737 
pošŒ
,
m2
,
cŞ2
,
ibd
=0,
js
,
k
;

3738 
®pha
,
dk
,
‹mp1
,
‹mp2
;

3739 
Úe
=1.0,
z”o
=0.0;

3740 
idx
;

3742 ià(
nsub
 <= 0) ;

3743 ià(
ršt
 >= 99)

3744 
cout
 << "----------------SUBSMƒÁ”ed-----------------" << 
’dl
;

3748 
pošŒ
 = 
h—d
;

3749 
i
 = 1; i <ğ
cŞ
; i++)

3751 
‹mp1
 = 
z”o
;

3752 
‹mp2
 = 
z”o
;

3753 
j
 = 1; j <ğ
nsub
; j++)

3755 
k
 = 
šd
[
j
];

3756 
idx
 = 
	`g‘Idx
(
k
,
pošŒ
,
n
);

3757 
‹mp1
 +ğ
wy
[
idx
]*
d
[
j
];

3758 
‹mp2
 +ğ
ws
[
idx
]*
d
[
j
];

3760 
wv
[
i
] = 
‹mp1
;

3761 
wv
[
cŞ
 + 
i
] = 
th‘a
*
‹mp2
;

3762 
pošŒ
 =…ošŒ%
m
 + 1;

3768 
m2
 = 2*
m
;

3769 
cŞ2
 = 2*
cŞ
;

3770 
	`dŒ¦
(
wn
,
m2
,
cŞ2
,
wv
,11,
šfo
);

3772 ià(
šfo
 != 0) ;

3773 
i
 = 1; i <ğ
cŞ
; i++)

3774 
wv
[
i
] = -wv[i];

3775 
	`dŒ¦
(
wn
,
m2
,
cŞ2
,
wv
,01,
šfo
);

3777 ià(
šfo
 != 0) ;

3781 
pošŒ
 = 
h—d
;

3782 
jy
 = 1; jy <ğ
cŞ
; jy++)

3784 
js
 = 
cŞ
 + 
jy
;

3785 
i
 = 1; i <ğ
nsub
; i++)

3787 
k
 = 
šd
[
i
];

3788 
idx
 = 
	`g‘Idx
(
k
,
pošŒ
,
n
);

3789 
d
[
i
] +ğ
wy
[
idx
]*
wv
[
jy
]/
th‘a
 + 
ws
[idx]*wv[
js
];

3791 
pošŒ
 =…ošŒ%
m
 + 1;

3794 
i
 = 1; i <ğ
nsub
; i++)

3795 
d
[
i
] /ğ
th‘a
;

3799 
®pha
 = 
Úe
;

3800 
‹mp1
 = 
®pha
;

3802 
i
 = 1; i <ğ
nsub
; i++)

3804 
k
 = 
šd
[
i
];

3805 
dk
 = 
d
[
i
];

3806 ià(
nbd
[
k
] != 0)

3808 ià(
dk
 < 
z”o
 && 
nbd
[
k
] <= 2)

3810 
‹mp2
 = 
l
[
k
] - 
x
[k];

3811 ià(
‹mp2
 >ğ
z”o
)

3812 
‹mp1
 = 
z”o
;

3814 ià(
dk
*
®pha
 < 
‹mp2
)

3815 
‹mp1
 = 
‹mp2
/
dk
;

3818 ià(
dk
 > 
z”o
 && 
nbd
[
k
] >= 2)

3820 
‹mp2
 = 
u
[
k
] - 
x
[k];

3821 ià(
‹mp2
 <ğ
z”o
)

3822 
‹mp1
 = 
z”o
;

3824 ià(
dk
*
®pha
 > 
‹mp2
)

3825 
‹mp1
 = 
‹mp2
/
dk
;

3827 ià(
‹mp1
 < 
®pha
)

3829 
®pha
 = 
‹mp1
;

3830 
ibd
 = 
i
;

3836 ià(
®pha
 < 
Úe
)

3838 
dk
 = 
d
[
ibd
];

3839 
k
 = 
šd
[
ibd
];

3840 ià(
dk
 > 
z”o
)

3842 
x
[
k
] = 
u
[k];

3843 
d
[
ibd
] = 
z”o
;

3846 ià(
dk
 < 
z”o
)

3848 
x
[
k
] = 
l
[k];

3849 
d
[
ibd
] = 
z”o
;

3853 
i
 = 1; i <ğ
nsub
; i++)

3855 
k
 = 
šd
[
i
];

3856 
x
[
k
] +ğ
®pha
*
d
[
i
];

3859 ià(
ršt
 >= 99)

3861 ià(
®pha
 < 
Úe
)

3862 
cout
 << "ALPHA = " << 
®pha
 << " backŒackØthBOX" << 
’dl
;

3864 
cout
 << "SM sŞutiÚ insidthbox" << 
’dl
;

3866 ià(
ršt
 >100)

3868 
cout
 << "Subspace solution X = ";

3869 
i
 = 1; i <ğ
n
; i++è
cout
 << 
x
[i] << " ";

3870 
cout
 << 
’dl
;

3874 ià(
®pha
 < 
Úe
)

3875 
iwÜd
 = 1;

3877 
iwÜd
 = 0;

3879 ià(
ršt
 >= 99)

3880 
cout
 << "----------------ex™ SUBSM --------------------" << 
’dl
;

3881 
	}
}

4017 
	$dc¤ch
(& 
f
, & 
g
, & 
¡p
, cÚ¡ & 
áŞ
,

4018 cÚ¡ & 
gtŞ
, cÚ¡ & 
xtŞ
, cÚ¡ & 
¡pmš
,

4019 cÚ¡ & 
¡pmax
, * cÚ¡ & 
sk
, * cÚ¡ & 
i§ve
,

4020 * cÚ¡ & 
d§ve
)

4022 
z”o
=0.0,
p5
=0.5,
p66
=0.66;

4023 
xŒ­l
=1.1,
xŒ­u
=4.0;

4025 
boŞ
 
b¿ckt
;

4026 
¡age
;

4027 
fš™
,
áe¡
,
fm
,
fx
,
fxm
,
fy
,
fym
,
gš™
,
g‹¡
,

4028 
gm
,
gx
,
gxm
,
gy
,
gym
,
¡x
,
¡y
,
¡mš
,
¡max
,
width
,
width1
;

4032 ià(
	`¡ºcmp
(
sk
,"START",5)==0)

4036 ià(
¡p
 < 
¡pmš
è
	`¡rıy
(
sk
, "ERROR: STP < STPMIN");

4037 ià(
¡p
 > 
¡pmax
è
	`¡rıy
(
sk
, "ERROR: STP > STPMAX");

4038 ià(
g
 >
z”o
è
	`¡rıy
(
sk
, "ERROR: INITIAL G >ZERO");

4039 ià(
áŞ
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: FTOL < ZERO");

4040 ià(
gtŞ
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: GTOL < ZERO");

4041 ià(
xtŞ
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: XTOL < ZERO");

4042 ià(
¡pmš
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: STPMIN < ZERO");

4043 ià(
¡pmax
 < 
¡pmš
è
	`¡rıy
(
sk
, "ERROR: STPMAX < STPMIN");

4046 ià(
	`¡ºcmp
(
sk
,"ERROR",5)==0) ;

4050 
b¿ckt
 = 
çl£
;

4051 
¡age
 = 1;

4052 
fš™
 = 
f
;

4053 
gš™
 = 
g
;

4054 
g‹¡
 = 
áŞ
*
gš™
;

4055 
width
 = 
¡pmax
 - 
¡pmš
;

4056 
width1
 = 
width
/
p5
;

4065 
¡x
 = 
z”o
;

4066 
fx
 = 
fš™
;

4067 
gx
 = 
gš™
;

4068 
¡y
 = 
z”o
;

4069 
fy
 = 
fš™
;

4070 
gy
 = 
gš™
;

4071 
¡mš
 = 
z”o
;

4072 
¡max
 = 
¡p
 + 
xŒ­u
*stp;

4073 
	`¡rıy
(
sk
, "FG");

4075 
gÙo1000
;

4081 ià(
i§ve
[1] == 1)

4082 
b¿ckt
 = 
Œue
;

4084 
b¿ckt
 = 
çl£
;

4086 
¡age
 = 
i§ve
[2];

4087 
gš™
 = 
d§ve
[1];

4088 
g‹¡
 = 
d§ve
[2];

4089 
gx
 = 
d§ve
[3];

4090 
gy
 = 
d§ve
[4];

4091 
fš™
 = 
d§ve
[5];

4092 
fx
 = 
d§ve
[6];

4093 
fy
 = 
d§ve
[7];

4094 
¡x
 = 
d§ve
[8];

4095 
¡y
 = 
d§ve
[9];

4096 
¡mš
 = 
d§ve
[10];

4097 
¡max
 = 
d§ve
[11];

4098 
width
 = 
d§ve
[12];

4099 
width1
 = 
d§ve
[13];

4105 
áe¡
 = 
fš™
 + 
¡p
*
g‹¡
;

4106 ià(
¡age
 =ğ1 && 
f
 <ğ
áe¡
 && 
g
 >ğ
z”o
) stage = 2;

4110 ià(
b¿ckt
 && (
¡p
 <ğ
¡mš
 || s >ğ
¡max
))

4111 
	`¡rıy
(
sk
, "WARNING: ROUNDING ERRORS PREVENT PROGRESS");

4112 ià(
b¿ckt
 && 
¡max
 - 
¡mš
 <ğ
xtŞ
*stmax)

4113 
	`¡rıy
(
sk
, "WARNING: XTOL TEST SATISFIED");

4114 ià(
¡p
 =ğ
¡pmax
 && 
f
 <ğ
áe¡
 && 
g
 <ğ
g‹¡
)

4115 
	`¡rıy
(
sk
, "WARNING: STP = STPMAX");

4116 ià(
¡p
 =ğ
¡pmš
 && (
f
 > 
áe¡
 || 
g
 >ğ
g‹¡
))

4117 
	`¡rıy
(
sk
, "WARNING: STP = STPMIN");

4121 ià(
f
 <ğ
áe¡
 && 
	`çbs
(
g
è<ğ
gtŞ
*(-
gš™
))

4122 
	`¡rıy
(
sk
, "CONVERGENCE");

4126 ià(
	`¡ºcmp
(
sk
,"WARN",4)==0 || sŒncmpÑask,"CONV",4)==0è
gÙo1000
;

4132 ià(
¡age
 =ğ1 && 
f
 <ğ
fx
 && f > 
áe¡
)

4136 
fm
 = 
f
 - 
¡p
*
g‹¡
;

4137 
fxm
 = 
fx
 - 
¡x
*
g‹¡
;

4138 
fym
 = 
fy
 - 
¡y
*
g‹¡
;

4139 
gm
 = 
g
 - 
g‹¡
;

4140 
gxm
 = 
gx
 - 
g‹¡
;

4141 
gym
 = 
gy
 - 
g‹¡
;

4145 
	`dc¡•
(
¡x
,
fxm
,
gxm
,
¡y
,
fym
,
gym
,
¡p
,
fm
,
gm
,

4146 
b¿ckt
,
¡mš
,
¡max
);

4150 
fx
 = 
fxm
 + 
¡x
*
g‹¡
;

4151 
fy
 = 
fym
 + 
¡y
*
g‹¡
;

4152 
gx
 = 
gxm
 + 
g‹¡
;

4153 
gy
 = 
gym
 + 
g‹¡
;

4159 
	`dc¡•
(
¡x
,
fx
,
gx
,
¡y
,
fy
,
gy
,
¡p
,
f
,
g
,

4160 
b¿ckt
,
¡mš
,
¡max
);

4165 ià(
b¿ckt
)

4167 ià(
	`çbs
(
¡y
-
¡x
è>ğ
p66
*
width1
è
¡p
 = stx + 
p5
*(sty - stx);

4168 
width1
 = 
width
;

4169 
width
 = 
	`çbs
(
¡y
-
¡x
);

4174 ià(
b¿ckt
)

4176 
¡mš
 = 
	`mš
(
¡x
,
¡y
);

4177 
¡max
 = 
	`max
(
¡x
,
¡y
);

4181 
¡mš
 = 
¡p
 + 
xŒ­l
*(¡°- 
¡x
);

4182 
¡max
 = 
¡p
 + 
xŒ­u
*(¡°- 
¡x
);

4187 
¡p
 = 
	`max
(¡p,
¡pmš
);

4188 
¡p
 = 
	`mš
(¡p,
¡pmax
);

4193 ià((
b¿ckt
 && (
¡p
 <ğ
¡mš
 || s >ğ
¡max
))

4194 || (
b¿ckt
 && 
¡max
-
¡mš
 <ğ
xtŞ
*¡max)è
¡p
 = 
¡x
;

4197 
	`¡rıy
(
sk
,"FG");

4199 
gÙo1000
:

4203 ià(
b¿ckt
)

4204 
i§ve
[1] = 1;

4206 
i§ve
[1] = 0;

4208 
i§ve
[2] = 
¡age
;

4209 
d§ve
[1] = 
gš™
;

4210 
d§ve
[2] = 
g‹¡
;

4211 
d§ve
[3] = 
gx
;

4212 
d§ve
[4] = 
gy
;

4213 
d§ve
[5] = 
fš™
;

4214 
d§ve
[6] = 
fx
;

4215 
d§ve
[7] = 
fy
;

4216 
d§ve
[8] = 
¡x
;

4217 
d§ve
[9] = 
¡y
;

4218 
d§ve
[10] = 
¡mš
;

4219 
d§ve
[11] = 
¡max
;

4220 
d§ve
[12] = 
width
;

4221 
d§ve
[13] = 
width1
;

4222 
	}
}

4318 
	$dc¡•
(& 
¡x
, & 
fx
, & 
dx
, & 
¡y
, & 
fy
,

4319 & 
dy
, & 
¡p
, cÚ¡ & 
å
, cÚ¡ & 
dp
,

4320 
boŞ
& 
b¿ckt
, cÚ¡ & 
¡pmš
, cÚ¡ & 
¡pmax
)

4322 
z”o
=0.0,
p66
=0.66,
two
=2.0,
th»e
=3.0;

4323 
gamma
,
p
,
q
,
r
,
s
,
sgnd
,
¡pc
,
¡pf
,
¡pq
,
th‘a
;

4325 
sgnd
 = 
dp
*(
dx
/
	`çbs
(dx));

4332 ià(
å
 > 
fx
)

4334 
th‘a
 = 
th»e
*(
fx
 - 
å
)/(
¡p
 - 
¡x
è+ 
dx
 + 
dp
;

4335 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dx
),çbs(
dp
));

4336 
gamma
 = 
s
*
	`sq¹
Ğ(
th‘a
/s)*Ñh‘a/sè- (
dx
/s)*(
dp
/s) );

4337 ià(
¡p
 < 
¡x
è
gamma
 = -gamma;

4338 
p
 = (
gamma
 - 
dx
è+ 
th‘a
;

4339 
q
 = ((
gamma
 - 
dx
è+ gammaè+ 
dp
;

4340 
r
 = 
p
/
q
;

4341 
¡pc
 = 
¡x
 + 
r
*(
¡p
 - stx);

4342 
¡pq
 = 
¡x
 + ((
dx
/((
fx
 - 
å
)/(
¡p
 - stxè+ dx))/
two
)*(stp - stx);

4343 ià(
	`çbs
(
¡pc
-
¡x
è< fabs(
¡pq
-stx))

4344 
¡pf
 = 
¡pc
;

4346 
¡pf
 = 
¡pc
 + (
¡pq
 - sc)/
two
;

4347 
b¿ckt
 = 
Œue
;

4356 ià(
sgnd
 < 
z”o
)

4358 
th‘a
 = 
th»e
*(
fx
 - 
å
)/(
¡p
 - 
¡x
è+ 
dx
 + 
dp
;

4359 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dx
),çbs(
dp
));

4360 
gamma
 = 
s
*
	`sq¹
Ğ(
th‘a
/s)*Ñh‘a/sè- (
dx
/s)*(
dp
/s) );

4361 ià(
¡p
 > 
¡x
è
gamma
 = -gamma;

4362 
p
 = (
gamma
 - 
dp
è+ 
th‘a
;

4363 
q
 = ((
gamma
 - 
dp
è+ gammaè+ 
dx
;

4364 
r
 = 
p
/
q
;

4365 
¡pc
 = 
¡p
 + 
r
*(
¡x
 - stp);

4366 
¡pq
 = 
¡p
 + (
dp
/(d°- 
dx
))*(
¡x
 - stp);

4367 ià(
	`çbs
(
¡pc
-
¡p
è> fabs(
¡pq
-stp))

4368 
¡pf
 = 
¡pc
;

4370 
¡pf
 = 
¡pq
;

4371 
b¿ckt
 = 
Œue
;

4378 ià(
	`çbs
(
dp
è< fabs(
dx
))

4385 
th‘a
 = 
th»e
*(
fx
 - 
å
)/(
¡p
 - 
¡x
è+ 
dx
 + 
dp
;

4386 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dx
),çbs(
dp
));

4391 
gamma
 = 
s
*
	`sq¹
(
	`max
(
z”o
, (
th‘a
/s)*Ñh‘a/s)-(
dx
/s)*(
dp
/s)));

4392 ià(
¡p
 > 
¡x
è
gamma
 = -gamma;

4393 
p
 = (
gamma
 - 
dp
è+ 
th‘a
;

4394 
q
 = (
gamma
 + (
dx
 - 
dp
)) + gamma;

4395 
r
 = 
p
/
q
;

4396 ià(
r
 < 
z”o
 && 
gamma
 != zero)

4397 
¡pc
 = 
¡p
 + 
r
*(
¡x
 - stp);

4399 ià(
¡p
 > 
¡x
)

4400 
¡pc
 = 
¡pmax
;

4402 
¡pc
 = 
¡pmš
;

4404 
¡pq
 = 
¡p
 + (
dp
/(d°- 
dx
))*(
¡x
 - stp);

4406 ià(
b¿ckt
)

4413 ià(
	`çbs
(
¡pc
-
¡p
è< fabs(
¡pq
-stp))

4414 
¡pf
 = 
¡pc
;

4416 
¡pf
 = 
¡pq
;

4418 ià(
¡p
 > 
¡x
)

4419 
¡pf
 = 
	`mš
(
¡p
+
p66
*(
¡y
-stp),stpf);

4421 
¡pf
 = 
	`max
(
¡p
+
p66
*(
¡y
-stp),stpf);

4429 ià(
	`çbs
(
¡pc
-
¡p
è> fabs(
¡pq
-stp))

4430 
¡pf
 = 
¡pc
;

4432 
¡pf
 = 
¡pq
;

4434 
¡pf
 = 
	`mš
(
¡pmax
,stpf);

4435 
¡pf
 = 
	`max
(
¡pmš
,stpf);

4444 ià(
b¿ckt
)

4446 
th‘a
 = 
th»e
*(
å
 - 
fy
)/(
¡y
 - 
¡p
è+ 
dy
 + 
dp
;

4447 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dy
),çbs(
dp
));

4448 
gamma
 = 
s
*
	`sq¹
((
th‘a
/s)*Ñh‘a/sè- (
dy
/s)*(
dp
/s));

4449 ià(
¡p
 > 
¡y
è
gamma
 = -gamma;

4450 
p
 = (
gamma
 - 
dp
è+ 
th‘a
;

4451 
q
 = ((
gamma
 - 
dp
è+ gammaè+ 
dy
;

4452 
r
 = 
p
/
q
;

4453 
¡pc
 = 
¡p
 + 
r
*(
¡y
 - stp);

4454 
¡pf
 = 
¡pc
;

4457 ià(
¡p
 > 
¡x
)

4458 
¡pf
 = 
¡pmax
;

4460 
¡pf
 = 
¡pmš
;

4465 ià(
å
 > 
fx
)

4467 
¡y
 = 
¡p
;

4468 
fy
 = 
å
;

4469 
dy
 = 
dp
;

4473 ià(
sgnd
 < 
z”o
)

4475 
¡y
 = 
¡x
;

4476 
fy
 = 
fx
;

4477 
dy
 = 
dx
;

4479 
¡x
 = 
¡p
;

4480 
fx
 = 
å
;

4481 
dx
 = 
dp
;

4486 
¡p
 = 
¡pf
;

4487 
	}
}

4520 
	$dÄm2
(& 
n
,* cÚ¡ & 
x
, & 
šcx
)

4523 
sÿË
 = 0.0;

4524 
ddÄm2
 = 0.0;

4526 
i
 = 1; i <ğ
n
; i+=
šcx
)

4527 
sÿË
 = 
	`max
(sÿË, 
	`çbs
(
x
[
i
]));

4529 ià(
sÿË
 =ğ0.0è 
ddÄm2
;

4531 
i
 = 1; i <ğ
n
; i+=
šcx
)

4532 
ddÄm2
 +ğ(
x
[
i
]/
sÿË
)*(x[i]/scale);

4534 
ddÄm2
 = 
sÿË
*
	`sq¹
(ddnrm2);

4535  
ddÄm2
;

4536 
	}
}

4569 
	$dpm•s
()

4572 
ib‘a
,
œnd
,
™
,
™emp
,
Ãg•
;

4573 
a
,
b
,
b‘a
,
b‘aš
,
b‘ah
,
‹mp
,
‹m·
,
‹mp1
,

4574 
z”o
=0.0,
Úe
=1.0,
two
=2.0;

4575 
ddpm•s
;

4579 
a
 = 
Úe
;

4580 
b
 = 
Úe
;

4581 
gÙo10
:

4582 
a
 =‡ +‡;

4583 
‹mp
 = 
a
 + 
Úe
;

4584 
‹mp1
 = 
‹mp
 - 
a
;

4585 ià(
‹mp1
 - 
Úe
 =ğ
z”o
è
gÙo10
;

4587 
gÙo20
:

4588 
b
 = b + b;

4589 
‹mp
 = 
a
 + 
b
;

4590 
™emp
 = (
‹mp
 - 
a
);

4591 ià(
™emp
 =ğ0è
gÙo20
;

4592 
ib‘a
 = 
™emp
;

4593 
b‘a
 = (
ib‘a
);

4597 
™
 = 0;

4598 
b
 = 
Úe
;

4599 
gÙo30
:

4600 
™
 += 1;

4601 
b
 *ğ
b‘a
;

4602 
‹mp
 = 
b
 + 
Úe
;

4603 
‹mp1
 = 
‹mp
 - 
b
;

4604 ià(
‹mp1
 - 
Úe
 =ğ
z”o
è
gÙo30
;

4605 
œnd
 = 0;

4606 
b‘ah
 = 
b‘a
/
two
;

4607 
‹mp
 = 
a
 + 
b‘ah
;

4608 ià(
‹mp
 - 
a
 !ğ
z”o
è
œnd
 = 1;

4609 
‹m·
 = 
a
 + 
b‘a
;

4610 
‹mp
 = 
‹m·
 + 
b‘ah
;

4611 ià((
œnd
 =ğ0è&& (
‹mp
 - 
‹m·
 !ğ
z”o
)) irnd = 2;

4615 
Ãg•
 = 
™
 + 3;

4616 
b‘aš
 = 
Úe
/
b‘a
;

4617 
a
 = 
Úe
;

4618 
i
 = 1; i <ğ
Ãg•
; i++)

4619 
a
 *ğ
b‘aš
;

4621 
gÙo50
:

4622 
‹mp
 = 
Úe
 + 
a
;

4623 ià(
‹mp
 - 
Úe
 !ğ
z”o
è
gÙo60
;

4624 
a
 *ğ
b‘a
;

4625 
gÙo50
;

4627 
gÙo60
:

4628 
ddpm•s
 = 
a
;

4629 ià((
ib‘a
 =ğ2è|| (
œnd
 =ğ0)è
gÙo70
;

4630 
a
 = (a*(
Úe
 +‡))/
two
;

4631 
‹mp
 = 
Úe
 + 
a
;

4632 ià(
‹mp
 - 
Úe
 !ğ
z”o
è
ddpm•s
 = 
a
;

4634 
gÙo70
:

4635  
ddpm•s
;

4636 
	}
}

4643 
	$daxpy
(cÚ¡ & 
n
, cÚ¡ & 
da
, cÚ¡ * cÚ¡ & 
dx
,

4644 cÚ¡ & 
šcx
, * cÚ¡ & 
dy
, cÚ¡ & 
šcy
)

4647 
ix
,
iy
,
m
,
mp1
;

4648 ià(
n
 <= 0) ;

4649 ià(
da
 == 0.0) ;

4650 if(
šcx
==1 && 
šcy
==1è
gÙo20
;

4655 
ix
 = 1;

4656 
iy
 = 1;

4657 if(
šcx
 < 0è
ix
 = (-
n
+1)*incx + 1;

4658 if(
šcy
 < 0è
iy
 = (-
n
+1)*incy + 1;

4660 
i
 = 1; i <ğ
n
; i++)

4662 
dy
[
iy
] +ğ
da
*
dx
[
ix
];

4663 
ix
 +ğ
šcx
;

4664 
iy
 +ğ
šcy
;

4671 
gÙo20
:

4672 
m
 = 
n
%4;

4673 ià(
m
 =ğ0è
gÙo40
;

4675 
i
 = 1; i <ğ
m
; i++)

4676 
dy
[
i
] +ğ
da
*
dx
[i];

4678 ià(
n
 < 4) ;

4680 
gÙo40
:

4681 
mp1
 = 
m
 + 1;

4683 
i
 = 
mp1
; i <ğ
n
; i+=4)

4685 
dy
[
i
] +ğ
da
*
dx
[i];

4686 
dy
[
i
 + 1] +ğ
da
*
dx
[i + 1];

4687 
dy
[
i
 + 2] +ğ
da
*
dx
[i + 2];

4688 
dy
[
i
 + 3] +ğ
da
*
dx
[i + 3];

4690 
	}
}

4697 
	$dcİy
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
dx
, cÚ¡ & 
šcx
,

4698 * cÚ¡ & 
dy
,cÚ¡ & 
šcy
)

4701 
ix
,
iy
,
m
,
mp1
;

4703 ià(
n
 <= 0) ;

4704 if(
šcx
==1 && 
šcy
==1è
gÙo20
;

4709 
ix
 = 1;

4710 
iy
 = 1;

4711 ià(
šcx
 < 0è
ix
 = (-
n
+1)*incx + 1;

4712 ià(
šcy
 < 0è
iy
 = (-
n
+1)*incy + 1;

4713 
i
 = 1; i <ğ
n
; i++)

4715 
dy
[
iy
] = 
dx
[
ix
];

4716 
ix
 +ğ
šcx
;

4717 
iy
 +ğ
šcy
;

4725 
gÙo20
:

4726 
m
 = 
n
%7;

4727 ià(
m
 =ğ0è
gÙo40
;

4728 
i
 = 1; i <ğ
m
; i++)

4729 
dy
[
i
] = 
dx
[i];

4731 ià(
n
 < 7) ;

4733 
gÙo40
:

4734 
mp1
 = 
m
 + 1;

4735 
i
 = 
mp1
; i <ğ
n
; i+=7)

4737 
dy
[
i
] = 
dx
[i];

4738 
dy
[
i
 + 1] = 
dx
[i + 1];

4739 
dy
[
i
 + 2] = 
dx
[i + 2];

4740 
dy
[
i
 + 3] = 
dx
[i + 3];

4741 
dy
[
i
 + 4] = 
dx
[i + 4];

4742 
dy
[
i
 + 5] = 
dx
[i + 5];

4743 
dy
[
i
 + 6] = 
dx
[i + 6];

4745 
	}
}

4752 
	$ddÙ
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
dx
, cÚ¡ & 
šcx
,

4753 cÚ¡ * cÚ¡ & 
dy
, cÚ¡ & 
šcy
)

4755 
d‹mp
;

4757 
ix
,
iy
,
m
,
mp1
;

4759 
dddÙ
 = 0.0;

4760 
d‹mp
 = 0.0;

4761 ià(
n
 <ğ0è 
dddÙ
;

4762 ià(
šcx
==1 && 
šcy
==1è
gÙo20
;

4767 
ix
 = 1;

4768 
iy
 = 1;

4769 ià(
šcx
 < 0è
ix
 = (-
n
+1)*incx + 1;

4770 ià(
šcy
 < 0è
iy
 = (-
n
+1)*incy + 1;

4772 
i
 = 1; i <ğ
n
; i++)

4774 
d‹mp
 +ğ
dx
[
ix
]*
dy
[
iy
];

4775 
ix
 +ğ
šcx
;

4776 
iy
 +ğ
šcy
;

4778 
dddÙ
 = 
d‹mp
;

4779  
dddÙ
;

4785 
gÙo20
:

4786 
m
 = 
n
%5;

4787 ià(
m
 =ğ0è
gÙo40
;

4789 
i
 = 1; i <ğ
m
; i++)

4790 
d‹mp
 +ğ
dx
[
i
]*
dy
[i];

4792 ifĞ
n
 < 5 ) 
gÙo60
;

4794 
gÙo40
:

4795 
mp1
 = 
m
 + 1;

4798 
i
 = 
mp1
; i <ğ
n
; i+=5)

4800 
d‹mp
 +ğ
dx
[
i
]*
dy
[i] + dx[i + 1]*dy[i + 1] +

4801 
dx
[
i
 + 2]*
dy
[i + 2] + dx[i + 3]*dy[i + 3] + dx[i + 4]*dy[i + 4];

4804 
gÙo60
:

4805 
dddÙ
 = 
d‹mp
;

4806  
dddÙ
;

4807 
	}
}

4852 
	$dpoç
(* cÚ¡ & 
a
, cÚ¡ & 
lda
, cÚ¡ & 
n
, & 
šfo
,

4853 
boŞ
 
sm®ËrM©rix
=
çl£
)

4855 
t
;

4856 
s
;

4858 
jm1
;

4859 
idx
;

4862 
j
 = 1; j <ğ
n
; j++)

4864 
šfo
 = 
j
;

4865 
s
 = 0.0;

4866 
jm1
 = 
j
 - 1;

4867 ià(
jm1
 < 1è
gÙo20
;

4868 
k
 = 1; k <ğ
jm1
; k++)

4870 
idx
 = 
	`g‘Idx
(
k
,
j
,
lda
);

4871 
t
 = 
a
[
idx
] - 
	`ddÙ
(
k
-1,&×[
	`g‘Idx
(1,k,
lda
)-1]),1,

4872 &(
a
[
	`g‘Idx
(1,
j
,
lda
)-1]),1);

4873 
t
 =/
a
[
	`g‘Idx
(
k
,k,
lda
)];

4874 
a
[
idx
] = 
t
;

4875 
s
 +ğ
t
*t;

4878 
gÙo20
:

4879 
idx
 = 
	`g‘Idx
(
j
,j,
lda
);

4880 
s
 = 
a
[
idx
] - s;

4883 ià(
s
 <ğ0.0è
gÙo40
;

4884 
a
[
idx
] = 
	`sq¹
(
s
);

4886 
šfo
 = 0;

4887 
gÙo40
:

4888 
t
 = 0;

4889 
	}
}

4897 
	$dsÿl
(cÚ¡ & 
n
, cÚ¡ & 
da
, * cÚ¡ & 
dx
,

4898 cÚ¡ & 
šcx
)

4901 
m
,
mp1
,
nšcx
;

4903 ià(
n
 <ğ0 || 
šcx
 <= 0) ;

4904 ià(
šcx
 =ğ1è
gÙo20
;

4908 
nšcx
 = 
n
*
šcx
;

4910 
i
 = 1; i <ğ
nšcx
; i+=
šcx
)

4911 
dx
[
i
] = 
da
*dx[i];

4918 
gÙo20
:

4919 
m
 = 
n
%5;

4920 ià(
m
 =ğ0è
gÙo40
;

4922 
i
 = 1; i <ğ
m
; i++)

4923 
dx
[
i
] = 
da
*dx[i];

4925 ià(
n
 < 5) ;

4927 
gÙo40
:

4928 
mp1
 = 
m
 + 1;

4929 
i
 = 
mp1
; i <ğ
n
; i+=5)

4931 
dx
[
i
] = 
da
*dx[i];

4932 
dx
[
i
 + 1] = 
da
*dx[i + 1];

4933 
dx
[
i
 + 2] = 
da
*dx[i + 2];

4934 
dx
[
i
 + 3] = 
da
*dx[i + 3];

4935 
dx
[
i
 + 4] = 
da
*dx[i + 4];

4937 
	}
}

4994 
	$dŒ¦
(* cÚ¡ & 
t
, cÚ¡ & 
ldt
, cÚ¡ & 
n
,

4995 * cÚ¡ &
b
, cÚ¡ & 
job
, & 
šfo
)

4997 
‹mp
;

4998 
cÿ£
,
j
;

5005 
šfo
 = 1; infØ<ğ
n
; info++)

5008 ià(
t
[
	`g‘Idx
(
šfo
,šfo,
ldt
)] =ğ0.0è
gÙo150
;

5010 
šfo
 = 0;

5014 
cÿ£
 = 1;

5015 ià(
job
%10 !ğ0è
cÿ£
 = 2;

5016 ià((
job
%100)/10 !ğ0è
cÿ£
 += 2;

5017 ià(
cÿ£
==1è
gÙo20
;

5018 ià(
cÿ£
==2è
gÙo50
;

5019 ià(
cÿ£
==3è
gÙo80
;

5020 ià(
cÿ£
==4è
gÙo110
;

5024 
gÙo20
:

5025 
b
[1] /ğ
t
[
	`g‘Idx
(1,1,
ldt
)];

5026 ià(
n
 < 2è
gÙo40
;

5027 
j
 = 2; j <ğ
n
; j++)

5029 
‹mp
 = -
b
[
j
-1];

5030 
	`daxpy
(
n
-
j
+1,
‹mp
,&(
t
[
	`g‘Idx
(j,j-1,
ldt
)-1]),1,&(
b
[j-1]),1);

5031 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

5033 
gÙo40
:

5034 
gÙo140
;

5038 
gÙo50
:

5039 
b
[
n
] /ğ
t
[
	`g‘Idx
Ò,n,
ldt
)];

5040 ià(
n
 < 2è
gÙo70
;

5041 
jj
 = 2; jj <ğ
n
; jj++)

5043 
j
 = 
n
 - 
jj
 + 1;

5044 
‹mp
 = -
b
[
j
+1];

5045 
	`daxpy
(
j
,
‹mp
,&(
t
[
	`g‘Idx
(1,j+1,
ldt
)-1]),1,&(
b
[1-1]),1);

5046 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

5049 
gÙo70
:

5050 
gÙo140
;

5054 
gÙo80
:

5055 
b
[
n
] /ğ
t
[
	`g‘Idx
Ò,n,
ldt
)];

5056 ià(
n
 < 2è
gÙo100
;

5057 
jj
 = 2; jj <ğ
n
; jj++)

5059 
j
 = 
n
 - 
jj
 + 1;

5060 
b
[
j
] = b[j] - 
	`ddÙ
(
jj
-1,&(
t
[
	`g‘Idx
(j+1,j,
ldt
)-1]),1,&(b[j+1-1]),1);

5061 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

5063 
gÙo100
:

5064 
gÙo140
;

5068 
gÙo110
:

5069 
b
[1] /ğ
t
[
	`g‘Idx
(1,1,
ldt
)];

5070 ià(
n
 < 2è
gÙo130
;

5071 
j
 = 2; j <ğ
n
; j++)

5073 
b
[
j
] = b[j] - 
	`ddÙ
(j-1,&(
t
[
	`g‘Idx
(1,j,
ldt
)-1]),1,&(b[1-1]),1);

5074 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

5077 
gÙo130
:

5079 ià(
çl£
);

5081 
gÙo140
:

5083 ià(
çl£
);

5085 
gÙo150
:

5087 ià(
çl£
);

5089 
	}
}

5091 
	g´iv©e
:

5092 
Tim”
 
tim”_
;

	@lbfgsp.h

67 #iâdeà
LBFGSP_H_SEP_17_2005


68 
	#LBFGSP_H_SEP_17_2005


	)

70 
	~<cm©h
>

71 
	~<c¡dlib
>

72 
	~<f¡»am
>

73 
	~"tim”.h
"

74 
	~"PŞynomŸl.h
"

76 cÚ¡ 
	gLBFGSP_PRINT
 = -1;

84 şas 
	cLBFGSP


86 
	mpublic
:

87 
	$LBFGSP
(cÚ¡ & 
maxI‹r
, cÚ¡ & 
áŞ
,

88 cÚ¡ & 
numWts
)

89 : 
	`maxI‹r_
(
maxI‹r
), 
	`áŞ_
(
áŞ
),

90 
	`nbd_
(
NULL
), 
	`iwa_
(NULL), 
	`l_
(NULL), 
	`u_
(NULL), 
	`g_
(NULL), 
	$wa_
(
NULL
)

91 { 
	`š™
(
numWts
); }

93 
	$LBFGSP
()

94 : 
	`maxI‹r_
(-1), 
	`áŞ_
(-1),

95 
	`nbd_
(
NULL
), 
	`iwa_
(NULL), 
	`l_
(NULL), 
	`u_
(NULL), 
	`g_
(NULL), 
	$wa_
(
NULL
)

96 { 
	`š™
(0); 
	}
}

99 ~
	$LBFGSP
(è{ 
	`de¡roy
(); 
	}
}

102 
	$£tMaxI‹r
(cÚ¡ & 
™”
è{ 
maxI‹r_
 = i‹r; 
	}
}

104 
	$£tFtŞ
(cÚ¡ & 
tŞ
è{ 
áŞ_
 =Ş; 
	}
}

107 
	$š™
(cÚ¡ & 
numWts
)

109 
	`de¡roy
();

110 
numWts_
 = 
numWts
;

111 
mmax
 = 17;

112 
nbd_
 = 
Ãw
 [
numWts_
+1];

113 
iwa_
 = 
Ãw
 [3*
numWts_
+1];

114 
l_
 = 
Ãw
 [
numWts_
+1];

115 
u_
 = 
Ãw
 [
numWts_
+1];

116 
g_
 = 
Ãw
 [
numWts_
+1];

117 
wa_
 = 
Ãw
 [2*
mmax
*
numWts_
+4*numWts_+12*mmax*mmax+12*mmax+1];

118 
	}
}

121 
	$»In™
(cÚ¡ & 
numWts
)

123 ià(
numWts_
 =ğ
numWts
) ;

124 
	`š™
(
numWts
);

125 
	}
}

127 
	$de¡roy
()

129 ià(
nbd_
 !ğ
NULL
è
d–‘e
 []‚bd_;

130 ià(
iwa_
 !ğ
NULL
è
d–‘e
 [] iwa_;

131 ià(
l_
 !ğ
NULL
è
d–‘e
 []†_;

132 ià(
u_
 !ğ
NULL
è
d–‘e
 [] u_;

133 ià(
g_
 !ğ
NULL
è
d–‘e
 [] g_;

134 ià(
wa_
 !ğ
NULL
è
d–‘e
 [] wa_;

135 
	}
}

137 
	$mšimize
(cÚ¡ & 
numWts
, * cÚ¡ & 
wts
, & 
™”
,
boŞ
& 
”rÜ
, 
PŞyNomŸl
& 
¶
)

139 
	`»In™
(
numWts
);

140  
	`mšimize
(
™”
, 
”rÜ
, 
¶
);

141 
	}
}

143 
	$¡¬tLBFGS
(
PŞyNomŸl
& 
¶
)

145 
m
 = 5;

146 
f
;

147 
çùr
 = 0;

148 
pgtŞ
 = 0;

150 
of¡»am
* 
™fe
 = 
NULL
;

151 
ršt
 = 
LBFGSP_PRINT
;

152 ià(
ršt
 >ğ1è
™fe
 = 
Ãw
 
	`of¡»am
("iterate.dat");

157 
i
 = 0; i <ğ
numWts_
; i++è
nbd_
[i] = 2;

159 
	`¡rıy
(
sk_
,"START");

160 
i
 = 5; i <ğ60; i++è
sk_
[i]=' ';

163 * 
wts
 = 
Ãw
 [
numWts_
 + 1];

165 
¶
.
	`CË¬V¬V®ue
();

166 
i
 = 0; i < 
numWts_
; i++)

168 
wts
[
i
+1] = 0;

169 
¶
.
	`Aµ’dV¬V®ue
(
wts
[
i
+1]);

172 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

173 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

174 
¶
.
	`CË¬V¬V®ue
();

175 
i
 = 0; i < 
numWts_
; i++è
¶
.
	`Aµ’dV¬V®ue
(
wts
[i+1]);

176 
d–‘e
[] 
wts
;

177  
f
;

178 
	}
}

181 
	$´oûedOÃS‹p
(
PŞyNomŸl
& 
¶
)

183 
m
 = 5;

184 
f
 = -999;

185 
çùr
 = 0;

186 
pgtŞ
 = 0;

188 
of¡»am
* 
™fe
 = 
NULL
;

189 
ršt
 = 
LBFGSP_PRINT
;

190 ià(
ršt
 >ğ1è
™fe
 = 
Ãw
 
	`of¡»am
("iterate.dat");

191 * 
wts
 = 
Ãw
 [
numWts_
 + 1];

192 
i
 = 0; i < 
numWts_
; i++) {

193 
wts
[
i
+1] = 
¶
.
	`G‘V¬V®ue
(i);

197 ià(
	`¡ºcmp
(
sk_
,"FG",2)==0)

199 
f
 = 
	`g‘V®ueAndG¿d›Á
(
g_
, 
wts
, 
¶
);

200 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

201 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

202 
¶
.
	`CË¬V¬V®ue
();

203 
i
 = 0; i < 
numWts_
; i++è
¶
.
	`Aµ’dV¬V®ue
(
wts
[i+1]);

209 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

210 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

212 
¶
.
	`CË¬V¬V®ue
();

213 
i
 = 0; i < 
numWts_
; i++è
¶
.
	`Aµ’dV¬V®ue
(
wts
[i+1]);

218 
d–‘e
[] 
wts
;

219  
¶
.
	`Compu‹PlV®ue
();

220 
	}
}

224 
	$mšimize
(& 
™”
, 
boŞ
& 
”rÜ
, 
PŞyNomŸl
& 
¶
)

227 
”rÜ
 = 
çl£
;

228 
m
 = 5;

229 
f
;

230 
çùr
 = 0;

231 
pgtŞ
 = 0;

233 
of¡»am
* 
™fe
 = 
NULL
;

234 
ršt
 = 
LBFGSP_PRINT
;

235 ià(
ršt
 >ğ1è
™fe
 = 
Ãw
 
	`of¡»am
("iterate.dat");

236 
™”
 = 0;

241 
i
 = 0; i <ğ
numWts_
; i++è
nbd_
[i] = 2;

243 
	`¡rıy
(
sk_
,"START");

244 
i
 = 5; i <ğ60; i++è
sk_
[i]=' ';

248 * 
wts
 = 
Ãw
 [
numWts_
 + 1];

249 
¶
.
	`CË¬V¬V®ue
();

250 
i
 = 0; i < 
numWts_
; i++)

252 
wts
[
i
 + 1] = 0;

253 
¶
.
	`Aµ’dV¬V®ue
(
wts
[
i
+1]);

256 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

257 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

259 
¶
.
	`CË¬V¬V®ue
();

260 
i
 = 0; i < 
numWts_
; i++è
¶
.
	`Aµ’dV¬V®ue
(
wts
[i+1]);

262 
š™ŸlV®ue
 = 0, 
´evV®ue
 = 0, 
ÃwV®ue
;

263 
boŞ
 
fœ¡I‹r
 = 
Œue
;

266 
	`¡ºcmp
(
sk_
,"FG",2)==0 || strncmp(task_,"NEW_X",5)==0)

268 ià(
	`¡ºcmp
(
sk_
,"FG",2)==0)

270 
f
 = 
	`g‘V®ueAndG¿d›Á
(
g_
, 
wts
, 
¶
);

272 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

273 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

275 
¶
.
	`CË¬V¬V®ue
();

276 
i
 = 0; i < 
numWts_
; i++è
¶
.
	`Aµ’dV¬V®ue
(
wts
[i+1]);

278 ià(
fœ¡I‹r
è{ fœ¡I‹¸ğ
çl£
; 
´evV®ue
 = 
f
; 
š™ŸlV®ue
 = f; }

284 ià(
™”
+1 > 
maxI‹r_
) ;

285 ++
™”
;

286 
ÃwV®ue
 = 
f
;

288 ià(
	`çbs
(
ÃwV®ue
-
´evV®ue
è< 
áŞ_
*fabs(prevValue)) ;

289 
´evV®ue
 = 
ÃwV®ue
;

290 
	`£tulb
(
numWts_
,
m
,
wts
,
l_
,
u_
,
nbd_
,
f
,
g_
,
çùr
,
pgtŞ
,
wa_
,
iwa_
,
sk_
,

291 
ršt
,
c§ve_
,
l§ve_
,
i§ve_
,
d§ve_
,
™fe
);

292 
¶
.
	`CË¬V¬V®ue
();

293 
i
 = 0; i < 
numWts_
; i++è
¶
.
	`Aµ’dV¬V®ue
(
wts
[i+1]);

301 ià(
	`¡ºcmp
(
sk_
,"ABNO",4) == 0)

303 
cout
 << "ERROR: LBFGSP faed. R‘uºed ABNO" << 
’dl
;

304 
”rÜ
 = 
Œue
;

305 
d–‘e
[] 
wts
;

306  
š™ŸlV®ue
;

309 ià(
	`¡ºcmp
(
sk_
,"ERROR",5)==0)

311 
cout
 << "ERROR: LBFGSP faed. R‘uºed ERROR" << 
’dl
;

312 
”rÜ
 = 
Œue
;

313 
d–‘e
[] 
wts
;

314  
š™ŸlV®ue
;

317 ià(
	`¡ºcmp
(
sk_
,"CONV",4)==0)

319 
cout
 << "LBFGSP cÚv”ged!" << 
’dl
;

322 
d–‘e
[] 
wts
;

324  
f
;

325 
	}
}

328 
	$£tUµ”Bounds
(cÚ¡ * 
u
)

330 ià(
numWts_
 > 0)

332 
	`memıy
(
u_
+1, 
u
, 
numWts_
*());

334 
	}
}

336 
	$£tLow”Bounds
(cÚ¡ * 
l
)

338 if(
numWts_
 > 0)

340 
	`memıy
(
l_
+1, 
l
, 
numWts_
*());

342 
	}
}

344 
	g´iv©e
:

345 
maxI‹r_
;

346 
	gáŞ_
;

347 
	gnumWts_
;

350 * 
	gnbd_
;

351 * 
	giwa_
;

352 * 
	gl_
;

353 * 
	gu_
;

354 * 
	gg_
;

355 * 
	gwa_
;

357 
	gsk_
[61];

358 
	gc§ve_
[61];

359 
boŞ
 
	gl§ve_
[5];

360 
	gi§ve_
[45];

361 
	gd§ve_
[30];

364 
	g´iv©e
 :

366 
	$g‘V®ueAndG¿d›Á
(* cÚ¡ & 
g
, cÚ¡ * cÚ¡ & 
wts
, 
PŞyNomŸl
& 
¶
)

368 
g
[0] = 0;

371 
A¼ay
<> 
gr
 = 
¶
.
	`G‘G¿d›Á
();

372 
i
 = 0; i < 
gr
.
	`size
(); i++)

374 
g
[
i
+1] = 
gr
[i];

377  
¶
.
	`Compu‹PlV®ue
();

378 
	}
}

385 
	$g‘Idx
(cÚ¡ & 
i
, cÚ¡ & 
j
, cÚ¡ & 
idim
)

387  (
j
-1)*
idim
 + 
i
;

388 
	}
}

391 
	$max
(cÚ¡ & 
a
, cÚ¡ & 
b
è{ ià×>=bè‡;  b; 
	}
}

393 
	$mš
(cÚ¡ & 
a
, cÚ¡ & 
b
è{ ià×<=bè‡;  b; 
	}
}

395 
	$mš
(cÚ¡ & 
a
, cÚ¡ & 
b
è{ ià×<=bè‡;  b; 
	}
}

397 
	$max
(cÚ¡ & 
a
, cÚ¡ & 
b
, cÚ¡ & 
c
)

399 ià(
a
 >ğ
b
 &&‡ >ğ
c
) ‡;

400 ià(
b
 >ğ
a
 && b >ğ
c
)  b;

401 
	`as£¹
(
c
 >ğ
a
 && c >ğ
b
);

402  
c
;

403 
	}
}

594 
	$£tulb
(cÚ¡ & 
n
, cÚ¡ & 
m
, * cÚ¡ & 
x
,

595 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

596 cÚ¡ * cÚ¡ & 
nbd
, & 
f
, * cÚ¡ & 
g
,

597 cÚ¡ & 
çùr
, cÚ¡ & 
pgtŞ
,

598 * cÚ¡ & 
wa
, * cÚ¡ & 
iwa
,

599 * cÚ¡ & 
sk
, cÚ¡ & 
ršt
,

600 * cÚ¡ & 
c§ve
, 
boŞ
* cÚ¡ & 
l§ve
,

601 * cÚ¡ & 
i§ve
, * cÚ¡ & 
d§ve
,

602 
of¡»am
* 
™fe
)

604 
l1
,
l2
,
l3
,
lws
,
Ì
,
lz
,
É
,
ld
,
lsg
,
lwa
,
lyg
,

605 
lsgo
,
lwy
,
lsy
,
lss
,
lyy
,
lwt
,
lwn
,
l¢d
,
lygo
;

607 ià(
	`¡ºcmp
(
sk
,"START",5)==0)

609 
i§ve
[1] = 
m
*
n
;

610 
i§ve
[2] = 
m
*m;

611 
i§ve
[3] = 4*
m
*m;

612 
i§ve
[4] = 1;

613 
i§ve
[5] = isave[4] + isave[1];

614 
i§ve
[6] = isave[5] + isave[1];

615 
i§ve
[7] = isave[6] + isave[2];

616 
i§ve
[8] = isave[7] + isave[2];

617 
i§ve
[9] = isave[8] + isave[2];

618 
i§ve
[10] = isave[9] + isave[2];

619 
i§ve
[11] = isave[10] + isave[3];

620 
i§ve
[12] = isave[11] + isave[3];

621 
i§ve
[13] = i§ve[12] + 
n
;

622 
i§ve
[14] = i§ve[13] + 
n
;

623 
i§ve
[15] = i§ve[14] + 
n
;

624 
i§ve
[16] = i§ve[15] + 
n
;

625 
i§ve
[17] = i§ve[16] + 8*
m
;

626 
i§ve
[18] = i§ve[17] + 
m
;

627 
i§ve
[19] = i§ve[18] + 
m
;

628 
i§ve
[20] = i§ve[19] + 
m
;

630 
l1
 = 
i§ve
[1];

631 
l2
 = 
i§ve
[2];

632 
l3
 = 
i§ve
[3];

633 
lws
 = 
i§ve
[4];

634 
lwy
 = 
i§ve
[5];

635 
lsy
 = 
i§ve
[6];

636 
lss
 = 
i§ve
[7];

637 
lyy
 = 
i§ve
[8];

638 
lwt
 = 
i§ve
[9];

639 
lwn
 = 
i§ve
[10];

640 
l¢d
 = 
i§ve
[11];

641 
lz
 = 
i§ve
[12];

642 
Ì
 = 
i§ve
[13];

643 
ld
 = 
i§ve
[14];

644 
É
 = 
i§ve
[15];

645 
lwa
 = 
i§ve
[16];

646 
lsg
 = 
i§ve
[17];

647 
lsgo
 = 
i§ve
[18];

648 
lyg
 = 
i§ve
[19];

649 
lygo
 = 
i§ve
[20];

651 
tim”_
.
	`»£t
();

653 
	`mašlb
(
n
,
m
,
x
,
l
,
u
,
nbd
,
f
,
g
,
çùr
,
pgtŞ
,

654 &(
wa
[
lws
-1]),&(wa[
lwy
-1]),&(wa[
lsy
-1]),&(wa[
lss
-1]),&(wa[
lyy
-1]),

655 &(
wa
[
lwt
-1]),&(wa[
lwn
-1]),&(wa[
l¢d
-1]),&(wa[
lz
-1]),&(wa[
Ì
-1]),

656 &(
wa
[
ld
-1]),&(wa[
É
-1]),&(wa[
lwa
-1]),&(wa[
lsg
-1]),&(wa[
lsgo
-1]),

657 &(
wa
[
lyg
-1]),&(wa[
lygo
-1]),&(
iwa
[1-1]),&(iwa[
n
+1-1]),&(iwa[2*n+1-1]),

658 
sk
,
ršt
,
c§ve
,
l§ve
,&(
i§ve
[22-1]),
d§ve
, 
™fe
);

659 
	}
}

841 
	$mašlb
(cÚ¡ & 
n
, cÚ¡ & 
m
, * cÚ¡ & 
x
,

842 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

843 cÚ¡ * cÚ¡ & 
nbd
, & 
f
, * cÚ¡ & 
g
,

844 cÚ¡ & 
çùr
, cÚ¡ & 
pgtŞ
,

845 * cÚ¡ & 
ws
, * cÚ¡ & 
wy
, * cÚ¡ & 
sy
,

846 * cÚ¡ & 
ss
, * cÚ¡ & 
yy
, * cÚ¡ & 
wt
,

847 * cÚ¡ & 
wn
, * cÚ¡ & 
¢d
, * cÚ¡ & 
z
,

848 * cÚ¡ & 
r
, * cÚ¡ & 
d
, * cÚ¡ & 
t
,

849 * cÚ¡ & 
wa
, * cÚ¡ & 
sg
, * cÚ¡& 
sgo
,

850 * cÚ¡ & 
yg
, * cÚ¡ & 
ygo
, * cÚ¡& 
šdex
,

851 * cÚ¡ & 
iwh”e
, * cÚ¡ & 
šdx2
, * cÚ¡& 
sk
,

852 cÚ¡ & 
ršt
, * cÚ¡& 
c§ve
, 
boŞ
 * cÚ¡& 
l§ve
,

853 * cÚ¡ & 
i§ve
, * cÚ¡ & 
d§ve
, 
of¡»am
* 
™fe
)

855 
boŞ
 
´jùd
,
ú¡nd
,
boxed
,
upd©d
,
wrk
;

856 
wÜd
[4];

857 
k
,
nštŞ
,
iback
,
nsk
,

858 
h—d
,
cŞ
,
™”
,
™a
,
iupd©
,

859 
nšt
,
nfgv
,
šfo
,
ifun
=0,

860 
iwÜd
,
nä“
,
Çù
,
—ve
,
ÃÁ”
;

861 
th‘a
,
fŞd
=0,
dr
,
¼
,
tŞ
,

862 
x¡•
,
sbgÄm
,
ddum
,
dnÜm
=0,
dtd
,
•smch
,

863 
ıu1
=0,
ıu2
,
ÿchyt
,
sbtime
,
Êscht
,
time1
,
time2
,

864 
gd
,
gdŞd
=0,
¡p
,
¡pmx
=0,
time
;

865 
Úe
=1.0,
z”o
=0.0;

867 ià(
ršt
 > 1è{ 
	`as£¹
(
™fe
); }

869 ià(
	`¡ºcmp
(
sk
,"START",5)==0)

871 
time1
 = 
tim”_
.
	`time
();

874 
•smch
 = 
	`dpm•s
();

881 
cŞ
 = 0;

882 
h—d
 = 1;

883 
th‘a
 = 
Úe
;

884 
iupd©
 = 0;

885 
upd©d
 = 
çl£
;

888 
™”
 = 0;

889 
nfgv
 = 0;

890 
nšt
 = 0;

891 
nštŞ
 = 0;

892 
nsk
 = 0;

893 
nä“
 = 
n
;

896 
tŞ
 = 
çùr
*
•smch
;

899 
ÿchyt
 = 0;

900 
sbtime
 = 0;

901 
Êscht
 = 0;

905 
	`¡rıy
(
wÜd
, "---");

908 
šfo
 = 0;

918 
	`”rşb
(
n
,
m
,
çùr
,
l
,
u
,
nbd
,
sk
,
šfo
,
k
);

919 ià(
	`¡ºcmp
(
sk
,"ERROR",5)==0)

921 
	`´n3lb
(
n
,
x
,
f
,
sk
,
ršt
,
šfo
,
™fe
,

922 
™”
,
nfgv
,
nštŞ
,
nsk
,
Çù
,
sbgÄm
,

923 
z”o
,
nšt
,
wÜd
,
iback
,
¡p
,
x¡•
,
k
,

924 
ÿchyt
,
sbtime
,
Êscht
);

928 
	`´n1lb
(
n
,
m
,
l
,
u
,
x
,
ršt
,
™fe
,
•smch
);

931 
	`aùive
(
n
,
l
,
u
,
nbd
,
x
,
iwh”e
,
ršt
,
´jùd
,
ú¡nd
,
boxed
) ;

938 
´jùd
 = 
l§ve
[1];

939 
ú¡nd
 = 
l§ve
[2];

940 
boxed
 = 
l§ve
[3];

941 
upd©d
 = 
l§ve
[4];

943 
nštŞ
 = 
i§ve
[1];

945 
iback
 = 
i§ve
[4];

946 
nsk
 = 
i§ve
[5];

947 
h—d
 = 
i§ve
[6];

948 
cŞ
 = 
i§ve
[7];

949 
™a
 = 
i§ve
[8];

950 
™”
 = 
i§ve
[9];

951 
iupd©
 = 
i§ve
[10];

952 
nšt
 = 
i§ve
[12];

953 
nfgv
 = 
i§ve
[13];

954 
šfo
 = 
i§ve
[14];

955 
ifun
 = 
i§ve
[15];

956 
iwÜd
 = 
i§ve
[16];

957 
nä“
 = 
i§ve
[17];

958 
Çù
 = 
i§ve
[18];

959 
—ve
 = 
i§ve
[19];

960 
ÃÁ”
 = 
i§ve
[20];

962 
th‘a
 = 
d§ve
[1];

963 
fŞd
 = 
d§ve
[2];

964 
tŞ
 = 
d§ve
[3];

965 
dnÜm
 = 
d§ve
[4];

966 
•smch
 = 
d§ve
[5];

967 
ıu1
 = 
d§ve
[6];

968 
ÿchyt
 = 
d§ve
[7];

969 
sbtime
 = 
d§ve
[8];

970 
Êscht
 = 
d§ve
[9];

971 
time1
 = 
d§ve
[10];

972 
gd
 = 
d§ve
[11];

973 
¡pmx
 = 
d§ve
[12];

974 
sbgÄm
 = 
d§ve
[13];

975 
¡p
 = 
d§ve
[14];

976 
gdŞd
 = 
d§ve
[15];

977 
dtd
 = 
d§ve
[16];

982 ià(
	`¡ºcmp
(
sk
,"FG_LN",5)==0è
gÙo66
;

983 ià(
	`¡ºcmp
(
sk
,"NEW_X",5)==0è
gÙo777
;

984 ià(
	`¡ºcmp
(
sk
,"FG_ST",5)==0è
gÙo111
;

985 ià(
	`¡ºcmp
(
sk
,"STOP",4)==0)

987 ià(
	`¡ºcmp
(&(
sk
[6]),"CPU",3)==0)

990 
	`dcİy
(
n
,
t
,1,
x
,1);

991 
	`dcİy
(
n
,
r
,1,
g
,1);

992 
f
 = 
fŞd
;

994 
gÙo999
;

1000 
	`¡rıy
(
sk
, "FG_START");

1002 
gÙo1000
;

1004 
gÙo111
:

1006 
nfgv
 = 1;

1010 
	`´ojgr
(
n
,
l
,
u
,
nbd
,
x
,
g
,
sbgÄm
);

1012 ià(
ršt
 >= 1)

1014 
cout
 << "Aˆ™”©" << 
™”
 << ": f=" <<
f
<<", |´oj g|="<<
sbgÄm
<<
’dl
;

1015 *
™fe
 << "Aˆ™”©" << 
™”
 << ":‚fgv=" << 
nfgv


1016 << ", sbgÄm=" << 
sbgÄm
 << ", f=" << 
f
 << 
’dl
;

1019 ià(
sbgÄm
 <ğ
pgtŞ
)

1022 
	`¡rıy
(
sk
,"CONVERGENCE: NORM OF PROJECTED GRADIENT <= PGTOL");

1023 
gÙo999
;

1028 
gÙo222
:

1029 ià(
ršt
 >ğ99è
cout
 << "ITERATION " << (
™”
 + 1è<< 
’dl
;

1030 
iwÜd
 = -1;

1032 ià(!
ú¡nd
 && 
cŞ
 > 0)

1035 
	`dcİy
(
n
,
x
,1,
z
,1);

1036 
wrk
 = 
upd©d
;

1037 
nšt
 = 0;

1038 
gÙo333
;

1047 
ıu1
 = 
tim”_
.
	`time
();

1049 
	`ÿuchy
(
n
,
x
,
l
,
u
,
nbd
,
g
,
šdx2
,
iwh”e
,
t
,
d
,
z
,

1050 
m
,
wy
,
ws
,
sy
,
wt
,
th‘a
,
cŞ
,
h—d
,

1051 &(
wa
[1-1]),&(wa[2*
m
+1-1]),&(wa[4*m+1-1]),&(wa[6*m+1-1]),
nšt
,

1052 
sg
,
yg
,
ršt
,
sbgÄm
,
šfo
,
•smch
);

1054 ià(
šfo
 > 0)

1057 ià(
ršt
 >= 1)

1058 
cout
 << "Singularriangular system detected; "

1059 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." <<
’dl
;

1060 
šfo
 = 0;

1061 
cŞ
 = 0;

1062 
h—d
 = 1;

1063 
th‘a
 = 
Úe
;

1064 
iupd©
 = 0;

1065 
upd©d
 = 
çl£
;

1066 
ıu2
 = 
tim”_
.
	`time
();

1067 
ÿchyt
 = cachyˆ+ 
ıu2
 - 
ıu1
;

1068 
gÙo222
;

1070 
ıu2
 = 
tim”_
.
	`time
();

1071 
ÿchyt
 = cachyˆ+ 
ıu2
 - 
ıu1
;

1072 
nštŞ
 =‚štŞ + 
nšt
;

1077 
	`ä“v
(
n
,
nä“
,
šdex
,
ÃÁ”
,
—ve
,
šdx2
,

1078 
iwh”e
,
wrk
,
upd©d
,
ú¡nd
,
ršt
,
™”
);

1080 
Çù
 = 
n
 - 
nä“
;

1082 
gÙo333
:

1087 ià(
nä“
 =ğ0 || 
cŞ
 =ğ0è
gÙo555
;

1095 
ıu1
 = 
tim”_
.
	`time
();

1103 ià(
wrk
è
	`fÜmk
(
n
,
nä“
,
šdex
,
ÃÁ”
,
—ve
,
šdx2
,
iupd©
,

1104 
upd©d
,
wn
,
¢d
,
m
,
ws
,
wy
,
sy
,
th‘a
,
cŞ
,
h—d
,
šfo
);

1106 ià(
šfo
 != 0)

1110 if(
ršt
 >= 1)

1111 
cout
 << "Nonpositive definiteness in Cholesky factorization in formk;"

1112 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." << 
’dl
;

1113 
šfo
 = 0;

1114 
cŞ
 = 0;

1115 
h—d
 = 1;

1116 
th‘a
 = 
Úe
;

1117 
iupd©
 = 0;

1118 
upd©d
 = 
çl£
;

1119 
ıu2
 = 
tim”_
.
	`time
() ;

1120 
sbtime
 = sbtim+ 
ıu2
 - 
ıu1
;

1121 
gÙo222
;

1126 
	`cm´lb
(
n
,
m
,
x
,
g
,
ws
,
wy
,
sy
,
wt
,
z
,
r
,
wa
,
šdex
,

1127 
th‘a
,
cŞ
,
h—d
,
nä“
,
ú¡nd
,
šfo
);

1129 ià(
šfo
 !ğ0è
gÙo444
;

1131 
	`subsm
(
n
,
m
,
nä“
,
šdex
,
l
,
u
,
nbd
,
z
,
r
,
ws
,
wy
,
th‘a
,

1132 
cŞ
,
h—d
,
iwÜd
,
wa
,
wn
,
ršt
,
šfo
);

1135 
gÙo444
:

1136 ià(
šfo
 != 0)

1140 if(
ršt
 >= 1)

1141 
cout
 << "Singularriangular system detected; "

1142 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." <<
’dl
;

1143 
šfo
 = 0;

1144 
cŞ
 = 0;

1145 
h—d
 = 1;

1146 
th‘a
 = 
Úe
;

1147 
iupd©
 = 0;

1148 
upd©d
 = 
çl£
;

1149 
ıu2
 = 
tim”_
.
	`time
();

1150 
sbtime
 = sbtim+ 
ıu2
 - 
ıu1
;

1151 
gÙo222
;

1154 
ıu2
 = 
tim”_
.
	`time
();

1155 
sbtime
 = sbtim+ 
ıu2
 - 
ıu1
 ;

1156 
gÙo555
:

1166 
i
 = 1; i <ğ
n
; i++)

1167 
d
[
i
] = 
z
[i] - 
x
[i];

1169 
ıu1
 = 
tim”_
.
	`time
();

1170 
gÙo66
:

1172 
	`Ê¤lb
(
n
,
l
,
u
,
nbd
,
x
,
f
,
fŞd
,
gd
,
gdŞd
,
g
,
d
,
r
,
t
,
z
,
¡p
,
dnÜm
,

1173 
dtd
,
x¡•
,
¡pmx
,
™”
,
ifun
,
iback
,
nfgv
,
šfo
,
sk
,

1174 
boxed
,
ú¡nd
,
c§ve
,&(
i§ve
[22-1]),&(
d§ve
[17-1]));

1176 ià(
šfo
 !ğ0 || 
iback
 >= 20)

1179 
	`dcİy
(
n
,
t
,1,
x
,1);

1180 
	`dcİy
(
n
,
r
,1,
g
,1);

1181 
f
 = 
fŞd
;

1182 ià(
cŞ
 == 0)

1185 ià(
šfo
 == 0)

1187 
šfo
 = -9;

1189 
nfgv
 -= 1;

1190 
ifun
 -= 1;

1191 
iback
 -= 1;

1193 
	`¡rıy
(
sk
, "ABNORMAL_TERMINATION_IN_LNSRCH");

1194 
™”
 += 1;

1195 
gÙo999
;

1200 if(
ršt
 >= 1)

1201 
cout
 << "Bad direction inhe†ine search; "

1202 << "thlbfg memÜy‡nd„e¡¬ˆth™”©iÚ" << 
’dl
;

1203 ià(
šfo
 =ğ0è
nfgv
 =‚fgv - 1;

1204 
šfo
 = 0;

1205 
cŞ
 = 0;

1206 
h—d
 = 1;

1207 
th‘a
 = 
Úe
;

1208 
iupd©
 = 0;

1209 
upd©d
 = 
çl£
;

1210 
	`¡rıy
(
sk
, "RESTART_FROM_LNSRCH");

1211 
ıu2
 = 
tim”_
.
	`time
();

1212 
Êscht
 +ğ
ıu2
 - 
ıu1
;

1213 
gÙo222
;

1217 ià(
	`¡ºcmp
(
sk
,"FG_LN",5)==0)

1220 
gÙo1000
;

1225 
ıu2
 = 
tim”_
.
	`time
() ;

1226 
Êscht
 +ğ
ıu2
 - 
ıu1
;

1227 
™”
 += 1;

1231 
	`´ojgr
(
n
,
l
,
u
,
nbd
,
x
,
g
,
sbgÄm
);

1235 
	`´n2lb
(
n
,
x
,
f
,
g
,
ršt
,
™fe
,
™”
,
nfgv
,
Çù
,

1236 
sbgÄm
,
nšt
,
wÜd
,
iwÜd
,
iback
,
¡p
,
x¡•
);

1237 
gÙo1000
;

1239 
gÙo777
:

1243 ià(
sbgÄm
 <ğ
pgtŞ
)

1246 
	`¡rıy
(
sk
, "CONVERGENCE: NORM OF PROJECTED GRADIENT <= PGTOL");

1247 
gÙo999
;

1250 
ddum
 = 
	`max
(
	`çbs
(
fŞd
), fabs(
f
), 
Úe
);

1251 ià((
fŞd
 - 
f
è<ğ
tŞ
*
ddum
)

1254 
	`¡rıy
(
sk
, "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH");

1255 ià(
iback
 >ğ10è
šfo
 = -5;

1257 
gÙo999
;

1262 
i
 = 1; i <ğ
n
; i++)

1263 
r
[
i
] = 
g
[i] -„[i];

1264 
¼
 = 
	`ddÙ
(
n
,
r
,1,r,1);

1265 ià(
¡p
 =ğ
Úe
)

1267 
dr
 = 
gd
 - 
gdŞd
;

1268 
ddum
 = -
gdŞd
;

1272 
dr
 = (
gd
 - 
gdŞd
)*
¡p
;

1273 
	`dsÿl
(
n
,
¡p
,
d
,1);

1274 
ddum
 = -
gdŞd
*
¡p
;

1277 ià(
dr
 <ğ
•smch
*
ddum
)

1280 
nsk
 =‚skip + 1;

1281 
upd©d
 = 
çl£
;

1282 ià(
ršt
 >= 1)

1283 
cout
 << " ys=" << 
dr
 << " -gs=" <<
ddum
<<" BFSG upd©SKIPPED"<<
’dl
;

1284 
gÙo888
;

1293 
upd©d
 = 
Œue
;

1294 
iupd©
 += 1;

1298 
	`m©upd
(
n
,
m
,
ws
,
wy
,
sy
,
ss
,
d
,
r
,
™a
,

1299 
iupd©
,
cŞ
,
h—d
,
th‘a
,
¼
,
dr
,
¡p
,
dtd
);

1306 
	`fÜmt
(
m
,
wt
,
sy
,
ss
,
cŞ
,
th‘a
,
šfo
);

1308 ià(
šfo
 != 0)

1312 if(
ršt
 >= 1)

1313 
cout
 << "Nonpositive definiteness in Cholesky factorization in formt; "

1314 << "»äeshhlbfg memÜy‡nd„e¡¬ˆth™”©iÚ." << 
’dl
;

1315 
šfo
 = 0;

1316 
cŞ
 = 0;

1317 
h—d
 = 1;

1318 
th‘a
 = 
Úe
;

1319 
iupd©
 = 0;

1320 
upd©d
 = 
çl£
;

1321 
gÙo222
;

1329 
gÙo888
:

1333 
gÙo222
;

1335 
gÙo999
:

1336 
time2
 = 
tim”_
.
	`time
();

1337 
time
 = 
time2
 - 
time1
;

1338 
	`´n3lb
(
n
,
x
,
f
,
sk
,
ršt
,
šfo
,
™fe
,

1339 
™”
,
nfgv
,
nštŞ
,
nsk
,
Çù
,
sbgÄm
,

1340 
time
,
nšt
,
wÜd
,
iback
,
¡p
,
x¡•
,
k
,

1341 
ÿchyt
,
sbtime
,
Êscht
);

1342 
gÙo1000
:

1345 
l§ve
[1] = 
´jùd
;

1346 
l§ve
[2] = 
ú¡nd
;

1347 
l§ve
[3] = 
boxed
;

1348 
l§ve
[4] = 
upd©d
;

1350 
i§ve
[1] = 
nštŞ
;

1352 
i§ve
[4] = 
iback
;

1353 
i§ve
[5] = 
nsk
;

1354 
i§ve
[6] = 
h—d
;

1355 
i§ve
[7] = 
cŞ
;

1356 
i§ve
[8] = 
™a
;

1357 
i§ve
[9] = 
™”
;

1358 
i§ve
[10] = 
iupd©
;

1359 
i§ve
[12] = 
nšt
;

1360 
i§ve
[13] = 
nfgv
;

1361 
i§ve
[14] = 
šfo
;

1362 
i§ve
[15] = 
ifun
;

1363 
i§ve
[16] = 
iwÜd
;

1364 
i§ve
[17] = 
nä“
;

1365 
i§ve
[18] = 
Çù
;

1366 
i§ve
[19] = 
—ve
;

1367 
i§ve
[20] = 
ÃÁ”
;

1369 
d§ve
[1] = 
th‘a
;

1370 
d§ve
[2] = 
fŞd
;

1371 
d§ve
[3] = 
tŞ
;

1372 
d§ve
[4] = 
dnÜm
;

1373 
d§ve
[5] = 
•smch
;

1374 
d§ve
[6] = 
ıu1
;

1375 
d§ve
[7] = 
ÿchyt
;

1376 
d§ve
[8] = 
sbtime
;

1377 
d§ve
[9] = 
Êscht
;

1378 
d§ve
[10] = 
time1
;

1379 
d§ve
[11] = 
gd
;

1380 
d§ve
[12] = 
¡pmx
;

1381 
d§ve
[13] = 
sbgÄm
;

1382 
d§ve
[14] = 
¡p
;

1383 
d§ve
[15] = 
gdŞd
;

1384 
d§ve
[16] = 
dtd
;

1386 
	}
}

1416 
	$aùive
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
l
,

1417 cÚ¡ * cÚ¡ & 
u
, cÚ¡ * cÚ¡ & 
nbd
,

1418 * cÚ¡ & 
x
, * cÚ¡ & 
iwh”e
, cÚ¡ & 
ršt
,

1419 
boŞ
& 
´jùd
, boŞ& 
ú¡nd
, boŞ& 
boxed
)

1422 
nbdd
;

1423 
z”o
=0.0;

1426 
nbdd
 = 0;

1427 
´jùd
 = 
çl£
;

1428 
ú¡nd
 = 
çl£
;

1429 
boxed
 = 
Œue
;

1433 
i
 = 1; i <ğ
n
; i++)

1435 ià(
nbd
[
i
] > 0)

1437 ià(
nbd
[
i
] <ğ2 && 
x
[i] <ğ
l
[i])

1439 ià(
x
[
i
] < 
l
[i])

1441 
´jùd
 = 
Œue
;

1442 
x
[
i
] = 
l
[i];

1444 
nbdd
 += 1;

1447 ià(
nbd
[
i
] >ğ2 && 
x
[i] >ğ
u
[i])

1449 ià(
x
[
i
] > 
u
[i])

1451 
´jùd
 = 
Œue
;

1452 
x
[
i
] = 
u
[i];

1454 
nbdd
 += 1;

1461 
i
 = 1; i <ğ
n
; i++)

1463 ià(
nbd
[
i
] !ğ2è
boxed
 = 
çl£
;

1464 ià(
nbd
[
i
] == 0)

1467 
iwh”e
[
i
] = -1;

1472 
ú¡nd
 = 
Œue
;

1473 ià(
nbd
[
i
] =ğ2 && (
u
[i]-
l
[i]è<ğ
z”o
)

1476 
iwh”e
[
i
] = 3;

1479 
iwh”e
[
i
] = 0;

1483 ià(
ršt
 >= 0)

1485 ià(
´jùd
)

1486 
cout
 << "The initial X is infeasible. Restart with its…rojection."

1487 << 
’dl
;

1488 ià(!
ú¡nd
è
cout
 << "Thi ´obËm i uncÚ¡¿šed." << 
’dl
;

1491 ià(
ršt
 > 0)

1492 
cout
 << "AˆX0 " << 
nbdd
 << " v¬ŸbË ¬exaùly‡ˆthbounds" <<
’dl
;

1493 
	}
}

1554 
	$bmv
(cÚ¡ & 
m
, * cÚ¡ & 
sy
, * cÚ¡ & 
wt
,

1555 cÚ¡ & 
cŞ
, cÚ¡ * cÚ¡ & 
v
, * cÚ¡ & 
p
,

1556 & 
šfo
)

1559 
i2
;

1560 
sum
;

1562 ià(
cŞ
 == 0) ;

1568 
p
[
cŞ
+1] = 
v
[col+1];

1570 
i
 = 2; i <ğ
cŞ
; i++)

1572 
i2
 = 
cŞ
 + 
i
;

1573 
sum
 = 0;

1574 
k
 = 1; k <ğ
i
-1; k++)

1575 
sum
 +ğ
sy
[
	`g‘Idx
(
i
,
k
,
m
)]*
v
[k]/sy[getIdx(k,k,m)];

1577 
p
[
i2
] = 
v
[i2] + 
sum
;

1581 
	`dŒ¦
(
wt
,
m
,
cŞ
,&(
p
[cŞ+1-1]),11,
šfo
);

1582 ià(
šfo
 != 0) ;

1585 
i
 = 1; i <ğ
cŞ
; i++)

1586 
p
[
i
] = 
v
[i]/
	`sq¹
(
sy
[
	`g‘Idx
(i,i,
m
)]);

1592 
	`dŒ¦
(
wt
,
m
,
cŞ
,&(
p
[cŞ+1-1]),1,
šfo
);

1593 ià(
šfo
 != 0) ;

1597 
i
 = 1; i <ğ
cŞ
; i++)

1598 
p
[
i
] = -p[i]/
	`sq¹
(
sy
[
	`g‘Idx
(i,i,
m
)]);

1600 
i
 = 1; i <ğ
cŞ
; i++)

1602 
sum
 = 0;

1603 
k
 = 
i
+1; i <ğ
cŞ
; i++)

1604 
sum
 +ğ
sy
[
	`g‘Idx
(
k
,
i
,
m
)]*
p
[
cŞ
+k]/sy[getIdx(i,i,m)];

1605 
p
[
i
] +ğ
sum
;

1607 
	}
}

1787 
	$ÿuchy
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
x
,

1788 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

1789 cÚ¡ * cÚ¡ & 
nbd
, cÚ¡ * cÚ¡ & 
g
,

1790 * cÚ¡ & 
iÜd”
, * cÚ¡ & 
iwh”e
,

1791 * cÚ¡ & 
t
, * cÚ¡ & 
d
, * cÚ¡ & 
xı
,

1792 cÚ¡ & 
m
, * cÚ¡ & 
wy
,

1793 * cÚ¡ & 
ws
, * cÚ¡ & 
sy
,

1794 * cÚ¡ & 
wt
, & 
th‘a
,

1795 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, * cÚ¡ & 
p
,

1796 * cÚ¡ & 
c
, * cÚ¡ & 
wbp
,

1797 * cÚ¡ & 
v
, & 
nšt
, cÚ¡ * cÚ¡ & 
sg
,

1798 cÚ¡ * cÚ¡ & 
yg
, cÚ¡ & 
ršt
,

1799 cÚ¡ & 
sbgÄm
, & 
šfo
, cÚ¡ & 
•smch
)

1801 
boŞ
 
xlow”
,
xuµ”
,
bnded
;

1803 
cŞ2
,
nä“
,
nb»ak
,
pošŒ
,

1804 
ibp
,
Æeá
,
ibkmš
,
™”
;

1805 
f1
,
f2
,
dt
,
dtm
,
tsum
,
dibp
,
zibp
,
dibp2
,
bkmš
,

1806 
tu
=0,

=0,
wmc
,
wmp
,
wmw
,
tj
,
tj0
,
Ãggi
,

1807 
f2_Üg
;

1808 
Úe
=1,
z”o
=0;

1814 ià(
sbgÄm
 <ğ
z”o
)

1816 ià(
ršt
 >ğ0è
cout
 << "SubgnÜm = 0. GCP = X." << 
’dl
;

1817 
	`dcİy
(
n
,
x
,1,
xı
,1);

1820 
bnded
 = 
Œue
;

1821 
nä“
 = 
n
 + 1;

1822 
nb»ak
 = 0;

1823 
ibkmš
 = 0;

1824 
bkmš
 = 
z”o
;

1825 
cŞ2
 = 2*
cŞ
;

1826 
f1
 = 
z”o
;

1827 ià(
ršt
 >= 99)

1828 
cout
 << "---------------- CAUCHYƒÁ”ed-------------------" << 
’dl
;

1831 
i
 = 1; i <ğ
cŞ2
; i++)

1832 
p
[
i
] = 
z”o
;

1838 
i
 = 1; i <ğ
n
; i++)

1840 
Ãggi
 = -
g
[
i
];

1841 ià(
iwh”e
[
i
] != 3 && iwhere[i] != -1)

1845 ià(
nbd
[
i
] <ğ2è

 = 
x
[i] - 
l
[i];

1846 ià(
nbd
[
i
] >ğ2è
tu
 = 
u
[i] - 
x
[i];

1850 
xlow”
 = (
nbd
[
i
] <ğ2 && 

 <ğ
z”o
);

1851 
xuµ”
 = (
nbd
[
i
] >ğ2 && 
tu
 <ğ
z”o
);

1854 
iwh”e
[
i
] = 0;

1855 ià(
xlow”
)

1857 ià(
Ãggi
 <ğ
z”o
è
iwh”e
[
i
] = 1;

1860 ià(
xuµ”
)

1862 ià(
Ãggi
 >ğ
z”o
è
iwh”e
[
i
] = 2;

1866 ià(
	`çbs
(
Ãggi
è<ğ
z”o
è
iwh”e
[
i
] = -3;

1869 
pošŒ
 = 
h—d
;

1870 ià(
iwh”e
[
i
] != 0 && iwhere[i] != -1)

1871 
d
[
i
] = 
z”o
;

1874 
d
[
i
] = 
Ãggi
;

1875 
f1
 -ğ
Ãggi
*neggi;

1877 
j
 = 1; j <ğ
cŞ
; j++)

1879 
p
[
j
] +ğ
wy
[
	`g‘Idx
(
i
,
pošŒ
,
n
)] * 
Ãggi
;

1880 
p
[
cŞ
 + 
j
] +ğ
ws
[
	`g‘Idx
(
i
,
pošŒ
,
n
)] * 
Ãggi
;

1881 
pošŒ
 =…ošŒ%
m
 + 1;

1883 ià(
nbd
[
i
] <ğ2 &&‚bd[i] !ğ0 && 
Ãggi
 < 
z”o
)

1886 
nb»ak
 += 1;

1887 
iÜd”
[
nb»ak
] = 
i
;

1888 
t
[
nb»ak
] = 

/(-
Ãggi
);

1889 ià(
nb»ak
 =ğ1 || 
t
[nb»ak] < 
bkmš
)

1891 
bkmš
 = 
t
[
nb»ak
];

1892 
ibkmš
 = 
nb»ak
;

1896 ià(
nbd
[
i
] >ğ2 && 
Ãggi
 > 
z”o
)

1899 
nb»ak
 += 1;

1900 
iÜd”
[
nb»ak
] = 
i
;

1901 
t
[
nb»ak
] = 
tu
/
Ãggi
;

1902 ià(
nb»ak
 =ğ1 || 
t
[nb»ak] < 
bkmš
)

1904 
bkmš
 = 
t
[
nb»ak
];

1905 
ibkmš
 = 
nb»ak
;

1911 
nä“
 -= 1;

1912 
iÜd”
[
nä“
] = 
i
;

1913 ià(
	`çbs
(
Ãggi
è> 
z”o
è
bnded
 = 
çl£
;

1923 ià(
th‘a
 !ğ
Úe
)

1926 
	`dsÿl
(
cŞ
,
th‘a
,&(
p
[col+1-1]),1);

1931 
	`dcİy
(
n
,
x
,1,
xı
,1);

1933 ià(
nb»ak
 =ğ0 && 
nä“
 =ğ
n
 + 1)

1936 ià(
ršt
 > 100)

1938 
cout
 << "Cauchy X = ";

1939 
i
 = 1; i <ğ
n
; i++)

1940 
cout
 << 
xı
[
i
] << " ";

1941 
cout
 << 
’dl
;

1948 
j
 = 1; j <ğ
cŞ2
; j++)

1949 
c
[
j
] = 
z”o
;

1953 
f2
 = -
th‘a
*
f1
;

1954 
f2_Üg
 = 
f2
;

1955 ià(
cŞ
 > 0)

1957 
	`bmv
(
m
,
sy
,
wt
,
cŞ
,
p
,
v
,
šfo
);

1958 ià(
šfo
 != 0) ;

1959 
f2
 -ğ
	`ddÙ
(
cŞ2
,
v
,1,
p
,1);

1961 
dtm
 = -
f1
/
f2
;

1962 
tsum
 = 
z”o
;

1963 
nšt
 = 1;

1964 ià(
ršt
 >= 99)

1965 
cout
 << "Th”¬" << 
nb»ak
 << " b»akpošts" << 
’dl
;

1969 ià(
nb»ak
 =ğ0è
gÙo888
;

1971 
Æeá
 = 
nb»ak
;

1972 
™”
 = 1;

1974 
tj
 = 
z”o
;

1978 
gÙo777
:

1983 
tj0
 = 
tj
;

1984 ià(
™”
 == 1)

1989 
tj
 = 
bkmš
;

1990 
ibp
 = 
iÜd”
[
ibkmš
];

1994 ià(
™”
 == 2)

1998 ià(
ibkmš
 !ğ
nb»ak
)

2000 
t
[
ibkmš
] =[
nb»ak
];

2001 
iÜd”
[
ibkmš
] = iÜd”[
nb»ak
];

2007 
	`hpsŞb
(
Æeá
,
t
,
iÜd”
,
™”
-2);

2008 
tj
 = 
t
[
Æeá
];

2009 
ibp
 = 
iÜd”
[
Æeá
];

2012 
dt
 = 
tj
 - 
tj0
;

2014 ià(
dt
 !ğ
z”o
 && 
ršt
 >= 100)

2016 
cout
 << "P›û " << 
nšt
 << " --f1, f2‡t start…oint "

2017 << 
f1
 << "," << 
f2
 << 
’dl
;

2018 
cout
 << "Di¡ªûØthÃxˆb»ak…ošˆğ" << 
dt
 << 
’dl
;

2019 
cout
 << "Di¡ªûØth¡©iÚ¬y…ošˆğ" << 
dtm
 << 
’dl
;

2024 ià(
dtm
 < 
dt
è
gÙo888
;

2029 
tsum
 +ğ
dt
;

2030 
Æeá
 -= 1;

2031 
™”
 += 1;

2032 
dibp
 = 
d
[
ibp
];

2033 
d
[
ibp
] = 
z”o
;

2034 ià(
dibp
 > 
z”o
)

2036 
zibp
 = 
u
[
ibp
] - 
x
[ibp];

2037 
xı
[
ibp
] = 
u
[ibp];

2038 
iwh”e
[
ibp
] = 2;

2042 
zibp
 = 
l
[
ibp
] - 
x
[ibp];

2043 
xı
[
ibp
] = 
l
[ibp];

2044 
iwh”e
[
ibp
] = 1;

2046 ià(
ršt
 >ğ100è
cout
 << "V¬ŸbË " << 
ibp
 << " i fixed." << 
’dl
;

2047 ià(
Æeá
 =ğ0 && 
nb»ak
 =ğ
n
)

2050 
dtm
 = 
dt
;

2051 
gÙo999
;

2056 
nšt
 += 1;

2057 
dibp2
 = 
dibp
*dibp;

2062 
f1
 +ğ
dt
*
f2
 + 
dibp2
 - 
th‘a
*
dibp
*
zibp
;

2063 
f2
 -ğ
th‘a
*
dibp2
;

2065 ià(
cŞ
 > 0)

2068 
	`daxpy
(
cŞ2
,
dt
,
p
,1,
c
,1);

2072 
pošŒ
 = 
h—d
;

2073 
j
 = 1; j <ğ
cŞ
; j++)

2075 
wbp
[
j
] = 
wy
[
	`g‘Idx
(
ibp
,
pošŒ
,
n
)];

2076 
wbp
[
cŞ
 + 
j
] = 
th‘a
*
ws
[
	`g‘Idx
(
ibp
,
pošŒ
,
n
)];

2077 
pošŒ
 =…ošŒ%
m
 + 1;

2080 
	`bmv
(
m
,
sy
,
wt
,
cŞ
,
wbp
,
v
,
šfo
);

2081 ià(
šfo
 != 0) ;

2082 
wmc
 = 
	`ddÙ
(
cŞ2
,
c
,1,
v
,1);

2083 
wmp
 = 
	`ddÙ
(
cŞ2
,
p
,1,
v
,1);

2084 
wmw
 = 
	`ddÙ
(
cŞ2
,
wbp
,1,
v
,1);

2087 
	`daxpy
(
cŞ2
,-
dibp
,
wbp
,1,
p
,1);

2090 
f1
 +ğ
dibp
*
wmc
;

2091 
f2
 +ğ2.0*
dibp
*
wmp
 - 
dibp2
*
wmw
;

2094 
f2
 = 
	`max
(
•smch
*
f2_Üg
,f2);

2095 ià(
Æeá
 > 0)

2097 
dtm
 = -
f1
/
f2
;

2098 
gÙo777
;

2102 if(
bnded
)

2104 
f1
 = 
z”o
;

2105 
f2
 = 
z”o
;

2106 
dtm
 = 
z”o
;

2109 
dtm
 = -
f1
/
f2
;

2113 
gÙo888
:

2114 ià(
ršt
 >= 99)

2116 
cout
 << 
’dl
 << "GCP found inhis segment" <<ƒndl

2117 << "P›û " << 
nšt
 << " --f1, f2‡t start…oint "

2118 << 
f1
 << "," << 
f2
 << 
’dl


2119 << "Di¡ªûØth¡©iÚ¬y…ošˆğ" << 
dtm
 << 
’dl
;

2122 ià(
dtm
 <ğ
z”o
) dtm = zero;

2123 
tsum
 +ğ
dtm
;

2128 
	`daxpy
(
n
,
tsum
,
d
,1,
xı
,1);

2130 
gÙo999
:

2135 ià(
cŞ
 > 0è
	`daxpy
(
cŞ2
,
dtm
,
p
,1,
c
,1);

2136 ià(
ršt
 > 100)

2138 
cout
<< "Cauchy X = ";

2139 
i
 = 1; i <=
n
; i++)

2140 
cout
 << 
xı
[
i
] << " ";

2141 
cout
 << 
’dl
;

2143 ià(
ršt
 >= 99)

2144 
cout
 << "----------------ƒx™ CAUCHY----------------------" << 
’dl
;

2145 
	}
}

2172 
	$cm´lb
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ * cÚ¡ & 
x
,

2173 cÚ¡ * cÚ¡ & 
g
, * cÚ¡ & 
ws
,

2174 * cÚ¡ & 
wy
, * cÚ¡ & 
sy
,

2175 * cÚ¡ & 
wt
, cÚ¡ * cÚ¡ & 
z
,

2176 * cÚ¡ & 
r
, * cÚ¡ & 
wa
,

2177 cÚ¡ * cÚ¡ & 
šdex
, cÚ¡ & 
th‘a
,

2178 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, cÚ¡ & 
nä“
,

2179 cÚ¡ 
boŞ
& 
ú¡nd
, & 
šfo
)

2182 
k
,
pošŒ
,
idx
;

2183 
a1
,
a2
;

2185 ià(!
ú¡nd
 && 
cŞ
 > 0)

2187 
i
 = 1; i <ğ
n
; i++)

2188 
r
[
i
] = -
g
[i];

2192 
i
 = 1; i <ğ
nä“
; i++)

2194 
k
 = 
šdex
[
i
];

2195 
r
[
i
] = -
th‘a
*(
z
[
k
] - 
x
[k]è- 
g
[k];

2197 
	`bmv
(
m
,
sy
,
wt
,
cŞ
,&(
wa
[2*m+1-1]),&(wa[1-1]),
šfo
);

2198 ià(
šfo
 != 0)

2200 
šfo
 = -8;

2203 
pošŒ
 = 
h—d
;

2204 
j
 = 1; j <ğ
cŞ
; j++)

2206 
a1
 = 
wa
[
j
];

2207 
a2
 = 
th‘a
*
wa
[
cŞ
 + 
j
];

2208 
i
 = 1; i <ğ
nä“
; i++)

2210 
k
 = 
šdex
[
i
];

2211 
idx
 = 
	`g‘Idx
(
k
,
pošŒ
,
n
);

2212 
r
[
i
] +ğ
wy
[
idx
]*
a1
 + 
ws
[idx]*
a2
;

2215 
pošŒ
 =…ošŒ%
m
 + 1;

2218 
	}
}

2240 
	$”rşb
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ & 
çùr
,

2241 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

2242 cÚ¡ * cÚ¡ & 
nbd
, * cÚ¡ & 
sk
, & 
šfo
,

2243 & 
k
)

2247 
z”o
=0.0;

2251 ià(
n
 <ğ0è
	`¡rıy
(
sk
,"ERROR: N <= 0");

2252 ià(
m
 <ğ0è
	`¡rıy
(
sk
,"ERROR: M <= 0");

2253 ià(
çùr
 < 
z”o
è
	`¡rıy
(
sk
,"ERROR: FACTR < 0");

2256 
i
 = 1; i <ğ
n
; i++)

2258 ià(
nbd
[
i
] < 0 ||‚bd[i] > 3)

2261 
	`¡rıy
(
sk
,"ERROR: INVALID NBD");

2262 
šfo
 = -6;

2263 
k
 = 
i
;

2265 ià(
nbd
[
i
] == 2)

2267 ià(
l
[
i
] > 
u
[i])

2270 
	`¡rıy
(
sk
, "ERROR: NO FEASIBLE SOLUTION");

2271 
šfo
 = -7;

2272 
k
 = 
i
;

2276 
	}
}

2402 
	$fÜmk
(cÚ¡ & 
n
, cÚ¡ & 
nsub
, cÚ¡ * cÚ¡ & 
šd
,

2403 cÚ¡ & 
ÃÁ”
, cÚ¡ & 
—ve
,

2404 cÚ¡ * cÚ¡ & 
šdx2
, cÚ¡ & 
iupd©
,

2405 cÚ¡ 
boŞ
& 
upd©d
, * cÚ¡ & 
wn
,

2406 * cÚ¡ & 
wn1
, cÚ¡ & 
m
,

2407 * cÚ¡ & 
ws
, * cÚ¡ & 
wy
,

2408 * cÚ¡ & 
sy
, cÚ¡ & 
th‘a
,

2409 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, & 
šfo
)

2412 
m2
,
Ár
,
j²Œ
,
iy
,
is
,
jy
,
js
,
is1
,
js1
,
k1
,

2413 
cŞ2
,
pbegš
,
³nd
,
dbegš
,
d’d
,
upş
;

2414 
idx1
, 
idx2
;

2415 
‹mp1
,
‹mp2
,
‹mp3
,
‹mp4
;

2417 
z”o
=0.0;

2419 
m2
 = 2*
m
;

2427 ià(
upd©d
)

2429 ià(
iupd©
 > 
m
)

2432 
jy
 = 1; jy <ğ
m
-1; jy++)

2434 
js
 = 
m
 + 
jy
;

2435 
	`dcİy
(
m
-
jy
,&(
wn1
[
	`g‘Idx
(jy+1,jy+1,
m2
)-1]),1,

2436 &(
wn1
[
	`g‘Idx
(
jy
,jy,
m2
)-1]),1);

2437 
	`dcİy
(
m
-
jy
,&(
wn1
[
	`g‘Idx
(
js
+1,js+1,
m2
)-1]),1,

2438 &(
wn1
[
	`g‘Idx
(
js
,js,
m2
)-1]), 1);

2439 
	`dcİy
(
m
-1, &(
wn1
[
	`g‘Idx
(m+2,
jy
+1,
m2
)-1]), 1,

2440 &(
wn1
[
	`g‘Idx
(
m
+1,
jy
,
m2
)-1]),1);

2445 
pbegš
 = 1;

2446 
³nd
 = 
nsub
;

2447 
dbegš
 = 
nsub
 + 1;

2448 
d’d
 = 
n
;

2449 
iy
 = 
cŞ
;

2450 
is
 = 
m
 + 
cŞ
;

2451 
Ár
 = 
h—d
 + 
cŞ
 - 1;

2452 ià(
Ár
 > 
m
) ipntr -= m ;

2453 
j²Œ
 = 
h—d
;

2455 
jy
 = 1; jy <ğ
cŞ
; jy++)

2457 
js
 = 
m
 + 
jy
;

2458 
‹mp1
 = 
z”o
;

2459 
‹mp2
 = 
z”o
;

2460 
‹mp3
 = 
z”o
;

2462 
k
 = 
pbegš
; k <ğ
³nd
; k++)

2464 
k1
 = 
šd
[
k
];

2465 
‹mp1
 +ğ
wy
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*wy[g‘Idx(k1,
j²Œ
,n)];

2468 
k
 = 
dbegš
; k <ğ
d’d
; k++)

2470 
k1
 = 
šd
[
k
];

2471 
idx1
 = 
	`g‘Idx
(
k1
,
Ár
,
n
);

2472 
idx2
 = 
	`g‘Idx
(
k1
,
j²Œ
,
n
);

2473 
‹mp2
 +ğ
ws
[
idx1
] * ws[
idx2
];

2474 
‹mp3
 +ğ
ws
[
idx1
] * 
wy
[
idx2
];

2476 
wn1
[
	`g‘Idx
(
iy
,
jy
,
m2
)] = 
‹mp1
;

2477 
wn1
[
	`g‘Idx
(
is
,
js
,
m2
)] = 
‹mp2
;

2478 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] = 
‹mp3
;

2479 
j²Œ
 = j²Œ%
m
 + 1;

2483 
jy
 = 
cŞ
;

2484 
j²Œ
 = 
h—d
 + 
cŞ
 - 1;

2485 ià(
j²Œ
 > 
m
) jpntr -= m;

2486 
Ár
 = 
h—d
;

2487 
i
 = 1; i <ğ
cŞ
; i++)

2489 
is
 = 
m
 + 
i
;

2490 
‹mp3
 = 
z”o
;

2492 
k
 = 
pbegš
; k <ğ
³nd
; k++)

2494 
k1
 = 
šd
[
k
];

2495 
‹mp3
 +ğ
ws
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*
wy
[g‘Idx(k1,
j²Œ
,n)];

2497 
Ár
 = i²Œ%
m
 + 1;

2498 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] = 
‹mp3
;

2500 
upş
 = 
cŞ
 - 1;

2503 
upş
 = 
cŞ
;

2507 
Ár
 = 
h—d
;

2509 
iy
 = 1; iy <ğ
upş
; iy++)

2511 
is
 = 
m
 + 
iy
;

2512 
j²Œ
 = 
h—d
;

2514 
jy
 = 1; jy <ğ
iy
; jy++)

2516 
js
 = 
m
 + 
jy
;

2517 
‹mp1
 = 
z”o
;

2518 
‹mp2
 = 
z”o
;

2519 
‹mp3
 = 
z”o
;

2520 
‹mp4
 = 
z”o
;

2521 
k
 = 1; k <ğ
ÃÁ”
; k++)

2523 
k1
 = 
šdx2
[
k
];

2524 
idx1
 = 
	`g‘Idx
(
k1
,
Ár
,
n
);

2525 
idx2
 = 
	`g‘Idx
(
k1
,
j²Œ
,
n
);

2526 
‹mp1
 +ğ
wy
[
idx1
]*wy[
idx2
];

2527 
‹mp2
 +ğ
ws
[
idx1
]*ws[
idx2
];

2529 
k
 = 
—ve
; k <ğ
n
; k++)

2531 
k1
 = 
šdx2
[
k
];

2532 
idx1
 = 
	`g‘Idx
(
k1
,
Ár
,
n
);

2533 
idx2
 = 
	`g‘Idx
(
k1
,
j²Œ
,
n
);

2534 
‹mp3
 +ğ
wy
[
idx1
]*wy[
idx2
];

2535 
‹mp4
 +ğ
ws
[
idx1
]*ws[
idx2
];

2537 
wn1
[
	`g‘Idx
(
iy
,
jy
,
m2
)] +ğ
‹mp1
 - 
‹mp3
;

2538 
wn1
[
	`g‘Idx
(
is
,
js
,
m2
)] +ğ
‹mp4
 - 
‹mp2
;

2539 
j²Œ
 = j²Œ%
m
 + 1;

2541 
Ár
 = i²Œ%
m
 + 1;

2544 
Ár
 = 
h—d
;

2546 
is
 = 
m
+1; i <ğm + 
upş
; is++)

2548 
j²Œ
 = 
h—d
;

2549 
jy
 = 1; jy <ğ
upş
; jy++)

2551 
‹mp1
 = 
z”o
;

2552 
‹mp3
 = 
z”o
;

2554 
k
 = 1; k <ğ
ÃÁ”
; k++)

2556 
k1
 = 
šdx2
[
k
];

2557 
‹mp1
 +ğ
ws
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*
wy
[g‘Idx(k1,
j²Œ
,n)];

2559 
k
 = 
—ve
; k <ğ
n
; k++)

2561 
k1
 = 
šdx2
[
k
];

2562 
‹mp3
 +ğ
ws
[
	`g‘Idx
(
k1
,
Ár
,
n
)]*
wy
[g‘Idx(k1,
j²Œ
,n)];

2564 ià(
is
 <ğ
jy
 + 
m
)

2565 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] +ğ
‹mp1
 - 
‹mp3
;

2567 
wn1
[
	`g‘Idx
(
is
,
jy
,
m2
)] +ğ
‹mp3
 - 
‹mp1
;

2569 
j²Œ
 = j²Œ%
m
 + 1;

2571 
Ár
 = i²Œ%
m
 + 1;

2576 
iy
 = 1; iy <ğ
cŞ
; iy++)

2578 
is
 = 
cŞ
 + 
iy
;

2579 
is1
 = 
m
 + 
iy
;

2580 
jy
 = 1; jy <ğ
iy
; jy++)

2582 
js
 = 
cŞ
 + 
jy
;

2583 
js1
 = 
m
 + 
jy
;

2584 
wn
[
	`g‘Idx
(
jy
,
iy
,
m2
)] = 
wn1
[g‘Idx(iy,jy,m2)]/
th‘a
;

2585 
wn
[
	`g‘Idx
(
js
,
is
,
m2
)] = 
wn1
[g‘Idx(
is1
,
js1
,m2)]*
th‘a
;

2588 
jy
 = 1; jy <ğ
iy
-1; jy++)

2589 
wn
[
	`g‘Idx
(
jy
,
is
,
m2
)] = -
wn1
[g‘Idx(
is1
,jy,m2)];

2591 
jy
 = 
iy
; jy <ğ
cŞ
; jy++)

2592 
wn
[
	`g‘Idx
(
jy
,
is
,
m2
)] = 
wn1
[g‘Idx(
is1
,jy,m2)];

2593 
wn
[
	`g‘Idx
(
iy
,iy,
m2
)] +ğ
sy
[g‘Idx(iy,iy,
m
)];

2601 
	`dpoç
(
wn
,
m2
,
cŞ
,
šfo
);

2602 ià(
šfo
 != 0)

2604 
šfo
 = -1;

2609 
cŞ2
 = 2*
cŞ
;

2610 
js
 = 
cŞ
+1; j <ğ
cŞ2
; js++)

2611 
	`dŒ¦
(
wn
,
m2
,
cŞ
,&(wn[
	`g‘Idx
(1,
js
,m2)-1]),11,
šfo
);

2618 
is
 = 
cŞ
+1; i <ğ
cŞ2
; is++)

2619 
js
 = 
is
; j <ğ
cŞ2
; js++)

2620 
wn
[
	`g‘Idx
(
is
,
js
,
m2
)] +ğ
	`ddÙ
(
cŞ
,&(wn[getIdx(1,is,m2)-1]),1,

2621 &(
wn
[
	`g‘Idx
(1,
js
,
m2
)-1]),1);

2624 
	`dpoç
(&(
wn
[
	`g‘Idx
(
cŞ
+1,cŞ+1,
m2
)-1]),m2,cŞ,
šfo
);

2626 ià(
šfo
 != 0)

2628 
šfo
 = -2;

2631 
	}
}

2660 
	$fÜmt
(cÚ¡ & 
m
, * cÚ¡ & 
wt
, * cÚ¡& 
sy
,

2661 * cÚ¡ & 
ss
, cÚ¡ & 
cŞ
, cÚ¡ & 
th‘a
,

2662 & 
šfo
)

2665 
k1
, 
idx
;

2666 
ddum
;

2667 
z”o
=0.0;

2671 
j
 = 1; j <ğ
cŞ
; j++)

2673 
idx
 = 
	`g‘Idx
(1,
j
,
m
);

2674 
wt
[
idx
] = 
th‘a
*
ss
[idx];

2677 
i
 = 2; i <ğ
cŞ
; i++)

2678 
j
 = 
i
; j <ğ
cŞ
; j++)

2680 
k1
 = 
	`mš
(
i
,
j
) - 1;

2681 
ddum
 = 
z”o
;

2682 
k
 = 1; k <ğ
k1
; k++)

2683 
ddum
 +ğ
sy
[
	`g‘Idx
(
i
,
k
,
m
)]*sy[g‘Idx(
j
,k,m)]/sy[getIdx(k,k,m)];

2684 
wt
[
	`g‘Idx
(
i
,
j
,
m
)] = 
ddum
 + 
th‘a
*
ss
[getIdx(i,j,m)];

2690 
	`dpoç
(
wt
,
m
,
cŞ
,
šfo
);

2691 ià(
šfo
 != 0) info = -3;

2692 
	}
}

2733 
	$ä“v
(cÚ¡ & 
n
, & 
nä“
, * cÚ¡ & 
šdex
, & 
ÃÁ”
,

2734 & 
—ve
, * cÚ¡ & 
šdx2
, * cÚ¡ & 
iwh”e
,

2735 
boŞ
& 
wrk
, cÚ¡ boŞ& 
upd©d
, cÚ¡ boŞ& 
ú¡nd
,

2736 cÚ¡ & 
ršt
, cÚ¡ & 
™”
)

2739 
Ÿù
,
k
;

2741 
ÃÁ”
 = 0;

2742 
—ve
 = 
n
 + 1;

2743 ià(
™”
 > 0 && 
ú¡nd
)

2746 
i
 = 1; i <ğ
nä“
; i++)

2748 
k
 = 
šdex
[
i
];

2749 ià(
iwh”e
[
k
] > 0)

2751 
—ve
 -= 1;

2752 
šdx2
[
—ve
] = 
k
;

2753 ià(
ršt
 >= 100)

2754 
cout
 << "V¬ŸbË " << 
k
<<"†—ve th£ˆoàä“ v¬ŸbËs"<<
’dl
;

2758 
i
 = 1+
nä“
; i <ğ
n
; i++)

2760 
k
 = 
šdex
[
i
];

2761 ià(
iwh”e
[
k
] <= 0)

2763 
ÃÁ”
 += 1;

2764 
šdx2
[
ÃÁ”
] = 
k
;

2765 ià(
ršt
 >= 100)

2766 
cout
 << "V¬ŸbË " << 
k
<<"ƒÁ” th£ˆoàä“ v¬ŸbËs"<<
’dl
;

2769 ià(
ršt
 >= 99)

2770 
cout
 << 
n
+1-
—ve
 << " variables†eave; "

2771 << 
ÃÁ”
 << " v¬ŸbË ’‹r" << 
’dl
;

2773 
wrk
 = (
—ve
 < 
n
+1è|| (
ÃÁ”
 > 0è|| 
upd©d
;

2777 
nä“
 = 0;

2778 
Ÿù
 = 
n
 + 1;

2779 
i
 = 1; i <ğ
n
; i++)

2781 ià(
iwh”e
[
i
] <= 0)

2783 
nä“
 += 1;

2784 
šdex
[
nä“
] = 
i
;

2788 
Ÿù
 -= 1;

2789 
šdex
[
Ÿù
] = 
i
;

2793 ià(
ršt
 >= 99)

2794 
cout
 << 
nä“
 << " v¬ŸbË ¬ä“‡ˆGCP " << 
™”
 + 1 << 
’dl
;

2795 
	}
}

2840 
	$hpsŞb
(cÚ¡ & 
n
, * cÚ¡ & 
t
, * cÚ¡ & 
iÜd”
,

2841 cÚ¡ & 
ih—p
)

2844 
i
,
j
,
šdxš
,
šdxou
;

2845 
ddum
,
out
;

2847 ià(
ih—p
 == 0)

2850 
k
 = 2; k <ğ
n
; k++)

2852 
ddum
 = 
t
[
k
];

2853 
šdxš
 = 
iÜd”
[
k
];

2856 
i
 = 
k
;

2857 
gÙo10
:

2858 ià(
i
>1)

2860 
j
 = 
i
/2;

2861 ià(
ddum
 < 
t
[
j
])

2863 
t
[
i
] =[
j
];

2864 
iÜd”
[
i
] = iÜd”[
j
];

2865 
i
 = 
j
;

2866 
gÙo10
;

2870 
t
[
i
] = 
ddum
;

2871 
iÜd”
[
i
] = 
šdxš
;

2879 ià(
n
 > 1)

2881 
i
 = 1;

2882 
out
 = 
t
[1];

2883 
šdxou
 = 
iÜd”
[1];

2884 
ddum
 = 
t
[
n
];

2885 
šdxš
 = 
iÜd”
[
n
];

2888 
gÙo30
:

2889 
j
 = 
i
+i;

2890 ià(
j
 <ğ
n
-1)

2892 ià(
t
[
j
+1] <[j]) j = j+1;

2893 ià(
t
[
j
] < 
ddum
 )

2895 
t
[
i
] =[
j
];

2896 
iÜd”
[
i
] = iÜd”[
j
];

2897 
i
 = 
j
;

2898 
gÙo30
;

2901 
t
[
i
] = 
ddum
;

2902 
iÜd”
[
i
] = 
šdxš
;

2906 
t
[
n
] = 
out
;

2907 
iÜd”
[
n
] = 
šdxou
;

2909 
	}
}

2939 
	$Ê¤lb
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

2940 cÚ¡ * cÚ¡& 
nbd
, * cÚ¡ & 
x
, & 
f
,

2941 & 
fŞd
, & 
gd
, & 
gdŞd
, * cÚ¡& 
g
,

2942 * cÚ¡& 
d
, * cÚ¡& 
r
, * cÚ¡& 
t
,

2943 * cÚ¡& 
z
, & 
¡p
, & 
dnÜm
, & 
dtd
,

2944 & 
x¡•
, & 
¡pmx
, cÚ¡ & 
™”
, & 
ifun
,

2945 & 
iback
, & 
nfgv
, & 
šfo
, * cÚ¡ & 
sk
,

2946 cÚ¡ 
boŞ
& 
boxed
, cÚ¡ boŞ& 
ú¡nd
, * cÚ¡ & 
c§ve
,

2947 * cÚ¡ & 
i§ve
, * cÚ¡ & 
d§ve
)

2950 
a1
,
a2
;

2951 
Úe
=1.0,
z”o
=0.0,
big
=1e10;

2952 
áŞ
=1.0e-3,
gtŞ
=0.9,
xtŞ
=0.1;

2955 ià(
	`¡ºcmp
(
sk
,"FG_LN",5)==0è
gÙo556
;

2957 
dtd
 = 
	`ddÙ
(
n
,
d
,1,d,1);

2958 
dnÜm
 = 
	`sq¹
(
dtd
);

2962 
¡pmx
 = 
big
;

2963 ià(
ú¡nd
)

2965 ià(
™”
 == 0)

2966 
¡pmx
 = 
Úe
;

2969 
i
 = 1; i <ğ
n
; i++)

2971 
a1
 = 
d
[
i
];

2972 ià(
nbd
[
i
] != 0)

2974 ià(
a1
 < 
z”o
 && 
nbd
[
i
] <= 2)

2976 
a2
 = 
l
[
i
] - 
x
[i];

2977 ià(
a2
 >ğ
z”o
)

2978 
¡pmx
 = 
z”o
;

2980 ià(
a1
*
¡pmx
 < 
a2
)

2981 
¡pmx
 = 
a2
/
a1
;

2984 ià(
a1
 > 
z”o
 && 
nbd
[
i
] >= 2)

2986 
a2
 = 
u
[
i
] - 
x
[i];

2987 ià(
a2
 <ğ
z”o
)

2988 
¡pmx
 = 
z”o
;

2990 ià(
a1
*
¡pmx
 > 
a2
)

2991 
¡pmx
 = 
a2
/
a1
;

2998 ià(
™”
 =ğ0 && !
boxed
)

2999 
¡p
 = 
	`mš
(
Úe
/
dnÜm
, 
¡pmx
);

3001 
¡p
 = 
Úe
;

3003 
	`dcİy
(
n
,
x
,1,
t
,1);

3004 
	`dcİy
(
n
,
g
,1,
r
,1);

3005 
fŞd
 = 
f
;

3006 
ifun
 = 0;

3007 
iback
 = 0;

3008 
	`¡rıy
(
c§ve
,"START");

3009 
gÙo556
:

3010 
gd
 = 
	`ddÙ
(
n
,
g
,1,
d
,1);

3011 ià(
ifun
 == 0)

3013 
gdŞd
=
gd
;

3014 ià(
gd
 >ğ
z”o
)

3018 
šfo
 = -4;

3023 
	`dc¤ch
(
f
,
gd
,
¡p
,
áŞ
,
gtŞ
,
xtŞ
,
z”o
,
¡pmx
,
c§ve
,
i§ve
,
d§ve
);

3025 
x¡•
 = 
¡p
*
dnÜm
;

3026 ià(
	`¡ºcmp
(
c§ve
,"CONV",4) != 0 && strncmp(csave,"WARN",4) != 0)

3028 
	`¡rıy
(
sk
,"FG_LNSRCH");

3029 
ifun
 += 1;

3030 
nfgv
 += 1;

3031 
iback
 = 
ifun
 - 1;

3032 ià(
¡p
 =ğ
Úe
)

3033 
	`dcİy
(
n
,
z
,1,
x
,1);

3036 
i
 = 1; i <ğ
n
; i++)

3037 
x
[
i
] = 
¡p
*
d
[i] + 
t
[i];

3041 
	`¡rıy
(
sk
,"NEW_X");

3042 
	}
}

3069 
	$m©upd
(cÚ¡ & 
n
, cÚ¡ & 
m
, * cÚ¡ & 
ws
,

3070 * cÚ¡ & 
wy
, * cÚ¡ & 
sy
, * cÚ¡ & 
ss
,

3071 * cÚ¡ & 
d
, * cÚ¡ & 
r
, & 
™a
, & 
iupd©
,

3072 & 
cŞ
, & 
h—d
, & 
th‘a
, & 
¼
, & 
dr
,

3073 & 
¡p
, & 
dtd
)

3076 
pošŒ
;

3077 
Úe
=1.0;

3078 
idx
;

3081 ià(
iupd©
 <ğ
m
)

3083 
cŞ
 = 
iupd©
;

3084 
™a
 = (
h—d
+
iupd©
-2)%
m
 + 1;

3088 
™a
 = i%
m
 + 1;

3089 
h—d
 = h—d%
m
 + 1;

3093 
idx
 = 
	`g‘Idx
(1,
™a
,
n
)-1;

3094 
	`dcİy
(
n
,
d
,1,&(
ws
[
idx
]),1);

3095 
	`dcİy
(
n
,
r
,1,&(
wy
[
idx
]),1);

3098 
th‘a
 = 
¼
/
dr
;

3103 ià(
iupd©
 > 
m
)

3106 
j
 = 1; j <ğ
cŞ
-1; j++)

3108 
	`dcİy
(
j
,&(
ss
[
	`g‘Idx
(2,j+1,
m
)-1]),1,&(ss[getIdx(1,j,m)-1]),1);

3109 
	`dcİy
(
cŞ
-
j
,&(
sy
[
	`g‘Idx
(j+1,j+1,
m
)-1]),1,&(sy[getIdx(j,j,m)-1]),1);

3115 
pošŒ
 = 
h—d
;

3116 
j
 = 1; j <ğ
cŞ
-1; j++)

3118 
idx
 = 
	`g‘Idx
(1,
pošŒ
,
n
)-1;

3119 
sy
[
	`g‘Idx
(
cŞ
,
j
,
m
)] = 
	`ddÙ
(
n
,
d
,1,&(
wy
[
idx
]),1);

3120 
ss
[
	`g‘Idx
(
j
,
cŞ
,
m
)] = 
	`ddÙ
(
n
,&(
ws
[
idx
]),1,
d
,1);

3121 
pošŒ
 =…ošŒ%
m
 + 1;

3124 
idx
 = 
	`g‘Idx
(
cŞ
,cŞ,
m
);

3125 ià(
¡p
 =ğ
Úe
)

3126 
ss
[
idx
] = 
dtd
;

3128 
ss
[
idx
] = 
¡p
*¡p*
dtd
;

3130 
sy
[
idx
] = 
dr
;

3131 
	}
}

3155 
	$´n1lb
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ * cÚ¡ & 
l
,

3156 cÚ¡ * cÚ¡ & 
u
, cÚ¡ * cÚ¡ & 
x
,

3157 cÚ¡ & 
ršt
, 
of¡»am
* 
™fe
, cÚ¡ & 
•smch
)

3161 ià(
ršt
 >= 0)

3163 
cout
 << "RUNNING THE L-BFGS-B CODE, " << 
’dl


3164 << "•smch = machš´ecisiÚ" << 
’dl


3165 << "™ = i‹¿tiÚ‚umb”" << 
’dl


3166 << "nà =‚umb” oàfunùiÚƒv®u©iÚs" << 
’dl


3168 << 
’dl


3170 << 
’dl


3172 << 
’dl


3173 <<"cÚ = cÚv”ged, bnd =‡ bound wa »ached" << 
’dl


3175 << 
’dl


3176 << "¡•Èğ¡•†’gth u£d" << 
’dl


3177 << "t¡• =‚Üm oàthdi¥Ïûm’ˆÑÙ® s‹p)" << 
’dl


3178 << "´ojg =‚Üm oàth´ojeùed g¿d›Á" << 
’dl


3179 << "à = funùiÚ v®ue" << 
’dl


3180 << "Machš´ecisiÚ = " << 
•smch
 << 
’dl
;

3181 
cout
 << "N = " << 
n
 << ", M = " << 
m
 << 
’dl
;

3182 ià(
ršt
 >= 1)

3184 *
™fe
 << "RUNNING THE L-BFGS-B CODE,ƒpsmch = "

3185 << "™ = i‹¿tiÚ‚umb”" << 
’dl


3186 << "nà =‚umb” oàfunùiÚƒv®u©iÚs" << 
’dl


3188 << 
’dl


3190 << 
’dl


3192 << 
’dl


3193 <<"cÚ = cÚv”ged, bnd =‡ bound wa »ached" << 
’dl


3195 << 
’dl


3196 << "¡•Èğ¡•†’gth u£d" << 
’dl


3197 << "t¡• =‚Üm oàthdi¥Ïûm’ˆÑÙ® s‹p)" << 
’dl


3198 << "´ojg =‚Üm oàth´ojeùed g¿d›Á" << 
’dl


3199 << "à = funùiÚ v®ue" << 
’dl


3200 << "Machš´ecisiÚ = " << 
•smch
 << 
’dl
;

3201 *
™fe
 << "N = " << 
n
 << ", M = " << 
m
 << 
’dl
;

3202 *
™fe
 << " it‚f‚int‚act sub itls steplstep…rojg"

3203 << " f" << 
’dl
;

3204 ià(
ršt
 > 100)

3206 
cout
 << "L = ";

3207 
i
 = 1; i <ğ
n
; i++è
cout
 << 
l
[i] << " ";

3208 
cout
 << 
’dl
;

3209 
cout
 << "X0 = ";

3210 
i
 = 1; i <ğ
n
; i++è
cout
 << 
x
[i] << " ";

3211 
cout
 << 
’dl
;

3212 
cout
 << "U = ";

3213 
i
 = 1; i <ğ
n
; i++è
cout
 << 
u
[i] << " ";

3214 
cout
 << 
’dl
;

3218 
	}
}

3241 
	$´n2lb
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
x
, cÚ¡ & 
f
,

3242 cÚ¡ * cÚ¡ & 
g
, cÚ¡ & 
ršt
,

3243 
of¡»am
* 
™fe
, cÚ¡ & 
™”
, cÚ¡ & 
nfgv
,

3244 cÚ¡ & 
Çù
, cÚ¡ & 
sbgÄm
, cÚ¡ & 
nšt
,

3245 * cÚ¡ & 
wÜd
, cÚ¡ & 
iwÜd
, cÚ¡ & 
iback
,

3246 cÚ¡ & 
¡p
, cÚ¡ & 
x¡•
)

3249 
imod
;

3252 ià(
iwÜd
 == 0)

3255 
	`¡rıy
(
wÜd
, "con");

3258 ià(
iwÜd
 == 1)

3261 
	`¡rıy
(
wÜd
, "bnd");

3264 ià(
iwÜd
 == 5)

3267 
	`¡rıy
(
wÜd
, "TNT");

3271 
	`¡rıy
(
wÜd
, "---");

3273 ià(
ršt
 >= 99)

3275 
cout
 << "LINE SEARCH " << 
iback
 <<"imes;‚Üm oà¡• = " <<
x¡•
<<
’dl
;

3276 
cout
 << "Aˆ™”©" << 
™”
 << " f=" << 
f
 <<" |´oj g|="<<
sbgÄm
<<
’dl
;

3277 ià(
ršt
 > 100)

3279 
cout
 << "X = " << 
’dl
;

3280 
i
 = 1; i <ğ
n
; i++è
cout
 << 
x
[i] << " ";

3281 
cout
 << 
’dl
;

3282 
cout
 << "G = " << 
’dl
;

3283 
i
 = 1; i <ğ
n
; i++è
cout
 << 
g
[i] << " ";

3284 
cout
 << 
’dl
;

3288 ià(
ršt
 > 0)

3290 
imod
 = 
™”
%
ršt
;

3291 ià(
imod
 == 0)

3292 
cout
 << "Aˆ™”©" << 
™”
 << " f="<<
f
<< " |´oj g|="<<
sbgÄm
<<
’dl
;

3294 ià(
ršt
 >= 1)

3295 *
™fe
 << " " << 
™”
 << " " << 
nfgv
 << " " << 
nšt
 << " " << 
Çù
 << " "

3296 << 
wÜd
 << " " << 
iback
 << " " << 
¡p
 << " " << 
x¡•
 << " "

3297 << 
sbgÄm
 << " " << 
f
 << 
’dl
;

3298 
	}
}

3322 
	$´n3lb
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
x
, & 
f
,

3323 cÚ¡ * cÚ¡ & 
sk
, cÚ¡ & 
ršt
,

3324 cÚ¡ & 
šfo
, 
of¡»am
* 
™fe
, cÚ¡ & 
™”
,

3325 cÚ¡ & 
nfgv
, cÚ¡ & 
nštŞ
, cÚ¡ & 
nsk
,

3326 cÚ¡ & 
Çù
, cÚ¡ & 
sbgÄm
, cÚ¡ & 
time
,

3327 cÚ¡ & 
nšt
, cÚ¡ * cÚ¡ & 
wÜd
, cÚ¡ & 
iback
,

3328 cÚ¡ & 
¡p
,cÚ¡ & 
x¡•
, cÚ¡ & 
k
,

3329 cÚ¡ & 
ÿchyt
, cÚ¡ & 
sbtime
, cÚ¡ & 
Êscht
)

3332 ià(
	`¡ºcmp
(
sk
,"ERROR",5)==0è
gÙo999
;

3334 ià(
ršt
 >= 0)

3336 
cout
 << " * * *"

3337 << "T™ =Ù®‚umb” oà™”©iÚs" << 
’dl


3338 << "Tnà =Ù®‚umb” oàfunùiÚƒv®u©iÚs" << 
’dl


3340 << " Cauchy s—rches" << 
’dl


3341 << "Sk =‚umb” oàBFGS upd©e sk³d" << 
’dl


3343 << " Cauchy…ošt" << 
’dl


3344 << "Projg =‚Üm oàthfš®…rojeùed g¿d›Á" << 
’dl


3345 << "F = fš® funùiÚ v®ue" << 
’dl


3346 << " * * *" << 
’dl
;

3348 
cout
 << " N T™ Tnà Tnšˆ Sk Naù Projg F" << 
’dl
;

3349 
cout
 << " " << 
n
 << " " << 
™”
 << " " << 
nfgv
 << " " << 
nštŞ
 << " "

3350 << 
nsk
 << " " << 
Çù
 << " " << 
sbgÄm
 << " " << 
f
 << 
’dl
;

3351 ià(
ršt
 >= 100)

3353 
cout
 << "X = ";

3354 
i
 = 1; i <ğ
n
; i++)

3355 
cout
 << 
x
[
i
] << " ";

3356 
cout
 << 
’dl
;

3358 ià(
ršt
 >ğ1è
cout
 << " F = " << 
f
 << 
’dl
;

3361 
gÙo999
:

3363 ià(
ršt
 >= 0)

3365 
cout
 << 
sk
 << 
’dl
;

3366 ià(
šfo
 != 0)

3368 ià(
šfo
 == -1)

3369 
cout
 << "Matrix in 1st Cholesky factorization in formk is‚ot "

3370 << "Pos. Def." << 
’dl
;

3371 ià(
šfo
 == -2)

3372 
cout
 << "Matrix in 2st Cholesky factorization in formk is‚ot "

3373 << "Pos. Def." << 
’dl
;

3374 ià(
šfo
 == -3)

3375 
cout
 << "Matrix inhe Cholesky factorization in formt is‚ot "

3376 << "Pos. Def." << 
’dl
;

3377 ià(
šfo
 == -4)

3378 
cout
 << "Derivative >= 0, backtracking†ine search impossible."

3379 << 
’dl
 << "Previous x, f‡nd g„estored." <<ƒndl

3381 <<"ev®u©iÚ;" << 
’dl


3382 << "2„oundšgƒ¼Ü domš©computiÚ." << 
’dl
;

3383 ià(
šfo
 == -5)

3384 
cout
 << "W¬nšg: mÜthª 10 funùiÚ‡nd g¿d›Á" << 
’dl


3386 << "may…ossibly bÿu£d by‡ bad s—rch dœeùiÚ."<<
’dl
;

3387 ià(
šfo
 == -6)

3388 
cout
 << " IÅuˆnbd(" << 
k
 << "èi šv®id."<<
’dl
;

3389 ià(
šfo
 == -7)

3390 
cout
 << "†(" << 
k
 << ") > u(" << k << "). No feasible solution."

3391 << 
’dl
;

3392 ià(
šfo
 == -8)

3393 
cout
 << "ThŒŸnguÏ¸sy¡em i sšguÏr" << 
’dl
;

3394 ià(
šfo
 == -9)

3395 
cout
 << " Lš£¬ch cªnÙ†oÿ‹‡Àadequ©pošˆaá”"<<
’dl


3397 << " g„e¡Üed." << 
’dl


3400 << 
’dl
;

3403 ià(
ršt
 >= 1)

3404 
cout
 << "Cauchyim" << 
ÿchyt
 << " secÚds."<<
’dl


3405 << "Sub¥aû mšimiz©iÚim" << 
sbtime
 << " secÚds."<<
’dl


3406 << "Lš£¬chim" << 
Êscht
 << " secÚds."<<
’dl
;

3408 
cout
 << "TÙ® U£¸tim" << 
time
 << " secÚds." << 
’dl
;

3410 ià(
ršt
 >= 1)

3412 ià(
šfo
 == -4 || info == -9)

3414 *
™fe
 << " " << 
n
 << " " << 
™”
 << " " << 
nfgv
 << " " << 
nštŞ


3415 << " " << 
nsk
 << " " << 
Çù
 << " " << 
sbgÄm
 << " " << 
f


3416 << 
’dl
;

3418 *
™fe
 << 
sk
 << 
’dl
;

3419 ià(
šfo
 != 0)

3421 ià(
šfo
 == -1)

3422 *
™fe
 << "Matrix in 1st Cholesky factorization in formk is‚ot"

3423 << " Pos. Def." << 
’dl
;

3424 ià(
šfo
 == -2)

3425 *
™fe
 << "Matrix in 2st Cholesky factorization in formk is‚ot"

3426 << " Pos. Def." << 
’dl
;

3427 ià(
šfo
 == -3)

3428 *
™fe
 << "Matrix inhe Cholesky factorization in formt is‚ot"

3429 << " Pos. Def." << 
’dl
;

3430 ià(
šfo
 == -4)

3431 *
™fe
 << "Derivative>=0, backtracking†ine search impossible."

3432 << 
’dl
 << "Previous x, f‡nd g„estored." <<ƒndl

3434 <<"ev®u©iÚ;" << 
’dl


3435 << "2„oundšgƒ¼Ü domš©computiÚ." << 
’dl
;

3436 ià(
šfo
 == -5)

3437 *
™fe
 << "W¬nšg: mÜthª 10 funùiÚ‡nd g¿d›Á" << 
’dl


3440 << 
’dl
;

3441 ià(
šfo
 == -8)

3442 
cout
 << "ThŒŸnguÏ¸sy¡em i sšguÏr" << 
’dl
;

3443 ià(
šfo
 == -9)

3444 
cout
 << " Line search cannot†ocate‡n‡dequate…oint‡fter"

3445 << 
’dl


3447 << "ªd g„e¡Üed." << 
’dl


3450 << 
’dl
;

3452 *
™fe
 << "TÙ® U£¸tim" << 
time
 << " secÚds." << 
’dl
;

3455 
	}
}

3478 
	$´ojgr
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

3479 cÚ¡ * cÚ¡ & 
nbd
, cÚ¡ * cÚ¡ & 
x
,

3480 cÚ¡ * cÚ¡ & 
g
, & 
sbgÄm
)

3483 
gi
;

3485 
z”o
=0.0;

3487 
sbgÄm
 = 
z”o
;

3488 
i
 = 1; i <ğ
n
; i++)

3490 
gi
 = 
g
[
i
];

3491 ià(
nbd
[
i
] != 0)

3493 ià(
gi
 < 
z”o
)

3495 ià(
nbd
[
i
] >ğ2è
gi
 = 
	`max
((
x
[i]-
u
[i]),gi);

3499 ià(
nbd
[
i
] <ğ2è
gi
 = 
	`mš
((
x
[i]-
l
[i]),gi);

3502 
sbgÄm
 = 
	`max
(sbgÄm,
	`çbs
(
gi
));

3504 
	}
}

3655 
	$subsm
(cÚ¡ & 
n
, cÚ¡ & 
m
, cÚ¡ & 
nsub
, cÚ¡ * cÚ¡& 
šd
,

3656 cÚ¡ * cÚ¡ & 
l
, cÚ¡ * cÚ¡ & 
u
,

3657 cÚ¡ * cÚ¡ & 
nbd
, * cÚ¡ & 
x
, * cÚ¡ & 
d
,

3658 * cÚ¡ & 
ws
, * cÚ¡ & 
wy
, cÚ¡ & 
th‘a
,

3659 cÚ¡ & 
cŞ
, cÚ¡ & 
h—d
, & 
iwÜd
, * cÚ¡ & 
wv
,

3660 * cÚ¡ & 
wn
, cÚ¡ & 
ršt
, & 
šfo
)

3663 
pošŒ
,
m2
,
cŞ2
,
ibd
=0,
js
,
k
;

3664 
®pha
,
dk
,
‹mp1
,
‹mp2
;

3665 
Úe
=1.0,
z”o
=0.0;

3666 
idx
;

3668 ià(
nsub
 <= 0) ;

3669 ià(
ršt
 >= 99)

3670 
cout
 << "----------------SUBSMƒÁ”ed-----------------" << 
’dl
;

3674 
pošŒ
 = 
h—d
;

3675 
i
 = 1; i <ğ
cŞ
; i++)

3677 
‹mp1
 = 
z”o
;

3678 
‹mp2
 = 
z”o
;

3679 
j
 = 1; j <ğ
nsub
; j++)

3681 
k
 = 
šd
[
j
];

3682 
idx
 = 
	`g‘Idx
(
k
,
pošŒ
,
n
);

3683 
‹mp1
 +ğ
wy
[
idx
]*
d
[
j
];

3684 
‹mp2
 +ğ
ws
[
idx
]*
d
[
j
];

3686 
wv
[
i
] = 
‹mp1
;

3687 
wv
[
cŞ
 + 
i
] = 
th‘a
*
‹mp2
;

3688 
pošŒ
 =…ošŒ%
m
 + 1;

3694 
m2
 = 2*
m
;

3695 
cŞ2
 = 2*
cŞ
;

3696 
	`dŒ¦
(
wn
,
m2
,
cŞ2
,
wv
,11,
šfo
);

3698 ià(
šfo
 != 0) ;

3699 
i
 = 1; i <ğ
cŞ
; i++)

3700 
wv
[
i
] = -wv[i];

3701 
	`dŒ¦
(
wn
,
m2
,
cŞ2
,
wv
,01,
šfo
);

3703 ià(
šfo
 != 0) ;

3707 
pošŒ
 = 
h—d
;

3708 
jy
 = 1; jy <ğ
cŞ
; jy++)

3710 
js
 = 
cŞ
 + 
jy
;

3711 
i
 = 1; i <ğ
nsub
; i++)

3713 
k
 = 
šd
[
i
];

3714 
idx
 = 
	`g‘Idx
(
k
,
pošŒ
,
n
);

3715 
d
[
i
] +ğ
wy
[
idx
]*
wv
[
jy
]/
th‘a
 + 
ws
[idx]*wv[
js
];

3717 
pošŒ
 =…ošŒ%
m
 + 1;

3720 
i
 = 1; i <ğ
nsub
; i++)

3721 
d
[
i
] /ğ
th‘a
;

3725 
®pha
 = 
Úe
;

3726 
‹mp1
 = 
®pha
;

3728 
i
 = 1; i <ğ
nsub
; i++)

3730 
k
 = 
šd
[
i
];

3731 
dk
 = 
d
[
i
];

3732 ià(
nbd
[
k
] != 0)

3734 ià(
dk
 < 
z”o
 && 
nbd
[
k
] <= 2)

3736 
‹mp2
 = 
l
[
k
] - 
x
[k];

3737 ià(
‹mp2
 >ğ
z”o
)

3738 
‹mp1
 = 
z”o
;

3740 ià(
dk
*
®pha
 < 
‹mp2
)

3741 
‹mp1
 = 
‹mp2
/
dk
;

3744 ià(
dk
 > 
z”o
 && 
nbd
[
k
] >= 2)

3746 
‹mp2
 = 
u
[
k
] - 
x
[k];

3747 ià(
‹mp2
 <ğ
z”o
)

3748 
‹mp1
 = 
z”o
;

3750 ià(
dk
*
®pha
 > 
‹mp2
)

3751 
‹mp1
 = 
‹mp2
/
dk
;

3753 ià(
‹mp1
 < 
®pha
)

3755 
®pha
 = 
‹mp1
;

3756 
ibd
 = 
i
;

3762 ià(
®pha
 < 
Úe
)

3764 
dk
 = 
d
[
ibd
];

3765 
k
 = 
šd
[
ibd
];

3766 ià(
dk
 > 
z”o
)

3768 
x
[
k
] = 
u
[k];

3769 
d
[
ibd
] = 
z”o
;

3772 ià(
dk
 < 
z”o
)

3774 
x
[
k
] = 
l
[k];

3775 
d
[
ibd
] = 
z”o
;

3779 
i
 = 1; i <ğ
nsub
; i++)

3781 
k
 = 
šd
[
i
];

3782 
x
[
k
] +ğ
®pha
*
d
[
i
];

3785 ià(
ršt
 >= 99)

3787 ià(
®pha
 < 
Úe
)

3788 
cout
 << "ALPHA = " << 
®pha
 << " backŒackØthBOX" << 
’dl
;

3790 
cout
 << "SM sŞutiÚ insidthbox" << 
’dl
;

3792 ià(
ršt
 >100)

3794 
cout
 << "Subspace solution X = ";

3795 
i
 = 1; i <ğ
n
; i++è
cout
 << 
x
[i] << " ";

3796 
cout
 << 
’dl
;

3800 ià(
®pha
 < 
Úe
)

3801 
iwÜd
 = 1;

3803 
iwÜd
 = 0;

3805 ià(
ršt
 >= 99)

3806 
cout
 << "----------------ex™ SUBSM --------------------" << 
’dl
;

3807 
	}
}

3943 
	$dc¤ch
(& 
f
, & 
g
, & 
¡p
, cÚ¡ & 
áŞ
,

3944 cÚ¡ & 
gtŞ
, cÚ¡ & 
xtŞ
, cÚ¡ & 
¡pmš
,

3945 cÚ¡ & 
¡pmax
, * cÚ¡ & 
sk
, * cÚ¡ & 
i§ve
,

3946 * cÚ¡ & 
d§ve
)

3948 
z”o
=0.0,
p5
=0.5,
p66
=0.66;

3949 
xŒ­l
=1.1,
xŒ­u
=4.0;

3951 
boŞ
 
b¿ckt
;

3952 
¡age
;

3953 
fš™
,
áe¡
,
fm
,
fx
,
fxm
,
fy
,
fym
,
gš™
,
g‹¡
,

3954 
gm
,
gx
,
gxm
,
gy
,
gym
,
¡x
,
¡y
,
¡mš
,
¡max
,
width
,
width1
;

3958 ià(
	`¡ºcmp
(
sk
,"START",5)==0)

3962 ià(
¡p
 < 
¡pmš
è
	`¡rıy
(
sk
, "ERROR: STP < STPMIN");

3963 ià(
¡p
 > 
¡pmax
è
	`¡rıy
(
sk
, "ERROR: STP > STPMAX");

3964 ià(
g
 >
z”o
è
	`¡rıy
(
sk
, "ERROR: INITIAL G >ZERO");

3965 ià(
áŞ
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: FTOL < ZERO");

3966 ià(
gtŞ
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: GTOL < ZERO");

3967 ià(
xtŞ
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: XTOL < ZERO");

3968 ià(
¡pmš
 < 
z”o
è
	`¡rıy
(
sk
, "ERROR: STPMIN < ZERO");

3969 ià(
¡pmax
 < 
¡pmš
è
	`¡rıy
(
sk
, "ERROR: STPMAX < STPMIN");

3972 ià(
	`¡ºcmp
(
sk
,"ERROR",5)==0) ;

3976 
b¿ckt
 = 
çl£
;

3977 
¡age
 = 1;

3978 
fš™
 = 
f
;

3979 
gš™
 = 
g
;

3980 
g‹¡
 = 
áŞ
*
gš™
;

3981 
width
 = 
¡pmax
 - 
¡pmš
;

3982 
width1
 = 
width
/
p5
;

3991 
¡x
 = 
z”o
;

3992 
fx
 = 
fš™
;

3993 
gx
 = 
gš™
;

3994 
¡y
 = 
z”o
;

3995 
fy
 = 
fš™
;

3996 
gy
 = 
gš™
;

3997 
¡mš
 = 
z”o
;

3998 
¡max
 = 
¡p
 + 
xŒ­u
*stp;

3999 
	`¡rıy
(
sk
, "FG");

4001 
gÙo1000
;

4007 ià(
i§ve
[1] == 1)

4008 
b¿ckt
 = 
Œue
;

4010 
b¿ckt
 = 
çl£
;

4012 
¡age
 = 
i§ve
[2];

4013 
gš™
 = 
d§ve
[1];

4014 
g‹¡
 = 
d§ve
[2];

4015 
gx
 = 
d§ve
[3];

4016 
gy
 = 
d§ve
[4];

4017 
fš™
 = 
d§ve
[5];

4018 
fx
 = 
d§ve
[6];

4019 
fy
 = 
d§ve
[7];

4020 
¡x
 = 
d§ve
[8];

4021 
¡y
 = 
d§ve
[9];

4022 
¡mš
 = 
d§ve
[10];

4023 
¡max
 = 
d§ve
[11];

4024 
width
 = 
d§ve
[12];

4025 
width1
 = 
d§ve
[13];

4031 
áe¡
 = 
fš™
 + 
¡p
*
g‹¡
;

4032 ià(
¡age
 =ğ1 && 
f
 <ğ
áe¡
 && 
g
 >ğ
z”o
) stage = 2;

4036 ià(
b¿ckt
 && (
¡p
 <ğ
¡mš
 || s >ğ
¡max
))

4037 
	`¡rıy
(
sk
, "WARNING: ROUNDING ERRORS PREVENT PROGRESS");

4038 ià(
b¿ckt
 && 
¡max
 - 
¡mš
 <ğ
xtŞ
*stmax)

4039 
	`¡rıy
(
sk
, "WARNING: XTOL TEST SATISFIED");

4040 ià(
¡p
 =ğ
¡pmax
 && 
f
 <ğ
áe¡
 && 
g
 <ğ
g‹¡
)

4041 
	`¡rıy
(
sk
, "WARNING: STP = STPMAX");

4042 ià(
¡p
 =ğ
¡pmš
 && (
f
 > 
áe¡
 || 
g
 >ğ
g‹¡
))

4043 
	`¡rıy
(
sk
, "WARNING: STP = STPMIN");

4047 ià(
f
 <ğ
áe¡
 && 
	`çbs
(
g
è<ğ
gtŞ
*(-
gš™
))

4048 
	`¡rıy
(
sk
, "CONVERGENCE");

4052 ià(
	`¡ºcmp
(
sk
,"WARN",4)==0 || sŒncmpÑask,"CONV",4)==0è
gÙo1000
;

4058 ià(
¡age
 =ğ1 && 
f
 <ğ
fx
 && f > 
áe¡
)

4062 
fm
 = 
f
 - 
¡p
*
g‹¡
;

4063 
fxm
 = 
fx
 - 
¡x
*
g‹¡
;

4064 
fym
 = 
fy
 - 
¡y
*
g‹¡
;

4065 
gm
 = 
g
 - 
g‹¡
;

4066 
gxm
 = 
gx
 - 
g‹¡
;

4067 
gym
 = 
gy
 - 
g‹¡
;

4071 
	`dc¡•
(
¡x
,
fxm
,
gxm
,
¡y
,
fym
,
gym
,
¡p
,
fm
,
gm
,

4072 
b¿ckt
,
¡mš
,
¡max
);

4076 
fx
 = 
fxm
 + 
¡x
*
g‹¡
;

4077 
fy
 = 
fym
 + 
¡y
*
g‹¡
;

4078 
gx
 = 
gxm
 + 
g‹¡
;

4079 
gy
 = 
gym
 + 
g‹¡
;

4085 
	`dc¡•
(
¡x
,
fx
,
gx
,
¡y
,
fy
,
gy
,
¡p
,
f
,
g
,

4086 
b¿ckt
,
¡mš
,
¡max
);

4091 ià(
b¿ckt
)

4093 ià(
	`çbs
(
¡y
-
¡x
è>ğ
p66
*
width1
è
¡p
 = stx + 
p5
*(sty - stx);

4094 
width1
 = 
width
;

4095 
width
 = 
	`çbs
(
¡y
-
¡x
);

4100 ià(
b¿ckt
)

4102 
¡mš
 = 
	`mš
(
¡x
,
¡y
);

4103 
¡max
 = 
	`max
(
¡x
,
¡y
);

4107 
¡mš
 = 
¡p
 + 
xŒ­l
*(¡°- 
¡x
);

4108 
¡max
 = 
¡p
 + 
xŒ­u
*(¡°- 
¡x
);

4113 
¡p
 = 
	`max
(¡p,
¡pmš
);

4114 
¡p
 = 
	`mš
(¡p,
¡pmax
);

4119 ià((
b¿ckt
 && (
¡p
 <ğ
¡mš
 || s >ğ
¡max
))

4120 || (
b¿ckt
 && 
¡max
-
¡mš
 <ğ
xtŞ
*¡max)è
¡p
 = 
¡x
;

4123 
	`¡rıy
(
sk
,"FG");

4125 
gÙo1000
:

4129 ià(
b¿ckt
)

4130 
i§ve
[1] = 1;

4132 
i§ve
[1] = 0;

4134 
i§ve
[2] = 
¡age
;

4135 
d§ve
[1] = 
gš™
;

4136 
d§ve
[2] = 
g‹¡
;

4137 
d§ve
[3] = 
gx
;

4138 
d§ve
[4] = 
gy
;

4139 
d§ve
[5] = 
fš™
;

4140 
d§ve
[6] = 
fx
;

4141 
d§ve
[7] = 
fy
;

4142 
d§ve
[8] = 
¡x
;

4143 
d§ve
[9] = 
¡y
;

4144 
d§ve
[10] = 
¡mš
;

4145 
d§ve
[11] = 
¡max
;

4146 
d§ve
[12] = 
width
;

4147 
d§ve
[13] = 
width1
;

4148 
	}
}

4244 
	$dc¡•
(& 
¡x
, & 
fx
, & 
dx
, & 
¡y
, & 
fy
,

4245 & 
dy
, & 
¡p
, cÚ¡ & 
å
, cÚ¡ & 
dp
,

4246 
boŞ
& 
b¿ckt
, cÚ¡ & 
¡pmš
, cÚ¡ & 
¡pmax
)

4248 
z”o
=0.0,
p66
=0.66,
two
=2.0,
th»e
=3.0;

4249 
gamma
,
p
,
q
,
r
,
s
,
sgnd
,
¡pc
,
¡pf
,
¡pq
,
th‘a
;

4251 
sgnd
 = 
dp
*(
dx
/
	`çbs
(dx));

4258 ià(
å
 > 
fx
)

4260 
th‘a
 = 
th»e
*(
fx
 - 
å
)/(
¡p
 - 
¡x
è+ 
dx
 + 
dp
;

4261 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dx
),çbs(
dp
));

4262 
gamma
 = 
s
*
	`sq¹
Ğ(
th‘a
/s)*Ñh‘a/sè- (
dx
/s)*(
dp
/s) );

4263 ià(
¡p
 < 
¡x
è
gamma
 = -gamma;

4264 
p
 = (
gamma
 - 
dx
è+ 
th‘a
;

4265 
q
 = ((
gamma
 - 
dx
è+ gammaè+ 
dp
;

4266 
r
 = 
p
/
q
;

4267 
¡pc
 = 
¡x
 + 
r
*(
¡p
 - stx);

4268 
¡pq
 = 
¡x
 + ((
dx
/((
fx
 - 
å
)/(
¡p
 - stxè+ dx))/
two
)*(stp - stx);

4269 ià(
	`çbs
(
¡pc
-
¡x
è< fabs(
¡pq
-stx))

4270 
¡pf
 = 
¡pc
;

4272 
¡pf
 = 
¡pc
 + (
¡pq
 - sc)/
two
;

4273 
b¿ckt
 = 
Œue
;

4282 ià(
sgnd
 < 
z”o
)

4284 
th‘a
 = 
th»e
*(
fx
 - 
å
)/(
¡p
 - 
¡x
è+ 
dx
 + 
dp
;

4285 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dx
),çbs(
dp
));

4286 
gamma
 = 
s
*
	`sq¹
Ğ(
th‘a
/s)*Ñh‘a/sè- (
dx
/s)*(
dp
/s) );

4287 ià(
¡p
 > 
¡x
è
gamma
 = -gamma;

4288 
p
 = (
gamma
 - 
dp
è+ 
th‘a
;

4289 
q
 = ((
gamma
 - 
dp
è+ gammaè+ 
dx
;

4290 
r
 = 
p
/
q
;

4291 
¡pc
 = 
¡p
 + 
r
*(
¡x
 - stp);

4292 
¡pq
 = 
¡p
 + (
dp
/(d°- 
dx
))*(
¡x
 - stp);

4293 ià(
	`çbs
(
¡pc
-
¡p
è> fabs(
¡pq
-stp))

4294 
¡pf
 = 
¡pc
;

4296 
¡pf
 = 
¡pq
;

4297 
b¿ckt
 = 
Œue
;

4304 ià(
	`çbs
(
dp
è< fabs(
dx
))

4311 
th‘a
 = 
th»e
*(
fx
 - 
å
)/(
¡p
 - 
¡x
è+ 
dx
 + 
dp
;

4312 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dx
),çbs(
dp
));

4317 
gamma
 = 
s
*
	`sq¹
(
	`max
(
z”o
, (
th‘a
/s)*Ñh‘a/s)-(
dx
/s)*(
dp
/s)));

4318 ià(
¡p
 > 
¡x
è
gamma
 = -gamma;

4319 
p
 = (
gamma
 - 
dp
è+ 
th‘a
;

4320 
q
 = (
gamma
 + (
dx
 - 
dp
)) + gamma;

4321 
r
 = 
p
/
q
;

4322 ià(
r
 < 
z”o
 && 
gamma
 != zero)

4323 
¡pc
 = 
¡p
 + 
r
*(
¡x
 - stp);

4325 ià(
¡p
 > 
¡x
)

4326 
¡pc
 = 
¡pmax
;

4328 
¡pc
 = 
¡pmš
;

4330 
¡pq
 = 
¡p
 + (
dp
/(d°- 
dx
))*(
¡x
 - stp);

4332 ià(
b¿ckt
)

4339 ià(
	`çbs
(
¡pc
-
¡p
è< fabs(
¡pq
-stp))

4340 
¡pf
 = 
¡pc
;

4342 
¡pf
 = 
¡pq
;

4344 ià(
¡p
 > 
¡x
)

4345 
¡pf
 = 
	`mš
(
¡p
+
p66
*(
¡y
-stp),stpf);

4347 
¡pf
 = 
	`max
(
¡p
+
p66
*(
¡y
-stp),stpf);

4355 ià(
	`çbs
(
¡pc
-
¡p
è> fabs(
¡pq
-stp))

4356 
¡pf
 = 
¡pc
;

4358 
¡pf
 = 
¡pq
;

4360 
¡pf
 = 
	`mš
(
¡pmax
,stpf);

4361 
¡pf
 = 
	`max
(
¡pmš
,stpf);

4370 ià(
b¿ckt
)

4372 
th‘a
 = 
th»e
*(
å
 - 
fy
)/(
¡y
 - 
¡p
è+ 
dy
 + 
dp
;

4373 
s
 = 
	`max
(
	`çbs
(
th‘a
),çbs(
dy
),çbs(
dp
));

4374 
gamma
 = 
s
*
	`sq¹
((
th‘a
/s)*Ñh‘a/sè- (
dy
/s)*(
dp
/s));

4375 ià(
¡p
 > 
¡y
è
gamma
 = -gamma;

4376 
p
 = (
gamma
 - 
dp
è+ 
th‘a
;

4377 
q
 = ((
gamma
 - 
dp
è+ gammaè+ 
dy
;

4378 
r
 = 
p
/
q
;

4379 
¡pc
 = 
¡p
 + 
r
*(
¡y
 - stp);

4380 
¡pf
 = 
¡pc
;

4383 ià(
¡p
 > 
¡x
)

4384 
¡pf
 = 
¡pmax
;

4386 
¡pf
 = 
¡pmš
;

4391 ià(
å
 > 
fx
)

4393 
¡y
 = 
¡p
;

4394 
fy
 = 
å
;

4395 
dy
 = 
dp
;

4399 ià(
sgnd
 < 
z”o
)

4401 
¡y
 = 
¡x
;

4402 
fy
 = 
fx
;

4403 
dy
 = 
dx
;

4405 
¡x
 = 
¡p
;

4406 
fx
 = 
å
;

4407 
dx
 = 
dp
;

4412 
¡p
 = 
¡pf
;

4413 
	}
}

4446 
	$dÄm2
(& 
n
,* cÚ¡ & 
x
, & 
šcx
)

4449 
sÿË
 = 0.0;

4450 
ddÄm2
 = 0.0;

4452 
i
 = 1; i <ğ
n
; i+=
šcx
)

4453 
sÿË
 = 
	`max
(sÿË, 
	`çbs
(
x
[
i
]));

4455 ià(
sÿË
 =ğ0.0è 
ddÄm2
;

4457 
i
 = 1; i <ğ
n
; i+=
šcx
)

4458 
ddÄm2
 +ğ(
x
[
i
]/
sÿË
)*(x[i]/scale);

4460 
ddÄm2
 = 
sÿË
*
	`sq¹
(ddnrm2);

4461  
ddÄm2
;

4462 
	}
}

4495 
	$dpm•s
()

4498 
ib‘a
,
œnd
,
™
,
™emp
,
Ãg•
;

4499 
a
,
b
,
b‘a
,
b‘aš
,
b‘ah
,
‹mp
,
‹m·
,
‹mp1
,

4500 
z”o
=0.0,
Úe
=1.0,
two
=2.0;

4501 
ddpm•s
;

4505 
a
 = 
Úe
;

4506 
b
 = 
Úe
;

4507 
gÙo10
:

4508 
a
 =‡ +‡;

4509 
‹mp
 = 
a
 + 
Úe
;

4510 
‹mp1
 = 
‹mp
 - 
a
;

4511 ià(
‹mp1
 - 
Úe
 =ğ
z”o
è
gÙo10
;

4513 
gÙo20
:

4514 
b
 = b + b;

4515 
‹mp
 = 
a
 + 
b
;

4516 
™emp
 = (
‹mp
 - 
a
);

4517 ià(
™emp
 =ğ0è
gÙo20
;

4518 
ib‘a
 = 
™emp
;

4519 
b‘a
 = (
ib‘a
);

4523 
™
 = 0;

4524 
b
 = 
Úe
;

4525 
gÙo30
:

4526 
™
 += 1;

4527 
b
 *ğ
b‘a
;

4528 
‹mp
 = 
b
 + 
Úe
;

4529 
‹mp1
 = 
‹mp
 - 
b
;

4530 ià(
‹mp1
 - 
Úe
 =ğ
z”o
è
gÙo30
;

4531 
œnd
 = 0;

4532 
b‘ah
 = 
b‘a
/
two
;

4533 
‹mp
 = 
a
 + 
b‘ah
;

4534 ià(
‹mp
 - 
a
 !ğ
z”o
è
œnd
 = 1;

4535 
‹m·
 = 
a
 + 
b‘a
;

4536 
‹mp
 = 
‹m·
 + 
b‘ah
;

4537 ià((
œnd
 =ğ0è&& (
‹mp
 - 
‹m·
 !ğ
z”o
)) irnd = 2;

4541 
Ãg•
 = 
™
 + 3;

4542 
b‘aš
 = 
Úe
/
b‘a
;

4543 
a
 = 
Úe
;

4544 
i
 = 1; i <ğ
Ãg•
; i++)

4545 
a
 *ğ
b‘aš
;

4547 
gÙo50
:

4548 
‹mp
 = 
Úe
 + 
a
;

4549 ià(
‹mp
 - 
Úe
 !ğ
z”o
è
gÙo60
;

4550 
a
 *ğ
b‘a
;

4551 
gÙo50
;

4553 
gÙo60
:

4554 
ddpm•s
 = 
a
;

4555 ià((
ib‘a
 =ğ2è|| (
œnd
 =ğ0)è
gÙo70
;

4556 
a
 = (a*(
Úe
 +‡))/
two
;

4557 
‹mp
 = 
Úe
 + 
a
;

4558 ià(
‹mp
 - 
Úe
 !ğ
z”o
è
ddpm•s
 = 
a
;

4560 
gÙo70
:

4561  
ddpm•s
;

4562 
	}
}

4569 
	$daxpy
(cÚ¡ & 
n
, cÚ¡ & 
da
, cÚ¡ * cÚ¡ & 
dx
,

4570 cÚ¡ & 
šcx
, * cÚ¡ & 
dy
, cÚ¡ & 
šcy
)

4573 
ix
,
iy
,
m
,
mp1
;

4574 ià(
n
 <= 0) ;

4575 ià(
da
 == 0.0) ;

4576 if(
šcx
==1 && 
šcy
==1è
gÙo20
;

4581 
ix
 = 1;

4582 
iy
 = 1;

4583 if(
šcx
 < 0è
ix
 = (-
n
+1)*incx + 1;

4584 if(
šcy
 < 0è
iy
 = (-
n
+1)*incy + 1;

4586 
i
 = 1; i <ğ
n
; i++)

4588 
dy
[
iy
] +ğ
da
*
dx
[
ix
];

4589 
ix
 +ğ
šcx
;

4590 
iy
 +ğ
šcy
;

4597 
gÙo20
:

4598 
m
 = 
n
%4;

4599 ià(
m
 =ğ0è
gÙo40
;

4601 
i
 = 1; i <ğ
m
; i++)

4602 
dy
[
i
] +ğ
da
*
dx
[i];

4604 ià(
n
 < 4) ;

4606 
gÙo40
:

4607 
mp1
 = 
m
 + 1;

4609 
i
 = 
mp1
; i <ğ
n
; i+=4)

4611 
dy
[
i
] +ğ
da
*
dx
[i];

4612 
dy
[
i
 + 1] +ğ
da
*
dx
[i + 1];

4613 
dy
[
i
 + 2] +ğ
da
*
dx
[i + 2];

4614 
dy
[
i
 + 3] +ğ
da
*
dx
[i + 3];

4616 
	}
}

4623 
	$dcİy
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
dx
, cÚ¡ & 
šcx
,

4624 * cÚ¡ & 
dy
,cÚ¡ & 
šcy
)

4627 
ix
,
iy
,
m
,
mp1
;

4629 ià(
n
 <= 0) ;

4630 if(
šcx
==1 && 
šcy
==1è
gÙo20
;

4635 
ix
 = 1;

4636 
iy
 = 1;

4637 ià(
šcx
 < 0è
ix
 = (-
n
+1)*incx + 1;

4638 ià(
šcy
 < 0è
iy
 = (-
n
+1)*incy + 1;

4639 
i
 = 1; i <ğ
n
; i++)

4641 
dy
[
iy
] = 
dx
[
ix
];

4642 
ix
 +ğ
šcx
;

4643 
iy
 +ğ
šcy
;

4651 
gÙo20
:

4652 
m
 = 
n
%7;

4653 ià(
m
 =ğ0è
gÙo40
;

4654 
i
 = 1; i <ğ
m
; i++)

4655 
dy
[
i
] = 
dx
[i];

4657 ià(
n
 < 7) ;

4659 
gÙo40
:

4660 
mp1
 = 
m
 + 1;

4661 
i
 = 
mp1
; i <ğ
n
; i+=7)

4663 
dy
[
i
] = 
dx
[i];

4664 
dy
[
i
 + 1] = 
dx
[i + 1];

4665 
dy
[
i
 + 2] = 
dx
[i + 2];

4666 
dy
[
i
 + 3] = 
dx
[i + 3];

4667 
dy
[
i
 + 4] = 
dx
[i + 4];

4668 
dy
[
i
 + 5] = 
dx
[i + 5];

4669 
dy
[
i
 + 6] = 
dx
[i + 6];

4671 
	}
}

4678 
	$ddÙ
(cÚ¡ & 
n
, cÚ¡ * cÚ¡ & 
dx
, cÚ¡ & 
šcx
,

4679 cÚ¡ * cÚ¡ & 
dy
, cÚ¡ & 
šcy
)

4681 
d‹mp
;

4683 
ix
,
iy
,
m
,
mp1
;

4685 
dddÙ
 = 0.0;

4686 
d‹mp
 = 0.0;

4687 ià(
n
 <ğ0è 
dddÙ
;

4688 ià(
šcx
==1 && 
šcy
==1è
gÙo20
;

4693 
ix
 = 1;

4694 
iy
 = 1;

4695 ià(
šcx
 < 0è
ix
 = (-
n
+1)*incx + 1;

4696 ià(
šcy
 < 0è
iy
 = (-
n
+1)*incy + 1;

4698 
i
 = 1; i <ğ
n
; i++)

4700 
d‹mp
 +ğ
dx
[
ix
]*
dy
[
iy
];

4701 
ix
 +ğ
šcx
;

4702 
iy
 +ğ
šcy
;

4704 
dddÙ
 = 
d‹mp
;

4705  
dddÙ
;

4711 
gÙo20
:

4712 
m
 = 
n
%5;

4713 ià(
m
 =ğ0è
gÙo40
;

4715 
i
 = 1; i <ğ
m
; i++)

4716 
d‹mp
 +ğ
dx
[
i
]*
dy
[i];

4718 ifĞ
n
 < 5 ) 
gÙo60
;

4720 
gÙo40
:

4721 
mp1
 = 
m
 + 1;

4724 
i
 = 
mp1
; i <ğ
n
; i+=5)

4726 
d‹mp
 +ğ
dx
[
i
]*
dy
[i] + dx[i + 1]*dy[i + 1] +

4727 
dx
[
i
 + 2]*
dy
[i + 2] + dx[i + 3]*dy[i + 3] + dx[i + 4]*dy[i + 4];

4730 
gÙo60
:

4731 
dddÙ
 = 
d‹mp
;

4732  
dddÙ
;

4733 
	}
}

4778 
	$dpoç
(* cÚ¡ & 
a
, cÚ¡ & 
lda
, cÚ¡ & 
n
, & 
šfo
,

4779 
boŞ
 
sm®ËrM©rix
=
çl£
)

4781 
t
;

4782 
s
;

4784 
jm1
;

4785 
idx
;

4788 
j
 = 1; j <ğ
n
; j++)

4790 
šfo
 = 
j
;

4791 
s
 = 0.0;

4792 
jm1
 = 
j
 - 1;

4793 ià(
jm1
 < 1è
gÙo20
;

4794 
k
 = 1; k <ğ
jm1
; k++)

4796 
idx
 = 
	`g‘Idx
(
k
,
j
,
lda
);

4797 
t
 = 
a
[
idx
] - 
	`ddÙ
(
k
-1,&×[
	`g‘Idx
(1,k,
lda
)-1]),1,

4798 &(
a
[
	`g‘Idx
(1,
j
,
lda
)-1]),1);

4799 
t
 =/
a
[
	`g‘Idx
(
k
,k,
lda
)];

4800 
a
[
idx
] = 
t
;

4801 
s
 +ğ
t
*t;

4804 
gÙo20
:

4805 
idx
 = 
	`g‘Idx
(
j
,j,
lda
);

4806 
s
 = 
a
[
idx
] - s;

4809 ià(
s
 <ğ0.0è
gÙo40
;

4810 
a
[
idx
] = 
	`sq¹
(
s
);

4812 
šfo
 = 0;

4813 
gÙo40
:

4814 
t
 = 0;

4815 
	}
}

4823 
	$dsÿl
(cÚ¡ & 
n
, cÚ¡ & 
da
, * cÚ¡ & 
dx
,

4824 cÚ¡ & 
šcx
)

4827 
m
,
mp1
,
nšcx
;

4829 ià(
n
 <ğ0 || 
šcx
 <= 0) ;

4830 ià(
šcx
 =ğ1è
gÙo20
;

4834 
nšcx
 = 
n
*
šcx
;

4836 
i
 = 1; i <ğ
nšcx
; i+=
šcx
)

4837 
dx
[
i
] = 
da
*dx[i];

4844 
gÙo20
:

4845 
m
 = 
n
%5;

4846 ià(
m
 =ğ0è
gÙo40
;

4848 
i
 = 1; i <ğ
m
; i++)

4849 
dx
[
i
] = 
da
*dx[i];

4851 ià(
n
 < 5) ;

4853 
gÙo40
:

4854 
mp1
 = 
m
 + 1;

4855 
i
 = 
mp1
; i <ğ
n
; i+=5)

4857 
dx
[
i
] = 
da
*dx[i];

4858 
dx
[
i
 + 1] = 
da
*dx[i + 1];

4859 
dx
[
i
 + 2] = 
da
*dx[i + 2];

4860 
dx
[
i
 + 3] = 
da
*dx[i + 3];

4861 
dx
[
i
 + 4] = 
da
*dx[i + 4];

4863 
	}
}

4920 
	$dŒ¦
(* cÚ¡ & 
t
, cÚ¡ & 
ldt
, cÚ¡ & 
n
,

4921 * cÚ¡ &
b
, cÚ¡ & 
job
, & 
šfo
)

4923 
‹mp
;

4924 
cÿ£
,
j
;

4931 
šfo
 = 1; infØ<ğ
n
; info++)

4934 ià(
t
[
	`g‘Idx
(
šfo
,šfo,
ldt
)] =ğ0.0è
gÙo150
;

4936 
šfo
 = 0;

4940 
cÿ£
 = 1;

4941 ià(
job
%10 !ğ0è
cÿ£
 = 2;

4942 ià((
job
%100)/10 !ğ0è
cÿ£
 += 2;

4943 ià(
cÿ£
==1è
gÙo20
;

4944 ià(
cÿ£
==2è
gÙo50
;

4945 ià(
cÿ£
==3è
gÙo80
;

4946 ià(
cÿ£
==4è
gÙo110
;

4950 
gÙo20
:

4951 
b
[1] /ğ
t
[
	`g‘Idx
(1,1,
ldt
)];

4952 ià(
n
 < 2è
gÙo40
;

4953 
j
 = 2; j <ğ
n
; j++)

4955 
‹mp
 = -
b
[
j
-1];

4956 
	`daxpy
(
n
-
j
+1,
‹mp
,&(
t
[
	`g‘Idx
(j,j-1,
ldt
)-1]),1,&(
b
[j-1]),1);

4957 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

4959 
gÙo40
:

4960 
gÙo140
;

4964 
gÙo50
:

4965 
b
[
n
] /ğ
t
[
	`g‘Idx
Ò,n,
ldt
)];

4966 ià(
n
 < 2è
gÙo70
;

4967 
jj
 = 2; jj <ğ
n
; jj++)

4969 
j
 = 
n
 - 
jj
 + 1;

4970 
‹mp
 = -
b
[
j
+1];

4971 
	`daxpy
(
j
,
‹mp
,&(
t
[
	`g‘Idx
(1,j+1,
ldt
)-1]),1,&(
b
[1-1]),1);

4972 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

4975 
gÙo70
:

4976 
gÙo140
;

4980 
gÙo80
:

4981 
b
[
n
] /ğ
t
[
	`g‘Idx
Ò,n,
ldt
)];

4982 ià(
n
 < 2è
gÙo100
;

4983 
jj
 = 2; jj <ğ
n
; jj++)

4985 
j
 = 
n
 - 
jj
 + 1;

4986 
b
[
j
] = b[j] - 
	`ddÙ
(
jj
-1,&(
t
[
	`g‘Idx
(j+1,j,
ldt
)-1]),1,&(b[j+1-1]),1);

4987 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

4989 
gÙo100
:

4990 
gÙo140
;

4994 
gÙo110
:

4995 
b
[1] /ğ
t
[
	`g‘Idx
(1,1,
ldt
)];

4996 ià(
n
 < 2è
gÙo130
;

4997 
j
 = 2; j <ğ
n
; j++)

4999 
b
[
j
] = b[j] - 
	`ddÙ
(j-1,&(
t
[
	`g‘Idx
(1,j,
ldt
)-1]),1,&(b[1-1]),1);

5000 
b
[
j
] /ğ
t
[
	`g‘Idx
(j,j,
ldt
)];

5003 
gÙo130
:

5005 ià(
çl£
);

5007 
gÙo140
:

5009 ià(
çl£
);

5011 
gÙo150
:

5013 ià(
çl£
);

5015 
	}
}

5017 
	g´iv©e
:

5018 
Tim”
 
tim”_
;

	@learnwts.cpp

67 
	~<f¡»am
>

68 
	~<io¡»am
>

69 
	~<s¡»am
>

70 
	~"¬gum’ts.h
"

71 
	~"šã»nû¬gs.h
"

72 
	~"lbfgsb.h
"

73 
	~"disüimš©iv–—º”.h
"

74 
	~"Ë¬nwts.h
"

75 
	~"maxw®k§t.h
"

76 
	~"mc§t.h
"

77 
	~"gibbs§m¶”.h
"

78 
	~"simuÏ‹d‹m³ršg.h
"

79 
	~"lbgšã»nû.h
"

80 
	~"lv·¿ms.h
"

83 
boŞ
 
	gPRINT_CLAUSE_DURING_COUNT
 = 
Œue
;

85 cÚ¡ 
	gDISC_DEFAULT_STD_DEV
 = 2;

86 cÚ¡ 
	gGEN_DEFAULT_STD_DEV
 = 100;

89 
boŞ
 
	gdiscL—º
 = 
çl£
;

90 
boŞ
 
	gg’L—º
 = 
çl£
;

91 * 
	goutMLNFe
 = 
NULL
;

92 * 
	gdbFes
 = 
NULL
;

93 * 
	gnÚEvidP»dsSŒ
 = 
NULL
;

94 
boŞ
 
	gnoAddUn™CÏu£s
 = 
çl£
;

95 
boŞ
 
	gmuÉËD©aba£s
 = 
çl£
;

96 
boŞ
 
	gš™W™hLogOdds
 = 
çl£
;

97 
boŞ
 
	gisQu”yEvid’û
 = 
çl£
;

99 
boŞ
 
	gaP”iodicMLNs
 = 
çl£
;

101 
boŞ
 
	gnoPriÜ
 = 
çl£
;

102 
	g´iÜM—n
 = 0;

103 
	g´iÜStdDev
 = -1;

106 
	gmaxI‹r
 = 10000;

107 
	gcÚvTh»sh
 = 1e-5;

108 
boŞ
 
	gnoEqu®P»dWt
 = 
çl£
;

111 
	gnumI‹r
 = 100;

112 
	gmaxSec
 = 0;

113 
	gmaxMš
 = 0;

114 
	gmaxHour
 = 0;

115 
	gË¬nšgR©e
 = 0.001;

116 
	gmom’tum
 = 0.0;

117 
boŞ
 
	gw™hEM
 = 
çl£
;

118 * 
	gaInãrSŒ
 = 
NULL
;

119 
boŞ
 
	gnoU£P”Weight
 = 
çl£
;

120 
boŞ
 
	gu£NewtÚ
 = 
çl£
;

121 
boŞ
 
	gu£CG
 = 
çl£
;

122 
boŞ
 
	gu£VP
 = 
çl£
;

123 
	gdiscM‘hod
 = 
Disüimš©iveL—º”
::
CG
;

124 
	gcg_Ïmbda
 = 100;

125 
	gcg_max_Ïmbda
 = 
DBL_MAX
;

126 
	gmš_Î_chªge
 = 0.00001;

127 
boŞ
 
	gcg_nİ»cÚd
 = 
çl£
;

128 
	gamwsMaxSub£qu’tS‹ps
 = -1;

129 * 
	gašDBLi¡Fe
 = 
NULL
;

130 
boŞ
 
	gaisLiáedGibbs
 = 
çl£
;

131 
boŞ
 
	gaisLiáedIS
 = 
çl£
;

132 
boŞ
 
	gaisU£UnifÜmPrİo§l
=
çl£
;

133 
boŞ
 
	gaisU£BšomŸlPrİo§l
=
çl£
;

134 
boŞ
 
	gaisU£InfÜmedPrİo§l
=
çl£
;

135 * 
	gaIÅutClu¡”Fe
 = 
NULL
;

136 
	gad­tiveR©e
 = -1;

141 
ARGS
 
	gARGS
::
Args
[] =

144 
ARGS
("i", ARGS::
Req
, 
ašMLNFes
,

150 
ARGS
("cw", ARGS::
O±
, 
aClo£dWÜldP»dsSŒ
,

156 
ARGS
("ow", ARGS::
O±
, 
aO³nWÜldP»dsSŒ
,

163 
ARGS
("m", ARGS::
Tog
, 
am­Pos
,

167 
ARGS
("a", ARGS::
Tog
, 
am­AÎ
,

171 
ARGS
("p", ARGS::
Tog
, 
agibbsInãr
,

176 
ARGS
("ms", ARGS::
Tog
, 
amc§tInãr
,

181 
ARGS
("sim", ARGS::
Tog
, 
asimInãr
,

186 
ARGS
("£ed", ARGS::
O±
, 
aS“d
,

191 
ARGS
("Ïzy", ARGS::
O±
, 
aLazy
,

195 
ARGS
("ÏzyNoAµrox", ARGS::
O±
, 
aLazyNoAµrox
,

200 
ARGS
("memLim™", ARGS::
O±
, 
aMemLim™
,

207 
ARGS
("mwsMaxS‹ps", ARGS::
O±
, 
amwsMaxS‹ps
,

211 
ARGS
("Œ›s", ARGS::
O±
, 
amwsTr›s
,

215 
ARGS
("rg‘Wt", ARGS::
O±
, 
amwsT¬g‘Wt
,

220 
ARGS
("h¬d", ARGS::
O±
, 
amwsH¬d
,

225 
ARGS
("heuri¡ic", ARGS::
O±
, 
amwsHeuri¡ic
,

230 
ARGS
("buL’gth", ARGS::
O±
, 
amwsTabuL’gth
,

235 
ARGS
("ÏzyLowS‹", ARGS::
O±
, 
amwsLazyLowS‹
,

245 
ARGS
("buºMšS‹ps", ARGS::
O±
, 
amcmcBuºMšS‹ps
,

249 
ARGS
("buºMaxS‹ps", ARGS::
O±
, 
amcmcBuºMaxS‹ps
,

253 
ARGS
("mšS‹ps", ARGS::
O±
, 
amcmcMšS‹ps
,

257 
ARGS
("maxS‹ps", ARGS::
O±
, 
amcmcMaxS‹ps
,

261 
ARGS
("maxSecÚds", ARGS::
O±
, 
amcmcMaxSecÚds
,

267 
ARGS
("subIÁ”v®", ARGS::
O±
, 
asimSubIÁ”v®
,

271 
ARGS
("numRuns", ARGS::
O±
, 
asimNumST
,

275 
ARGS
("numSw­", ARGS::
O±
, 
asimNumSw­
,

281 
ARGS
("numSŞutiÚs", ARGS::
O±
, 
amwsNumSŞutiÚs
,

285 
ARGS
("§R©io", ARGS::
O±
, 
assSaR©io
,

290 
ARGS
("§Tem³¿tu»", ARGS::
O±
, 
assSaTemp
,

295 
ARGS
("Ï‹Sa", ARGS::
Tog
, 
assL©eSa
,

301 
ARGS
("numChašs", ARGS::
O±
, 
amcmcNumChašs
,

306 
ARGS
("d–", ARGS::
O±
, 
agibbsD–
,

311 
ARGS
("•sÚE¼Ü", ARGS::
O±
, 
agibbsEpsÚE¼Ü
,

315 
ARGS
("äacCÚv”ged", ARGS::
O±
, 
agibbsF¿cCÚv”ged
,

320 
ARGS
("w®k§tTy³", ARGS::
O±
, 
agibbsW®k§tTy³
,

325 
ARGS
("§m¶esP”Te¡", ARGS::
O±
, 
agibbsSam¶esP”Te¡
,

332 
ARGS
("³riodic", ARGS::
Tog
, 
aP”iodicMLNs
,

335 
ARGS
("šãr", ARGS::
O±
, 
aInãrSŒ
,

341 
ARGS
("d", ARGS::
Tog
, 
discL—º
, "Discriminative weight†earning."),

343 
ARGS
("g", ARGS::
Tog
, 
g’L—º
, "Generative weight†earning."),

345 
ARGS
("o", ARGS::
Req
, 
outMLNFe
,

348 
ARGS
("t", ARGS::
O±
, 
dbFes
,

353 
ARGS
("l", ARGS::
O±
, 
ašDBLi¡Fe
,

357 
ARGS
("Ã", ARGS::
O±
, 
nÚEvidP»dsSŒ
,

364 
ARGS
("noAddUn™CÏu£s", ARGS::
Tog
, 
noAddUn™CÏu£s
,

368 
ARGS
("muÉËD©aba£s", ARGS::
Tog
, 
muÉËD©aba£s
,

372 
ARGS
("w™hEM", ARGS::
Tog
, 
w™hEM
,

376 
ARGS
("dNumI‹r", ARGS::
O±
, 
numI‹r
,

380 
ARGS
("dMaxSec", ARGS::
O±
, 
maxSec
,

383 
ARGS
("dMaxMš", ARGS::
O±
, 
maxMš
,

386 
ARGS
("dMaxHour", ARGS::
O±
, 
maxHour
,

389 
ARGS
("dL—ºšgR©e", ARGS::
O±
, 
Ë¬nšgR©e
,

393 
ARGS
("dMom’tum", ARGS::
O±
, 
mom’tum
,

397 
ARGS
("dNoPW", ARGS::
Tog
, 
noU£P”Weight
,

402 
ARGS
("dVP", ARGS::
Tog
, 
u£VP
,

406 
ARGS
("dNewtÚ", ARGS::
Tog
, 
u£NewtÚ
,

410 
ARGS
("dCG", ARGS::
Tog
, 
u£CG
,

414 
ARGS
("cgLambda", ARGS::
O±
, 
cg_Ïmbda
,

418 
ARGS
("cgMaxLambda", ARGS::
O±
, 
cg_max_Ïmbda
,

421 
ARGS
("cgMšLLChªge", ARGS::
O±
, 
mš_Î_chªge
,

424 
ARGS
("cgNoP»cÚd", ARGS::
Tog
, 
cg_nİ»cÚd
,

427 
ARGS
("qu”yEvid’û", ARGS::
Tog
, 
isQu”yEvid’û
,

431 
ARGS
("dIn™W™hLogOdds", ARGS::
Tog
, 
š™W™hLogOdds
,

435 
ARGS
("dMwsMaxSub£qu’tS‹ps", ARGS::
O±
, 
amwsMaxSub£qu’tS‹ps
,

441 
ARGS
("gMaxI‹r", ARGS::
O±
, 
maxI‹r
,

446 
ARGS
("gCÚvTh»sh", ARGS::
O±
, 
cÚvTh»sh
,

451 
ARGS
("gNoEqu®P»dWt", ARGS::
O±
, 
noEqu®P»dWt
,

456 
ARGS
("noPriÜ", ARGS::
Tog
, 
noPriÜ
, "No Gaussian…riors on formula weights."),

458 
ARGS
("´iÜM—n", ARGS::
O±
, 
´iÜM—n
,

464 
ARGS
("´iÜStdDev", ARGS::
O±
, 
´iÜStdDev
,

468 
ARGS
("lvg", ARGS::
Tog
, 
aisLiáedGibbs
,

487 
ARGS
("ic", ARGS::
O±
, 
aIÅutClu¡”Fe
,

495 
ARGS
()

500 
lßdA¼ay
(cÚ¡ * 
fe
, 
A¼ay
<
¡ršg
>& 
¬¿y
)

502 
if¡»am
 
is
(
fe
);

503 
	g¬¿y
.
ş—r
();

504 
¡ršg
 
	glše
;

505 
g‘lše
(
is
, 
lše
))

507 
	g¬¿y
.
­³nd
(
lše
);

511 
	$maš
(
¬gc
, * 
¬gv
[])

513 
ARGS
::
	`·r£
(
¬gc
,
¬gv
,&
cout
);

514 ià(!
discL—º
 && !
g’L—º
)

517 
discL—º
 = 
Œue
;

524 
Tim”
 
tim”
;

525 
¡¬tSec
 = 
tim”
.
	`time
();

526 
begSec
;

528 ià(
´iÜStdDev
 < 0)

530 ià(
discL—º
)

532 
cout
 << "priorStdDev seto (discriminative†earning's) default of "

533 << 
DISC_DEFAULT_STD_DEV
 << 
’dl
;

534 
´iÜStdDev
 = 
DISC_DEFAULT_STD_DEV
;

538 
cout
 << "priorStdDev seto (generative†earning's) default of "

539 << 
GEN_DEFAULT_STD_DEV
 << 
’dl
;

540 
´iÜStdDev
 = 
GEN_DEFAULT_STD_DEV
;

546 ià(
discL—º
 && 
nÚEvidP»dsSŒ
 =ğ
NULL
)

548 
cout
 << "ERROR: you must specify‚on-evidence…redicates for "

549 << "disüimš©ivË¬nšg" << 
’dl
;

553 ià(
maxI‹r
 <ğ0è{ 
cout
 << "maxI‹¸mu¡ b> 0" << 
’dl
;  -1; }

554 ià(
cÚvTh»sh
 <= 0 || convThresh > 1)

555 { 
cout
 << "cÚvTh»sh mu¡ b> 0‡nd <ğ1" << 
’dl
;  -1; }

556 ià(
´iÜStdDev
 <ğ0è{ 
cout
 << "´iÜStdDev mu¡ b> 0" << 
’dl
;  -1;}

558 ià(
amwsMaxS‹ps
 <= 0)

559 { 
cout
 << "ERROR: mwsMaxS‹p mu¡ bpos™ive" << 
’dl
;  -1; }

562 ià(
amwsMaxSub£qu’tS‹ps
 <ğ0èamwsMaxSub£qu’tS‹p ğ
amwsMaxS‹ps
;

564 ià(
amwsTr›s
 <= 0)

565 { 
cout
 << "ERROR:r› mu¡ bpos™ive" << 
’dl
;  -1; }

567 ià(
aMemLim™
 <= 0 &&‡MemLimit != -1)

568 { 
cout
 << "ERROR:†im™ mu¡ bpos™iv(Ü -1)" << 
’dl
;  -1; }

570 ià(!
discL—º
 && 
aLazy
)

572 
cout
 << "ERROR:†azy can only be used with discriminative†earning"

573 << 
’dl
;

577 
of¡»am
 
	`out
(
outMLNFe
);

578 ià(!
out
.
	`good
())

580 
cout
 << "ERROR: uÇbËØİ’ " << 
outMLNFe
 << 
’dl
;

585 ià(
discL—º
)

588 ià(!
u£VP
 && !
u£CG
 && !
u£NewtÚ
)

589 
u£CG
 = 
Œue
;

591 ià((
u£CG
 || 
u£NewtÚ
è&& !
noU£P”Weight
)

593 
noU£P”Weight
 = 
Œue
;

598 
amcmcBuºMaxS‹ps
 = -1;

599 ià(!
aInãrSŒ
)

603 
amc§tInãr
 = 
Œue
;

608 
šãrArgc
 = 0;

609 **
šãrArgv
 = 
Ãw
 *[200];

610 
i
 = 0; i < 200; i++)

612 
šãrArgv
[
i
] = 
Ãw
 [500];

616 
¡ršg
 
šãrSŒšg
 = "infer ";

617 
šãrSŒšg
.
	`­³nd
(
aInãrSŒ
);

618 
	`exŒaùArgs
(
šãrSŒšg
.
	`c_¡r
(), 
šãrArgc
, 
šãrArgv
);

619 
cout
 << "exŒaùArg " << 
šãrArgc
 << 
’dl
;

620 
i
 = 0; i < 
šãrArgc
; i++)

622 
cout
 << 
i
 << ": " << 
šãrArgv
[i] << 
’dl
;

625 
ARGS
::
	`·r£FromCommªdLše
(
šãrArgc
, 
šãrArgv
);

628 
i
 = 0; i < 200; i++)

630 
d–‘e
[] 
šãrArgv
[
i
];

632 
d–‘e
[] 
šãrArgv
;

635 ià(!
asimInãr
 && !
am­Pos
 && !
am­AÎ
 && !
agibbsInãr
 && !
amc§tInãr
)

638 
amc§tInãr
 = 
Œue
;

648 
A¼ay
<
¡ršg
> 
cÚ¡FesA¼
;

649 
	`exŒaùFeNames
(
ašMLNFes
, 
cÚ¡FesA¼
);

650 
	`as£¹
(
cÚ¡FesA¼
.
	`size
() >= 1);

651 
¡ršg
 
šMLNFe
 = 
cÚ¡FesA¼
[0];

652 
cÚ¡FesA¼
.
	`»moveI‹m
(0);

654 
A¼ay
<
¡ršg
> 
dbFesA¼
;

655 ià(
NULL
 !ğ
dbFes
)

657 
	`exŒaùFeNames
(
dbFes
, 
dbFesA¼
);

661 
	`lßdA¼ay
(
ašDBLi¡Fe
, 
dbFesA¼
);

664 ià(
dbFesA¼
.
	`size
() <= 0)

665 {
cout
<<"ERROR: mu¡ s³cify¿ššg d©¨w™h -ˆİtiÚ."<<
’dl
;  -1;}

668 ià(
muÉËD©aba£s
)

671 ià((
cÚ¡FesA¼
.
	`size
(è> 0 && cÚ¡FesA¼.size(è!ğ
dbFesA¼
.size()))

673 
cout
 << "ERROR: whenhere‡re multiple databases, if .mln files "

675 << "bth§mnumb” oàthem‡ .db fes" << 
’dl
;

680 
SŒšgHashA¼ay
 
nÚEvidP»dNames
;

681 ià(
nÚEvidP»dsSŒ
)

683 ià(!
	`exŒaùP»dNames
(
nÚEvidP»dsSŒ
, 
NULL
, 
nÚEvidP»dNames
))

685 
cout
 << "ERROR: faedØexŒaù‚Ú-evid’û…»diÿ‹‚ames." << 
’dl
;

690 
SŒšgHashA¼ay
 
owP»dNames
;

691 
SŒšgHashA¼ay
 
cwP»dNames
;

695 
cout
 << "P¬sšg MLN‡nd c»©šg domašs..." << 
’dl
;

696 
SŒšgHashA¼ay
* 
ÃP»dNames
 = (
discL—º
è? &
nÚEvidP»dNames
 : 
NULL
;

697 
A¼ay
<
Domaš
*> 
domašs
;

698 
A¼ay
<
MLN
*> 
mÊs
;

699 
begSec
 = 
tim”
.
	`time
();

700 
boŞ
 
®lP»dsExû±Qu”›sA»CW
 = 
Œue
;

701 ià(
discL—º
)

704 ià(
aO³nWÜldP»dsSŒ
)

706 ià(!
	`exŒaùP»dNames
(
	`¡ršg
(
aO³nWÜldP»dsSŒ
), 
NULL
, 
owP»dNames
))

708 
	`as£¹
(
owP»dNames
.
	`size
() > 0);

712 ià(
aClo£dWÜldP»dsSŒ
)

714 ià(!
	`exŒaùP»dNames
(
	`¡ršg
(
aClo£dWÜldP»dsSŒ
), 
NULL
, 
cwP»dNames
))

716 
	`as£¹
(
cwP»dNames
.
	`size
() > 0);

717 ià(!
	`checkQu”yP»dsNÙInClo£dWÜldP»ds
(
nÚEvidP»dNames
, 
cwP»dNames
))

722 
®lP»dsExû±Qu”›sA»CW
 = 
çl£
;

726 
	`ü—‹DomašsAndMLNs
(
domašs
, 
mÊs
, 
muÉËD©aba£s
, 
šMLNFe
,

727 
cÚ¡FesA¼
, 
dbFesA¼
, 
ÃP»dNames
,

728 !
noAddUn™CÏu£s
, 
´iÜM—n
, 
Œue
,

729 
®lP»dsExû±Qu”›sA»CW
, &
owP»dNames
, &
cwP»dNames
);

730 
cout
 << "Parsing MLN‡nd creating domainsook ";

731 
Tim”
::
	`´štTime
(
cout
, 
tim”
.
	`time
(è- 
begSec
); couˆ<< 
’dl
;

734 cÚ¡ 
FÜmuÏAndCÏu£sA¼ay
* 
fÿ
 = 
mÊs
[0]->
	`g‘FÜmuÏAndCÏu£sA¼ay
();

735 
i
 = 0; i < 
fÿ
->
	`size
(); i++)

737 
IndexCÏu£HashA¼ay
* 
šdexCÏu£s
 = (*
fÿ
)[
i
]->indexClauses;

738 
j
 = 0; j < 
šdexCÏu£s
->
	`size
(); j++)

740 
idx
 = (*
šdexCÏu£s
)[
j
]->
šdex
;

741 
CÏu£
* 
c
 = (*
šdexCÏu£s
)[
j
]->
şau£
;

742 
cout
 << "idx " << 
idx
 << ": ";

743 
c
->
	`´štW™hWtAndSŒV¬
(
cout
, 
domašs
[0]);

744 
cout
 << 
’dl
;

765 
IndexT¿n¦©Ü
* 
šdexT¿ns


766 ğ(
IndexT¿n¦©Ü
::
	`ÃedIndexT¿n¦©Ü
(
mÊs
, 
domašs
)) ?

767 
Ãw
 
	`IndexT¿n¦©Ü
(&
mÊs
, &
domašs
è: 
NULL
;

769 ià(
šdexT¿ns
)

770 
cout
 << 
’dl
 << "the weights of clauses inhe CNFs ofƒxistential"

771 << " fÜmuÏ wÈbt›d" << 
’dl
;

773 
A¼ay
<> 
´iÜM—ns
, 
´iÜStdDevs
;

774 
A¼ay
<
boŞ
> 
lockedWts
;

775 ià(!
noPriÜ
)

777 ià(
šdexT¿ns
)

779 
šdexT¿ns
->
	`£tPriÜM—ns
(
´iÜM—ns
);

780 
´iÜStdDevs
.
	`growToSize
(
´iÜM—ns
.
	`size
());

781 
lockedWts
.
	`growToSize
(
´iÜM—ns
.
	`size
());

782 
i
 = 0; i < 
´iÜM—ns
.
	`size
(); i++)

784 
´iÜStdDevs
[
i
] = 
´iÜStdDev
;

785 
lockedWts
[
i
] = 
çl£
;

790 cÚ¡ 
CÏu£HashA¼ay
* 
şau£s
 = 
mÊs
[0]->
	`g‘CÏu£s
();

791 
numCÏu£s
 = 
şau£s
->
	`size
();

793 
i
 = 0; i < 
numCÏu£s
; i++)

795 
´iÜM—ns
.
	`­³nd
((*
şau£s
)[
i
]->
	`g‘Wt
());

796 
´iÜStdDevs
.
	`­³nd
(
´iÜStdDev
);

797 
lockedWts
.
	`­³nd
((*
şau£s
)[
i
]->
	`isSticWt
());

802 
numCÏu£sFÜmuÏs
;

803 ià(
šdexT¿ns
)

804 
numCÏu£sFÜmuÏs
 = 
šdexT¿ns
->
	`g‘NumCÏu£sAndExi¡FÜmuÏs
();

806 
numCÏu£sFÜmuÏs
 = 
mÊs
[0]->
	`g‘CÏu£s
()->
	`size
();

810 
A¼ay
<> 
wts
;

812 
j
 = 0; j < 
mÊs
[0]->
	`g‘NumCÏu£s
(); j++)

814 
CÏu£
* 
c
 = (CÏu£*è
mÊs
[0]->
	`g‘CÏu£
(
j
);

817 ià(
c
->
	`g‘Wt
(è!ğ0 && c->
	`isSticWt
())

818 
c
->
	`lock
();

822 ià(
discL—º
)

824 
wts
.
	`growToSize
(
numCÏu£sFÜmuÏs
 + 1);

825 * 
wwts
 = (*è
wts
.
	`g‘I‹ms
();

826 
wwts
++;

828 
¡ršg
 
ÃP»dsSŒ
 = 
nÚEvidP»dsSŒ
;

831 
Sam¶eS©P¬ams
* 
s¥¬ams
 = 
Ãw
 SampleSatParams;

832 
s¥¬ams
->
Ï‹Sa
 = 
assL©eSa
;

833 
s¥¬ams
->
§R©io
 = 
assSaR©io
;

834 
s¥¬ams
->
§Temp
 = 
assSaTemp
;

837 
MaxW®k§tP¬ams
* 
mw¥¬ams
 = 
NULL
;

838 
mw¥¬ams
 = 
Ãw
 
MaxW®k§tP¬ams
;

839 
mw¥¬ams
->
ssP¬ams
 = 
s¥¬ams
;

840 
mw¥¬ams
->
maxS‹ps
 = 
amwsMaxS‹ps
;

841 
mw¥¬ams
->
maxTr›s
 = 
amwsTr›s
;

842 
mw¥¬ams
->
rg‘Co¡
 = 
amwsT¬g‘Wt
;

843 
mw¥¬ams
->
h¬d
 = 
amwsH¬d
;

846 
mw¥¬ams
->
numSŞutiÚs
 = 
amwsNumSŞutiÚs
;

847 
mw¥¬ams
->
heuri¡ic
 = 
amwsHeuri¡ic
;

848 
mw¥¬ams
->
buL’gth
 = 
amwsTabuL’gth
;

849 
mw¥¬ams
->
ÏzyLowS‹
 = 
amwsLazyLowS‹
;

852 
MCS©P¬ams
* 
m¥¬ams
 = 
Ãw
 MCSatParams;

853 
m¥¬ams
->
mwsP¬ams
 = 
mw¥¬ams
;

855 
m¥¬ams
->
numChašs
 = 1;

856 
m¥¬ams
->
buºMšS‹ps
 = 
amcmcBuºMšS‹ps
;

857 
m¥¬ams
->
buºMaxS‹ps
 = 
amcmcBuºMaxS‹ps
;

858 
m¥¬ams
->
mšS‹ps
 = 
amcmcMšS‹ps
;

859 
m¥¬ams
->
maxS‹ps
 = 
amcmcMaxS‹ps
;

860 
m¥¬ams
->
maxSecÚds
 = 
amcmcMaxSecÚds
;

863 
GibbsP¬ams
* 
gibb¥¬ams
 = 
Ãw
 GibbsParams;

864 
gibb¥¬ams
->
mwsP¬ams
 = 
mw¥¬ams
;

865 
gibb¥¬ams
->
numChašs
 = 
amcmcNumChašs
;

866 
gibb¥¬ams
->
buºMšS‹ps
 = 
amcmcBuºMšS‹ps
;

867 
gibb¥¬ams
->
buºMaxS‹ps
 = 
amcmcBuºMaxS‹ps
;

868 
gibb¥¬ams
->
mšS‹ps
 = 
amcmcMšS‹ps
;

869 
gibb¥¬ams
->
maxS‹ps
 = 
amcmcMaxS‹ps
;

870 
gibb¥¬ams
->
maxSecÚds
 = 
amcmcMaxSecÚds
;

872 
gibb¥¬ams
->
gamma
 = 1 - 
agibbsD–
;

873 
gibb¥¬ams
->
•sÚE¼Ü
 = 
agibbsEpsÚE¼Ü
;

874 
gibb¥¬ams
->
äacCÚv”ged
 = 
agibbsF¿cCÚv”ged
;

875 
gibb¥¬ams
->
w®k§tTy³
 = 
agibbsW®k§tTy³
;

876 
gibb¥¬ams
->
§m¶esP”Te¡
 = 
agibbsSam¶esP”Te¡
;

879 
SimuÏ‹dTem³ršgP¬ams
* 
¡·¿ms
 = 
Ãw
 SimulatedTemperingParams;

880 
¡·¿ms
->
mwsP¬ams
 = 
mw¥¬ams
;

881 
¡·¿ms
->
numChašs
 = 
amcmcNumChašs
;

882 
¡·¿ms
->
buºMšS‹ps
 = 
amcmcBuºMšS‹ps
;

883 
¡·¿ms
->
buºMaxS‹ps
 = 
amcmcBuºMaxS‹ps
;

884 
¡·¿ms
->
mšS‹ps
 = 
amcmcMšS‹ps
;

885 
¡·¿ms
->
maxS‹ps
 = 
amcmcMaxS‹ps
;

886 
¡·¿ms
->
maxSecÚds
 = 
amcmcMaxSecÚds
;

888 
¡·¿ms
->
subIÁ”v®
 = 
asimSubIÁ”v®
;

889 
¡·¿ms
->
numST
 = 
asimNumST
;

890 
¡·¿ms
->
numSw­
 = 
asimNumSw­
;

892 
A¼ay
<
V¬ŸbËS‹
*> 
¡©es
;

893 
A¼ay
<
Inã»nû
*> 
šã»nûs
;

894 
A¼ay
<
V¬ŸbËS‹
*> 
emS‹s
;

895 
A¼ay
<
Inã»nû
*> 
emInã»nûs
;

897 
¡©es
.
	`growToSize
(
domašs
.
	`size
());

898 
šã»nûs
.
	`growToSize
(
domašs
.
	`size
());

899 
emS‹s
.
	`growToSize
(
domašs
.
	`size
());

900 
emInã»nûs
.
	`growToSize
(
domašs
.
	`size
());

903 
A¼ay
<> 
®lP»dGndšgsA»NÚEvid
;

904 
A¼ay
<
P»diÿ‹
*> 
µ»ds
;

907 
j
 = 0; j < 
mÊs
[0]->
	`g‘NumCÏu£s
(); j++)

909 
CÏu£
* 
c
 = (CÏu£*è
mÊs
[0]->
	`g‘CÏu£
(
j
);

912 ià(
c
->
	`isH¬dCÏu£
()) {

913 
c
->
	`£tWt
(10);

917 
c
->
	`£tWt
(1);

920 
i
 = 0; i < 
domašs
.
	`size
(); i++)

922 
Domaš
* 
domaš
 = 
domašs
[
i
];

923 
MLN
* 
mÊ
 = 
mÊs
[
i
];

927 ià(
amcmcMaxS‹ps
 == 1000)

929 
mšSize
 = 
INT_MAX
;

931 
c
 = 0; c < 
mÊ
->
	`g‘NumCÏu£s
(); c++)

933 
CÏu£
* 
şau£
 = (CÏu£*)
mÊ
->
	`g‘CÏu£
(
c
);

934 
size
 = 
şau£
->
	`g‘NumGroundšgs
(
domaš
);

935 ià(
size
 < 
mšSize
) minSize = ()size;

937 
¡•s
 = 10000 / 
mšSize
;

939 ià(
¡•s
 < 100) steps = 100;

940 
cout
 << "S‘tšg‚umb” oàMCMC s‹p tØ" << 
¡•s
 << 
’dl
;

941 
amcmcMaxS‹ps
 = 
¡•s
;

942 
m¥¬ams
->
maxS‹ps
 = 
amcmcMaxS‹ps
;

943 
gibb¥¬ams
->
maxS‹ps
 = 
amcmcMaxS‹ps
;

944 
¡·¿ms
->
maxS‹ps
 = 
amcmcMaxS‹ps
;

948 ià(!
aLazy
)

949 
domašs
[
i
]->
	`g‘DB
()->
	`£tLazyFÏg
(
çl£
);

952 
GroundP»diÿ‹HashA¼ay
* 
uÃP»ds
 = 
NULL
;

955 
GroundP»diÿ‹HashA¼ay
* 
kÃP»ds
 = 
NULL
;

956 
A¼ay
<
TruthV®ue
>* 
kÃP»dV®ues
 = 
NULL
;

959 ià(!
®lP»dsExû±Qu”›sA»CW
)

961 
i
 = 0; i < 
owP»dNames
.
	`size
(); i++)

963 
ÃP»dsSŒ
.
	`­³nd
(",");

964 
ÃP»dsSŒ
.
	`­³nd
(
owP»dNames
[
i
]);

965 
nÚEvidP»dNames
.
	`­³nd
(
owP»dNames
[
i
]);

969 
boŞ
 
m¬kH¬dGndCÏu£s
 = 
çl£
;

970 
boŞ
 
ŒackP¬’tCÏu£Wts
 = 
Œue
;

972 
V¬ŸbËS‹
*& 
emS‹
 = 
emS‹s
[
i
];

974 
A¼ay
<
P»diÿ‹
*> 
g´eds
;

975 
A¼ay
<
TruthV®ue
> 
g´edV®ues
;

978 ià(!
aLazy
)

980 
uÃP»ds
 = 
Ãw
 
GroundP»diÿ‹HashA¼ay
;

981 
kÃP»ds
 = 
Ãw
 
GroundP»diÿ‹HashA¼ay
;

982 
kÃP»dV®ues
 = 
Ãw
 
A¼ay
<
TruthV®ue
>;

984 
®lP»dGndšgsA»NÚEvid
.
	`growToSize
(
domaš
->
	`g‘NumP»diÿ‹s
(), 
çl£
);

986 
	`ü—‹ComLšeQu”yP»ds
(
ÃP»dsSŒ
, 
domaš
, domaš->
	`g‘DB
(),

987 
uÃP»ds
, 
kÃP»ds
,

988 &
®lP»dGndšgsA»NÚEvid
, 
NULL
);

990 ià(
w™hEM
)

992 
emS‹
 = 
Ãw
 
	`V¬ŸbËS‹
(
uÃP»ds
, 
NULL
, NULL,

993 &
®lP»dGndšgsA»NÚEvid
, 
m¬kH¬dGndCÏu£s
,

994 
ŒackP¬’tCÏu£Wts
, 
mÊ
, 
domaš
, 
aLazy
);

1002 
kÃP»dV®ues
->
	`growToSize
(
kÃP»ds
->
	`size
(), 
FALSE
);

1003 
´edno
 = 0;…»dnØ< 
kÃP»ds
->
	`size
();…redno++)

1006 
blockIdx
 = 
domaš
->
	`g‘Block
((*
kÃP»ds
)[
´edno
]);

1007 ià(
blockIdx
 > -1 &&

1008 
domaš
->
	`g‘DB
()->
	`g‘V®ue
((*
kÃP»ds
)[
´edno
]è=ğ
TRUE
)

1010 
domaš
->
	`£tBlockEvid’û
(
blockIdx
, 
çl£
);

1013 (*
kÃP»dV®ues
)[
´edno
] =

1014 
domaš
->
	`g‘DB
()->
	`£tV®ue
((*
kÃP»ds
)[
´edno
], 
UNKNOWN
);

1020 ià(
isQu”yEvid’û
)

1023 
´edno
 = 0;…»dnØ< 
uÃP»ds
->
	`size
();…redno++)

1025 
domaš
->
	`g‘DB
()->
	`£tV®ue
((*
uÃP»ds
)[
´edno
], 
FALSE
);

1026 
	`d–‘e
 (*
uÃP»ds
)[
´edno
];

1028 
uÃP»ds
->
	`ş—r
();

1033 
A¼ay
<
P»diÿ‹
*> 
µ»ds
;

1035 
domaš
->
	`g‘DB
()->
	`£tP”fÜmšgInã»nû
(
çl£
);

1037 
g´eds
.
	`ş—r
();

1038 
g´edV®ues
.
	`ş—r
();

1039 
´edno
 = 0;…»dnØ< 
nÚEvidP»dNames
.
	`size
();…redno++)

1041 
µ»ds
.
	`ş—r
();

1042 
´edid
 = 
domaš
->
	`g‘P»diÿ‹Id
(
nÚEvidP»dNames
[
´edno
].
	`c_¡r
());

1043 
P»diÿ‹
::
	`ü—‹AÎGroundšgs
(
´edid
, 
domaš
, 
µ»ds
);

1044 
g´eds
.
	`­³nd
(
µ»ds
);

1047 
domaš
->
	`g‘DB
()->
	`£tV®uesToUnknown
(&
g´eds
, &
g´edV®ues
);

1052 
cout
 << 
’dl
 << "cÚ¡ruùšg s‹ fÜ domaš " << 
i
 << "..." <<ƒndl;

1054 
V¬ŸbËS‹
*& 
¡©e
 = 
¡©es
[
i
];

1055 
¡©e
 = 
Ãw
 
	`V¬ŸbËS‹
(
uÃP»ds
, 
kÃP»ds
, 
kÃP»dV®ues
,

1056 &
®lP»dGndšgsA»NÚEvid
, 
m¬kH¬dGndCÏu£s
,

1057 
ŒackP¬’tCÏu£Wts
, 
mÊ
, 
domaš
, 
aLazy
);

1093 
Inã»nû
*& 
šã»nû
 = 
šã»nûs
[
i
];

1094 
Inã»nû
*& 
emInã»nû
 = 
emInã»nûs
[
i
];

1095 
boŞ
 
ŒackCÏu£TrueCÁs
 = 
Œue
;

1097 ià(
am­Pos
 || 
am­AÎ
)

1101 
mw¥¬ams
->
numSŞutiÚs
 = 1;

1102 
šã»nû
 = 
Ãw
 
	`MaxW®kS©
(
¡©e
, 
aS“d
, 
ŒackCÏu£TrueCÁs
,

1103 
mw¥¬ams
);

1104 ià(
w™hEM
)

1105 
emInã»nû
 = 
Ãw
 
	`MaxW®kS©
(
emS‹
, 
aS“d
, 
ŒackCÏu£TrueCÁs
,

1106 
mw¥¬ams
);

1108 ià(
amc§tInãr
)

1110 
šã»nû
 = 
Ãw
 
	`MCSAT
(
¡©e
, 
aS“d
, 
ŒackCÏu£TrueCÁs
, 
m¥¬ams
);

1111 ià(
w™hEM
)

1112 
emInã»nû
 = 
Ãw
 
	`MCSAT
(
emS‹
, 
aS“d
, 
ŒackCÏu£TrueCÁs
,

1113 
m¥¬ams
);

1115 ià(
asimInãr
)

1119 
mw¥¬ams
->
numSŞutiÚs
 = 1;

1120 
šã»nû
 = 
Ãw
 
	`SimuÏ‹dTem³ršg
(
¡©e
, 
aS“d
, 
ŒackCÏu£TrueCÁs
,

1121 
¡·¿ms
);

1122 ià(
w™hEM
)

1123 
emInã»nû
 = 
Ãw
 
	`SimuÏ‹dTem³ršg
(
emS‹
, 
aS“d
,

1124 
ŒackCÏu£TrueCÁs
, 
¡·¿ms
);

1126 ià(
agibbsInãr
)

1130 
mw¥¬ams
->
numSŞutiÚs
 = 1;

1131 
šã»nû
 = 
Ãw
 
	`GibbsSam¶”
(
¡©e
, 
aS“d
, 
ŒackCÏu£TrueCÁs
,

1132 
gibb¥¬ams
);

1133 ià(
w™hEM
)

1134 
emInã»nû
 = 
Ãw
 
	`GibbsSam¶”
(
emS‹
, 
aS“d
, 
ŒackCÏu£TrueCÁs
,

1135 
gibb¥¬ams
);

1138 ià(!
aLazy
)

1141 
domaš
->
	`g‘DB
()->
	`£tV®uesToGiv’V®ues
(
kÃP»ds
, 
kÃP»dV®ues
);

1145 
´edno
 = 0;…»dnØ< 
uÃP»ds
->
	`size
();…redno++)

1147 
domaš
->
	`g‘DB
()->
	`£tV®ue
((*
uÃP»ds
)[
´edno
], 
FALSE
);

1152 
domaš
->
	`g‘DB
()->
	`£tV®uesToGiv’V®ues
(&
g´eds
, &
g´edV®ues
);

1155 
´edno
 = 0;…»dnØ< 
g´eds
.
	`size
();…redno++)

1159 
d–‘e
 
g´eds
[
´edno
];

1162 
domaš
->
	`g‘DB
()->
	`£tP”fÜmšgInã»nû
(
Œue
);

1165 if(
aisLiáedGibbs
)

1167 
LvrP¬ams
* 
lP¬ams
 = 
Ãw
 
	`LvrP¬ams
();

1168 
lP¬ams
->
numChašs
 = 
amcmcNumChašs
;

1169 
lP¬ams
->
buºMšS‹ps
 = 
amcmcBuºMšS‹ps
;

1170 
lP¬ams
->
buºMaxS‹ps
 = 
amcmcBuºMaxS‹ps
;

1171 
lP¬ams
->
mšS‹ps
 = 
amcmcMšS‹ps
;

1172 
lP¬ams
->
maxS‹ps
 = 
amcmcMaxS‹ps
;

1173 
lP¬ams
->
maxSecÚds
 = 
amcmcMaxSecÚds
;

1174 
lP¬ams
->
®gÜ™hm
 = 
LVG
;

1176 if(
aIÅutClu¡”Fe
 !ğ
NULL
)

1177 
lP¬ams
->
šClu¡”Fe
 = 
aIÅutClu¡”Fe
;

1178 
šã»nû
 = 
Ãw
 
	`LBGInã»nû
(
¡©e
, 
aS“d
, 
Œue
,

1179 
lP¬ams
);

1205 
cout
 << 
’dl
 << "done constructing variable states" <<ƒndl <<ƒndl;

1207 ià(
u£VP
)

1208 
discM‘hod
 = 
Disüimš©iveL—º”
::
SIMPLE
;

1209 ià(
u£NewtÚ
)

1210 
discM‘hod
 = 
Disüimš©iveL—º”
::
DN
;

1212 
discM‘hod
 = 
Disüimš©iveL—º”
::
CG
;

1215 
Disüimš©iveL—º”
 
	`dl
(
šã»nûs
, 
nÚEvidP»dNames
, 
šdexT¿ns
, 
aLazy
,

1216 
w™hEM
, 
emInã»nûs
, !
noU£P”Weight
, 
discM‘hod
,

1217 
cg_Ïmbda
, !
cg_nİ»cÚd
, 
cg_max_Ïmbda
,

1218 
mš_Î_chªge
);

1220 ià(!
noPriÜ
)

1221 
dl
.
	`£tM—nsStdDevs
(
numCÏu£sFÜmuÏs
, 
´iÜM—ns
.
	`g‘I‹ms
(),

1222 
´iÜStdDevs
.
	`g‘I‹ms
());

1224 
dl
.
	`£tM—nsStdDevs
(-1, 
NULL
, NULL);

1226 
begSec
 = 
tim”
.
	`time
();

1227 
cout
 << "Ë¬nšg (disüimš©iveèweight .. " << 
’dl
;

1228 
maxTime
 = 
maxSec
 + 60*
maxMš
 + 3600*
maxHour
;

1229 
dl
.
	`Ë¬nWeights
(
wwts
, 
wts
.
	`size
()-1, 
numI‹r
, 
maxTime
, 
Ë¬nšgR©e
,

1230 
mom’tum
, 
š™W™hLogOdds
, 
amwsMaxSub£qu’tS‹ps
,

1231 
aP”iodicMLNs
);

1232 
cout
 << 
’dl
 <<ƒndl << "Done†earning discriminative weights. "<<ƒndl;

1233 
cout
 << "Time Taken for†earning = ";

1234 
Tim”
::
	`´štTime
(
cout
, (
tim”
.
	`time
(è- 
begSec
)); couˆ<< 
’dl
;

1236 ià(
mw¥¬ams
è
d–‘e
 mwsparams;

1237 ià(
s¥¬ams
è
d–‘e
 ssparams;

1238 ià(
m¥¬ams
è
d–‘e
 msparams;

1239 ià(
gibb¥¬ams
è
d–‘e
 gibbsparams;

1240 ià(
¡·¿ms
è
d–‘e
 stparams;

1241 
i
 = 0; i < 
šã»nûs
.
	`size
(); i++è
d–‘e
 inferences[i];

1242 
i
 = 0; i < 
¡©es
.
	`size
(); i++è
d–‘e
 states[i];

1248 
A¼ay
<
boŞ
> 
¬eNÚEvidP»ds
;

1249 ià(
nÚEvidP»dNames
.
	`em±y
())

1251 
¬eNÚEvidP»ds
.
	`growToSize
(
domašs
[0]->
	`g‘NumP»diÿ‹s
(), 
Œue
);

1252 
i
 = 0; i < 
domašs
[0]->
	`g‘NumP»diÿ‹s
(); i++)

1255 ià(
domašs
[0]->
	`g‘P»diÿ‹Tem¶©e
(
i
)->
	`isEqu®P»d
())

1257 cÚ¡ * 
²ame
 = 
domašs
[0]->
	`g‘P»diÿ‹Tem¶©e
(
i
)->
	`g‘Name
();

1258 
´edId
 = 
domašs
[0]->
	`g‘P»diÿ‹Id
(
²ame
);

1259 
¬eNÚEvidP»ds
[
´edId
] = 
çl£
;

1262 ià(
domašs
[0]->
	`g‘P»diÿ‹Tem¶©e
(
i
)->
	`isIÁ”ÇlP»diÿ‹Tem¶©e
())

1264 cÚ¡ * 
²ame
 = 
domašs
[0]->
	`g‘P»diÿ‹Tem¶©e
(
i
)->
	`g‘Name
();

1265 
´edId
 = 
domašs
[0]->
	`g‘P»diÿ‹Id
(
²ame
);

1266 
¬eNÚEvidP»ds
[
´edId
] = 
çl£
;

1272 
¬eNÚEvidP»ds
.
	`growToSize
(
domašs
[0]->
	`g‘NumP»diÿ‹s
(), 
çl£
);

1273 
i
 = 0; i < 
nÚEvidP»dNames
.
	`size
(); i++)

1275 
´edId
 = 
domašs
[0]->
	`g‘P»diÿ‹Id
(
nÚEvidP»dNames
[
i
].
	`c_¡r
());

1276 ià(
´edId
 < 0)

1278 
cout
 << "ERROR: P»diÿ‹ " << 
nÚEvidP»dNames
[
i
] << " undefined."

1279 << 
’dl
;

1280 
	`ex™
(-1);

1282 
¬eNÚEvidP»ds
[
´edId
] = 
Œue
;

1286 
A¼ay
<
boŞ
>* 
ÃP»ds
 = &
¬eNÚEvidP»ds
;

1287 
P£udoLogLik–ihood
 
	`¶l
(
ÃP»ds
, &
domašs
, !
noEqu®P»dWt
, 
çl£
,-1,-1,-1);

1288 
¶l
.
	`£tIndexT¿n¦©Ü
(
šdexT¿ns
);

1290 ià(!
noPriÜ
)

1291 
¶l
.
	`£tM—nsStdDevs
(
numCÏu£sFÜmuÏs
, 
´iÜM—ns
.
	`g‘I‹ms
(),

1292 
´iÜStdDevs
.
	`g‘I‹ms
());

1294 
¶l
.
	`£tM—nsStdDevs
(-1, 
NULL
, NULL);

1296 
¶l
.
	`£tLockedWts
(
lockedWts
.
	`g‘I‹ms
());

1300 
begSec
 = 
tim”
.
	`time
();

1301 
A¼ay
<
boŞ
> 
wtsW™hT›dCÏu£s
;

1302 
wtsW™hT›dCÏu£s
.
	`growToSize
(
numCÏu£sFÜmuÏs
 + 1, 
çl£
);

1303 
numWts
 = 0;

1304 
m
 = 0; m < 
mÊs
.
	`size
(); m++)

1306 
cout
 << "Computšg couÁ fÜ cÏu£ š domaš " << 
m
 << "..." << 
’dl
;

1322 cÚ¡ 
CÏu£HashA¼ay
* 
şau£s
 = 
mÊs
[
m
]->
	`g‘CÏu£s
();

1323 cÚ¡ 
A¼ay
<
MLNCÏu£Info
*>* 
şau£Infos
 = 
mÊs
[
m
]->
	`g‘MLNCÏu£Infos
();

1324 cÚ¡ 
FÜmuÏAndCÏu£sA¼ay
* 
çcs
 = 
mÊs
[
m
]->
	`g‘FÜmuÏAndCÏu£sA¼ay
();

1325 
i
 = 0; i < 
şau£Infos
->
	`size
(); i++)

1327 
MLNCÏu£Info
* 
ci
 = (*
şau£Infos
)[
i
];

1328 ià(
PRINT_CLAUSE_DURING_COUNT
)

1330 
cout
 << "şau£ " << 
i
 << ": ";

1331 (*
şau£s
)[
i
]->
	`´štW™houtWt
(
cout
, 
domašs
[
m
]);

1332 
cout
 << 
’dl
; cout.
	`æush
();

1335 
A¼ay
<
FÜmuÏCÏu£Indexes
*>& 
fciA¼
 = 
ci
->
fÜmuÏCÏu£Indexes
;

1336 
fidx
 = *(
fciA¼
[0]->
fÜmuÏIndex
);

1337 
cidx
 = *(
fciA¼
[0]->
şau£Index
);

1338 
FÜmuÏAndCÏu£s
* 
çc
 = (*
çcs
)[
fidx
];

1342 ià(
çc
->
t›dCÏu£s
)

1344 
cout
<< "t›dşau£s..." <<
’dl
;

1345 ià(
cidx
 == 0)

1347 ià(
m
 == 0)

1349 
numWts
++;

1350 
wtsW™hT›dCÏu£s
[
i
+1] = 
Œue
;

1352 
A¼ay
<
CÏu£
*>* 
t›dCÏu£s
 = 
Ãw
 Array<Clause*>;

1353 
IndexCÏu£HashA¼ay
* 
šdexCÏu£s
 = 
çc
->indexClauses;

1354 
c
 = 1; c < 
šdexCÏu£s
->
	`size
(); c++)

1355 
t›dCÏu£s
->
	`­³nd
((*
šdexCÏu£s
)[
c
]->
şau£
);

1356 
cout
<<"1ÿÎšg…Î.compu‹CouÁsFÜNewAµ’dedCÏu£..."<<(
ci
->
šdex
)<<
’dl
;

1357 
¶l
.
	`compu‹CouÁsFÜNewAµ’dedCÏu£
((*
şau£s
)[
i
], &(
ci
->
šdex
),

1358 
m
, 
NULL
, 
çl£
, NULL,

1359 
t›dCÏu£s
);

1360 
cout
<<"1dÚÿÎšg…Î.compu‹CouÁsFÜNewAµ’dedCÏu£..."<<
’dl
;

1361 
d–‘e
 
t›dCÏu£s
;

1366 ià(
m
 == 0)

1368 
numWts
++;

1369 
wtsW™hT›dCÏu£s
[
i
+1] = 
Œue
;

1371 
û¼
<<"2ÿÎšg…Î.compu‹CouÁsFÜNewAµ’dedCÏu£..."<<(
ci
->
šdex
)<<
’dl
;

1372 
¶l
.
	`compu‹CouÁsFÜNewAµ’dedCÏu£
((*
şau£s
)[
i
], &(
ci
->
šdex
), 
m
,

1373 
NULL
, 
çl£
, NULL, NULL);

1374 
û¼
<<"2dÚÿÎšg…Î.compu‹CouÁsFÜNewAµ’dedCÏu£..."<<
’dl
;

1380 
¶l
.
	`com´ess
();

1381 
cout
 <<"Computing countsook ";

1382 
Tim”
::
	`´štTime
(
cout
, 
tim”
.
	`time
(è- 
begSec
); couˆ<< 
’dl
;

1387 
wts
.
	`growToSize
(1);

1388 
wts
.
	`­³nd
(0.0);

1389 
numNÚLockedWts
 = 
numWts
;

1390 
i
 = 0; i < 
numWts
; i++)

1392 ià(
noPriÜ
)

1394 
wts
.
	`growToSize
(wts.
	`size
() + 1);

1395 
wts
[
i
+1] = 0;

1399 ià(
lockedWts
[
i
]è
numNÚLockedWts
--;

1402 
wts
.
	`growToSize
(wts.
	`size
() + 1);

1403 
wts
[
i
+1] = 0;

1409 
cout
 << "L-BFGS-B i fšdšg o±im® weights......" << 
’dl
;

1410 
begSec
 = 
tim”
.
	`time
();

1412 
LBFGSB
 
	`lbfgsb
(
maxI‹r
, 
cÚvTh»sh
, &
¶l
, 
numNÚLockedWts
);

1413 
™”
;

1414 
boŞ
 
”rÜ
;

1415 
¶lV®ue
 = 
lbfgsb
.
	`mšimize
((*)
wts
.
	`g‘I‹ms
(), 
™”
, 
”rÜ
);

1417 ià(
”rÜ
è
cout
 << "LBFGSB„‘uºed w™h‡À”rÜ!" << 
’dl
;

1418 
cout
 << "num i‹¿tiÚ  = " << 
™”
 << 
’dl
;

1419 
cout
 << "timeaken = ";

1420 
Tim”
::
	`´štTime
(
cout
, 
tim”
.
	`time
(è- 
begSec
);

1421 
cout
 << 
’dl
;

1422 
cout
 << "p£udo-log-lik–ihood = " << -
¶lV®ue
 << 
’dl
;

1425 
wts
.
	`growToSize
(
numCÏu£sFÜmuÏs
 + 1);

1426 
A¼ay
<> 
wtsAá”T›dCÏu£s
;

1427 
wtsAá”T›dCÏu£s
.
	`growToSize
(
numCÏu£sFÜmuÏs
 + 1);

1428 
idxOff£t
 = 0;

1429 
w
 = 1; w < 
wtsAá”T›dCÏu£s
.
	`size
(); w++)

1431 ià(
wtsW™hT›dCÏu£s
[
w
])

1433 
wtsAá”T›dCÏu£s
[
w
] = 
wts
[w - 
idxOff£t
];

1434 
idxOff£t
 = 0;

1438 
wtsAá”T›dCÏu£s
[
w
] = 0.0;

1439 
idxOff£t
++;

1442 
w
 = 1; w < 
wtsAá”T›dCÏu£s
.
	`size
(); w++)

1444 
wts
[
w
] = 
wtsAá”T›dCÏu£s
[w];

1449 ià(
šdexT¿ns
è
	`assignWtsAndOuutMLN
(
out
, 
mÊs
, 
domašs
, 
wts
, indexTrans);

1450 
	`assignWtsAndOuutMLN
(
out
, 
mÊs
, 
domašs
, 
wts
);

1452 
out
.
	`şo£
();

1455 
	`d–‘eDomašs
(
domašs
);

1457 
i
 = 0; i < 
mÊs
.
	`size
(); i++)

1459 ià(
DOMAINS_SHARE_DATA_STRUCT
 && 
i
 > 0)

1461 
mÊs
[
i
]->
	`£tCÏu£s
(
NULL
);

1462 
mÊs
[
i
]->
	`£tMLNCÏu£Infos
(
NULL
);

1463 
mÊs
[
i
]->
	`£tP»dIdToCÏu£sM­
(
NULL
);

1464 
mÊs
[
i
]->
	`£tFÜmuÏAndCÏu£sA¼ay
(
NULL
);

1465 
mÊs
[
i
]->
	`£tEx‹º®CÏu£
(
NULL
);

1467 
d–‘e
 
mÊs
[
i
];

1470 
Pow”S‘
::
	`d–‘ePow”S‘
();

1471 ià(
šdexT¿ns
è
d–‘e
 indexTrans;

1473 
cout
 << "Totalime = ";

1474 
Tim”
::
	`´štTime
(
cout
, 
tim”
.
	`time
(è- 
¡¬tSec
); couˆ<< 
’dl
;

1475 
	}
}

	@learnwts.h

67 #iâdeà
LEARNWTS_H_NOV_23_2005


68 
	#LEARNWTS_H_NOV_23_2005


	)

70 
	~<sys/time.h
>

71 
	~"ut.h
"

72 
	~"tim”.h
"

73 
	~"fŞ.h
"

74 
	~"mÊ.h
"

75 
	~"šdexŒª¦©Ü.h
"

78 cÚ¡ * 
ZZ_TMP_FILE_POSTFIX
;

79 cÚ¡ 
boŞ
 
	gDOMAINS_SHARE_DATA_STRUCT
 = 
Œue
;

88 
exŒaùFeNames
(cÚ¡ * cÚ¡ & 
ÇmesSŒ
, 
A¼ay
<
¡ršg
>& 
ÇmesA¼ay
)

90 ià(
	gÇmesSŒ
 =ğ
NULL
) ;

91 
¡ršg
 
s
(
ÇmesSŒ
);

92 
	gs
 = 
Ut
::
Œim
(
s
);

93 ià(
	gs
.
Ëngth
() == 0) ;

94 
	gs
.
­³nd
(",");

95 
	g¡ršg
::
size_ty³
 
cur
 = 0;

96 
	g¡ršg
::
size_ty³
 
comma
;

97 
¡ršg
 
	gÇme
;

98 
	gŒue
)

100 
	gcomma
 = 
s
.
fšd
(",", 
cur
);

101 ià(
	gcomma
 =ğ
¡ršg
::
Åos
) ;

102 
	gÇme
 = 
s
.
sub¡r
(
cur
, 
comma
-cur);

103 
	gÇmesA¼ay
.
­³nd
(
Çme
);

104 
	gcur
 = 
comma
+1;

115 
	$exŒaùArgs
(cÚ¡ * cÚ¡ & 
¬gsSŒ
, & 
¬gc
, ** 
¬gv
)

117 
¬gc
 = 0;

118 ià(
¬gsSŒ
 =ğ
NULL
) ;

119 
¡ršg
 
	`s
(
¬gsSŒ
);

120 
s
 = 
Ut
::
	`Œim
(s);

121 ià(
s
.
	`Ëngth
() == 0) ;

122 
s
.
	`­³nd
(" ");

123 
¡ršg
::
size_ty³
 
cur
 = 0;

124 
¡ršg
::
size_ty³
 
bÏnk
;

125 
¡ršg
 
¬g
;

127 
Œue
)

129 
bÏnk
 = 
s
.
	`fšd
(" ", 
cur
);

130 ià(
bÏnk
 =ğ
¡ršg
::
Åos
) ;

131 
¬g
 = 
s
.
	`sub¡r
(
cur
, 
bÏnk
-cur);

132 
¬g
 = 
Ut
::
	`Œim
(arg);

133 
	`mem£t
(
¬gv
[
¬gc
], '\0', 500);

134 
¬g
.
	`cİy
(
¬gv
[
¬gc
],‡rg.
	`Ëngth
());

135 
¬gc
++;

136 
cur
 = 
bÏnk
 + 1;

138 
	}
}

140 
ü—‹DomašAndMLN
(
A¼ay
<
Domaš
*>& 
domašs
, A¼ay<
MLN
*>& 
mÊs
,

141 cÚ¡ 
¡ršg
& 
šMLNFe
, 
o¡ršg¡»am
& 
cÚ¡Fes
,

142 
o¡ršg¡»am
& 
dbFes
,

143 cÚ¡ 
SŒšgHashA¼ay
* cÚ¡ & 
nÚEvidP»dNames
,

144 cÚ¡ 
boŞ
& 
addUn™CÏu£s
, cÚ¡ & 
´iÜM—n
,

145 cÚ¡ 
boŞ
& 
checkPlusTy³s
, cÚ¡ boŞ& 
mwsLazy
,

146 cÚ¡ 
boŞ
& 
®lP»dsExû±Qu”›sA»CW
,

147 cÚ¡ 
SŒšgHashA¼ay
* cÚ¡ & 
owP»dNames
,

148 cÚ¡ 
SŒšgHashA¼ay
* cÚ¡ & 
cwP»dNames
)

150 
	g¡ršg
::
size_ty³
 
b¦ash
 = 
šMLNFe
.
rfšd
("/");

151 
¡ršg
 
	gtmp
 = (
b¦ash
 =ğ¡ršg::
Åos
) ?

152 
šMLNFe
:šMLNFe.
sub¡r
(
b¦ash
+1,šMLNFe.
Ëngth
()-bslash-1);

153 
	gtmpInMLN
[100];

154 
¥rštf
(
tmpInMLN
, "%s%d%s", 
tmp
.
c_¡r
(), 
g‘pid
(), 
ZZ_TMP_FILE_POSTFIX
);

156 
of¡»am
 
out
(
tmpInMLN
);

157 
if¡»am
 
š
(
šMLNFe
.
c_¡r
());

158 ià(!
	gout
.
good
()è{ 
	gcout
<<"ERROR: faedØİ’ "<<
	gtmpInMLN
 <<
	g’dl
; 
ex™
(-1);}

159 ià(!
	gš
.
good
()è{ 
	gcout
<<"ERROR: faedØİ’ "<<
	gšMLNFe
<<
	g’dl
; 
ex™
(-1);}

161 
¡ršg
 
	gbufãr
;

162 
g‘lše
(
š
, 
bufãr
)è
	gout
 << 
	gbufãr
 << 
	g’dl
;

163 
	gš
.
şo£
();

165 
	gout
 << 
	gcÚ¡Fes
.
¡r
(è<< 
	g’dl


166 << 
	gdbFes
.
¡r
(è<< 
	g’dl
;

167 
	gout
.
şo£
();

170 
Domaš
* 
	gdomaš
 = 
Ãw
 Domain;

171 
MLN
* 
	gmÊ
 = 
Ãw
 MLN();

174 
boŞ
 
	gw¬nAboutDupGndP»ds
 = 
Œue
;

175 
boŞ
 
	gmu¡HaveWtOrFuÎStİ
 = 
çl£
;

176 
boŞ
 
	gæWtsOfFl³dCÏu£
 = 
çl£
;

177 
Domaš
* 
	gdomaš0
 = (
checkPlusTy³s
è? 
domašs
[0] : 
NULL
;

179 
boŞ
 
	gok
 = 
runYYP¬£r
(
mÊ
, 
domaš
, 
tmpInMLN
, 
®lP»dsExû±Qu”›sA»CW
,

180 
owP»dNames
, 
cwP»dNames
, 
nÚEvidP»dNames
,

181 
addUn™CÏu£s
, 
w¬nAboutDupGndP»ds
, 
´iÜM—n
,

182 
mu¡HaveWtOrFuÎStİ
, 
domaš0
, 
mwsLazy
,

183 
æWtsOfFl³dCÏu£
);

185 
uÆšk
(
tmpInMLN
);

186 ià(!
	gok
è
ex™
(-1);

187 
	gdomašs
.
­³nd
(
domaš
);

188 
	gmÊs
.
­³nd
(
mÊ
);

192 
ü—‹DomašsAndMLNs
(
A¼ay
<
Domaš
*>& 
domašs
, A¼ay<
MLN
*>& 
mÊs
,

193 cÚ¡ 
boŞ
& 
muÉËD©aba£s
,

194 cÚ¡ 
¡ršg
& 
šMLNFe
,

195 cÚ¡ 
A¼ay
<
¡ršg
>& 
cÚ¡FesA¼
,

196 cÚ¡ 
A¼ay
<
¡ršg
>& 
dbFesA¼
,

197 cÚ¡ 
SŒšgHashA¼ay
* cÚ¡ & 
nÚEvidP»dNames
,

198 cÚ¡ 
boŞ
& 
addUn™CÏu£s
, cÚ¡ & 
´iÜM—n
,

199 cÚ¡ 
boŞ
& 
mwsLazy
,

200 cÚ¡ 
boŞ
& 
®lP»dsExû±Qu”›sA»CW
,

201 cÚ¡ 
SŒšgHashA¼ay
* cÚ¡ & 
owP»dNames
,

202 cÚ¡ 
SŒšgHashA¼ay
* cÚ¡ & 
cwP»dNames
)

204 ià(!
	gmuÉËD©aba£s
)

206 
o¡ršg¡»am
 
	gcÚ¡FesSŒ—m
, 
	gdbFesSŒ—m
;

207 
	gi
 = 0; i < 
	gcÚ¡FesA¼
.
size
(); i++)

208 
	gcÚ¡FesSŒ—m
 << "#šşud\"" << 
	gcÚ¡FesA¼
[
i
] << "\"" << 
	g’dl
;

209 
	gi
 = 0; i < 
	gdbFesA¼
.
size
(); i++)

210 
	gdbFesSŒ—m
 << "#šşud\"" << 
	gdbFesA¼
[
i
] << "\"" << 
	g’dl
;

211 
ü—‹DomašAndMLN
(
domašs
, 
mÊs
, 
šMLNFe
, 
cÚ¡FesSŒ—m
,

212 
dbFesSŒ—m
, 
nÚEvidP»dNames
,

213 
addUn™CÏu£s
, 
´iÜM—n
, 
çl£
, 
mwsLazy
,

214 
®lP»dsExû±Qu”›sA»CW
, 
owP»dNames
, 
cwP»dNames
);

218 
	gi
 = 0; i < 
	gdbFesA¼
.
size
(); i++)

220 
	gcout
 << "·rsšg MLN‡nd c»©šg domaš " << 
	gi
 << "..." << 
	g’dl
;

221 
o¡ršg¡»am
 
	gcÚ¡FesSŒ—m
, 
	gdbFesSŒ—m
;

222 ià(
	gcÚ¡FesA¼
.
size
() > 0)

223 
	gcÚ¡FesSŒ—m
 << "#šşud\"" << 
	gcÚ¡FesA¼
[
i
] << "\"" << 
	g’dl
;

224 
	gdbFesSŒ—m
 << "#šşud\"" << 
	gdbFesA¼
[
i
] << "\"" << 
	g’dl
;

226 
boŞ
 
	gcheckPlusTy³s
 = (
i
 > 0);

228 
ü—‹DomašAndMLN
(
domašs
, 
mÊs
, 
šMLNFe
, 
cÚ¡FesSŒ—m
,

229 
dbFesSŒ—m
, 
nÚEvidP»dNames
,

230 
addUn™CÏu£s
, 
´iÜM—n
, 
checkPlusTy³s
, 
mwsLazy
,

231 
®lP»dsExû±Qu”›sA»CW
, 
owP»dNames
, 
cwP»dNames
);

233 
	gcout
<<"Prštšg MLNs..."<<
	g’dl
;

236 ià(
	gDOMAINS_SHARE_DATA_STRUCT
 && 
	gi
 > 0)

240 
	gnumTy³s
 = 
domašs
[
i
]->
g‘NumTy³s
();

241 
	gj
 = 0; j < 
	gnumTy³s
; j++)

243 cÚ¡ * 
	gty³Name
 = 
domašs
[
i
]->
g‘Ty³Name
(
j
);

244 cÚ¡ 
	gA¼ay
<>* 
	gcÚ¡ªtsByTy³
 = 
domašs
[
i
]->
g‘CÚ¡ªtsByTy³
(
j
);

245 
	gk
 = 0; k < 
	gcÚ¡ªtsByTy³
->
size
(); k++)

247 cÚ¡ * 
	gcÚ¡ªtName
 =

248 
domašs
[
i
]->
g‘CÚ¡ªtName
((*
cÚ¡ªtsByTy³
)[
k
]);

250 ià(!
	gdomašs
[0]->
isCÚ¡ªt
(
cÚ¡ªtName
))

252 
	gdomašs
[0]->
addEx‹º®CÚ¡ªt
(
cÚ¡ªtName
, 
ty³Name
);

258 cÚ¡ 
CÏu£HashA¼ay
* 
	gÿ¼
 = 
mÊs
[
i
]->
g‘CÏu£s
();

259 
	gj
 = 0; j < 
	gÿ¼
->
size
(); j++)

261 
CÏu£
* 
	gc
 = (*
ÿ¼
)[
j
];

264 
	gk
 = 0; k < 
	gc
->
g‘NumP»diÿ‹s
(); k++)

266 
P»diÿ‹
* 
	gp
 = 
c
->
g‘P»diÿ‹
(
k
);

267 cÚ¡ 
P»diÿ‹Tem¶©e
* 
	gt


268 ğ
domašs
[0]->
g‘P»diÿ‹Tem¶©e
(
p
->
g‘Name
());

269 
as£¹
(
t
);

270 
	gp
->
£tTem¶©e
((
P»diÿ‹Tem¶©e
*)
t
);

275 ((
	gDomaš
*)
	gdomašs
[
i
])->
»¶aûTy³Du®M­
((

276 
Du®M­
*)
domašs
[0]->
g‘Ty³Du®M­
());

282 ((
	gDomaš
*)
	gdomašs
[
i
])->
»¶aûSŒToFuncTem¶©eM­AndFuncDu®M­
(

283 (
SŒToFuncTem¶©eM­
*è
domašs
[0]->
g‘SŒToFuncTem¶©eM­
(),

284 (
Du®M­
*è
domašs
[0]->
g‘FuncDu®M­
());

285 ((
	gDomaš
*)
	gdomašs
[
i
])->
»¶aûEqu®P»dTem¶©e
(

286 (
P»diÿ‹Tem¶©e
*)
domašs
[0]->
g‘Equ®P»dTem¶©e
());

287 ((
	gDomaš
*)
	gdomašs
[
i
])->
»¶aûFuncS‘
(

288 (
FunùiÚS‘
*)
domašs
[0]->
g‘FuncS‘
());

294 
	gdomašs
[0]->
»Üd”CÚ¡ªts
(
mÊs
[0]);

295 
	gi
 = 1; i < 
	gdomašs
.
size
(); i++)

297 ((
	gDomaš
*)
	gdomašs
[
i
])->
»Üd”CÚ¡ªts
(

298 (
CÚ¡Du®M­
*)
domašs
[0]->
g‘CÚ¡Du®M­
(),

299 (
A¼ay
<A¼ay<>*>*)
domašs
[0]->
g‘CÚ¡ªtsByTy³
(),

300 (
A¼ay
<A¼ay<>*>*)
domašs
[0]->
g‘Ex‹º®CÚ¡ªtsByTy³
(),

301 
mÊs
[
i
]);

306 
	gA¼ay
<A¼ay<
	gboŞ
>*>* 
	gex‹º®CÏu£sP”MLN
 = 
Ãw
 
A¼ay
<A¼ay<
boŞ
>*>;

307 
	gex‹º®CÏu£sP”MLN
->
growToSize
(
mÊs
.
size
());

308 (*
	gex‹º®CÏu£sP”MLN
)[0] = 
Ãw
 
A¼ay
<
boŞ
>;

309 (*
	gex‹º®CÏu£sP”MLN
)[0]->
growToSize
(
mÊs
[0]->
g‘NumCÏu£s
(), 
çl£
);

310 
	gi
 = 1; i < 
	gmÊs
.
size
(); i++)

312 cÚ¡ 
CÏu£HashA¼ay
* 
	gÿ¼
 = 
mÊs
[
i
]->
g‘CÏu£s
();

313 (*
	gex‹º®CÏu£sP”MLN
)[
i
] = 
Ãw
 
A¼ay
<
boŞ
>;

314 
	gj
 = 0; j < 
	gÿ¼
->
size
(); j++)

316 
CÏu£
* 
	gc
 = (*
ÿ¼
)[
j
];

317 ià(!
	gmÊs
[0]->
cÚšsCÏu£
(
c
))

319 
¡ršg
 
	gfÜmuÏSŒšg
 = 
mÊs
[
i
]->
g‘P¬’tFÜmuÏ
(
j
, 0);

320 
boŞ
 
	ghasExi¡
 = 
mÊs
[
i
]->
isExi¡CÏu£
(
j
);

321 ià(
	gmÊs
[0]->
­³ndEx‹º®CÏu£
(
fÜmuÏSŒšg
, 
hasExi¡
,

322 
Ãw
 
CÏu£
(*
c
), 
domašs
[0], 
çl£
,

323 
çl£
, false))

325 (*
	gex‹º®CÏu£sP”MLN
)[0]->
­³nd
(
çl£
);

331 cÚ¡ 
CÏu£HashA¼ay
* 
	gÿ¼
 = 
mÊs
[0]->
g‘CÏu£s
();

332 
	gj
 = 0; j < 
	gÿ¼
->
size
(); j++)

334 
CÏu£
* 
	gc
 = (*
ÿ¼
)[
j
];

337 
	gk
 = 1; k < 
	gmÊs
.
size
(); k++)

339 ià(
	gmÊs
[
k
]->
cÚšsCÏu£
(
c
))

340 (*
	gex‹º®CÏu£sP”MLN
)[
k
]->
­³nd
(
çl£
);

342 (*
	gex‹º®CÏu£sP”MLN
)[
k
]->
­³nd
(
Œue
);

346 
	gi
 = 1; i < 
	gmÊs
.
size
(); i++)

348 
	gmÊs
[
i
]->
»¶aûCÏu£s
(
Ãw


349 
CÏu£HashA¼ay
(*(CÏu£HashA¼ay*)
mÊs
[0]->
g‘CÏu£s
()));

350 
	gmÊs
[
i
]->
»¶aûMLNCÏu£Infos
(
Ãw


351 
A¼ay
<
MLNCÏu£Info
*>(*(A¼ay<MLNCÏu£Info*>*)
mÊs
[0]->

352 
g‘MLNCÏu£Infos
()));

353 
	gmÊs
[
i
]->
»¶aûP»dIdToCÏu£sM­
(
Ãw


354 
A¼ay
<A¼ay<
IndexCÏu£
*>*>(*(A¼ay<A¼ay<IndexCÏu£*>*>*)
mÊs
[0]->

355 
g‘P»dIdToCÏu£sM­
()));

356 
	gmÊs
[
i
]->
»¶aûFÜmuÏAndCÏu£sA¼ay
(
Ãw


357 
FÜmuÏAndCÏu£sA¼ay
(*(FÜmuÏAndCÏu£sA¼ay*)
mÊs
[0]->

358 
g‘FÜmuÏAndCÏu£sA¼ay
()));

359 
	gmÊs
[
i
]->
»¶aûEx‹º®CÏu£
((*
ex‹º®CÏu£sP”MLN
)[i]);

362 
d–‘e
 
	gex‹º®CÏu£sP”MLN
;

364 
	gi
 = 1; i < 
	gmÊs
.
size
(); i++)

365 
	gmÊs
[
i
]->
»hashCÏu£s
();

376 
assignWtsAndOuutMLN
(
o¡»am
& 
out
, 
A¼ay
<
MLN
*>& 
mÊs
,

377 
A¼ay
<
Domaš
*>& 
domašs
, cÚ¡ A¼ay<>& 
wts
,

378 
IndexT¿n¦©Ü
* cÚ¡& 
šdexT¿ns
)

382 * 
	gwwts
 = (*è
wts
.
g‘I‹ms
();

383 
	gšdexT¿ns
->
assignNÚT›dCÏu£WtsToMLNs
(++
wwts
);

387 
	gout
 << "//´ediÿ‹ deş¬©iÚs" << 
	g’dl
;

388 
	gdomašs
[0]->
´štP»diÿ‹Tem¶©es
(
out
);

389 
	gout
 << 
	g’dl
;

392 ià(
	gdomašs
[0]->
g‘NumFunùiÚs
() > 0)

394 
	gout
 << "//funùiÚ deş¬©iÚs" << 
	g’dl
;

395 
	gdomašs
[0]->
´štFunùiÚTem¶©es
(
out
);

396 
	gout
 << 
	g’dl
;

399 
	gmÊs
[0]->
´štMLNNÚExi¡FÜmuÏs
(
out
, 
domašs
[0]);

401 cÚ¡ 
CÏu£HashA¼ay
* 
	gşau£Ord”šg
 = 
šdexT¿ns
->
g‘CÏu£Ord”šg
();

402 cÚ¡ 
SŒšgHashA¼ay
* 
	gexFÜmOrd”šg
 = 
šdexT¿ns
->
g‘Exi¡FÜmuÏOrd”šg
();

403 
	gi
 = 0; i < 
	gexFÜmOrd”šg
->
size
(); i++)

406 
	gout
.
width
(0); out << "// "; out.width(6);

407 
	gout
 << 
	gwts
[1+
şau£Ord”šg
->
size
()+
i
] << " " <<(*
	gexFÜmOrd”šg
)[i]<<
	g’dl
;

408 
	gout
 << 
	gwts
[1+
şau£Ord”šg
->
size
()+
i
] << " " <<(*
	gexFÜmOrd”šg
)[i]<<
	g’dl
;

409 
	gout
 << 
	g’dl
;

414 
assignWtsAndOuutMLN
(
o¡»am
& 
out
, 
A¼ay
<
MLN
*>& 
mÊs
,

415 
A¼ay
<
Domaš
*>& 
domašs
, cÚ¡ A¼ay<>& 
wts
)

418 
	gi
 = 0; i < 
	gmÊs
.
size
(); i++)

420 
MLN
* 
	gmÊ
 = 
mÊs
[
i
];

421 cÚ¡ 
CÏu£HashA¼ay
* 
	gşau£s
 = 
mÊ
->
g‘CÏu£s
();

422 
	gj
 = 0; j < 
	gşau£s
->
size
(); j++)

423 (*
	gşau£s
)[
j
]->
£tWt
(
wts
[j+1]);

426 
	gi
 = 0; i < 
	gmÊs
.
size
(); i++)

428 
MLN
* 
	gmÊ
 = 
mÊs
[
i
];

429 
Domaš
* 
	gdomaš
 = 
domašs
[
i
];

430 cÚ¡ 
	gA¼ay
<
	gCÏu£
*>* 
	ghşau£s
 = 
mÊ
->
g‘HybridCÏu£s
();

431 
	gj
 = 0; j < 
	ghşau£s
->
size
(); j++)

433 
	gv¬Ÿnû
 = 
mÊ
->
g‘HybridCÏu£V¬Ÿnû
(
j
, 
domaš
);

434 
	gw
 = 1.0/(2.0*
v¬Ÿnû
);

435 (*
	ghşau£s
)[
j
]->
£tWt
(
w
);

440 
	gout
 << "//´ediÿ‹ deş¬©iÚs" << 
	g’dl
;

441 
	gdomašs
[0]->
´štP»diÿ‹Tem¶©es
(
out
);

442 
	gout
 << 
	g’dl
;

445 ià(
	gdomašs
[0]->
g‘NumFunùiÚs
() > 0)

448 
	gout
 << "//funùiÚ deş¬©iÚs" << 
	g’dl
;

449 
	gdomašs
[0]->
´štFunùiÚTem¶©es
(
out
);

450 
	gout
 << 
	g’dl
;

452 
	gmÊs
[0]->
´štMLN
(
out
, 
domašs
[0]);

456 
d–‘eDomašs
(
A¼ay
<
Domaš
*>& 
domašs
)

458 
	gi
 = 0; i < 
	gdomašs
.
size
(); i++)

460 ià(
	gDOMAINS_SHARE_DATA_STRUCT
 && 
	gi
 > 0)

462 ((
	gDomaš
*)
	gdomašs
[
i
])->
£tTy³Du®M­
(
NULL
);

463 ((
	gDomaš
*)
	gdomašs
[
i
])->
£tSŒToP»dTem¶©eM­AndP»dDu®M­
(
NULL
, NULL);

464 ((
	gDomaš
*)
	gdomašs
[
i
])->
£tSŒToFuncTem¶©eM­AndFuncDu®M­
(
NULL
, NULL);

465 ((
	gDomaš
*)
	gdomašs
[
i
])->
£tEqu®P»dTem¶©e
(
NULL
);

466 ((
	gDomaš
*)
	gdomašs
[
i
])->
£tFuncS‘
(
NULL
);

469 ((
	gDomaš
*)
	gdomašs
[
i
])->
£tCÚ¡Du®M­
(
NULL
);

470 ((
	gDomaš
*)
	gdomašs
[
i
])->
£tCÚ¡ªtsByTy³
(
NULL
);

472 
d–‘e
 
	gdomašs
[
i
];

	@pseudologlikelihood.h

67 #iâdeà
LOGPSEUDOLIKELIHOOD_H_AUG_18_2005


68 
	#LOGPSEUDOLIKELIHOOD_H_AUG_18_2005


	)

70 
	~<cm©h
>

71 
	~"¬¿y.h
"

72 
	~"¿ndom.h
"

73 
	~"domaš.h
"

74 
	~"şau£.h
"

75 
	~"mÊ.h
"

76 
	~"šdexŒª¦©Ü.h
"

81 #iâdeà
ex¶


82 
	#ex¶
 
exp


	)

83 
	#logl
 
log


	)

90 cÚ¡ 
boŞ
 
	gDB_HAS_UNKNOWN_PREDS
 = 
çl£
;

92 
	sIndexAndCouÁ


94 
IndexAndCouÁ
(è: 
šdex
(
NULL
), 
couÁ
(0) {}

95 
IndexAndCouÁ
(* cÚ¡ & 
i
, cÚ¡ & 
c
è: 
šdex
(i), 
couÁ
(c) {}

96 * 
	mšdex
;

97 
	mcouÁ
;

101 
	sUndoInfo


103 
UndoInfo
(
A¼ay
<
IndexAndCouÁ
*>* cÚ¡ & 
affA¼
,

104 
IndexAndCouÁ
* cÚ¡ & 
Ÿc
, cÚ¡ & 
»mIdx
, cÚ¡ & 
domIdx
)

105 : 
afãùedA¼
(
affA¼
), 
»mIac
(
Ÿc
), 
»mIacIdx
(
»mIdx
), 
domašIdx
(
domIdx
) {}

106 ~
UndoInfo
(è{ià(
	m»mIac
è
d–‘e
„emIac; }

107 
	mA¼ay
<
	mIndexAndCouÁ
*>* 
	mafãùedA¼
;

108 
IndexAndCouÁ
* 
	m»mIac
;

109 
	m»mIacIdx
;

110 
	mdomašIdx
;

114 
	sSam¶edGndšgs


116 
IÁHashA¼ay
 
	mŒueGndšgs
;

117 
IÁHashA¼ay
 
	mçl£Gndšgs
;

118 
	mtÙ®True
;

119 
	mtÙ®F®£
;

126 şas 
	cP£udoLogLik–ihood


128 
	mpublic
:

129 
P£udoLogLik–ihood
(cÚ¡ 
A¼ay
<
boŞ
>* cÚ¡ & 
¬eNÚEvidP»ds
,

130 cÚ¡ 
A¼ay
<
Domaš
*>* cÚ¡ & 
domašs
,

131 cÚ¡ 
boŞ
& 
wtFOP»d
, cÚ¡ boŞ& 
§m¶eGndP»ds
,

132 cÚ¡ & 
äaùiÚ
, cÚ¡ & 
mšGndP»dSam¶es
,

133 cÚ¡ & 
maxGndP»dSam¶es
)

134 : 
domašs_
(
Ãw
 
A¼ay
<
Domaš
*>è, 
numM—ns_
(-1),

135 
´iÜM—ns_
(
NULL
), 
´iÜStdDevs_
(NULL), 
lockedWts_
(NULL),

136 
wtFOP»d_
(
wtFOP»d
), 
§m¶eGndP»ds_
(
§m¶eGndP»ds
), 
	$idxT¿ns_
(
NULL
)

139 ià(
¬eNÚEvidP»ds
)

141 
¬eNÚEvidP»ds_
 = 
Ãw
 
A¼ay
<
boŞ
>(*
¬eNÚEvidP»ds
);

142 
	`as£¹
(
¬eNÚEvidP»ds_
->
	`size
(è=ğ(*
domašs
)[0]->
	`g‘NumP»diÿ‹s
());

146 
¬eNÚEvidP»ds_
 = 
Ãw
 
A¼ay
<
boŞ
>;

147 
¬eNÚEvidP»ds_
->
	`growToSize
((*
domašs
)[0]->
	`g‘NumP»diÿ‹s
(), 
Œue
);

150 
numDomašs
 = 
domašs
->
	`size
();

151 
	`as£¹
(
numDomašs
 > 0);

152 
domašs_
->
	`growToSize
(
numDomašs
,
NULL
);

153 
i
 = 0; i < 
numDomašs
; i++)

154 (*
domašs_
)[
i
] = (*
domašs
)[i];

156 
gndP»dCÏu£IndexesAndCouÁsA¼_


157 ğ
Ãw
 
A¼ay
<A¼ay<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>*>;

158 
gndP»dCÏu£IndexesAndCouÁsA¼_
->
	`growToSize
(
numDomašs
,
NULL
);

159 
i
 = 0; i < 
numDomašs
; i++)

161 (*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
i
]

162 ğ
Ãw
 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>;

163 (*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
i
]->
	`growToSize
(

164 (*
domašs_
)[
i
]->
	`g‘NumP»diÿ‹s
(),
NULL
);

167 
	`ü—‹NumGndšgs
();

169 ià(
§m¶eGndP»ds_
)

171 
§m¶edGndšgsM­s_
 = 
Ãw
 
A¼ay
<A¼ay<
Sam¶edGndšgs
*>*>;

172 
§m¶edGndšgsM­s_
->
	`growToSize
(
numDomašs
, 
NULL
);

173 
i
 = 0; i < 
numDomašs
; i++)

175 (*
§m¶edGndšgsM­s_
)[
i
] = 
Ãw
 
A¼ay
<
Sam¶edGndšgs
*>;

176 (*
§m¶edGndšgsM­s_
)[
i
]->
	`growToSize
((*
domašs_
)[i]->
	`g‘NumP»diÿ‹s
()

177 , 
NULL
);

179 
¿ndom_
 = 
Ãw
 
Rªdom
;

180 
¿ndom_
->
	`š™
(-3);

181 
	`§m¶eP»dGroundšgs
(
äaùiÚ
, 
mšGndP»dSam¶es
, 
maxGndP»dSam¶es
);

185 
§m¶edGndšgsM­s_
 = 
NULL
;

186 
¿ndom_
 = 
NULL
;

191 ~
	$P£udoLogLik–ihood
()

193 
d–‘e
 
¬eNÚEvidP»ds_
;

194 
d–‘e
 
domašs_
;

196 
i
 = 0; i < 
gndP»dCÏu£IndexesAndCouÁsA¼_
->
	`size
(); i++)

198 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>*

199 
gndP»dCÏu£IndexesAndCouÁs


200 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
i
];

202 
numP»ds
 = 
gndP»dCÏu£IndexesAndCouÁs
->
	`size
();

203 
p
 = 0;… < 
numP»ds
;…++)

205 iàĞ(*
gndP»dCÏu£IndexesAndCouÁs
)[
p
] )

207 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>* 
gndšgsToCÏu£IndexesAndCouÁs


208 ğ(*
gndP»dCÏu£IndexesAndCouÁs
)[
p
];

209 
numGnds
 = 
gndšgsToCÏu£IndexesAndCouÁs
->
	`size
();

210 
g
 = 0; g < 
numGnds
; g++)

212 
h
 = 0; h < (*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
]->
	`size
();

213 
h
++)

215 
j
 = 0;

216 
j
 < (*(*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
])[
h
]->
	`size
();

217 
j
++)

219 
	`d–‘e
 (*(*(*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
])[
h
])[
j
];

221 
	`d–‘e
 (*(*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
])[
h
];

223 
	`d–‘e
 (*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
];

225 
d–‘e
 
gndšgsToCÏu£IndexesAndCouÁs
;

228 
d–‘e
 
gndP»dCÏu£IndexesAndCouÁs
;

230 
d–‘e
 
gndP»dCÏu£IndexesAndCouÁsA¼_
;

232 
numGndšgs_
->
	`d–‘eI‹msAndCË¬
();

233 
d–‘e
 
numGndšgs_
;

235 ià(
§m¶edGndšgsM­s_
)

237 
i
 = 0; i < 
§m¶edGndšgsM­s_
->
	`size
(); i++)

239 (*
§m¶edGndšgsM­s_
)[
i
]->
	`d–‘eI‹msAndCË¬
();

240 
	`d–‘e
 (*
§m¶edGndšgsM­s_
)[
i
];

242 
d–‘e
 
§m¶edGndšgsM­s_
;

245 ià(
¿ndom_
è
d–‘e
„andom_;

246 
	}
}

249 
	$com´ess
()

251 
i
 = 0; i < 
gndP»dCÏu£IndexesAndCouÁsA¼_
->
	`size
(); i++)

253 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>*

254 
gndP»dCÏu£IndexesAndCouÁs


255 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
i
];

257 
numP»ds
 = 
gndP»dCÏu£IndexesAndCouÁs
->
	`size
();

258 
p
 = 0;… < 
numP»ds
;…++)

261 ià((*
gndP»dCÏu£IndexesAndCouÁs
)[
p
])

263 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>* 
gndšgsToCÏu£IndexesAndCouÁs


264 ğ(*
gndP»dCÏu£IndexesAndCouÁs
)[
p
];

265 
numGnds
 = 
gndšgsToCÏu£IndexesAndCouÁs
->
	`size
();

266 
g
 = 0; g < 
numGnds
; g++)

268 
A¼ay
<A¼ay<
IndexAndCouÁ
*>*>* 
combosToCÏu£IndexesAndCouÁs


269 ğ(*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
];

270 
numCombos
 = 
combosToCÏu£IndexesAndCouÁs
->
	`size
();

271 
c
 = 0; c < 
numCombos
; c++)

272 (*
combosToCÏu£IndexesAndCouÁs
)[
c
]->
	`com´ess
();

279 
	}
}

283 
š£¹CouÁs
(* cÚ¡ & 
şau£IdxInMLN
,

284 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
,

285 
A¼ay
<A¼ay<A¼ay<
CacheCouÁ
*>*>*>* cÚ¡ & 
ÿche
,

286 cÚ¡ & 
d
)

288 
	gA¼ay
<A¼ay<A¼ay<A¼ay<
	gIndexAndCouÁ
*>*>*>*>*

289 
	ggndP»dCÏu£IndexesAndCouÁs
;

291 
	gA¼ay
<
	gIndexAndCouÁ
*>* 
	ggA¼
;

292 
CacheCouÁ
* 
	gcc
;

293 
as£¹
(
ÿche
->
size
(è=ğ
domašs_
->size());

295 
	ggndP»dCÏu£IndexesAndCouÁs
 = (*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
d
];

296 
	gp
 = 0;… < (*
	gÿche
)[
d
]->
size
();…++)

298 
	gA¼ay
<
	gCacheCouÁ
*>* 
	gccA¼
 = (*(*
ÿche
)[
d
])[
p
];

299 ià(
	gccA¼
 =ğ
NULL
) ;

300 
	gi
 = 0; i < 
	gccA¼
->
size
(); i++)

302 
as£¹
((*
gndP»dCÏu£IndexesAndCouÁs
)[
p
] !ğ
NULL
);

303 
	gcc
 = (*
ccA¼
)[
i
];

304 
	ggA¼
 = (*(*(*
gndP»dCÏu£IndexesAndCouÁs
)[
p
])[
cc
->
g
])[cc->
c
];

306 
as£¹
(
gA¼
->
size
()==0 ||*(gA¼->
Ï¡I‹m
()->
šdex
)!=*
şau£IdxInMLN
);

307 
as£¹
(
cc
->
út
 != 0);

308 
	ggA¼
->
­³nd
(
Ãw
 
IndexAndCouÁ
(
şau£IdxInMLN
, 
cc
->
út
));

309 ià(
	gundoInfos
èundoInfos->
­³nd
(
Ãw
 
UndoInfo
(
gA¼
, 
NULL
, -1, 
d
));

316 
š£¹CouÁs
(cÚ¡ 
A¼ay
<*>& 
şau£IdxInMLNs
,

317 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
,

318 
A¼ay
<A¼ay<A¼ay<
CacheCouÁ
*>*>*>* cÚ¡ & 
ÿche
)

320 
as£¹
(
ÿche
->
size
(è=ğ
domašs_
->size());

321 
as£¹
(
şau£IdxInMLNs
.
size
(è=ğ
domašs_
->size());

323 
	gd
 = 0; d < 
	gÿche
->
size
(); d++)

324 
š£¹CouÁs
(
şau£IdxInMLNs
[
d
], 
undoInfos
, 
ÿche
, d);

331 
compu‹CouÁsFÜNewAµ’dedCÏu£
(cÚ¡ 
CÏu£
* cÚ¡ & 
c
,

332 * cÚ¡ & 
şau£IdxInMLN
,

333 cÚ¡ & 
domašIdx
,

334 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
,

335 cÚ¡ 
boŞ
& 
§m¶eCÏu£s
,

336 
A¼ay
<A¼ay<A¼ay<
CacheCouÁ
*>*>*>* cÚ¡ & 
ÿche
,

337 
A¼ay
<
CÏu£
*>* cÚ¡ & 
t›dCÏu£s
)

339 
compu‹CouÁsRemoveCouÁsH–³r
(
Œue
, 
c
, 
şau£IdxInMLN
, 
domašIdx
,

340 
undoInfos
, 
§m¶eCÏu£s
, 
ÿche
,

341 
t›dCÏu£s
);

345 
»moveCouÁsFÜCÏu£
(cÚ¡ 
CÏu£
* cÚ¡ & 
c
,

346 * cÚ¡ & 
şau£IdxInMLN
, cÚ¡ & 
domašIdx
,

347 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
)

349 
compu‹CouÁsRemoveCouÁsH–³r
(
çl£
, 
c
, 
şau£IdxInMLN
, 
domašIdx
,

350 
undoInfos
, 
çl£
, 
NULL
, NULL);

355 
undoAµ’dRemoveCouÁs
(cÚ¡ 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
)

357 
	gi
 = 
undoInfos
->
size
() - 1; i >= 0; i--)

359 ià((*
	gundoInfos
)[
i
]->
	g»mIacIdx
 >= 0)

361 
A¼ay
<
IndexAndCouÁ
*>* 
afãùedA¼
 = (*
undoInfos
)[
i
]->affectedArr;

362 
IndexAndCouÁ
* 
	g»mIac
 = (*
undoInfos
)[
i
]->
»mIac
;

363 (*
	gundoInfos
)[
i
]->
	g»mIac
 = 
NULL
;

364 
	g»mIacIdx
 = (*
undoInfos
)[
i
]->
»mIacIdx
;

366 ià(
	gafãùedA¼
->
size
(è=ğ
»mIacIdx
)

367 
afãùedA¼
->
­³nd
(
»mIac
);

370 
as£¹
(
»mIacIdx
 < 
afãùedA¼
->
size
());

371 
IndexAndCouÁ
* 
	gtmpRemIac
 = (*
afãùedA¼
)[
»mIacIdx
];

372 (*
	gafãùedA¼
)[
»mIacIdx
] = 
»mIac
;

373 
	gafãùedA¼
->
­³nd
(
tmpRemIac
);

378 
IndexAndCouÁ
* 
	gŸc
 = (*
undoInfos
)[
i
]->
afãùedA¼
->
»moveLa¡I‹m
();

379 
d–‘e
 
	gŸc
;

382 
as£¹
(
noR•—‹dIndex
((*
undoInfos
)[
i
]->
afãùedA¼
));

383 
d–‘e
 (*
undoInfos
)[
i
];

388 
	$g‘V®ueAndG¿d›Á
(* 
g¿d›Á
, * 
wt
,

389 cÚ¡ & 
¬rSize
)

391 
w¶l
 = 0.0;

393 
A¼ay
<> 
ÃwWts
;

394 
ÃwWts
.
	`growToSize
(
numM—ns_
);

396 
off£t1
 = 0;

397 
i
 = 0; i < 
numM—ns_
; i++)

399 ià(
lockedWts_
 &&†ockedWts_[
i
])

401 
ÃwWts
[
i
] = 
´iÜM—ns_
[i];

402 
off£t1
++;

404 
ÃwWts
[
i
] = 
wt
[˜- 
off£t1
];

407 
A¼ay
<> 
ÃwG¿d›Á
;

408 
ÃwG¿d›Á
.
	`growToSize
(
numM—ns_
, 0.0);

411 ià(
idxT¿ns_
 =ğ
NULL
)

413 
i
 = 0; i < 
domašs_
->
	`size
(); i++)

414 
w¶l
 +ğ
	`g‘V®ueAndG¿d›ÁFÜDomaš
((*)
ÃwG¿d›Á
.
	`g‘I‹ms
(),

415 (*)
ÃwWts
.
	`g‘I‹ms
(),

416 
numM—ns_
, 
i
);

420 
A¼ay
<A¼ay<> >* 
wtsP”Domaš
 = 
idxT¿ns_
->
	`g‘WtsP”Domaš
();

421 
A¼ay
<A¼ay<> >* 
g¿dsP”Domaš
 = 
idxT¿ns_
->
	`g‘G¿dsP”Domaš
();

422 cÚ¡ 
A¼ay
<A¼ay<A¼ay<
IdxDiv
>*> >* 
cIdxToCFIdxsP”Domaš


423 ğ
idxT¿ns_
->
	`g‘CÏu£IdxToCÏu£FÜmuÏIdxsP”Domaš
();

425 
i
 = 0; i < 
domašs_
->
	`size
(); i++)

427 
A¼ay
<>& 
wts
 = (*
wtsP”Domaš
)[
i
];

428 
A¼ay
<>& 
g¿ds
 = (*
g¿dsP”Domaš
)[
i
];

429 
	`as£¹
(
g¿ds
.
	`size
(è=ğ
wts
.size());

430 
	`mem£t
((*)
wts
.
	`g‘I‹ms
(), 0, wts.
	`size
()*());

431 
	`mem£t
((*)
g¿ds
.
	`g‘I‹ms
(), 0, g¿ds.
	`size
()*());

439 
j
 = 0; j < 
wts
.
	`size
(); j++)

441 
A¼ay
<
IdxDiv
>* 
idxDivs
 =(*
cIdxToCFIdxsP”Domaš
)[
i
][
j
];

442 
k
 = 0; k < 
idxDivs
->
	`size
(); k++)

443 ià((*
idxDivs
)[
k
].
idx
 < 
numM—ns_
)

444 
wts
[
j
] +ğ
ÃwWts
[ (*
idxDivs
)[
k
].
idx
 ] / (*idxDivs)[k].
div
;

447 
w¶l
 +ğ
	`g‘V®ueAndG¿d›ÁFÜDomaš
((*)
g¿ds
.
	`g‘I‹ms
(),

448 (*)
wts
.
	`g‘I‹ms
(),

449 
wts
.
	`size
(), 
i
);

452 
j
 = 0; j < 
g¿ds
.
	`size
(); j++)

454 
A¼ay
<
IdxDiv
>* 
idxDivs
 =(*
cIdxToCFIdxsP”Domaš
)[
i
][
j
];

455 
k
 = 0; k < 
idxDivs
->
	`size
(); k++)

456 ià((*
idxDivs
)[
k
].
idx
 < 
numM—ns_
)

457 
ÃwG¿d›Á
[ (*
idxDivs
)[
k
].
idx
 ] +ğ
g¿ds
[
j
] / (*idxDivs)[k].
div
;

467 ià(
numM—ns_
 > 0)

474 
i
 = 0; i < 
numM—ns_
; i++)

478 
w¶l
 +ğ(
ÃwWts
[
i
]-
´iÜM—ns_
[i])*(newWts[i]-priorMeans_[i])/

479 (2*
´iÜStdDevs_
[
i
]*priorStdDevs_[i]);

481 
ÃwG¿d›Á
[
i
] +ğ(
ÃwWts
[i]-
´iÜM—ns_
[i])/

482 (
´iÜStdDevs_
[
i
]*priorStdDevs_[i]);

491 
off£t2
 = 0;

492 
i
 = 0; i < 
numM—ns_
; i++)

494 ià(
lockedWts_
 &&†ockedWts_[
i
])

496 
off£t2
++;

500 
wt
[
i
 - 
off£t2
] = 
ÃwWts
[i];

501 
g¿d›Á
[
i
 - 
off£t2
] = 
ÃwG¿d›Á
[i];

507  
w¶l
;

508 
	}
}

513 
	$£tM—nsStdDevs
(cÚ¡ & 
¬rSize
, cÚ¡ * cÚ¡ & 
´iÜM—ns
,

514 cÚ¡ * cÚ¡ & 
´iÜStdDevs
)

516 
numM—ns_
 = 
¬rSize
;

517 
´iÜM—ns_
 = 
´iÜM—ns
;

518 
´iÜStdDevs_
 = 
´iÜStdDevs
;

519 
	}
}

521 
	$£tLockedWts
(cÚ¡ 
boŞ
* cÚ¡ & 
lockedWts
)

523 
lockedWts_
 = 
lockedWts
;

524 
	}
}

526 
	$£tSam¶eGndP»ds
(cÚ¡ 
boŞ
& 
sgp
)

528 ià(
sgp
è{ 
	`as£¹
(
§m¶edGndšgsM­s_
);‡s£¹(
¿ndom_
); }

529 
§m¶eGndP»ds_
 = 
sgp
;

530 
	}
}

533 
boŞ
 
	$checkNoR•—‹dIndex
(cÚ¡ 
MLN
* cÚ¡ & 
mÊ
=
NULL
)

535 
boŞ
 
»t
 = 
Œue
;

536 
d
 = 0; d < 
domašs_
->
	`size
(); d++)

538 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>*

539 
gndP»dCÏu£IndexesAndCouÁs


540 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
d
];

542 
numP»ds
 = 
gndP»dCÏu£IndexesAndCouÁs
->
	`size
();

543 
p
 = 0;… < 
numP»ds
;…++)

545 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>* 
gndšgsToCÏu£IndexesAndCouÁs


546 ğ(*
gndP»dCÏu£IndexesAndCouÁs
)[
p
];

548 ià(
gndšgsToCÏu£IndexesAndCouÁs
 =ğ
NULL
) ;

550 
numGnds
 = 
gndšgsToCÏu£IndexesAndCouÁs
->
	`size
();

551 
g
 = 0; g < 
numGnds
; g++)

553 
A¼ay
<A¼ay<
IndexAndCouÁ
*>*>* 
gndšgs


554 ğ(*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
];

556 
c
 = 0; c < 
gndšgs
->
	`size
(); c++)

558 
boŞ
 
ok
 = 
	`noR•—‹dIndex
((*
gndšgs
)[
c
], 
mÊ
);

559 ià(!
ok
)

561 
cout
 << "ERROR:„•—‹d index iÀdomaš " << 
d
 << " for…red "

562 << (*
domašs_
)[0]->
	`g‘P»diÿ‹Name
(
p
è<< " gndšg " << 
g


563 << " combš©iÚ " << 
c
 << 
’dl
;

564 
»t
 = 
çl£
;

570  
»t
;

571 
	}
}

574 
	$´štGndP»dCÏu£IndexesAndCouÁs
(cÚ¡ 
MLN
* cÚ¡ & 
mÊ
=
NULL
)

576 
d
 = 0; d < 
domašs_
->
	`size
(); d++)

578 
cout
 << "domašIdx: " << 
d
 << 
’dl
;

579 
cout
 << "gndPredClauseIndexesAndCounts[predIdx][gndingIdx][combIdx][i]"

580 << 
’dl
;

582 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>*

583 
gndP»dCÏu£IndexesAndCouÁs


584 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
d
];

586 
numP»ds
 = 
gndP»dCÏu£IndexesAndCouÁs
->
	`size
();

587 
p
 = 0;… < 
numP»ds
;…++)

589 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>* 
gndšgsToCÏu£IndexesAndCouÁs


590 ğ(*
gndP»dCÏu£IndexesAndCouÁs
)[
p
];

592 ià(
gndšgsToCÏu£IndexesAndCouÁs
 =ğ
NULL
)

594 
cout
 << "gndP»dCÏu£IndexesAndCouÁs[" << 
p
 << "] = NULL" << 
’dl
;

598 
numGnds
 = 
gndšgsToCÏu£IndexesAndCouÁs
->
	`size
();

599 
g
 = 0; g < 
numGnds
; g++)

601 
A¼ay
<A¼ay<
IndexAndCouÁ
*>*>* 
gndšgs


602 ğ(*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
];

604 
c
 = 0; c < 
gndšgs
->
	`size
(); c++)

606 
A¼ay
<
IndexAndCouÁ
*>* 
combos


607 ğ(*
gndšgs
)[
c
];

608 
numCÏu£Idx
 = 
combos
->
	`size
();

610 ià(
numCÏu£Idx
 == 0)

612 
cout
 << "gndP»dCÏu£IndexesAndCouÁs[" << 
p
 << "][" << 
g


613 << "][" << 
c
 << "] =ƒm±y" << 
’dl
;

617 
i
 = 0; i < 
numCÏu£Idx
; i++)

619 
cout
 << "gndP»dCÏu£IndexesAndCouÁs[" << 
p
 << "][" << 
g
 << "]["

620 << 
c
 << "][" << 
i
 << "] (clauseIndex,count) = "

621 << *((*
combos
)[
i
]->
šdex
)

622 << ", " << (*
combos
)[
i
]->
couÁ


623 << ", " << (*
combos
)[
i
] << 
’dl
;

625 ià(
mÊ
)

627 
cout
 << " \t";

628 
mÊ
->
	`g‘CÏu£
(*((*
combos
)[
i
]->
šdex
)è->
	`´št
(
cout
,

629 (*
domašs_
)[0]);

630 
cout
 << 
’dl
;

638 
	}
}

641 
	$£tIndexT¿n¦©Ü
(
IndexT¿n¦©Ü
* cÚ¡ & 
™
è{ 
idxT¿ns_
 = it; 
	}
}

644 
IndexT¿n¦©Ü
* 
	$g‘IndexT¿n¦©Ü
(ècÚ¡ {  
idxT¿ns_
; 
	}
}

647 
	g´iv©e
:

648 
	$ü—‹NumGndšgs
()

650 
numGndšgs_
 = 
Ãw
 
A¼ay
<Array<>*>;

651 
numGndšgs_
->
	`growToSize
(
domašs_
->
	`size
());

652 
i
 = 0; i < 
domašs_
->
	`size
(); i++)

654 (*
numGndšgs_
)[
i
] = 
Ãw
 
A¼ay
<>;

655 (*
numGndšgs_
)[
i
]->
	`growToSize
((*
domašs_
)[i]->
	`g‘NumP»diÿ‹s
(), -1);

658 
i
 = 0; i < 
domašs_
->
	`size
(); i++)

660 cÚ¡ 
Domaš
* 
domaš
 = (*
domašs_
)[
i
];

661 
j
 = 0; j < 
domaš
->
	`g‘NumP»diÿ‹s
(); j++)

663 ià(!(*
¬eNÚEvidP»ds_
)[
j
]) ;

664 cÚ¡ 
P»diÿ‹Tem¶©e
* 
±
 = 
domaš
->
	`g‘P»diÿ‹Tem¶©e
(
j
);

666 
numGndšgs
 = 1;

667 
t
 = 0; < 
±
->
	`g‘NumT”ms
();++)

669 
ty³Id
 = 
±
->
	`g‘T”mTy³AsIÁ
(
t
);

670 
numGndšgs
 *ğ
domaš
->
	`g‘NumCÚ¡ªtsByTy³
(
ty³Id
);

672 (*((*
numGndšgs_
)[
i
]))[
j
] = 
numGndšgs
;

675 
	}
}

678 
ü—‹AÎPossibËP»dsGroundšgs
(cÚ¡ 
P»diÿ‹
* cÚ¡ & 
´ed
,

679 cÚ¡ 
Domaš
* cÚ¡ & 
domaš
,

680 
A¼aysAcûssÜ
<>& 
acc
)

682 
	gi
 = 0; i < 
	g´ed
->
g‘NumT”ms
(); i++)

684 
	gty³Id
 = 
´ed
->
g‘T”mTy³AsIÁ
(
i
);

685 cÚ¡ 
	gA¼ay
<>* 
	gcÚ¡A¼
 = 
domaš
->
g‘CÚ¡ªtsByTy³
(
ty³Id
);

686 
	gacc
.
­³ndA¼ay
(
cÚ¡A¼
);

691 
boŞ
 
	$isSam¶edGndP»d
(cÚ¡ & 
g
, cÚ¡ 
Sam¶edGndšgs
* cÚ¡ & 
sg
)

693 ià(
sg
->
çl£Gndšgs
.
	`cÚšs
(
g
)è 
Œue
;

694 ià(
sg
->
ŒueGndšgs
.
	`cÚšs
(
g
)è 
Œue
;

695  
çl£
;

696 
	}
}

699 
compu‹CouÁsRemoveCouÁsH–³r
(
boŞ
 
compu‹CouÁs
,

700 cÚ¡ 
CÏu£
* cÚ¡ & 
c
,

701 * cÚ¡ & 
şau£IdxInMLN
,

702 cÚ¡ & 
domašIdx
,

703 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
,

704 cÚ¡ 
boŞ
& 
§m¶eCÏu£s
,

705 
A¼ay
<A¼ay<A¼ay<
CacheCouÁ
*>*>*>* cÚ¡ & 
ÿche
,

706 
A¼ay
<
CÏu£
*>* cÚ¡ & 
t›dCÏu£s
)

709 cÚ¡ 
Domaš
* 
	gdomaš
 = (*
domašs_
)[
domašIdx
];

710 
D©aba£
* 
	gdb
 = 
domaš
->
g‘DB
();

713 
	gA¼ay
<> 
´edIdxW™hAÎT”msDiffV¬s
(
domaš
->
g‘NumP»diÿ‹s
());

714 
	g´edIdxW™hAÎT”msDiffV¬s
.
growToSize
(
domaš
->
g‘NumP»diÿ‹s
());

715 * 
	g·¼
 = (*è
´edIdxW™hAÎT”msDiffV¬s
.
g‘I‹ms
();

716 
mem£t
(
·¼
, -1, 
domaš
->
g‘NumP»diÿ‹s
()*());

719 
	gA¼ay
<
	gboŞ
> 
´edAÎT”msA»DiffV¬s
(
c
->
g‘NumP»diÿ‹s
());

720 
ü—‹P»dAÎT”msA»DiffV¬s
(
c
, 
´edAÎT”msA»DiffV¬s
,

721 
´edIdxW™hAÎT”msDiffV¬s
);

724 
P»diÿ‹HashA¼ay
 
	g£’P»ds
;

727 
	gp
 = 0;… < 
	gc
->
g‘NumP»diÿ‹s
();…++)

729 
P»diÿ‹
* 
	g´ed
 = 
c
->
g‘P»diÿ‹
(
p
);

730 
	g´edId
 = 
´ed
->
g‘Id
();

731 ià(!(*
	g¬eNÚEvidP»ds_
)[
´edId
]) ;

733 
P»diÿ‹
 
gndP»d
(*
´ed
);

734 
	ggndP»d
.
ÿnÚiÿlize
();

735 
boŞ
 
	g´edIsIn™ŸÎyGnded
 = 
gndP»d
.
isGrounded
();

737 
Sam¶edGndšgs
* 
	gsg
 = 
NULL
;

738 ià(
	g§m¶eGndP»ds_
è
	gsg
 = (*(*
§m¶edGndšgsM­s_
)[
domašIdx
])[
´edId
];

740 
P»diÿ‹
* 
	g£’P»d
 = 
Ãw
 P»diÿ‹(
gndP»d
);

742 ià(
	g£’P»ds
.
­³nd
(
£’P»d
è< 0è{ 
d–‘e
 
	g£’P»d
; ; }

744 ià(
	g´edAÎT”msA»DiffV¬s
[
p
])

749 
	gA¼aysAcûssÜ
<> 
	gacc
;

750 
ü—‹AÎPossibËP»dsGroundšgs
(&
gndP»d
, 
domaš
, 
acc
);

753 
	gg
 = -1;

754 
	gacc
.
hasNextCombš©iÚ
())

756 ++
	gg
;

758 
	gt
 = 0; 
	gcÚ¡Id
;

759 
	gacc
.
ÃxtI‹mInCombš©iÚ
(
cÚ¡Id
))

760 ((
	gT”m
*è
	ggndP»d
.
g‘T”m
(
t
++))->
£tId
(
cÚ¡Id
);

762 ià(
	g§m¶eGndP»ds_
 && !
isSam¶edGndP»d
(
g
,
sg
)) ;

764 ià(
	gcompu‹CouÁs
)

766 
	gcout
<<"ÿÎšg compu‹AndS‘CouÁ © 766..."<<
	g’dl
;

767 
compu‹AndS‘CouÁs
(
c
, 
şau£IdxInMLN
, 
´edId
, 
gndP»d
, 
g
, 
db
,

768 
domašIdx
, 
undoInfos
, 
§m¶eCÏu£s
, 
ÿche
,

769 
t›dCÏu£s
);

770 
	gcout
<<"dÚcompu‹AndS‘CouÁ © 770..."<<
	g’dl
;

773 
»moveCouÁs
(
şau£IdxInMLN
, 
´edId
, 
g
, 
domašIdx
, 
undoInfos
);

780 ià(
	g´edIdxW™hAÎT”msDiffV¬s
[
´edId
] >= 0) ;

785 
	gA¼ay
<> 
muÉl›rs
(
gndP»d
.
g‘NumT”ms
());

786 
ü—‹MuÉl›rs
(
muÉl›rs
, 
gndP»d
, 
domaš
);

790 
	goff£tDueToCÚ¡ªts
 = 0;

796 
	gA¼ay
<A¼ay<
	g·œ
<,
	gT”m
*> >* > 
	gv¬IdToMuÉs
;

797 
	gA¼ay
<> 
	gÃgV¬IdsA¼
;

798 
	gA¼aysAcûssÜ
<> 
	ggroundšgs
;

799 
ü—‹M­pšgOfV¬IdToMuÉl›rsAndV¬GroundšgsAndOff£t
(

800 
gndP»d
, 
domaš
, 
muÉl›rs
, 
off£tDueToCÚ¡ªts
, 
v¬IdToMuÉs
,

801 
ÃgV¬IdsA¼
, 
groundšgs
);

804 ià(!
	g´edIsIn™ŸÎyGnded
)

807 
	gcÚ¡Id
, 
	gcÚ¡Idx
;

808 
	ggroundšgs
.
hasNextCombš©iÚ
())

810 
	gg
 = 
off£tDueToCÚ¡ªts
;

811 
	gj
 = -1;

812 
	ggroundšgs
.
ÃxtI‹mInCombš©iÚ
(
cÚ¡Id
, 
cÚ¡Idx
))

814 ++
	gj
;

815 
	gÃgV¬Id
 = 
ÃgV¬IdsA¼
[
j
];

816 
	gA¼ay
<
	g·œ
<,
	gT”m
*> >* 
	gmuÉsAndT”ms
 = 
v¬IdToMuÉs
[
ÃgV¬Id
];

817 
	gm
 = 0; m < 
	gmuÉsAndT”ms
->
size
(); m++)

819 
	gg
 +ğ
cÚ¡Idx
 * (*
muÉsAndT”ms
)[
m
].
fœ¡
;

820 (*
	gmuÉsAndT”ms
)[
m
].
	g£cÚd
->
£tId
(
cÚ¡Id
);

824 ià(
	g§m¶eGndP»ds_
 && !
isSam¶edGndP»d
(
g
,
sg
)) ;

825 ià(
	gcompu‹CouÁs
)

827 
	gcout
<<"ÿÎšg compu‹AndS‘CouÁ © 827..."<<
	g’dl
;

828 
compu‹AndS‘CouÁs
(
c
, 
şau£IdxInMLN
, 
´edId
, 
gndP»d
, 
g
, 
db
,

829 
domašIdx
, 
undoInfos
, 
§m¶eCÏu£s
, 
ÿche
,

830 
t›dCÏu£s
);

831 
	gcout
<<"dÚcompu‹AndS‘CouÁ © 831..."<<
	g’dl
;

834 
»moveCouÁs
(
şau£IdxInMLN
, 
´edId
, 
g
, 
domašIdx
, 
undoInfos
);

839 
	gg
 = 
off£tDueToCÚ¡ªts
;

841 
boŞ
 
	gok
 = 
Œue
;

842 ià(
	g§m¶eGndP»ds_
è
	gok
 = 
isSam¶edGndP»d
(
g
,
sg
);

844 ià(
	gok
)

846 ià(
	gcompu‹CouÁs
)

848 
	gcout
<<"ÿÎšg compu‹AndS‘CouÁ © 848..."<<
	g’dl
;

849 
compu‹AndS‘CouÁs
(
c
, 
şau£IdxInMLN
, 
´edId
, 
gndP»d
, 
g
, 
db
,

850 
domašIdx
, 
undoInfos
, 
§m¶eCÏu£s
, 
ÿche
,

851 
t›dCÏu£s
);

852 
	gcout
<<"dÚcompu‹AndS‘CouÁ © 852..."<<
	g’dl
;

855 
»moveCouÁs
(
şau£IdxInMLN
, 
´edId
, 
g
, 
domašIdx
, 
undoInfos
);

859 
	gj
 = 0; j < 
	gv¬IdToMuÉs
.
size
(); j++è
d–‘e
 v¬IdToMuÉs[
j
];

863 
	gi
 = 0; i < 
	g£’P»ds
.
size
(); i++è
d–‘e
 s“nP»ds[
i
];

869 
compu‹P”P»dPÎAndG¿d
(cÚ¡ 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*

870 cÚ¡& 
gndšgsToCÏu£IndexesAndCouÁs
,

871 cÚ¡ & 
g
, cÚ¡ * cÚ¡ & 
wt
,

872 & 
³rP»dPÎ
,

873 * cÚ¡ & 
³rP»dG¿d
)

897 
	gwdÙn
 = 0;

899 
	gpmb
 = 1;

901 
	gA¼ay
<A¼ay<
	gIndexAndCouÁ
*>*>* 
	ggndšgs
 =

902 (*
gndšgsToCÏu£IndexesAndCouÁs
)[
g
];

905 
	gc
 = 0; c < 
	ggndšgs
->
size
(); c++)

907 
	gA¼ay
<
	gIndexAndCouÁ
*>* 
	gşau£IndexesAndCouÁs
 = (*
gndšgs
)[
c
];

908 
as£¹
(
noR•—‹dIndex
(
şau£IndexesAndCouÁs
));

910 
	gnumCÏu£sUnifyW™h
 = 
şau£IndexesAndCouÁs
->
size
();

913 
	gi
 = 0; i < 
	gnumCÏu£sUnifyW™h
; i++)

918 
	gwdÙn
 +ğ
wt
[ *Ğ(*
şau£IndexesAndCouÁs
)[
i
]->
šdex
 ) ] *

919 (*
şau£IndexesAndCouÁs
)[
i
]->
couÁ
;

922 
	gpmb
 +ğ
ex¶
(
wdÙn
);

925 
	g³rP»dPÎ
 -ğ
logl
(
pmb
);

928 
	gc
 = 0; c < 
	ggndšgs
->
size
(); c++)

930 
	gA¼ay
<
	gIndexAndCouÁ
*>* 
	gşau£IndexesAndCouÁs


931 ğ(*
gndšgs
)[
c
];

933 
	gi
 = 0; i < 
	gşau£IndexesAndCouÁs
->
size
(); i++)

934 
	g³rP»dG¿d
[ *Ğ(*
şau£IndexesAndCouÁs
)[
i
]->
	gšdex
 ) ]

935 +ğĞ(1.0/
pmb
-1è* (*
şau£IndexesAndCouÁs
)[
i
]->
couÁ
 );

939 
compu‹Sam¶edP”P»dPÎAndG¿d
(
IÁHashA¼ay
& 
gndšgs
,

940 cÚ¡ & 
tÙ®Gndšgs
,

941 & 
tmpP”P»dPÎ
,

942 * cÚ¡ & 
tmpP”P»dG¿d
,

943 & 
³rP»dPÎ
,

944 * cÚ¡ & 
³rP»dG¿d
,

945 cÚ¡ & 
¬rSize
,

946 cÚ¡ * cÚ¡ & 
wt
,

947 cÚ¡ 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*

948 cÚ¡& 
gndšgsToCÏu£IndexesAndCouÁs
)

950 
	gtmpP”P»dPÎ
 = 0;

951 
mem£t
(
tmpP”P»dG¿d
, 0, 
¬rSize
*());

952 
	gi
 = 0; i < 
	ggndšgs
.
size
(); i++)

953 
compu‹P”P»dPÎAndG¿d
(
gndšgsToCÏu£IndexesAndCouÁs
,

954 
gndšgs
[
i
], 
wt
, 
tmpP”P»dPÎ
,

955 
tmpP”P»dG¿d
);

956 ià(
	ggndšgs
.
size
() > 0)

958 
	g³rP»dPÎ
 +ğ
tÙ®Gndšgs
 * 
tmpP”P»dPÎ
/
gndšgs
.
size
();

960 
	gi
 = 0; i < 
	g¬rSize
; i++)

961 
	g³rP»dG¿d
[
i
] +ğ
tÙ®Gndšgs
 * 
tmpP”P»dG¿d
[i]/
gndšgs
.
size
();

968 
	$g‘V®ueAndG¿d›ÁFÜDomaš
(* cÚ¡ & 
g¿d›Á
,

969 cÚ¡ * cÚ¡ & 
wt
,

970 cÚ¡ & 
¬rSize
, cÚ¡ & 
domašIdx
)

972 
w¶l
 = 0;

973 * 
³rP»dG¿d
 = 
Ãw
 [
¬rSize
];

976 
tmpP”P»dPÎ
;

977 * 
tmpP”P»dG¿d
 = 
NULL
;

978 ià(
§m¶eGndP»ds_
è
tmpP”P»dG¿d
 = 
Ãw
 [
¬rSize
];

980 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>* 
gndP»dCÏu£IndexesAndCouÁs


981 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
domašIdx
];

983 
numP»ds
 = 
gndP»dCÏu£IndexesAndCouÁs
->
	`size
();

984 
p
 = 0;… < 
numP»ds
;…++)

986 ià(!(*
¬eNÚEvidP»ds_
)[
p
]) ;

992 
³rP»dPÎ
 = 0;

993 
	`mem£t
(
³rP»dG¿d
, 0, 
¬rSize
*());

996 ià((*
gndP»dCÏu£IndexesAndCouÁs
)[
p
] !ğ
NULL
)

998 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>* 
gndšgsToCÏu£IndexesAndCouÁs


999 ğ(*
gndP»dCÏu£IndexesAndCouÁs
)[
p
];

1001 ià(
§m¶eGndP»ds_
)

1003 
Sam¶edGndšgs
* 
sg
 = (*(*
§m¶edGndšgsM­s_
)[
domašIdx
])[
p
];

1004 
	`compu‹Sam¶edP”P»dPÎAndG¿d
(
sg
->
ŒueGndšgs
, sg->
tÙ®True
,

1005 
tmpP”P»dPÎ
, 
tmpP”P»dG¿d
,

1006 
³rP»dPÎ
, 
³rP»dG¿d
, 
¬rSize
,

1007 
wt
, 
gndšgsToCÏu£IndexesAndCouÁs
);

1008 
	`compu‹Sam¶edP”P»dPÎAndG¿d
(
sg
->
çl£Gndšgs
, sg->
tÙ®F®£
,

1009 
tmpP”P»dPÎ
, 
tmpP”P»dG¿d
,

1010 
³rP»dPÎ
, 
³rP»dG¿d
, 
¬rSize
,

1011 
wt
, 
gndšgsToCÏu£IndexesAndCouÁs
);

1015 
numGnds
 = 
gndšgsToCÏu£IndexesAndCouÁs
->
	`size
();

1016 
	`as£¹
(
numGnds
 =ğ(*((*
numGndšgs_
)[
domašIdx
]))[
p
]);

1017 
g
 = 0; g < 
numGnds
; g++)

1018 
	`compu‹P”P»dPÎAndG¿d
(
gndšgsToCÏu£IndexesAndCouÁs
, 
g
, 
wt
,

1019 
³rP»dPÎ
, 
³rP»dG¿d
);

1024 
³rP»dPÎ
 = (*((*
numGndšgs_
)[
domašIdx
]))[
p
] * -
	`log
(2);

1028 ià(
wtFOP»d_
)

1031 
w¶l
 -ğ
³rP»dPÎ
 / (*((*
numGndšgs_
)[
domašIdx
]))[
p
];

1032 
i
 = 0; i < 
¬rSize
; i++)

1033 
g¿d›Á
[
i
] -ğ
³rP»dG¿d
[i]/(*((*
numGndšgs_
)[
domašIdx
]))[
p
];

1038 
w¶l
 -ğ
³rP»dPÎ
;

1039 
i
 = 0; i < 
¬rSize
; i++)

1040 
g¿d›Á
[
i
] -ğ
³rP»dG¿d
[i];

1044 
d–‘e
 [] 
³rP»dG¿d
;

1045 ià(
§m¶eGndP»ds_
è
d–‘e
 [] 
tmpP”P»dG¿d
;

1047  
w¶l
;

1048 
	}
}

1050 
	$ü—‹CÏu£IndexesAndCouÁsA¼ays
(cÚ¡ & 
´edId
,

1051 cÚ¡ & 
domašIdx
)

1053 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>* 
gndP»dCÏu£IndexesAndCouÁs


1054 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
domašIdx
];

1055 ià((*
gndP»dCÏu£IndexesAndCouÁs
)[
´edId
] !ğ
NULL
) ;

1057 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>* 
¬r
 =

1058 
Ãw
 
A¼ay
<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>;

1059 
numGndšgs
 = (*((*
numGndšgs_
)[
domašIdx
]))[
´edId
];

1063 
g
 = 0; g < 
numGndšgs
; g++)

1064 
¬r
->
	`­³nd
(
Ãw
 
A¼ay
<A¼ay<
IndexAndCouÁ
*>*>);

1065 
¬r
->
	`com´ess
();

1066 (*
gndP»dCÏu£IndexesAndCouÁs
)[
´edId
] = 
¬r
;

1067 
	}
}

1069 
	$ü—‹ComboCÏu£IndexesAndCouÁsA¼ays
(cÚ¡ & 
´edId
,

1070 cÚ¡ & 
domašIdx
,

1071 
P»diÿ‹
* cÚ¡ & 
gndP»d
,

1072 cÚ¡ & 
g
)

1074 
A¼ay
<A¼ay<A¼ay<A¼ay<
IndexAndCouÁ
*>*>*>*>* 
gndP»dCÏu£IndexesAndCouÁs


1075 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
domašIdx
];

1077 
A¼ay
<A¼ay<
IndexAndCouÁ
*>*>* 
comboCÏu£IndexesAndCouÁs


1078 ğ(*(*
gndP»dCÏu£IndexesAndCouÁs
)[
´edId
])[
g
];

1079 ià(
comboCÏu£IndexesAndCouÁs
->
	`size
() > 0) ;

1082 
numCombInBlock
 = 1;

1084 
blockIdx
 = (*
domašs_
)[
domašIdx
]->
	`g‘Block
(
gndP»d
);

1085 ià(
blockIdx
 >= 0)

1086 
numCombInBlock
 = (*
domašs_
)[
domašIdx
]->
	`g‘BlockSize
(
blockIdx
) - 1;

1088 
comboCÏu£IndexesAndCouÁs
->
	`growToSize
(
numCombInBlock
, 
NULL
);

1089 
c
 = 0; c < 
numCombInBlock
; c++)

1091 (*
comboCÏu£IndexesAndCouÁs
)[
c
] = 
Ãw
 
A¼ay
<
IndexAndCouÁ
*>;

1093 
comboCÏu£IndexesAndCouÁs
->
	`com´ess
();

1094 
	}
}

1104 
boŞ
 
compu‹AndS‘CouÁs
(cÚ¡ 
CÏu£
* cÚ¡ 
şau£
,

1105 * cÚ¡ & 
şau£IdxInMLN
,

1106 cÚ¡ & 
´edId
, 
P»diÿ‹
& 
gndP»d
,

1107 cÚ¡ & 
g
, 
D©aba£
* cÚ¡ & 
db
,

1108 cÚ¡ & 
domašIdx
,

1109 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
,

1110 cÚ¡ 
boŞ
& 
§m¶eCÏu£s
,

1111 
A¼ay
<A¼ay<A¼ay<
CacheCouÁ
*>*>*>* cÚ¡ & 
ÿche
,

1112 
A¼ay
<
CÏu£
*>* cÚ¡ & 
t›dCÏu£s
)

1114 
	gA¼ay
<A¼ay<A¼ay<A¼ay<
	gIndexAndCouÁ
*>*>*>*>* 
	ggndP»dCÏu£IndexesAndCouÁs


1115 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
domašIdx
];

1116 cÚ¡ 
Domaš
* 
	gdomaš
 = (*
domašs_
)[
domašIdx
];

1118 ià((*
	ggndP»dCÏu£IndexesAndCouÁs
)[
´edId
] =ğ
NULL
)

1119 
ü—‹CÏu£IndexesAndCouÁsA¼ays
(
´edId
, 
domašIdx
);

1121 
ü—‹ComboCÏu£IndexesAndCouÁsA¼ays
(
´edId
, 
domašIdx
, &
gndP»d
, 
g
);

1123 
	gA¼ay
<A¼ay<
	gIndexAndCouÁ
*>*>* 
	gcomboCÏu£IndexesAndCouÁs


1124 ğ(*(*
gndP»dCÏu£IndexesAndCouÁs
)[
´edId
])[
g
];

1137 
	gc
 = 0; c < 
	gcomboCÏu£IndexesAndCouÁs
->
size
(); c++)

1141 
	gA¼ay
<
	gIndexAndCouÁ
*>* 
	ggA¼
 = (*
comboCÏu£IndexesAndCouÁs
)[
c
];

1142 ià(
	ggA¼
->
size
(è> 0 && *ĞgA¼->
Ï¡I‹m
()->
	gšdex
 ) =ğ*
şau£IdxInMLN
)

1149 
	gút
 =

1150 ((
CÏu£
*)
şau£
)->
couÁDiffNumTrueGroundšgs
(&
gndP»d
, 
domaš
, 
db
,

1151 
DB_HAS_UNKNOWN_PREDS
,

1152 
§m¶eCÏu£s
, 
c
,

1154 
NULL
);

1155 ià(
	gt›dCÏu£s
)

1157 
	gtc
 = 0;ø< 
	gt›dCÏu£s
->
size
();c++)

1159 
boŞ
 
	gnoP»d
 = 
Œue
;

1160 
CÏu£
* 
	gt›dCÏu£
 = (*
t›dCÏu£s
)[
tc
];

1161 cÚ¡ 
	gA¼ay
<
	gP»diÿ‹
*>* 
	g´eds
 = 
t›dCÏu£
->
g‘P»diÿ‹s
();

1162 
	gp
 = 0;… < 
	g´eds
->
size
();…++)

1164 ià((*
	g´eds
)[
p
]->
ÿnBeGroundedAs
(&
gndP»d
))

1166 
	gnoP»d
 = 
çl£
;

1171 ià(
	gnoP»d
) ;

1172 
	gút
 +ğ
t›dCÏu£
->
couÁDiffNumTrueGroundšgs
(&
gndP»d
, 
domaš
, 
db
,

1173 
DB_HAS_UNKNOWN_PREDS
,

1174 
§m¶eCÏu£s
, 
c
, 
NULL
);

1179 ià(
	gút
 != 0)

1182 
gA¼
->
­³nd
(
Ãw
 
IndexAndCouÁ
(
şau£IdxInMLN
, 
út
));

1183 ià(
	gundoInfos
)

1184 
	gundoInfos
->
­³nd
(
Ãw
 
UndoInfo
(
gA¼
, 
NULL
, -1, 
domašIdx
));

1186 ià(
	gÿche
)

1188 
	gA¼ay
<
	gCacheCouÁ
*>*& 
	gccA¼
 = (*(*
ÿche
)[
domašIdx
])[
´edId
];

1189 ià(
	gccA¼
 =ğ
NULL
è
ccA¼
 = 
Ãw
 
A¼ay
<
CacheCouÁ
*>;

1190 
	gccA¼
->
­³nd
(
Ãw
 
CacheCouÁ
(
g
, 
c
, 
út
));

1194 
as£¹
(
noR•—‹dIndex
(
gA¼
));

1197  
	gŒue
;

1202 
boŞ
 
»moveCouÁs
(* cÚ¡ & 
şau£IdxInMLN
, cÚ¡ & 
´edId
,

1203 cÚ¡ & 
g
, cÚ¡ & 
domašIdx
,

1204 
A¼ay
<
UndoInfo
*>* cÚ¡ & 
undoInfos
)

1206 
boŞ
 
	g»moved
 = 
çl£
;

1207 
	gA¼ay
<A¼ay<A¼ay<A¼ay<
	gIndexAndCouÁ
*>*>*>*>* 
	ggndP»dCÏu£IndexesAndCouÁs


1208 ğ(*
gndP»dCÏu£IndexesAndCouÁsA¼_
)[
domašIdx
];

1210 ià((*
	ggndP»dCÏu£IndexesAndCouÁs
)[
´edId
] =ğ
NULL
è 
çl£
;

1212 
	gA¼ay
<A¼ay<
	gIndexAndCouÁ
*>*>* 
	gcomboCÏu£IndexesAndCouÁs


1213 ğ(*(*
gndP»dCÏu£IndexesAndCouÁs
)[
´edId
])[
g
];

1215 
	gc
 = 0; c < 
	gcomboCÏu£IndexesAndCouÁs
->
size
(); c++)

1217 
	gA¼ay
<
	gIndexAndCouÁ
*>* 
	ggA¼
 =(*
comboCÏu£IndexesAndCouÁs
)[
c
];

1218 
	gi
 = 0; i < 
	ggA¼
->
size
(); i++)

1220 ià((*
	ggA¼
)[
i
]->
	gšdex
 =ğ
şau£IdxInMLN
)

1222 
IndexAndCouÁ
* 
ic
 = 
gA¼
->
»moveI‹mFa¡DisÜd”
(
i
);

1224 ià(
	gundoInfos
)

1226 
	gundoInfos
->
­³nd
(
Ãw
 
UndoInfo
(
gA¼
, 
ic
, 
i
, 
domašIdx
));

1227 
as£¹
(
noR•—‹dIndex
(
gA¼
));

1229 
	g»moved
 = 
Œue
;

1233 
d–‘e
 
	gic
;

1234 
as£¹
(
noR•—‹dIndex
(
gA¼
));

1236 
	g»moved
 = 
Œue
;

1240 
as£¹
(
noR•—‹dIndex
(
gA¼
));

1244  
	g»moved
;

1248 
ü—‹P»dAÎT”msA»DiffV¬s
(cÚ¡ 
CÏu£
* cÚ¡ & 
c
,

1249 
A¼ay
<
boŞ
>& 
´edAÎT”msA»DiffV¬s
,

1250 
A¼ay
<>& 
´edIdxW™hAÎT”msDiffV¬s
)

1252 
	gp
 = 0;… < 
	gc
->
g‘NumP»diÿ‹s
();…++)

1254 
P»diÿ‹
* 
	g´ed
 = 
c
->
g‘P»diÿ‹
(
p
);

1255 
boŞ
 
	g®lDiffV¬s
;

1257 ià(
	gc
->
isDœty
())

1260 
	g®lDiffV¬s
 = 
´ed
->
checkAÎT”msA»DiffV¬s
();

1264 
as£¹
(!
´ed
->
isDœty
());

1265 
	g®lDiffV¬s
 = 
´ed
->
®lT”msA»DiffV¬s
();

1268 
	g´edAÎT”msA»DiffV¬s
.
­³nd
(
®lDiffV¬s
);

1269 ià(
	g®lDiffV¬s
)

1271 
	g´edId
 = 
´ed
->
g‘Id
();

1272 ià(
	g´edIdxW™hAÎT”msDiffV¬s
[
´edId
] < 0)

1273 
	g´edIdxW™hAÎT”msDiffV¬s
[
´edId
] = 
p
;

1276 
	g´edAÎT”msA»DiffV¬s
.
com´ess
();

1280 
ü—‹MuÉl›rs
(
A¼ay
<>& 
muÉl›rs
,

1281 cÚ¡ 
P»diÿ‹
& 
gndP»d
,

1282 cÚ¡ 
Domaš
* cÚ¡ & 
domaš
)

1284 
	gmuÉ
 = 1;

1285 
	gnumT”ms
 = 
gndP»d
.
g‘NumT”ms
();

1286 
	gmuÉl›rs
.
growToSize
(
numT”ms
);

1287 
	gj
 = 
numT”ms
-1; j >= 0; j--)

1289 
	gmuÉl›rs
[
j
] = 
muÉ
;

1290 
	gty³Id
 = 
gndP»d
.
g‘T”mTy³AsIÁ
(
j
);

1291 
	gmuÉ
 *ğ
domaš
->
g‘NumCÚ¡ªtsByTy³
(
ty³Id
);

1296 
ü—‹M­pšgOfV¬IdToMuÉl›rsAndV¬GroundšgsAndOff£t
(

1297 cÚ¡ 
P»diÿ‹
& 
gndP»d
,

1298 cÚ¡ 
Domaš
* cÚ¡ & 
domaš
,

1299 
A¼ay
<>& 
muÉl›rs
,

1300 & 
off£tDueToCÚ¡ªts
,

1301 
A¼ay
<A¼ay<
·œ
<,
T”m
*> >* >& 
v¬IdToMuÉs
,

1302 
A¼ay
<>& 
ÃgV¬IdsA¼
,

1303 
A¼aysAcûssÜ
<>& 
groundšgs
)

1305 
	gj
 = 0; j < 
	ggndP»d
.
g‘NumT”ms
(); j++)

1307 cÚ¡ 
T”m
* 
	gt
 = 
gndP»d
.
g‘T”m
(
j
);

1308 ià(
	gt
->
g‘Ty³
(è=ğ
T”m
::
VARIABLE
)

1310 
as£¹
(
t
->
g‘Id
()<0);

1311 
	gid
 = -(
t
->
g‘Id
());

1312 ià(
	gid
 >ğ
v¬IdToMuÉs
.
size
()èv¬IdToMuÉs.
growToSize
(
id
+1,
NULL
);

1313 ià(
	gv¬IdToMuÉs
[
id
] =ğ
NULL
)

1315 
ÃgV¬IdsA¼
.
­³nd
(
id
);

1316 
	gv¬IdToMuÉs
[
id
] = 
Ãw
 
A¼ay
<
·œ
<,
	gT”m
*> >;

1317 
	gty³Id
 = 
gndP»d
.
g‘T”mTy³AsIÁ
(
j
);

1318 cÚ¡ 
	gA¼ay
<>* 
	gcÚ¡ªts
 = 
domaš
->
g‘CÚ¡ªtsByTy³
(
ty³Id
);

1319 
	ggroundšgs
.
­³ndA¼ay
(
cÚ¡ªts
);

1321 
	gv¬IdToMuÉs
[
id
]->
­³nd
(
·œ
<,
T”m
*>(
muÉl›rs
[
j
], (T”m*)
t
));

1324 ià(
	gt
->
g‘Ty³
(è=ğ
T”m
::
CONSTANT
)

1326 
id
 = 
t
->
g‘Id
();

1327 
as£¹
(
id
 >= 0);

1328 
	gty³Id
 = 
gndP»d
.
g‘T”mTy³AsIÁ
(
j
);

1329 cÚ¡ 
	gA¼ay
<>* 
	gcÚ¡ªts
 = 
domaš
->
g‘CÚ¡ªtsByTy³
(
ty³Id
);

1330 
as£¹
(
cÚ¡ªts
->
size
() > 0);

1333 
	gi
 = 0; i < 
	gcÚ¡ªts
->
size
(); i++)

1335 ià((*
	gcÚ¡ªts
)[
i
] =ğ
id
)

1337 
off£tDueToCÚ¡ªts
 +ğ
i
*
muÉl›rs
[
j
];

1345 
as£¹
(
çl£
);

1351 
	$¿ndomlyS–eù
(
IÁHashA¼ay
& 
gndšgs
, cÚ¡ & 
äaùiÚ
,

1352 cÚ¡ & 
mš
, cÚ¡ & 
max
)

1354 
size
 = (
äaùiÚ
 * 
gndšgs
.
	`size
() + 0.5);

1355 ià(
mš
 >ğ0 && 
size
 < min) size = min;

1356 ià(
max
 >ğ0 && 
size
 > max) size = max;

1357 
gndšgs
.
	`size
(è> 
size
)

1358 
gndšgs
.
	`»moveI‹mFa¡DisÜd”
(
¿ndom_
->
	`¿ndomOÃOf
(gndšgs.
	`size
()));

1359 
	}
}

1362 
	$§m¶eP»dGroundšgsFÜDomaš
(cÚ¡ 
P»diÿ‹
* cÚ¡& 
foP»d
,

1363 cÚ¡ 
Domaš
* cÚ¡ & 
domaš
,

1364 
Sam¶edGndšgs
* 
§m¶edGndšgs
,

1365 cÚ¡ & 
äaùiÚ
,

1366 cÚ¡ & 
mš
, cÚ¡ & 
max
)

1368 
cout
 << "§m¶šg…»diÿ‹ "; 
foP»d
->
	`´štW™hSŒV¬
(cout, 
domaš
);

1369 
cout
 << 
’dl
;

1371 
	`as£¹
(((
P»diÿ‹
*)
foP»d
)->
	`®lT”msA»DiffV¬s
());

1372 
A¼aysAcûssÜ
<> 
acc
;

1373 
	`ü—‹AÎPossibËP»dsGroundšgs
(
foP»d
, 
domaš
, 
acc
);

1374 
P»diÿ‹
* 
gndP»d
 = (P»diÿ‹*è
foP»d
;

1375 cÚ¡ 
D©aba£
* 
db
 = 
domaš
->
	`g‘DB
();

1377 
IÁHashA¼ay
& 
ŒueGndšgs
 = 
§m¶edGndšgs
->trueGndings;

1378 
IÁHashA¼ay
& 
çl£Gndšgs
 = 
§m¶edGndšgs
->falseGndings;

1380 
g
 = -1;

1381 
acc
.
	`hasNextCombš©iÚ
())

1383 ++
g
;

1384 
t
 = 0;

1385 
cÚ¡Id
;

1386 
acc
.
	`ÃxtI‹mInCombš©iÚ
(
cÚ¡Id
))

1387 ((
T”m
*è
gndP»d
->
	`g‘T”m
(
t
++))->
	`£tId
(
cÚ¡Id
);

1389 
TruthV®ue
 
tv
 = 
db
->
	`g‘V®ue
(
gndP»d
);

1390 ià(
tv
 =ğ
TRUE
è
ŒueGndšgs
.
	`­³nd
(
g
);

1391 ià(
tv
 =ğ
FALSE
è
çl£Gndšgs
.
	`­³nd
(
g
);

1395 
§m¶edGndšgs
->
tÙ®True
 = 
ŒueGndšgs
.
	`size
();

1396 
§m¶edGndšgs
->
tÙ®F®£
 = 
çl£Gndšgs
.
	`size
();

1397 
	`¿ndomlyS–eù
(
ŒueGndšgs
, 
äaùiÚ
, 
mš
, 
max
);

1398 
	`¿ndomlyS–eù
(
çl£Gndšgs
, 
äaùiÚ
, 
mš
, 
max
);

1399 
ŒueGndšgs
.
	`com´ess
();

1400 
çl£Gndšgs
.
	`com´ess
();

1402 
cout
 << "\tsampled/total (true ground‡toms) = "

1403 << 
ŒueGndšgs
.
	`size
(è<< "/" << 
§m¶edGndšgs
->
tÙ®True
 << 
’dl
;

1404 
cout
 << "\tsampled/total (false ground‡toms) = "

1405 << 
çl£Gndšgs
.
	`size
(è<< "/" << 
§m¶edGndšgs
->
tÙ®F®£
 << 
’dl
;

1406 
	}
}

1409 
	$§m¶eP»dGroundšgs
(cÚ¡ & 
äaùiÚ
,

1410 cÚ¡ & 
mš
, cÚ¡ & 
max
)

1412 
d
 = 0; d < 
domašs_
->
	`size
(); d++)

1414 
cout
 << "domaš " << 
d
 << 
’dl
;

1415 cÚ¡ 
Domaš
* 
domaš
 = (*
domašs_
)[
d
];

1416 
A¼ay
<
Sam¶edGndšgs
*>* 
sgm
 = (*
§m¶edGndšgsM­s_
)[
d
];

1417 
p
 = 0;… < 
domaš
->
	`g‘NumP»diÿ‹s
();…++)

1419 ià(!(*
¬eNÚEvidP»ds_
)[
p
]) ;

1420 
Sam¶edGndšgs
* 
sg
 = 
Ãw
 SampledGndings;

1421 
	`as£¹
((*
sgm
)[
p
] =ğ
NULL
);

1422 (*
sgm
)[
p
] = 
sg
;

1423 
P»diÿ‹
* 
foP»d
 = 
domaš
->
	`ü—‹P»diÿ‹
(
p
, 
Œue
);

1424 
	`as£¹
(
foP»d
);

1425 
	`§m¶eP»dGroundšgsFÜDomaš
(
foP»d
, 
domaš
, 
sg
, 
äaùiÚ
, 
mš
, 
max
);

1426 
d–‘e
 
foP»d
;

1429 
	}
}

1432 
boŞ
 
noR•—‹dIndex
(cÚ¡ 
A¼ay
<
IndexAndCouÁ
*>* cÚ¡ & 
gA¼
,

1433 cÚ¡ 
MLN
* cÚ¡ & 
mÊ0
=
NULL
)

1435 
hash_£t
<> 
£t
;

1436 
	gi
 = 0; i < 
	ggA¼
->
size
(); i++)

1438 
	gii
 = *((*
gA¼
)[
i
]->
šdex
);

1439 ià(
	g£t
.
fšd
(
ii
è!ğ
£t
.
’d
())

1441 
cout
 << "ERROR: in PseudoLogLikelihood::noRepeatedIndex. "

1442 << "R•—‹d index " << 
ii
 << " found. ";

1443 ià(
	gmÊ0
)

1444 
	gmÊ0
->
g‘CÏu£
(
ii
)->
´štW™houtWtW™hSŒV¬
(
cout
, (*
domašs_
)[0]);

1445 
	gcout
 << 
	g’dl
;

1446  
	gçl£
;

1448 
	g£t
.
š£¹
(
ii
);

1450  
	gŒue
;

1454 
	$´štWtsG¿dsWPLL
(cÚ¡ * cÚ¡ & 
wts
, cÚ¡ * cÚ¡ & 
g¿ds
,

1455 cÚ¡ & 
¬rSize
, cÚ¡ & 
w¶l
)

1457 
cout
.
	`´ecisiÚ
(10);

1458 
cout
 << "wt ğ" << 
’dl
;

1459 
i
 = 0; i < 
¬rSize
; i++è
cout
 << " " << i << ":" << 
wts
[i];

1460 
cout
 << 
’dl
;

1461 
cout
 << "g¿d ğ" << 
’dl
;

1462 
i
 = 0; i < 
¬rSize
; i++è
cout
 << " " << i << ":" << 
g¿ds
[i];

1463 
cout
 << 
’dl
;

1464 
cout
 << "w¶Èğ" << 
w¶l
 << 
’dl
;

1465 
cout
 << 
’dl
;

1466 
cout
.
	`´ecisiÚ
(6);

1467 
	}
}

1470 
	g´iv©e
:

1471 
A¼ay
<
boŞ
>* 
¬eNÚEvidP»ds_
;

1474 
	gA¼ay
<
	gDomaš
*>* 
	gdomašs_
;

1484 
	gA¼ay
<A¼ay<A¼ay<A¼ay<A¼ay<
	gIndexAndCouÁ
*>*>*>*>*>*

1485 
	ggndP»dCÏu£IndexesAndCouÁsA¼_
;

1487 
	gnumM—ns_
;

1488 cÚ¡ * 
	g´iÜM—ns_
;

1489 cÚ¡ * 
	g´iÜStdDevs_
;

1490 cÚ¡ 
boŞ
* 
	glockedWts_
;

1492 
boŞ
 
	gwtFOP»d_
;

1493 
	gA¼ay
<A¼ay<>*>* 
	gnumGndšgs_
;

1495 
boŞ
 
	g§m¶eGndP»ds_
;

1498 
	gA¼ay
<A¼ay<
	gSam¶edGndšgs
*>*>* 
	g§m¶edGndšgsM­s_
;

1499 
Rªdom
* 
	g¿ndom_
;

1501 
IndexT¿n¦©Ü
* 
	gidxT¿ns_
;

	@
1
.
1
/usr/include
7
106
discriminativelearner.h
indextranslator.h
lbfgsb.h
lbfgsp.h
learnwts.cpp
learnwts.h
pseudologlikelihood.h
